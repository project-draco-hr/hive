{
  String smcUrl=conf.get(FBHiveConf.METASTORE_SMC_URL);
  if (smcUrl == null) {
    throw new Exception(FBHiveConf.METASTORE_SMC_URL + " is not defined");
  }
  String mysqlTier=conf.get(FBHiveConf.METASTORE_MYSQL_TIER_VAR_NAME);
  if (mysqlTier == null) {
    throw new Exception(FBHiveConf.METASTORE_MYSQL_TIER_VAR_NAME + " is not defined");
  }
  String mysqlProps=conf.get(FBHiveConf.METASTORE_MYSQL_PROPS);
  if (mysqlProps == null) {
    throw new Exception(FBHiveConf.METASTORE_MYSQL_PROPS + " is not defined");
  }
  if (urlFactory == null) {
    urlFactory=HookUtils.getUrlFactory(conf,FBHiveConf.CONNECTION_FACTORY,null,FBHiveConf.METASTORE_MYSQL_TIER_VAR_NAME,null,FBHiveConf.METASTORE_MYSQL_PROPS);
  }
  urlFactory.updateProps(smcUrl,mysqlTier,mysqlProps);
  return urlFactory.getUrl();
}
