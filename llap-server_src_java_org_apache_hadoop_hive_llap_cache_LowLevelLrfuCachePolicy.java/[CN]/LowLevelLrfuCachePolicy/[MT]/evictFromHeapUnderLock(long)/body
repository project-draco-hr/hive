{
  while (true) {
    if (heapSize == 0)     return null;
    LlapCacheableBuffer result=heap[0];
    if (LlapIoImpl.CACHE_LOGGER.isTraceEnabled()) {
      LlapIoImpl.CACHE_LOGGER.info("Evicting {} at {}",result,time);
    }
    result.indexInHeap=LlapCacheableBuffer.NOT_IN_CACHE;
    --heapSize;
    boolean canEvict=result.invalidate();
    if (heapSize > 0) {
      LlapCacheableBuffer newRoot=heap[heapSize];
      newRoot.indexInHeap=0;
      if (newRoot.lastUpdate != time) {
        newRoot.priority=expirePriority(time,newRoot.lastUpdate,newRoot.priority);
        newRoot.lastUpdate=time;
      }
      heapifyDownUnderLock(newRoot,time);
    }
    if (canEvict)     return result;
  }
}
