{
  if (authenticatedUser == null) {
    return newConnectionImpl(authenticatedUser,createPartIfNotExists,conf);
  }
  try {
    return authenticatedUser.doAs(new PrivilegedExceptionAction<StreamingConnection>(){
      @Override public StreamingConnection run() throws ConnectionError, InvalidPartition, InvalidTable, PartitionCreationFailed {
        return newConnectionImpl(authenticatedUser,createPartIfNotExists,conf);
      }
    }
);
  }
 catch (  IOException e) {
    throw new ConnectionError("Failed to connect as : " + authenticatedUser.getShortUserName(),e);
  }
}
