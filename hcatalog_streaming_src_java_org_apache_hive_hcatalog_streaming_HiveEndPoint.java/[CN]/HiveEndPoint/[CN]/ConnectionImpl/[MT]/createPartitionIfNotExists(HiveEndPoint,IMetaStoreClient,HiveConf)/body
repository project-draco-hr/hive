{
  if (ep.partitionVals.isEmpty()) {
    return;
  }
  SessionState localSession=null;
  if (SessionState.get() == null) {
    localSession=SessionState.start(new CliSessionState(conf));
  }
  Driver driver=new Driver(conf);
  try {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Attempting to create partition (if not existent) " + ep);
    }
    List<FieldSchema> partKeys=msClient.getTable(ep.database,ep.table).getPartitionKeys();
    runDDL(driver,"use " + ep.database);
    String query="alter table " + ep.table + " add if not exists partition "+ partSpecStr(partKeys,ep.partitionVals);
    runDDL(driver,query);
  }
 catch (  MetaException e) {
    LOG.error("Failed to create partition : " + ep,e);
    throw new PartitionCreationFailed(ep,e);
  }
catch (  NoSuchObjectException e) {
    LOG.error("Failed to create partition : " + ep,e);
    throw new InvalidTable(ep.database,ep.table);
  }
catch (  TException e) {
    LOG.error("Failed to create partition : " + ep,e);
    throw new PartitionCreationFailed(ep,e);
  }
catch (  QueryFailedException e) {
    LOG.error("Failed to create partition : " + ep,e);
    throw new PartitionCreationFailed(ep,e);
  }
 finally {
    driver.close();
    try {
      if (localSession != null) {
        localSession.close();
      }
    }
 catch (    IOException e) {
      LOG.warn("Error closing SessionState used to run Hive DDL.");
    }
  }
}
