{
  validateFunctionInfo(func);
  boolean success=false;
  RawStore ms=getMS();
  try {
    ms.openTransaction();
    Database db=ms.getDatabase(func.getDbName());
    if (db == null) {
      throw new NoSuchObjectException("The database " + func.getDbName() + " does not exist");
    }
    Function existingFunc=ms.getFunction(func.getDbName(),func.getFunctionName());
    if (existingFunc != null) {
      throw new AlreadyExistsException("Function " + func.getFunctionName() + " already exists");
    }
    long time=System.currentTimeMillis() / 1000;
    func.setCreateTime((int)time);
    ms.createFunction(func);
    success=ms.commitTransaction();
  }
  finally {
    if (!success) {
      ms.rollbackTransaction();
    }
  }
}
