{
  String db=parts.get(0).getDbName();
  String tbl=parts.get(0).getTableName();
  logInfo("add_partitions : db=" + db + " tbl="+ tbl);
  boolean success=false;
  Map<Partition,Boolean> addedPartitions=new HashMap<Partition,Boolean>();
  try {
    ms.openTransaction();
    for (    Partition part : parts) {
      Entry<Partition,Boolean> e=add_partition_core_notxn(ms,part,null);
      addedPartitions.put(e.getKey(),e.getValue());
    }
    success=true;
    ms.commitTransaction();
  }
  finally {
    if (!success) {
      ms.rollbackTransaction();
      for (      Entry<Partition,Boolean> e : addedPartitions.entrySet()) {
        if (e.getValue()) {
          wh.deleteDir(new Path(e.getKey().getSd().getLocation()),true);
        }
      }
    }
  }
  return parts.size();
}
