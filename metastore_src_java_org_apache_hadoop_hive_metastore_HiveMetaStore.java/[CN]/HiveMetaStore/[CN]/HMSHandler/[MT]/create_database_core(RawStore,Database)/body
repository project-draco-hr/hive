{
  if (!validateName(db.getName())) {
    throw new InvalidObjectException(db.getName() + " is not a valid database name");
  }
  boolean success=false;
  try {
    ms.openTransaction();
    if (null == db.getLocationUri()) {
      db.setLocationUri(wh.getDefaultDatabasePath(db.getName()).toString());
    }
    ms.createDatabase(db);
    success=ms.commitTransaction();
  }
  finally {
    if (!success) {
      ms.rollbackTransaction();
    }
 else {
      wh.mkdirs(new Path(db.getLocationUri()));
    }
    for (    MetaStoreEventListener listener : listeners) {
      listener.onCreateDatabase(new CreateDatabaseEvent(db,success,this));
    }
  }
}
