{
  this.incrementCounter("create_table");
  logStartFunction("create_table: db=" + tbl.getDatabase() + " tbl="+ tbl.getTableName());
  boolean success=false;
  if (!MetaStoreUtils.validateName(tbl.getTableName())) {
    throw new InvalidObjectException(tbl.getTableName() + " is not a valid object name");
  }
  try {
    getMS().openTransaction();
    Path tblPath=null;
    if (tbl.getSd().getLocation() == null || tbl.getSd().getLocation().isEmpty()) {
      tblPath=wh.getDefaultTablePath(tbl.getDatabase(),tbl.getTableName());
      tbl.getSd().setLocation(tblPath.toString());
    }
 else {
      tblPath=new Path(tbl.getSd().getLocation());
    }
    try {
      if (get_table(tbl.getDatabase(),tbl.getTableName()) != null) {
        throw new AlreadyExistsException("Table " + tbl.getTableName() + " already exists");
      }
    }
 catch (    NoSuchObjectException e) {
    }
    getMS().createTable(tbl);
    if (wh.mkdirs(tblPath)) {
      success=getMS().commitTransaction();
    }
  }
  finally {
    if (!success) {
      getMS().rollbackTransaction();
    }
  }
}
