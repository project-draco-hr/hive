{
  boolean ret=true;
  List<ColumnStatistics> csNews=request.getColStats();
  if (csNews == null || csNews.isEmpty()) {
    return ret;
  }
  ColumnStatistics firstColStats=csNews.get(0);
  ColumnStatisticsDesc statsDesc=firstColStats.getStatsDesc();
  String dbName=statsDesc.getDbName();
  String tableName=statsDesc.getTableName();
  List<String> colNames=new ArrayList<>();
  for (  ColumnStatisticsObj obj : firstColStats.getStatsObj()) {
    colNames.add(obj.getColName());
  }
  if (statsDesc.isIsTblLevel()) {
    if (request.getColStatsSize() != 1) {
      throw new MetaException("Expecting only 1 ColumnStatistics for table's column stats, but find " + request.getColStatsSize());
    }
 else {
      if (request.isSetNeedMerge() && request.isNeedMerge()) {
        ColumnStatistics csOld=getMS().getTableColumnStatistics(dbName,tableName,colNames);
        if (csOld != null && csOld.getStatsObjSize() != 0) {
          MetaStoreUtils.mergeColStats(firstColStats,csOld);
        }
      }
      return update_table_column_statistics(firstColStats);
    }
  }
 else {
    List<String> partitionNames=new ArrayList<>();
    for (    ColumnStatistics csNew : csNews) {
      partitionNames.add(csNew.getStatsDesc().getPartName());
    }
    Map<String,ColumnStatistics> map=new HashMap<>();
    if (request.isSetNeedMerge() && request.isNeedMerge()) {
      List<ColumnStatistics> csOlds=getMS().getPartitionColumnStatistics(dbName,tableName,partitionNames,colNames);
      if (csNews.size() != csOlds.size()) {
        LOG.debug("Some of the partitions miss stats.");
      }
      for (      ColumnStatistics csOld : csOlds) {
        map.put(csOld.getStatsDesc().getPartName(),csOld);
      }
    }
    Table t=getTable(dbName,tableName);
    for (int index=0; index < csNews.size(); index++) {
      ColumnStatistics csNew=csNews.get(index);
      ColumnStatistics csOld=map.get(csNew.getStatsDesc().getPartName());
      if (csOld != null && csOld.getStatsObjSize() != 0) {
        MetaStoreUtils.mergeColStats(csNew,csOld);
      }
      ret=ret && updatePartitonColStats(t,csNew);
    }
  }
  return ret;
}
