{
  boolean success=false;
  Database db=null;
  try {
    ms.openTransaction();
    db=ms.getDatabase(name);
    if (!get_all_tables(db.getName()).isEmpty()) {
      throw new InvalidOperationException("Database " + db.getName() + " is not empty");
    }
    Path path=new Path(db.getLocationUri()).getParent();
    if (!wh.isWritable(path)) {
      throw new MetaException("Database not dropped since " + path + " is not writable by "+ hiveConf.getUser());
    }
    if (ms.dropDatabase(name)) {
      success=ms.commitTransaction();
    }
  }
  finally {
    if (!success) {
      ms.rollbackTransaction();
    }
 else     if (deleteData) {
      wh.deleteDir(new Path(db.getLocationUri()),true);
    }
  }
}
