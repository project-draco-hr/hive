{
  try {
    int minWorkerThreads=conf.getIntVar(HiveConf.ConfVars.METASTORESERVERMINTHREADS);
    int maxWorkerThreads=conf.getIntVar(HiveConf.ConfVars.METASTORESERVERMAXTHREADS);
    boolean tcpKeepAlive=conf.getBoolVar(HiveConf.ConfVars.METASTORE_TCP_KEEP_ALIVE);
    useSasl=conf.getBoolVar(HiveConf.ConfVars.METASTORE_USE_THRIFT_SASL);
    TServerTransport serverTransport=tcpKeepAlive ? new TServerSocketKeepAlive(port) : new TServerSocket(port);
    TProcessor processor;
    TTransportFactory transFactory;
    if (useSasl) {
      saslServer=bridge.createServer(conf.getVar(HiveConf.ConfVars.METASTORE_KERBEROS_KEYTAB_FILE),conf.getVar(HiveConf.ConfVars.METASTORE_KERBEROS_PRINCIPAL));
      saslServer.startDelegationTokenSecretManager(conf);
      transFactory=saslServer.createTransportFactory();
      processor=saslServer.wrapProcessor(new ThriftHiveMetastore.Processor(new HMSHandler("new db based metaserver",conf)));
    }
 else {
      processor=new ThriftHiveMetastore.Processor(new HMSHandler("new db based metaserver",conf));
      transFactory=new TTransportFactory();
    }
    TThreadPoolServer.Args args=new TThreadPoolServer.Args(serverTransport).processor(processor).transportFactory(transFactory).protocolFactory(new TBinaryProtocol.Factory()).minWorkerThreads(minWorkerThreads).maxWorkerThreads(maxWorkerThreads);
    TServer tServer=new TThreadPoolServer(args);
    HMSHandler.LOG.info("Started the new metaserver on port [" + port + "]...");
    HMSHandler.LOG.info("Options.minWorkerThreads = " + minWorkerThreads);
    HMSHandler.LOG.info("Options.maxWorkerThreads = " + maxWorkerThreads);
    HMSHandler.LOG.info("TCP keepalive = " + tcpKeepAlive);
    tServer.serve();
  }
 catch (  Throwable x) {
    x.printStackTrace();
    HMSHandler.LOG.error(StringUtils.stringifyException(x));
    throw x;
  }
}
