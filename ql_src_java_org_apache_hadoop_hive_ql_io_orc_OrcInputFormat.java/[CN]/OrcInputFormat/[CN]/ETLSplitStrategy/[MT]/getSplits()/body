{
  List<SplitInfo> result=new ArrayList<>(files.size());
  FooterCache cache=context.cacheStripeDetails ? (deltas == null ? context.footerCache : Context.localCache) : null;
  if (cache != null) {
    FileInfo[] infos=cache.getAndValidate(files);
    int dirIx=-1, fileInDirIx=-1, filesInDirCount=0;
    ETLDir dir=null;
    for (int i=0; i < files.size(); ++i) {
      if ((++fileInDirIx) == filesInDirCount) {
        dir=dirs.get(++dirIx);
        filesInDirCount=dir.fileCount;
      }
      FileInfo info=infos[i];
      if (info != null) {
        context.cacheHitCounter.incrementAndGet();
      }
      HdfsFileStatusWithId file=files.get(i);
      if (file.getFileStatus().getLen() > 0) {
        result.add(new SplitInfo(context,dir.fs,file,info,isOriginal,deltas,true,dir.dir,covered));
      }
    }
  }
 else {
    int dirIx=-1, fileInDirIx=-1, filesInDirCount=0;
    ETLDir dir=null;
    for (    HdfsFileStatusWithId file : files) {
      if ((++fileInDirIx) == filesInDirCount) {
        dir=dirs.get(++dirIx);
        filesInDirCount=dir.fileCount;
      }
      if (file.getFileStatus().getLen() > 0) {
        result.add(new SplitInfo(context,dir.fs,file,null,isOriginal,deltas,true,dir.dir,covered));
      }
    }
  }
  return result;
}
