{
  Context context=new Context(job);
  for (  Path dir : getInputPaths(job)) {
    FileSystem fs=dir.getFileSystem(job);
    context.schedule(new FileGenerator(context,fs,dir));
  }
  context.waitForTasks();
  if (!context.errors.isEmpty()) {
    List<IOException> errors=new ArrayList<IOException>(context.errors.size());
    for (    Throwable th : context.errors) {
      if (th instanceof IOException) {
        errors.add((IOException)th);
      }
 else {
        throw new IOException("serious problem",th);
      }
    }
    throw new InvalidInputException(errors);
  }
  InputSplit[] result=new InputSplit[context.splits.size()];
  context.splits.toArray(result);
  return result;
}
