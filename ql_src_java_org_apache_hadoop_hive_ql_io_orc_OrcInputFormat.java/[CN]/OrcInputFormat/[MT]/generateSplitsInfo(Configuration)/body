{
  Context context=new Context(conf);
  for (  Path dir : getInputPaths(conf)) {
    FileSystem fs=dir.getFileSystem(conf);
    context.schedule(new FileGenerator(context,fs,dir));
  }
  context.waitForTasks();
  if (!context.errors.isEmpty()) {
    List<IOException> errors=new ArrayList<IOException>(context.errors.size());
    for (    Throwable th : context.errors) {
      if (th instanceof IOException) {
        errors.add((IOException)th);
      }
 else {
        throw new RuntimeException("serious problem",th);
      }
    }
    throw new InvalidInputException(errors);
  }
  if (context.cacheStripeDetails) {
    LOG.info("FooterCacheHitRatio: " + context.cacheHitCounter.get() + "/"+ context.numFilesCounter.get());
  }
  return context.splits;
}
