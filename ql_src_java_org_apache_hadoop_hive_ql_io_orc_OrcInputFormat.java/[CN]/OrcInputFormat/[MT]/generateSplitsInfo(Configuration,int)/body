{
  if (HiveConf.getBoolVar(conf,HiveConf.ConfVars.HIVE_ORC_MS_FOOTER_CACHE_ENABLED)) {
    conf=new HiveConf(conf,OrcInputFormat.class);
  }
  Context context=new Context(conf,numSplits);
  if (LOG.isInfoEnabled()) {
    LOG.info("ORC pushdown predicate: " + context.sarg);
  }
  boolean useFileIds=HiveConf.getBoolVar(conf,ConfVars.HIVE_ORC_INCLUDE_FILE_ID_IN_SPLITS);
  List<OrcSplit> splits=Lists.newArrayList();
  List<Future<AcidDirInfo>> pathFutures=Lists.newArrayList();
  List<Future<Void>> strategyFutures=Lists.newArrayList();
  final List<Future<List<OrcSplit>>> splitFutures=Lists.newArrayList();
  Path[] paths=getInputPaths(conf);
  CompletionService<AcidDirInfo> ecs=new ExecutorCompletionService<>(Context.threadPool);
  for (  Path dir : paths) {
    FileSystem fs=dir.getFileSystem(conf);
    FileGenerator fileGenerator=new FileGenerator(context,fs,dir,useFileIds);
    pathFutures.add(ecs.submit(fileGenerator));
  }
  try {
    for (int notIndex=0; notIndex < paths.length; ++notIndex) {
      AcidDirInfo adi=ecs.take().get();
      SplitStrategy<?> splitStrategy=determineSplitStrategy(context,adi.fs,adi.splitPath,adi.acidInfo,adi.baseOrOriginalFiles);
      if (isDebugEnabled) {
        LOG.debug("Split strategy: ",splitStrategy);
      }
      if (splitStrategy instanceof ETLSplitStrategy) {
        Future<Void> ssFuture=((ETLSplitStrategy)splitStrategy).generateSplitWork(context,splitFutures);
        if (ssFuture != null) {
          strategyFutures.add(ssFuture);
        }
      }
 else {
        @SuppressWarnings("unchecked") List<OrcSplit> readySplits=(List<OrcSplit>)splitStrategy.getSplits();
        splits.addAll(readySplits);
      }
    }
    for (    Future<Void> ssFuture : strategyFutures) {
      ssFuture.get();
    }
    for (    Future<List<OrcSplit>> splitFuture : splitFutures) {
      splits.addAll(splitFuture.get());
    }
  }
 catch (  Exception e) {
    cancelFutures(pathFutures);
    cancelFutures(strategyFutures);
    cancelFutures(splitFutures);
    throw new RuntimeException("ORC split generation failed with exception: " + e.getMessage(),e);
  }
  if (context.cacheStripeDetails) {
    LOG.info("FooterCacheHitRatio: " + context.cacheHitCounter.get() + "/"+ context.numFilesCounter.get());
  }
  if (isDebugEnabled) {
    for (    OrcSplit split : splits) {
      LOG.debug(split + " projected_columns_uncompressed_size: " + split.getColumnarProjectionSize());
    }
  }
  return splits;
}
