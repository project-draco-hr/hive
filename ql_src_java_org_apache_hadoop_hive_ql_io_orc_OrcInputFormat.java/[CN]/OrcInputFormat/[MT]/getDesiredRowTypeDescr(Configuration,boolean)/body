{
  String columnNameProperty=null;
  String columnTypeProperty=null;
  ArrayList<String> schemaEvolutionColumnNames=null;
  ArrayList<TypeDescription> schemaEvolutionTypeDescrs=null;
  boolean haveSchemaEvolutionProperties=false;
  if (isAcidRead || HiveConf.getBoolVar(conf,ConfVars.HIVE_SCHEMA_EVOLUTION)) {
    columnNameProperty=conf.get(IOConstants.SCHEMA_EVOLUTION_COLUMNS);
    columnTypeProperty=conf.get(IOConstants.SCHEMA_EVOLUTION_COLUMNS_TYPES);
    haveSchemaEvolutionProperties=(columnNameProperty != null && columnTypeProperty != null);
    if (haveSchemaEvolutionProperties) {
      schemaEvolutionColumnNames=Lists.newArrayList(columnNameProperty.split(","));
      if (schemaEvolutionColumnNames.size() == 0) {
        haveSchemaEvolutionProperties=false;
      }
 else {
        schemaEvolutionTypeDescrs=typeDescriptionsFromHiveTypeProperty(columnTypeProperty);
        if (schemaEvolutionTypeDescrs.size() != schemaEvolutionColumnNames.size()) {
          haveSchemaEvolutionProperties=false;
        }
      }
    }
 else     if (isAcidRead) {
      throw new IOException(ErrorMsg.SCHEMA_REQUIRED_TO_READ_ACID_TABLES.getErrorCodedMsg());
    }
  }
  if (haveSchemaEvolutionProperties) {
    if (LOG.isInfoEnabled()) {
      LOG.info("Using schema evolution configuration variables schema.evolution.columns " + schemaEvolutionColumnNames.toString() + " / schema.evolution.columns.types "+ schemaEvolutionTypeDescrs.toString()+ " (isAcidRead "+ isAcidRead+ ")");
    }
  }
 else {
    columnNameProperty=conf.get(serdeConstants.LIST_COLUMNS);
    columnTypeProperty=conf.get(serdeConstants.LIST_COLUMN_TYPES);
    if (columnTypeProperty == null || columnNameProperty == null) {
      return null;
    }
    schemaEvolutionColumnNames=Lists.newArrayList(columnNameProperty.split(","));
    if (schemaEvolutionColumnNames.size() == 0) {
      return null;
    }
    schemaEvolutionTypeDescrs=typeDescriptionsFromHiveTypeProperty(columnTypeProperty);
    if (schemaEvolutionTypeDescrs.size() != schemaEvolutionColumnNames.size()) {
      return null;
    }
    int virtualColumnClipNum=-1;
    int columnNum=0;
    for (    String columnName : schemaEvolutionColumnNames) {
      if (VirtualColumn.VIRTUAL_COLUMN_NAMES.contains(columnName)) {
        virtualColumnClipNum=columnNum;
        break;
      }
      columnNum++;
    }
    if (virtualColumnClipNum != -1) {
      schemaEvolutionColumnNames=Lists.newArrayList(schemaEvolutionColumnNames.subList(0,virtualColumnClipNum));
      schemaEvolutionTypeDescrs=Lists.newArrayList(schemaEvolutionTypeDescrs.subList(0,virtualColumnClipNum));
    }
    if (LOG.isInfoEnabled()) {
      LOG.info("Using column configuration variables columns " + schemaEvolutionColumnNames.toString() + " / columns.types "+ schemaEvolutionTypeDescrs.toString()+ " (isAcidRead "+ isAcidRead+ ")");
    }
  }
  TypeDescription result=TypeDescription.createStruct();
  for (int i=0; i < schemaEvolutionColumnNames.size(); i++) {
    result.addField(schemaEvolutionColumnNames.get(i),schemaEvolutionTypeDescrs.get(i));
  }
  return result;
}
