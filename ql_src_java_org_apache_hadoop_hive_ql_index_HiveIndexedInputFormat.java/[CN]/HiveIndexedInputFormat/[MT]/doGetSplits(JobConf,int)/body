{
  super.init(job);
  Path[] dirs=FileInputFormat.getInputPaths(job);
  if (dirs.length == 0) {
    throw new IOException("No input paths specified in job");
  }
  JobConf newjob=new JobConf(job);
  ArrayList<InputSplit> result=new ArrayList<InputSplit>();
  PartitionDesc part;
  for (  Path dir : dirs) {
    part=HiveFileFormatUtils.getPartitionDescFromPathRecursively(pathToPartitionInfo,dir,IOPrepareCache.get().allocatePartitionDescMap(),true);
    Class inputFormatClass=part.getInputFileFormatClass();
    InputFormat inputFormat=getInputFormatFromCache(inputFormatClass,job);
    Utilities.copyTableJobPropertiesToConf(part.getTableDesc(),newjob);
    FileInputFormat.setInputPaths(newjob,dir);
    newjob.setInputFormat(inputFormat.getClass());
    InputSplit[] iss=inputFormat.getSplits(newjob,numSplits / dirs.length);
    for (    InputSplit is : iss) {
      result.add(new HiveInputSplit(is,inputFormatClass.getName()));
    }
  }
  return result.toArray(new HiveInputSplit[result.size()]);
}
