{
  if (bd == null) {
    return null;
  }
  bd=trim(bd);
  int intDigits=bd.precision() - bd.scale();
  if (intDigits > MAX_PRECISION) {
    return null;
  }
  int maxScale=Math.min(MAX_SCALE,Math.min(MAX_PRECISION - intDigits,bd.scale()));
  if (bd.scale() > maxScale) {
    bd=allowRounding ? bd.setScale(maxScale,RoundingMode.HALF_UP) : null;
  }
  return bd;
}
