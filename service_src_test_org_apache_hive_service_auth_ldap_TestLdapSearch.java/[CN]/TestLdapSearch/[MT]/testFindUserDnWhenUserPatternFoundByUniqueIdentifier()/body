{
  conf.setVar(HiveConf.ConfVars.HIVE_SERVER2_PLAIN_LDAP_USERDNPATTERN,"CN=%s,OU=org1,DC=foo,DC=bar");
  NamingEnumeration<SearchResult> validResult=mockNamingEnumeration("CN=User1,OU=org1,DC=foo,DC=bar");
  when(ctx.search(anyString(),anyString(),any(SearchControls.class))).thenReturn(null).thenReturn(validResult);
  search=new LdapSearch(conf,ctx);
  String expected="CN=User1,OU=org1,DC=foo,DC=bar";
  String actual=search.findUserDn("User1");
  assertEquals(expected,actual);
  verify(ctx).search(eq("OU=org1,DC=foo,DC=bar"),contains("CN=User1"),any(SearchControls.class));
  verify(ctx).search(eq("OU=org1,DC=foo,DC=bar"),contains("uid=User1"),any(SearchControls.class));
}
