{
  int tag=GenericData.get().resolveUnion(recordSchema,datum);
  Schema schema=recordSchema.getTypes().get(tag);
  if (schema.getType().equals(Schema.Type.NULL)) {
    return null;
  }
  Schema currentFileSchema=null;
  if (fileSchema != null) {
    if (fileSchema.getType() == Type.UNION) {
      tag=GenericData.get().resolveUnion(fileSchema,datum);
      currentFileSchema=fileSchema.getTypes().get(tag);
    }
 else {
      currentFileSchema=fileSchema;
    }
  }
  return worker(datum,currentFileSchema,schema,SchemaToTypeInfo.generateTypeInfo(schema));
}
