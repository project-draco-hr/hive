{
  int tag=GenericData.get().resolveUnion(recordSchema,datum);
  Schema schema=recordSchema.getTypes().get(tag);
  if (schema.getType().equals(Schema.Type.NULL)) {
    return null;
  }
  Schema currentFileSchema=null;
  if (fileSchema != null) {
    currentFileSchema=fileSchema.getType() == Type.UNION ? fileSchema.getTypes().get(tag) : fileSchema;
  }
  return worker(datum,currentFileSchema,schema,SchemaToTypeInfo.generateTypeInfo(schema));
}
