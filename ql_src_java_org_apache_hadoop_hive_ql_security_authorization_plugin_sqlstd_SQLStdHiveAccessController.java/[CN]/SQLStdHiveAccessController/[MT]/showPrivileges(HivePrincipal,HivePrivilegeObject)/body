{
  try {
    IMetaStoreClient mClient=metastoreClientFactory.getHiveMetastoreClient();
    List<HivePrivilegeInfo> resPrivInfos=new ArrayList<HivePrivilegeInfo>();
    String principalName=principal == null ? null : principal.getName();
    PrincipalType principalType=principal == null ? null : AuthorizationUtils.getThriftPrincipalType(principal.getType());
    List<HiveObjectPrivilege> msObjPrivs=mClient.list_privileges(principalName,principalType,SQLAuthorizationUtils.getThriftHiveObjectRef(privObj));
    for (    HiveObjectPrivilege msObjPriv : msObjPrivs) {
      HivePrincipal resPrincipal=new HivePrincipal(msObjPriv.getPrincipalName(),AuthorizationUtils.getHivePrincipalType(msObjPriv.getPrincipalType()));
      PrivilegeGrantInfo msGrantInfo=msObjPriv.getGrantInfo();
      HivePrivilege resPrivilege=new HivePrivilege(msGrantInfo.getPrivilege(),null);
      HiveObjectRef msObjRef=msObjPriv.getHiveObject();
      HivePrivilegeObject resPrivObj=new HivePrivilegeObject(getPluginObjType(msObjRef.getObjectType()),msObjRef.getDbName(),msObjRef.getObjectName());
      HivePrincipal grantorPrincipal=new HivePrincipal(msGrantInfo.getGrantor(),AuthorizationUtils.getHivePrincipalType(msGrantInfo.getGrantorType()));
      HivePrivilegeInfo resPrivInfo=new HivePrivilegeInfo(resPrincipal,resPrivilege,resPrivObj,grantorPrincipal,msGrantInfo.isGrantOption(),msGrantInfo.getCreateTime());
      resPrivInfos.add(resPrivInfo);
    }
    return resPrivInfos;
  }
 catch (  Exception e) {
    throw new HiveAuthzPluginException("Error showing privileges: " + e.getMessage(),e);
  }
}
