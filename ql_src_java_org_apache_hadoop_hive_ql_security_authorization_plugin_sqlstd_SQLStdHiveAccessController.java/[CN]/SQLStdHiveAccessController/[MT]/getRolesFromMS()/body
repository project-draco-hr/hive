{
  List<Role> roles;
  try {
    roles=metastoreClientFactory.getHiveMetastoreClient().list_roles(currentUserName,PrincipalType.USER);
    Map<String,HiveRole> name2Rolesmap=new HashMap<String,HiveRole>();
    getAllRoleAncestors(name2Rolesmap,roles);
    List<HiveRole> currentRoles=new ArrayList<HiveRole>(roles.size());
    for (    HiveRole role : name2Rolesmap.values()) {
      if (!HiveMetaStore.ADMIN.equalsIgnoreCase(role.getRoleName())) {
        currentRoles.add(role);
      }
 else {
        this.adminRole=role;
      }
    }
    return currentRoles;
  }
 catch (  Exception e) {
    throw new HiveAuthzPluginException("Failed to retrieve roles for " + currentUserName + ": "+ e.getMessage(),e);
  }
}
