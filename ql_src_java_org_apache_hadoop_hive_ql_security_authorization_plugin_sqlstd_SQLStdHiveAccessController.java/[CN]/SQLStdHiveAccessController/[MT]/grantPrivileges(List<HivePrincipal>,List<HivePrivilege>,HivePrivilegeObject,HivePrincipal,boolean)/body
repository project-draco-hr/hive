{
  hivePrivileges=expandAndValidatePrivileges(hivePrivileges);
  IMetaStoreClient metastoreClient=metastoreClientFactory.getHiveMetastoreClient();
  GrantPrivAuthUtils.authorize(hivePrincipals,hivePrivileges,hivePrivObject,grantOption,metastoreClient,authenticator.getUserName(),getCurrentRoles(),isUserAdmin());
  PrivilegeBag privBag=getThriftPrivilegesBag(hivePrincipals,hivePrivileges,hivePrivObject,grantorPrincipal,grantOption);
  try {
    metastoreClient.grant_privileges(privBag);
  }
 catch (  Exception e) {
    throw new HiveAuthzPluginException("Error granting privileges: " + e.getMessage(),e);
  }
}
