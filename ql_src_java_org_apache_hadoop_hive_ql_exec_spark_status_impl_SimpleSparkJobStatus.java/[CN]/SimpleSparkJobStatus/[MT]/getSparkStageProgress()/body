{
  Map<String,SparkProgress> stageProgresses=new HashMap<String,SparkProgress>();
  int[] stageIds=jobStateListener.getStageIds(jobId);
  if (stageIds != null) {
    for (    int stageId : stageIds) {
      List<StageInfo> stageInfos=getStageInfo(stageId);
      for (      StageInfo stageInfo : stageInfos) {
        Tuple2<Object,Object> tuple2=new Tuple2<Object,Object>(stageInfo.stageId(),stageInfo.attemptId());
        UIData.StageUIData uiData=jobProgressListener.stageIdToData().get(tuple2).get();
        if (uiData != null) {
          int runningTaskCount=uiData.numActiveTasks();
          int completedTaskCount=uiData.numCompleteTasks();
          int failedTaskCount=uiData.numFailedTasks();
          int totalTaskCount=stageInfo.numTasks();
          int killedTaskCount=0;
          SparkProgress stageProgress=new SparkProgress(totalTaskCount,completedTaskCount,runningTaskCount,failedTaskCount,killedTaskCount);
          stageProgresses.put(stageInfo.stageId() + "_" + stageInfo.attemptId(),stageProgress);
        }
      }
    }
  }
  return stageProgresses;
}
