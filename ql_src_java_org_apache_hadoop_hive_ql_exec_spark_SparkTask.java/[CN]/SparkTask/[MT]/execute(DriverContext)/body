{
  int rc=1;
  SparkSession sparkSession=null;
  SparkSessionManager sparkSessionManager=null;
  try {
    configureNumberOfReducers();
    sparkSessionManager=SparkSessionManagerImpl.getInstance();
    sparkSession=SessionState.get().getSparkSession();
    sparkSession=sparkSessionManager.getSession(sparkSession,conf,true);
    SessionState.get().setSparkSession(sparkSession);
    rc=sparkSession.submit(driverContext,getWork());
  }
 catch (  Exception e) {
    LOG.error("Failed to execute spark task.",e);
    return 1;
  }
 finally {
    if (sparkSession != null && sparkSessionManager != null) {
      rc=close(rc);
      try {
        sparkSessionManager.returnSession(sparkSession);
      }
 catch (      HiveException ex) {
        LOG.error("Failed to return the session to SessionManager",ex);
      }
    }
  }
  return rc;
}
