{
  try {
    Deque<String> tokenList=new ArrayDeque<String>();
    StringBuilder messageToken=new StringBuilder();
    for (    byte b : response) {
      if (b == 0) {
        tokenList.addLast(messageToken.toString());
        messageToken=new StringBuilder();
      }
 else {
        messageToken.append((char)b);
      }
    }
    tokenList.addLast(messageToken.toString());
    if ((tokenList.size() < 2) || (tokenList.size() > 3)) {
      throw new SaslException("Invalid message format");
    }
    passwd=tokenList.removeLast();
    user=tokenList.removeLast();
    if (!tokenList.isEmpty()) {
      authzId=tokenList.removeLast();
    }
 else {
      authzId=user;
    }
    if (user == null || user.isEmpty()) {
      throw new SaslException("No user name provide");
    }
    if (passwd == null || passwd.isEmpty()) {
      throw new SaslException("No password name provide");
    }
    NameCallback nameCallback=new NameCallback("User");
    nameCallback.setName(user);
    PasswordCallback pcCallback=new PasswordCallback("Password",false);
    pcCallback.setPassword(passwd.toCharArray());
    AuthorizeCallback acCallback=new AuthorizeCallback(user,authzId);
    Callback[] cbList=new Callback[]{nameCallback,pcCallback,acCallback};
    handler.handle(cbList);
    if (!acCallback.isAuthorized()) {
      throw new SaslException("Authentication failed");
    }
  }
 catch (  IllegalStateException eL) {
    throw new SaslException("Invalid message format",eL);
  }
catch (  IOException eI) {
    throw new SaslException("Error validating the login",eI);
  }
catch (  UnsupportedCallbackException eU) {
    throw new SaslException("Error validating the login",eU);
  }
  return null;
}
