{
  try {
    Deque<String> tokenList=new ArrayDeque<String>();
    StringBuilder messageToken=new StringBuilder();
    for (    byte b : response) {
      if (b == 0) {
        tokenList.addLast(messageToken.toString());
        messageToken=new StringBuilder();
      }
 else {
        messageToken.append((char)b);
      }
    }
    tokenList.addLast(messageToken.toString());
    if ((tokenList.size() < 2) || (tokenList.size() > 3)) {
      throw new SaslException("Invalid message format");
    }
    passwd=tokenList.removeLast();
    user=tokenList.removeLast();
    if (user == null || user.isEmpty()) {
      throw new SaslException("No user name provide");
    }
    if (passwd == null || passwd.isEmpty()) {
      throw new SaslException("No password name provide");
    }
    ExternalAuthenticationCallback exAuth=new ExternalAuthenticationCallback(authMethod,user,passwd);
    Callback[] cbList=new Callback[]{exAuth};
    handler.handle(cbList);
    if (!exAuth.isAuthenticated()) {
      throw new SaslException("Authentication failed");
    }
  }
 catch (  IllegalStateException eL) {
    throw new SaslException("Invalid message format",eL);
  }
catch (  IOException eI) {
    throw new SaslException("Error validating the login",eI);
  }
catch (  UnsupportedCallbackException eU) {
    throw new SaslException("Error validating the login",eU);
  }
  return null;
}
