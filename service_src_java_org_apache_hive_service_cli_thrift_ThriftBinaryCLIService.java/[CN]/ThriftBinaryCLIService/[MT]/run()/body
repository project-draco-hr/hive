{
  try {
    String threadPoolName="HiveServer2-Handler-Pool";
    ExecutorService executorService=new ThreadPoolExecutor(minWorkerThreads,maxWorkerThreads,workerKeepAliveTime,TimeUnit.SECONDS,new SynchronousQueue<Runnable>(),new ThreadFactoryWithGarbageCleanup(threadPoolName));
    hiveAuthFactory=new HiveAuthFactory(hiveConf);
    TTransportFactory transportFactory=hiveAuthFactory.getAuthTransFactory();
    TProcessorFactory processorFactory=hiveAuthFactory.getAuthProcFactory(this);
    TServerSocket serverSocket=null;
    if (!hiveConf.getBoolVar(ConfVars.HIVE_SERVER2_USE_SSL)) {
      serverSocket=HiveAuthFactory.getServerSocket(hiveHost,portNum);
    }
 else {
      String keyStorePath=hiveConf.getVar(ConfVars.HIVE_SERVER2_SSL_KEYSTORE_PATH).trim();
      if (keyStorePath.isEmpty()) {
        throw new IllegalArgumentException(ConfVars.HIVE_SERVER2_SSL_KEYSTORE_PATH.varname + " Not configured for SSL connection");
      }
      String keyStorePassword=ShimLoader.getHadoopShims().getPassword(hiveConf,HiveConf.ConfVars.HIVE_SERVER2_SSL_KEYSTORE_PASSWORD.varname);
      serverSocket=HiveAuthFactory.getServerSSLSocket(hiveHost,portNum,keyStorePath,keyStorePassword);
    }
    TThreadPoolServer.Args sargs=new TThreadPoolServer.Args(serverSocket).processorFactory(processorFactory).transportFactory(transportFactory).protocolFactory(new TBinaryProtocol.Factory()).executorService(executorService);
    server=new TThreadPoolServer(sargs);
    server.serve();
    String msg="Started " + ThriftBinaryCLIService.class.getSimpleName() + " on port "+ portNum+ " with "+ minWorkerThreads+ "..."+ maxWorkerThreads+ " worker threads";
    LOG.info(msg);
  }
 catch (  Throwable t) {
    LOG.fatal("Error starting HiveServer2: could not start " + ThriftBinaryCLIService.class.getSimpleName(),t);
    System.exit(-1);
  }
}
