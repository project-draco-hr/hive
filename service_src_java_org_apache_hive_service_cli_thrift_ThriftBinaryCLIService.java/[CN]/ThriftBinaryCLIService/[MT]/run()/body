{
  try {
    hiveAuthFactory=new HiveAuthFactory(hiveConf);
    TTransportFactory transportFactory=hiveAuthFactory.getAuthTransFactory();
    TProcessorFactory processorFactory=hiveAuthFactory.getAuthProcFactory(this);
    String portString=System.getenv("HIVE_SERVER2_THRIFT_PORT");
    if (portString != null) {
      portNum=Integer.valueOf(portString);
    }
 else {
      portNum=hiveConf.getIntVar(ConfVars.HIVE_SERVER2_THRIFT_PORT);
    }
    String hiveHost=System.getenv("HIVE_SERVER2_THRIFT_BIND_HOST");
    if (hiveHost == null) {
      hiveHost=hiveConf.getVar(ConfVars.HIVE_SERVER2_THRIFT_BIND_HOST);
    }
    if (hiveHost != null && !hiveHost.isEmpty()) {
      serverAddress=new InetSocketAddress(hiveHost,portNum);
    }
 else {
      serverAddress=new InetSocketAddress(portNum);
    }
    minWorkerThreads=hiveConf.getIntVar(ConfVars.HIVE_SERVER2_THRIFT_MIN_WORKER_THREADS);
    maxWorkerThreads=hiveConf.getIntVar(ConfVars.HIVE_SERVER2_THRIFT_MAX_WORKER_THREADS);
    workerKeepAliveTime=hiveConf.getTimeVar(ConfVars.HIVE_SERVER2_THRIFT_WORKER_KEEPALIVE_TIME,TimeUnit.SECONDS);
    String threadPoolName="HiveServer2-Handler-Pool";
    ExecutorService executorService=new ThreadPoolExecutor(minWorkerThreads,maxWorkerThreads,workerKeepAliveTime,TimeUnit.SECONDS,new SynchronousQueue<Runnable>(),new ThreadFactoryWithGarbageCleanup(threadPoolName));
    TServerSocket serverSocket=null;
    if (!hiveConf.getBoolVar(ConfVars.HIVE_SERVER2_USE_SSL)) {
      serverSocket=HiveAuthFactory.getServerSocket(hiveHost,portNum);
    }
 else {
      String keyStorePath=hiveConf.getVar(ConfVars.HIVE_SERVER2_SSL_KEYSTORE_PATH).trim();
      if (keyStorePath.isEmpty()) {
        throw new IllegalArgumentException(ConfVars.HIVE_SERVER2_SSL_KEYSTORE_PATH.varname + " Not configured for SSL connection");
      }
      String keyStorePassword=ShimLoader.getHadoopShims().getPassword(hiveConf,HiveConf.ConfVars.HIVE_SERVER2_SSL_KEYSTORE_PASSWORD.varname);
      serverSocket=HiveAuthFactory.getServerSSLSocket(hiveHost,portNum,keyStorePath,keyStorePassword);
    }
    TThreadPoolServer.Args sargs=new TThreadPoolServer.Args(serverSocket).processorFactory(processorFactory).transportFactory(transportFactory).protocolFactory(new TBinaryProtocol.Factory()).executorService(executorService);
    server=new TThreadPoolServer(sargs);
    LOG.info("ThriftBinaryCLIService listening on " + serverAddress);
    server.serve();
  }
 catch (  Throwable t) {
    LOG.error("Error: ",t);
  }
}
