{
  int len=0;
  int fb=bitsDeltaMax;
  int efb=0;
  if (alignedBitpacking) {
    fb=utils.getClosestAlignedFixedBits(fb);
  }
  if (isFixedDelta) {
    if (fixedRunLength > MIN_REPEAT) {
      len=fixedRunLength - 1;
      fixedRunLength=0;
    }
 else {
      len=variableRunLength - 1;
      variableRunLength=0;
    }
  }
 else {
    if (fb == 1) {
      fb=2;
    }
    efb=utils.encodeBitWidth(fb);
    efb=efb << 1;
    len=variableRunLength - 1;
    variableRunLength=0;
  }
  final int tailBits=(len & 0x100) >>> 8;
  final int headerFirstByte=getOpcode() | efb | tailBits;
  final int headerSecondByte=len & 0xff;
  output.write(headerFirstByte);
  output.write(headerSecondByte);
  if (signed) {
    utils.writeVslong(output,literals[0]);
  }
 else {
    utils.writeVulong(output,literals[0]);
  }
  if (isFixedDelta) {
    utils.writeVslong(output,fixedDelta);
  }
 else {
    utils.writeVslong(output,adjDeltas[0]);
    utils.writeInts(adjDeltas,1,numLiterals - 2,fb,output);
  }
}
