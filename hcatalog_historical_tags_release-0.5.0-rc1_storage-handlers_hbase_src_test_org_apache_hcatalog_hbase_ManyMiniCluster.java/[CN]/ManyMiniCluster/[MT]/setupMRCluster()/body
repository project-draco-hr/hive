{
  try {
    final int jobTrackerPort=findFreePort();
    final int taskTrackerPort=findFreePort();
    if (jobConf == null)     jobConf=new JobConf();
    jobConf.setInt("mapred.submit.replication",1);
    System.setProperty("hadoop.log.dir",new File(workDir,"/logs").getAbsolutePath());
    mrCluster=new MiniMRCluster(jobTrackerPort,taskTrackerPort,numTaskTrackers,getFileSystem().getUri().toString(),numTaskTrackers,null,null,null,jobConf);
    jobConf=mrCluster.createJobConf();
  }
 catch (  IOException e) {
    throw new IllegalStateException("Failed to Setup MR Cluster",e);
  }
}
