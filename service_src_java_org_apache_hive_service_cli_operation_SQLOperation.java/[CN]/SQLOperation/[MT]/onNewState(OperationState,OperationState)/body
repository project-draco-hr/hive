{
  super.onNewState(state,prevState);
  currentSQLStateScope=setMetrics(currentSQLStateScope,MetricsConstant.SQL_OPERATION_PREFIX,MetricsConstant.COMPLETED_SQL_OPERATION_PREFIX,state);
  Metrics metrics=MetricsFactory.getInstance();
  if (metrics != null) {
    try {
      if (state == OperationState.RUNNING && prevState != state) {
        incrementUserQueries(metrics);
      }
      if (prevState == OperationState.RUNNING && prevState != state) {
        decrementUserQueries(metrics);
      }
    }
 catch (    IOException e) {
      LOG.warn("Error metrics",e);
    }
  }
  if (state == OperationState.FINISHED || state == OperationState.CANCELED || state == OperationState.ERROR) {
    sqlOpDisplay.setRuntime(getOperationComplete() - getOperationStart());
  }
  if (state == OperationState.CLOSED) {
    sqlOpDisplay.closed();
  }
 else {
    sqlOpDisplay.updateState(state);
  }
}
