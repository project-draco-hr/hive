{
  setState(OperationState.PENDING);
  prepare(getConfigForOperation());
  if (!shouldRunAsync()) {
    runInternal(getConfigForOperation());
  }
 else {
    Runnable backgroundOperation=new Runnable(){
      SessionState ss=SessionState.get();
      @Override public void run(){
        SessionState.setCurrentSessionState(ss);
        try {
          runInternal(getConfigForOperation());
        }
 catch (        HiveSQLException e) {
          LOG.error("Error: ",e);
        }
      }
    }
;
    try {
      backgroundHandle=getParentSession().getSessionManager().submitBackgroundOperation(backgroundOperation);
    }
 catch (    RejectedExecutionException rejected) {
      setState(OperationState.ERROR);
      throw new HiveSQLException("All the asynchronous threads are currently busy, " + "please retry the operation",rejected);
    }
  }
}
