{
  setState(OperationState.PENDING);
  prepare(getConfigForOperation());
  if (!shouldRunAsync()) {
    runInternal(getConfigForOperation());
  }
 else {
    final SessionState parentSessionState=SessionState.get();
    final Hive sessionHive=getCurrentHive();
    Runnable backgroundOperation=new Runnable(){
      @Override public void run(){
        Hive.set(sessionHive);
        SessionState.setCurrentSessionState(parentSessionState);
        try {
          runInternal(getConfigForOperation());
        }
 catch (        HiveSQLException e) {
          setOperationException(e);
          LOG.error("Error: ",e);
        }
      }
    }
;
    try {
      Future<?> backgroundHandle=getParentSession().getSessionManager().submitBackgroundOperation(backgroundOperation);
      setBackgroundHandle(backgroundHandle);
    }
 catch (    RejectedExecutionException rejected) {
      setState(OperationState.ERROR);
      throw new HiveSQLException("The background threadpool cannot accept" + " new task for execution, please retry the operation",rejected);
    }
  }
}
