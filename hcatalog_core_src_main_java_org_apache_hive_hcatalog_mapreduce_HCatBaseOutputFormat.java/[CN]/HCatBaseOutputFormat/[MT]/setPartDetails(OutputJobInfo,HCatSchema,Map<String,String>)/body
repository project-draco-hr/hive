{
  List<Integer> posOfPartCols=new ArrayList<Integer>();
  List<Integer> posOfDynPartCols=new ArrayList<Integer>();
  HCatSchema schemaWithoutParts=new HCatSchema(schema.getFields());
  for (  String partKey : partMap.keySet()) {
    Integer idx;
    if ((idx=schema.getPosition(partKey)) != null) {
      posOfPartCols.add(idx);
      schemaWithoutParts.remove(schema.get(partKey));
    }
  }
  if (jobInfo.isDynamicPartitioningUsed()) {
    for (    String partKey : jobInfo.getDynamicPartitioningKeys()) {
      Integer idx;
      if ((idx=schema.getPosition(partKey)) != null) {
        posOfPartCols.add(idx);
        posOfDynPartCols.add(idx);
        schemaWithoutParts.remove(schema.get(partKey));
      }
    }
  }
  HCatUtil.validatePartitionSchema(new Table(jobInfo.getTableInfo().getTable()),schemaWithoutParts);
  jobInfo.setPosOfPartCols(posOfPartCols);
  jobInfo.setPosOfDynPartCols(posOfDynPartCols);
  jobInfo.setOutputSchema(schemaWithoutParts);
}
