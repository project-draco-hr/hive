{
  Set<Long> abortedTransactions=new HashSet<Long>();
  RevisionManager rm=null;
  try {
    rm=HBaseRevisionManagerUtil.getOpenedRevisionManager(conf);
    byte[][] families=scan.getFamilies();
    for (    byte[] familyKey : families) {
      String family=Bytes.toString(familyKey);
      List<FamilyRevision> abortedWriteTransactions=rm.getAbortedWriteTransactions(tableName,family);
      if (abortedWriteTransactions != null) {
        for (        FamilyRevision revision : abortedWriteTransactions) {
          abortedTransactions.add(revision.getRevision());
        }
      }
    }
    return abortedTransactions;
  }
  finally {
    HBaseRevisionManagerUtil.closeRevisionManagerQuietly(rm);
  }
}
