{
  Map<Integer,Integer> bucketTaskMap=estimateBucketSizes(availableSlots,waves,bucketSplitMultimap.asMap());
  Multimap<Integer,InputSplit> bucketGroupedSplitMultimap=ArrayListMultimap.<Integer,InputSplit>create();
  for (  int bucketId : bucketSplitMultimap.keySet()) {
    Collection<InputSplit> inputSplitCollection=bucketSplitMultimap.get(bucketId);
    InputSplit[] rawSplits=inputSplitCollection.toArray(new InputSplit[0]);
    InputSplit[] groupedSplits=tezGrouper.getGroupedSplits(conf,rawSplits,bucketTaskMap.get(bucketId),HiveInputFormat.class.getName(),new ColumnarSplitSizeEstimator(),splitLocationProvider);
    LOG.info("Original split count is " + rawSplits.length + " grouped split count is "+ groupedSplits.length+ ", for bucket: "+ bucketId);
    for (    InputSplit inSplit : groupedSplits) {
      bucketGroupedSplitMultimap.put(bucketId,inSplit);
    }
  }
  return bucketGroupedSplitMultimap;
}
