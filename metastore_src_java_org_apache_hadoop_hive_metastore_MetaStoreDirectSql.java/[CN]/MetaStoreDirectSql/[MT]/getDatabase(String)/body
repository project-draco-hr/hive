{
  Query queryDbSelector=null;
  Query queryDbParams=null;
  try {
    dbName=dbName.toLowerCase();
    doDbSpecificInitializationsBeforeQuery();
    String queryTextDbSelector="select " + "\"DB_ID\", \"NAME\", \"DB_LOCATION_URI\", \"DESC\", " + "\"OWNER_NAME\", \"OWNER_TYPE\" "+ "FROM \"DBS\" where \"NAME\" = ? ";
    Object[] params=new Object[]{dbName};
    queryDbSelector=pm.newQuery("javax.jdo.query.SQL",queryTextDbSelector);
    LOG.debug("getDatabase:query instantiated : " + queryTextDbSelector + " with param ["+ params[0]+ "]");
    List<Object[]> sqlResult=(List<Object[]>)queryDbSelector.executeWithArray(params);
    if ((sqlResult == null) || sqlResult.isEmpty()) {
      LOG.debug("getDatabase:queryDbSelector ran, returned no/empty results, returning NoSuchObjectException");
      throw new MetaException("There is no database named " + dbName);
    }
    assert(sqlResult.size() == 1);
    if (sqlResult.get(0) == null) {
      LOG.debug("getDatabase:queryDbSelector ran, returned results, but the result entry was null, returning NoSuchObjectException");
      throw new MetaException("There is no database named " + dbName);
    }
    Object[] dbline=sqlResult.get(0);
    Long dbid=StatObjectConverter.extractSqlLong(dbline[0]);
    String queryTextDbParams="select \"PARAM_KEY\", \"PARAM_VALUE\" " + " FROM \"DATABASE_PARAMS\" " + " WHERE \"DB_ID\" = ? "+ " AND \"PARAM_KEY\" IS NOT NULL";
    Object[] params2=new Object[]{dbid};
    queryDbParams=pm.newQuery("javax.jdo.query.SQL",queryTextDbParams);
    LOG.debug("getDatabase:query2 instantiated : " + queryTextDbParams + " with param ["+ params2[0]+ "]");
    Map<String,String> dbParams=new HashMap<String,String>();
    List<Object[]> sqlResult2=ensureList(queryDbParams.executeWithArray(params2));
    if (!sqlResult2.isEmpty()) {
      for (      Object[] line : sqlResult2) {
        dbParams.put(extractSqlString(line[0]),extractSqlString(line[1]));
      }
    }
    LOG.debug("getDatabase: instantiating db object to return");
    Database db=new Database();
    db.setName(extractSqlString(dbline[1]));
    db.setLocationUri(extractSqlString(dbline[2]));
    db.setDescription(extractSqlString(dbline[3]));
    db.setOwnerName(extractSqlString(dbline[4]));
    String type=extractSqlString(dbline[5]);
    db.setOwnerType((null == type || type.trim().isEmpty()) ? null : PrincipalType.valueOf(type));
    db.setParameters(dbParams);
    if (LOG.isDebugEnabled()) {
      LOG.debug("getDatabase: directsql returning db " + db.getName() + " locn["+ db.getLocationUri()+ "] desc ["+ db.getDescription()+ "] owner ["+ db.getOwnerName()+ "] ownertype ["+ db.getOwnerType()+ "]");
    }
    return db;
  }
  finally {
    if (queryDbSelector != null) {
      queryDbSelector.closeAll();
    }
    if (queryDbParams != null) {
      queryDbParams.closeAll();
    }
  }
}
