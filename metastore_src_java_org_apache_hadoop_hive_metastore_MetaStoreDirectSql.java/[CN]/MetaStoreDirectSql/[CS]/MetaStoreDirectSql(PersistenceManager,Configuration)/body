{
  this.pm=pm;
  this.dbType=determineDbType();
  int batchSize=HiveConf.getIntVar(conf,ConfVars.METASTORE_DIRECT_SQL_PARTITION_BATCH_SIZE);
  if (batchSize == DETECT_BATCHING) {
    batchSize=(dbType == DB.ORACLE || dbType == DB.MSSQL) ? 1000 : NO_BATCHING;
  }
  this.batchSize=batchSize;
  convertMapNullsToEmptyStrings=HiveConf.getBoolVar(conf,ConfVars.METASTORE_ORM_RETRIEVE_MAPNULLS_AS_EMPTY_STRINGS);
  this.isCompatibleDatastore=ensureDbInit() && runTestQuery();
  if (isCompatibleDatastore) {
    LOG.info("Using direct SQL, underlying DB is " + dbType);
  }
  isAggregateStatsCacheEnabled=HiveConf.getBoolVar(conf,ConfVars.METASTORE_AGGREGATE_STATS_CACHE_ENABLED);
  if (isAggregateStatsCacheEnabled) {
    aggrStatsCache=AggregateStatsCache.getInstance(conf);
  }
}
