{
  this.pm=pm;
  this.dbType=determineDbType();
  int batchSize=HiveConf.getIntVar(conf,ConfVars.METASTORE_DIRECT_SQL_PARTITION_BATCH_SIZE);
  if (batchSize == DETECT_BATCHING) {
    batchSize=(dbType == DB.ORACLE || dbType == DB.MSSQL) ? 1000 : NO_BATCHING;
  }
  this.batchSize=batchSize;
  this.isCompatibleDatastore=ensureDbInit() && runTestQuery();
  if (isCompatibleDatastore) {
    LOG.info("Using direct SQL, underlying DB is " + dbType);
  }
}
