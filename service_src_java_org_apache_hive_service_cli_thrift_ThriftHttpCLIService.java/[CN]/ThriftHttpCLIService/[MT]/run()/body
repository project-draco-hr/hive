{
  try {
    verifyHttpConfiguration(hiveConf);
    String portString=System.getenv("HIVE_SERVER2_THRIFT_HTTP_PORT");
    if (portString != null) {
      portNum=Integer.valueOf(portString);
    }
 else {
      portNum=hiveConf.getIntVar(ConfVars.HIVE_SERVER2_THRIFT_HTTP_PORT);
    }
    minWorkerThreads=hiveConf.getIntVar(ConfVars.HIVE_SERVER2_THRIFT_HTTP_MIN_WORKER_THREADS);
    maxWorkerThreads=hiveConf.getIntVar(ConfVars.HIVE_SERVER2_THRIFT_HTTP_MAX_WORKER_THREADS);
    String httpPath=hiveConf.getVar(HiveConf.ConfVars.HIVE_SERVER2_THRIFT_HTTP_PATH);
    if (httpPath == null || httpPath.equals("")) {
      httpPath="/*";
    }
 else {
      if (!httpPath.startsWith("/")) {
        httpPath="/" + httpPath;
      }
      if (httpPath.endsWith("/")) {
        httpPath=httpPath + "*";
      }
      if (!httpPath.endsWith("/*")) {
        httpPath=httpPath + "/*";
      }
    }
    httpServer=new org.eclipse.jetty.server.Server();
    QueuedThreadPool threadPool=new QueuedThreadPool();
    threadPool.setMinThreads(minWorkerThreads);
    threadPool.setMaxThreads(maxWorkerThreads);
    httpServer.setThreadPool(threadPool);
    SelectChannelConnector connector;
    Boolean useSsl=hiveConf.getBoolVar(ConfVars.HIVE_SERVER2_USE_SSL);
    String schemeName=useSsl ? "https" : "http";
    if (useSsl) {
      String keyStorePath=hiveConf.getVar(ConfVars.HIVE_SERVER2_SSL_KEYSTORE_PATH).trim();
      String keyStorePassword=hiveConf.getVar(ConfVars.HIVE_SERVER2_SSL_KEYSTORE_PASSWORD);
      if (keyStorePath.isEmpty()) {
        throw new IllegalArgumentException(ConfVars.HIVE_SERVER2_SSL_KEYSTORE_PATH.varname + " Not configured for SSL connection");
      }
      SslContextFactory sslContextFactory=new SslContextFactory();
      sslContextFactory.setKeyStorePath(keyStorePath);
      sslContextFactory.setKeyStorePassword(keyStorePassword);
      connector=new SslSelectChannelConnector(sslContextFactory);
    }
 else {
      connector=new SelectChannelConnector();
    }
    connector.setPort(portNum);
    connector.setReuseAddress(!Shell.WINDOWS);
    httpServer.addConnector(connector);
    TCLIService.Processor<ThriftCLIService> processor=new TCLIService.Processor<ThriftCLIService>(new EmbeddedThriftBinaryCLIService());
    TProtocolFactory protocolFactory=new TBinaryProtocol.Factory();
    TServlet thriftHttpServlet=new ThriftHttpServlet(processor,protocolFactory);
    final ServletContextHandler context=new ServletContextHandler(ServletContextHandler.SESSIONS);
    context.setContextPath("/");
    httpServer.setHandler(context);
    context.addServlet(new ServletHolder(thriftHttpServlet),httpPath);
    httpServer.start();
    String msg="Started ThriftHttpCLIService in " + schemeName + " mode on port "+ portNum+ " path="+ httpPath+ " with "+ minWorkerThreads+ ".."+ maxWorkerThreads+ " worker threads";
    LOG.info(msg);
    httpServer.join();
  }
 catch (  Throwable t) {
    LOG.error("Error: ",t);
  }
}
