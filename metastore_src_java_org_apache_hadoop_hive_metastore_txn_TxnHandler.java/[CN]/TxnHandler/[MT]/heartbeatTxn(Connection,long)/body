{
  if (txnid == 0)   return;
  Statement stmt=null;
  try {
    stmt=dbConn.createStatement();
    long now=getDbTime(dbConn);
    String s="select txn_state from TXNS where txn_id = " + txnid;
    LOG.debug("Going to execute query <" + s + ">");
    ResultSet rs=stmt.executeQuery(s);
    if (!rs.next()) {
      s="select count(*) from COMPLETED_TXN_COMPONENTS where CTC_TXNID = " + txnid;
      ResultSet rs2=stmt.executeQuery(s);
      boolean alreadyCommitted=rs2.next() && rs2.getInt(1) > 0;
      LOG.debug("Going to rollback");
      dbConn.rollback();
      if (alreadyCommitted) {
        throw new NoSuchTxnException("Transaction " + JavaUtils.txnIdToString(txnid) + " is already committed.");
      }
      throw new NoSuchTxnException("No such transaction " + JavaUtils.txnIdToString(txnid));
    }
    if (rs.getString(1).charAt(0) == TXN_ABORTED) {
      LOG.debug("Going to rollback");
      dbConn.rollback();
      throw new TxnAbortedException("Transaction " + JavaUtils.txnIdToString(txnid) + " already aborted");
    }
    s="update TXNS set txn_last_heartbeat = " + now + " where txn_id = "+ txnid;
    LOG.debug("Going to execute update <" + s + ">");
    stmt.executeUpdate(s);
    LOG.debug("Going to commit");
    dbConn.commit();
  }
  finally {
    closeStmt(stmt);
  }
}
