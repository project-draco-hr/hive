{
  final String mysqlDeadlock="Deadlock found when trying to get lock; try restarting transaction";
  if (e.getMessage().contains(mysqlDeadlock) || e instanceof SQLTransactionRollbackException) {
    if (deadlockCnt++ < ALLOWED_REPEATED_DEADLOCKS) {
      LOG.warn("Deadlock detected in " + caller + ", trying again.");
      throw new DeadlockException();
    }
 else {
      LOG.error("Too many repeated deadlocks in " + caller + ", giving up.");
      deadlockCnt=0;
    }
  }
}
