{
  Statement stmt=null;
  int updateCnt=0;
  if (txnids.isEmpty()) {
    return 0;
  }
  try {
    stmt=dbConn.createStatement();
    StringBuilder buf=new StringBuilder("update TXNS set txn_state = '" + TXN_ABORTED + "' where txn_state = '"+ TXN_OPEN+ "' and txn_id in (");
    boolean first=true;
    for (    Long id : txnids) {
      if (first)       first=false;
 else       buf.append(',');
      buf.append(id);
    }
    buf.append(')');
    if (max_heartbeat > 0) {
      buf.append(" and txn_last_heartbeat < ").append(max_heartbeat);
    }
    LOG.debug("Going to execute update <" + buf.toString() + ">");
    updateCnt=stmt.executeUpdate(buf.toString());
    if (updateCnt < txnids.size()) {
      return updateCnt;
    }
    buf=new StringBuilder("delete from HIVE_LOCKS where hl_txnid in (");
    first=true;
    for (    Long id : txnids) {
      if (first)       first=false;
 else       buf.append(',');
      buf.append(id);
    }
    buf.append(')');
    LOG.debug("Going to execute update <" + buf.toString() + ">");
    stmt.executeUpdate(buf.toString());
  }
  finally {
    closeStmt(stmt);
  }
  return updateCnt;
}
