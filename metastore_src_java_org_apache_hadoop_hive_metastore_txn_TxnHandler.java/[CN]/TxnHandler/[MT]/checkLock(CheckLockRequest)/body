{
  try {
    Connection dbConn=null;
    long extLockId=rqst.getLockid();
    try {
      dbConn=getDbConn(Connection.TRANSACTION_READ_COMMITTED);
      Long txnid=getTxnIdFromLockId(dbConn,extLockId);
      if (txnid == null) {
        throw new NoSuchLockException("No such lock " + JavaUtils.lockIdToString(extLockId));
      }
      if (txnid > 0) {
        heartbeatTxn(dbConn,txnid);
      }
 else {
        heartbeatLock(dbConn,extLockId);
      }
      dbConn=getDbConn(Connection.TRANSACTION_SERIALIZABLE);
      return checkLock(dbConn,extLockId);
    }
 catch (    SQLException e) {
      LOG.debug("Going to rollback");
      rollbackDBConn(dbConn);
      checkRetryable(dbConn,e,"checkLock(" + rqst + " )");
      throw new MetaException("Unable to update transaction database " + JavaUtils.lockIdToString(extLockId) + " "+ StringUtils.stringifyException(e));
    }
 finally {
      closeDbConn(dbConn);
    }
  }
 catch (  RetryException e) {
    return checkLock(rqst);
  }
}
