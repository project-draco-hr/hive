{
  Connection dbConn=null;
  Statement stmt=null;
  ResultSet rs=null;
  try {
    dbConn=getDbConn(getRequiredIsolationLevel());
    stmt=dbConn.createStatement();
    String s=addForUpdateClause(dbConn,"select nl_next from NEXT_LOCK_ID");
    LOG.debug("Going to execute query <" + s + ">");
    rs=stmt.executeQuery(s);
    if (!rs.next()) {
      LOG.debug("Going to rollback");
      dbConn.rollback();
      throw new MetaException("Transaction tables not properly " + "initialized, no record found in next_lock_id");
    }
    long extLockId=rs.getLong(1);
    s="update NEXT_LOCK_ID set nl_next = " + (extLockId + 1);
    LOG.debug("Going to execute update <" + s + ">");
    stmt.executeUpdate(s);
    LOG.debug("Going to commit.");
    dbConn.commit();
    return extLockId;
  }
  finally {
    close(rs,stmt,dbConn);
  }
}
