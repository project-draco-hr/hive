{
  long now=getDbTime(dbConn);
  Statement stmt=null;
  try {
    stmt=dbConn.createStatement();
    String s="select txn_id from TXNS where txn_state = '" + TXN_OPEN + "' and txn_last_heartbeat <  "+ (now - timeout);
    LOG.debug("Going to execute query <" + s + ">");
    ResultSet rs=stmt.executeQuery(s);
    List<Long> deadTxns=new ArrayList<Long>();
    do {
      deadTxns.clear();
      for (int i=0; i < TIMED_OUT_TXN_ABORT_BATCH_SIZE && rs.next(); i++) {
        deadTxns.add(rs.getLong(1));
      }
      if (deadTxns.size() > 0)       abortTxns(dbConn,deadTxns);
    }
 while (deadTxns.size() > 0);
    LOG.debug("Going to commit");
    dbConn.commit();
  }
 catch (  SQLException e) {
    LOG.debug("Going to rollback");
    rollbackDBConn(dbConn);
    checkRetryable(dbConn,e,"abortTxn");
    throw new MetaException("Unable to update transaction database " + StringUtils.stringifyException(e));
  }
 finally {
    closeStmt(stmt);
  }
}
