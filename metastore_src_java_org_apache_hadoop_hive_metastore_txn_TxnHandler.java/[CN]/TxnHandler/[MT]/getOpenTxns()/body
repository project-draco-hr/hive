{
  try {
    Connection dbConn=null;
    Statement stmt=null;
    ResultSet rs=null;
    try {
      dbConn=getDbConn(Connection.TRANSACTION_READ_COMMITTED);
      stmt=dbConn.createStatement();
      String s="select ntxn_next - 1 from NEXT_TXN_ID";
      LOG.debug("Going to execute query <" + s + ">");
      rs=stmt.executeQuery(s);
      if (!rs.next()) {
        throw new MetaException("Transaction tables not properly " + "initialized, no record found in next_txn_id");
      }
      long hwm=rs.getLong(1);
      if (rs.wasNull()) {
        throw new MetaException("Transaction tables not properly " + "initialized, null record found in next_txn_id");
      }
      close(rs);
      Set<Long> openList=new HashSet<Long>();
      s="select txn_id from TXNS where txn_id <= " + hwm;
      LOG.debug("Going to execute query<" + s + ">");
      rs=stmt.executeQuery(s);
      while (rs.next()) {
        openList.add(rs.getLong(1));
      }
      LOG.debug("Going to rollback");
      dbConn.rollback();
      return new GetOpenTxnsResponse(hwm,openList);
    }
 catch (    SQLException e) {
      LOG.debug("Going to rollback");
      rollbackDBConn(dbConn);
      checkRetryable(dbConn,e,"getOpenTxns");
      throw new MetaException("Unable to select from transaction database, " + StringUtils.stringifyException(e));
    }
 finally {
      close(rs,stmt,dbConn);
    }
  }
 catch (  RetryException e) {
    return getOpenTxns();
  }
}
