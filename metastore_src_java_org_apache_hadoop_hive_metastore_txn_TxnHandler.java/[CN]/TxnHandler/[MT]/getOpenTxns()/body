{
  Connection dbConn=getDbConn(Connection.TRANSACTION_READ_COMMITTED);
  Statement stmt=null;
  try {
    timeOutTxns(dbConn);
    stmt=dbConn.createStatement();
    String s="select ntxn_next - 1 from NEXT_TXN_ID";
    LOG.debug("Going to execute query <" + s + ">");
    ResultSet rs=stmt.executeQuery(s);
    if (!rs.next()) {
      throw new MetaException("Transaction tables not properly " + "initialized, no record found in next_txn_id");
    }
    long hwm=rs.getLong(1);
    if (rs.wasNull()) {
      throw new MetaException("Transaction tables not properly " + "initialized, null record found in next_txn_id");
    }
    Set<Long> openList=new HashSet<Long>();
    s="select txn_id from TXNS";
    LOG.debug("Going to execute query<" + s + ">");
    rs=stmt.executeQuery(s);
    while (rs.next()) {
      openList.add(rs.getLong(1));
    }
    LOG.debug("Going to rollback");
    dbConn.rollback();
    return new GetOpenTxnsResponse(hwm,openList);
  }
 catch (  SQLException e) {
    try {
      LOG.debug("Going to rollback");
      dbConn.rollback();
    }
 catch (    SQLException e1) {
    }
    throw new MetaException("Unable to select from transaction database, " + StringUtils.stringifyException(e));
  }
 finally {
    closeStmt(stmt);
    closeDbConn(dbConn);
  }
}
