{
  String indexName=unescapeIdentifier(ast.getChild(0).getText());
  String typeName=unescapeSQLString(ast.getChild(1).getText());
  String[] qualified=getQualifiedTableName((ASTNode)ast.getChild(2));
  List<String> indexedCols=getColumnNames((ASTNode)ast.getChild(3));
  IndexType indexType=HiveIndex.getIndexType(typeName);
  if (indexType != null) {
    typeName=indexType.getHandlerClsName();
  }
 else {
    try {
      Class.forName(typeName);
    }
 catch (    Exception e) {
      throw new SemanticException("class name provided for index handler not found.",e);
    }
  }
  String indexTableName=null;
  boolean deferredRebuild=false;
  String location=null;
  Map<String,String> tblProps=null;
  Map<String,String> idxProps=null;
  String indexComment=null;
  RowFormatParams rowFormatParams=new RowFormatParams();
  StorageFormat storageFormat=new StorageFormat(conf);
  for (int idx=4; idx < ast.getChildCount(); idx++) {
    ASTNode child=(ASTNode)ast.getChild(idx);
    if (storageFormat.fillStorageFormat(child)) {
      continue;
    }
switch (child.getToken().getType()) {
case HiveParser.TOK_TABLEROWFORMAT:
      rowFormatParams.analyzeRowFormat(child);
    break;
case HiveParser.TOK_CREATEINDEX_INDEXTBLNAME:
  ASTNode ch=(ASTNode)child.getChild(0);
indexTableName=getUnescapedName(ch);
break;
case HiveParser.TOK_DEFERRED_REBUILDINDEX:
deferredRebuild=true;
break;
case HiveParser.TOK_TABLELOCATION:
location=unescapeSQLString(child.getChild(0).getText());
addLocationToOutputs(location);
break;
case HiveParser.TOK_TABLEPROPERTIES:
tblProps=DDLSemanticAnalyzer.getProps((ASTNode)child.getChild(0));
break;
case HiveParser.TOK_INDEXPROPERTIES:
idxProps=DDLSemanticAnalyzer.getProps((ASTNode)child.getChild(0));
break;
case HiveParser.TOK_TABLESERIALIZER:
child=(ASTNode)child.getChild(0);
storageFormat.setSerde(unescapeSQLString(child.getChild(0).getText()));
if (child.getChildCount() == 2) {
readProps((ASTNode)(child.getChild(1).getChild(0)),storageFormat.getSerdeProps());
}
break;
case HiveParser.TOK_INDEXCOMMENT:
child=(ASTNode)child.getChild(0);
indexComment=unescapeSQLString(child.getText());
}
}
storageFormat.fillDefaultStorageFormat();
if (indexTableName == null) {
indexTableName=MetaStoreUtils.getIndexTableName(qualified[0],qualified[1],indexName);
indexTableName=qualified[0] + "." + indexTableName;
}
 else {
indexTableName=getDotName(Utilities.getDbTableName(indexTableName));
}
CreateIndexDesc crtIndexDesc=new CreateIndexDesc(getDotName(qualified),indexName,indexedCols,indexTableName,deferredRebuild,storageFormat.getInputFormat(),storageFormat.getOutputFormat(),storageFormat.getStorageHandler(),typeName,location,idxProps,tblProps,storageFormat.getSerde(),storageFormat.getSerdeProps(),rowFormatParams.collItemDelim,rowFormatParams.fieldDelim,rowFormatParams.fieldEscape,rowFormatParams.lineDelim,rowFormatParams.mapKeyDelim,indexComment);
Task<?> createIndex=TaskFactory.get(new DDLWork(getInputs(),getOutputs(),crtIndexDesc),conf);
rootTasks.add(createIndex);
}
