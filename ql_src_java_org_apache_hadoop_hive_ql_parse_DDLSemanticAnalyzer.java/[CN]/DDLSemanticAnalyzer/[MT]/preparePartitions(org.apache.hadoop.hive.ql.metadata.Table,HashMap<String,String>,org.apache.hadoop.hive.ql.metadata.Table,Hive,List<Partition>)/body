{
  List<Partition> baseTblPartitions=new ArrayList<Partition>();
  if (partSpec != null) {
    Partition part=db.getPartition(baseTbl,partSpec,false);
    if (part == null) {
      throw new HiveException("Partition " + Warehouse.makePartName(partSpec) + " does not exist in table "+ baseTbl.getTableName());
    }
    baseTblPartitions.add(part);
    Partition indexPart=db.getPartition(indexTbl,partSpec,false);
    if (indexPart == null) {
      indexPart=db.createPartition(indexTbl,partSpec);
    }
    indexTblPartitions.add(indexPart);
  }
 else   if (baseTbl.isPartitioned()) {
    baseTblPartitions=db.getPartitions(baseTbl);
    for (    Partition basePart : baseTblPartitions) {
      HashMap<String,String> pSpec=basePart.getSpec();
      Partition indexPart=db.getPartition(indexTbl,pSpec,false);
      if (indexPart == null) {
        indexPart=db.createPartition(indexTbl,pSpec);
      }
      indexTblPartitions.add(indexPart);
    }
  }
  return baseTblPartitions;
}
