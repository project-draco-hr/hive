{
  mConfig=config;
  mComputeServiceContext=initComputeServiceContext(config.getmProvider(),config.getIdentity(),config.getCredential());
  mComputeService=mComputeServiceContext.getComputeService();
  mTemplate=mComputeService.templateBuilder().hardwareId(config.getInstanceType()).imageId(config.getImageId()).build();
  TemplateOptions options=mTemplate.getOptions();
  options.blockOnPort(22,60);
  options.userMetadata(config.getUserMetaData());
switch (config.getmProvider()) {
case AWS:
    mGroupTag=String.format("group=%s",config.getGroupName());
  options.as(AWSEC2TemplateOptions.class).keyPair(config.getKeyPairName()).securityGroupIds(config.getSecurityGroup()).spotPrice(config.getMaxBid()).tags(Collections.singletonList(mGroupTag));
break;
case GCE:
mGroupTag=config.getGroupName();
options.as(GoogleComputeEngineTemplateOptions.class).tags(Arrays.asList(config.getGroupName(),config.getSecurityGroup()));
break;
default :
mGroupTag="";
}
}
