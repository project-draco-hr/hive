{
  String statsImpl=HiveConf.getVar(conf,HiveConf.ConfVars.HIVESTATSDBCLASS);
  StatsFactory factory=StatsFactory.newFactory(statsImpl,conf);
  if (factory == null) {
    throw new HiveException(ErrorMsg.STATSPUBLISHER_NOT_OBTAINED.getErrorCodedMsg());
  }
  StatsPublisher statsPublisher=factory.getStatsPublisher();
  if (!statsPublisher.init(conf)) {
    throw new HiveException(ErrorMsg.STATSPUBLISHER_INITIALIZATION_ERROR.getErrorCodedMsg());
  }
  Task sourceTask=getWork().getSourceTask();
  if (sourceTask == null) {
    throw new HiveException(ErrorMsg.STATSAGGREGATOR_SOURCETASK_NULL.getErrorCodedMsg());
  }
  StatsAggregator statsAggregator=factory.getStatsAggregator();
  if (!statsAggregator.connect(conf,sourceTask)) {
    throw new HiveException(ErrorMsg.STATSAGGREGATOR_CONNECTION_ERROR.getErrorCodedMsg(statsImpl));
  }
  return statsAggregator;
}
