{
  if (streamingState.rankLimitReached()) {
    return null;
  }
  WindowTableFunctionDef tabDef=(WindowTableFunctionDef)getTableDef();
  for (int i=0; i < tabDef.getWindowFunctions().size(); i++) {
    WindowFunctionDef wFn=tabDef.getWindowFunctions().get(i);
    GenericUDAFEvaluator fnEval=wFn.getWFnEval();
    int numRowsRemaining=wFn.getWindowFrame().getEnd().getRelativeOffset();
    if (fnEval instanceof ISupportStreamingModeForWindowing) {
      fnEval.terminate(streamingState.aggBuffers[i]);
      WindowingFunctionInfoHelper wFnInfo=getWindowingFunctionInfoHelper(wFn.getName());
      if (!wFnInfo.isSupportsWindow()) {
        numRowsRemaining=((ISupportStreamingModeForWindowing)fnEval).getRowsRemainingAfterTerminate();
      }
      if (numRowsRemaining != BoundarySpec.UNBOUNDED_AMOUNT) {
        while (numRowsRemaining > 0) {
          Object out=((ISupportStreamingModeForWindowing)fnEval).getNextResult(streamingState.aggBuffers[i]);
          if (out != null) {
            streamingState.fnOutputs[i].add(out == ISupportStreamingModeForWindowing.NULL_RESULT ? null : out);
          }
          numRowsRemaining--;
        }
      }
    }
 else {
      while (numRowsRemaining > 0) {
        int rowToProcess=streamingState.rollingPart.size() - numRowsRemaining;
        if (rowToProcess >= 0) {
          Range rng=getRange(wFn,rowToProcess,streamingState.rollingPart);
          PTFPartitionIterator<Object> rItr=rng.iterator();
          PTFOperator.connectLeadLagFunctionsToPartition(ptfDesc,rItr);
          Object out=evaluateWindowFunction(wFn,rItr);
          streamingState.fnOutputs[i].add(out);
        }
        numRowsRemaining--;
      }
    }
  }
  List<Object> oRows=new ArrayList<Object>();
  while (!streamingState.rollingPart.processedAllRows() && !streamingState.rankLimitReached()) {
    boolean hasRow=streamingState.hasOutputRow();
    if (!hasRow && !streamingState.rankLimitReached()) {
      throw new HiveException("Internal Error: cannot generate all output rows for a Partition");
    }
    if (hasRow) {
      oRows.add(streamingState.nextOutputRow());
    }
  }
  return oRows.size() == 0 ? null : oRows;
}
