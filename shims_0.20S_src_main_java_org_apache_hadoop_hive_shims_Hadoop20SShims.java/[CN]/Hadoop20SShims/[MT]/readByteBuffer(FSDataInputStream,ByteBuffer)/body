{
  int pos=dest.position();
  if (dest.hasArray()) {
    int result=file.read(dest.array(),dest.arrayOffset(),dest.remaining());
    if (result > 0) {
      dest.position(pos + result);
    }
    return result;
  }
 else {
    byte[] arr=new byte[dest.remaining()];
    int result=file.read(arr,0,arr.length);
    if (result > 0) {
      dest.put(arr,0,result);
      dest.position(pos + result);
    }
    return result;
  }
}
