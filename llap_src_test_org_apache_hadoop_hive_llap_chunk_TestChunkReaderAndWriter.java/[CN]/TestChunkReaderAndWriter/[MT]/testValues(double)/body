{
  Random random=new Random(1234);
  ChunkWriterImpl writer=new ChunkWriterImpl();
  WeakBuffer wb=createBuffer(LARGE_BUFFER);
  int[] valueCounts=new int[]{1,3,11,64,65,2048};
  int totalCount=0;
  for (  int valueCount : valueCounts) {
    LOG.info("Testing for value count " + valueCount);
    BufferInProgress buf=new BufferInProgress(wb);
    writer.prepare(buf);
    totalCount+=valueCount;
    Long[] src=new Long[valueCount];
    writeLongs(writer,random,nullFraction,valueCount,src,0);
    writer.finishCurrentSegment();
    verifyValues(completeChunk(writer,buf),src);
  }
  BufferInProgress buf=new BufferInProgress(wb);
  writer.prepare(buf);
  Long[] src=new Long[totalCount];
  int offset=0;
  LOG.info("Testing for total count " + totalCount);
  for (  int valueCount : valueCounts) {
    writeLongs(writer,random,nullFraction,valueCount,src,offset);
    offset+=valueCount;
  }
  writer.finishCurrentSegment();
  verifyValues(completeChunk(writer,buf),src);
}
