{
  NullsState nullState=nullFraction == 0 ? NullsState.NO_NULLS : NullsState.NEXT_NULL;
  long[] srcPart=new long[count];
  int offset=0;
  boolean isFirst=true, isNull=true;
  while (offset < count) {
    int runLength=0;
    if (!isFirst) {
      isNull=!isNull;
      if (!isNull) {
        srcPart[0]=rdm.nextLong();
      }
      src[srcOffset + offset]=isNull ? null : srcPart[0];
      runLength=1;
      ++offset;
    }
    while (offset < count) {
      boolean curIsNull=(rdm.nextDouble() <= nullFraction);
      if (!isFirst && curIsNull != isNull)       break;
      isNull=curIsNull;
      if (!isNull) {
        srcPart[runLength]=rdm.nextLong();
      }
      src[srcOffset + offset]=isNull ? null : srcPart[runLength];
      ++runLength;
      ++offset;
      isFirst=false;
    }
    if (isNull) {
      LOG.info("Writing " + runLength + " nulls");
      writer.writeNulls(runLength,true);
    }
 else {
      LOG.info("Writing " + runLength + " values");
      writer.writeLongs(srcPart,0,runLength,nullState);
    }
  }
}
