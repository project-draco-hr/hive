{
  assert(hookContext.getHookType() == HookContext.HookType.PRE_EXEC_HOOK);
  QueryPlan queryPlan=hookContext.getQueryPlan();
  ArrayList<Task<? extends Serializable>> rootTasks=queryPlan.getRootTasks();
  if ((rootTasks == null) || (rootTasks.size() != 1)) {
    return;
  }
  Task<? extends Serializable> tsk=rootTasks.get(0);
  if (!(tsk.getWork() instanceof DDLWork)) {
    return;
  }
  HiveConf conf=hookContext.getConf();
  DDLWork ddlWork=(DDLWork)tsk.getWork();
  float pubPercent=conf.getFloat(FBHiveConf.ENABLE_PARTIAL_CHANGEDFS,0);
  if (!HookUtils.rollDice(pubPercent)) {
    return;
  }
  String newDir=conf.get(FBHiveConf.SECONDARYMETASTOREWAREHOUSE);
  if (ddlWork.getCreateTblDesc() != null) {
    CreateTableDesc crtTblDesc=ddlWork.getCreateTblDesc();
    if (crtTblDesc.getLocation() != null) {
      return;
    }
    if ((crtTblDesc.getTableName() == null) || ((!crtTblDesc.getTableName().startsWith("tmp_")) && (!crtTblDesc.getTableName().startsWith("temp_")))) {
      return;
    }
    String locn=(new Warehouse(conf)).getTablePath(newDir,crtTblDesc.getTableName()).toString();
    crtTblDesc.setLocation(locn);
    LOG.info("change location for table " + crtTblDesc.getTableName());
    return;
  }
  if (ddlWork.getCreateTblLikeDesc() != null) {
    CreateTableLikeDesc crtTblLikeDesc=ddlWork.getCreateTblLikeDesc();
    if (crtTblLikeDesc.getLocation() != null) {
      return;
    }
    if ((crtTblLikeDesc.getTableName() == null) || ((!crtTblLikeDesc.getTableName().startsWith("tmp_")) && (!crtTblLikeDesc.getTableName().startsWith("temp_")))) {
      return;
    }
    String locn=(new Warehouse(conf)).getTablePath(newDir,crtTblLikeDesc.getTableName()).toString();
    crtTblLikeDesc.setLocation(locn);
    LOG.info("change location for table " + crtTblLikeDesc.getTableName());
    return;
  }
}
