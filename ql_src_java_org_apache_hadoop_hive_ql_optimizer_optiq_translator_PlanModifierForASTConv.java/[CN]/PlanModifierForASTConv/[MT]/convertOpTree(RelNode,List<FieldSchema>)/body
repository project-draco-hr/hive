{
  RelNode newTopNode=rel;
  if (!(newTopNode instanceof ProjectRelBase) && !(newTopNode instanceof SortRel)) {
    newTopNode=introduceDerivedTable(newTopNode);
  }
  convertOpTree(newTopNode,(RelNode)null);
  Pair<RelNode,RelNode> topSelparentPair=HiveOptiqUtil.getTopLevelSelect(newTopNode);
  fixTopOBSchema(newTopNode,topSelparentPair,resultSchema);
  topSelparentPair=HiveOptiqUtil.getTopLevelSelect(newTopNode);
  newTopNode=renameTopLevelSelectInResultSchema(newTopNode,topSelparentPair,resultSchema);
  return newTopNode;
}
