{
  UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
  Text owner=new Text(ugi.getUserName());
  Text realUser=null;
  if (ugi.getRealUser() != null) {
    realUser=new Text(ugi.getRealUser().getUserName());
  }
  DelegationTokenIdentifier ident=new DelegationTokenIdentifier(owner,new Text(renewer),realUser);
  Token<DelegationTokenIdentifier> t=new Token<DelegationTokenIdentifier>(ident,this);
  if (tokenSignature != null) {
    t.setService(new Text(tokenSignature));
  }
  return t.encodeToUrlString();
}
