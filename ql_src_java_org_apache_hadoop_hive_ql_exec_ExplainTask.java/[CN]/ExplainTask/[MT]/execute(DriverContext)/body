{
  PrintStream out=null;
  try {
    Path resFile=new Path(work.getResFile());
    OutputStream outS=resFile.getFileSystem(conf).create(resFile);
    out=new PrintStream(outS);
    if (work.getDependency()) {
      JSONObject jsonDependencies=getJSONDependencies(work);
      out.print(jsonDependencies);
    }
 else {
      JSONObject jsonPlan=getJSONPlan(out,work);
      if (work.isFormatted()) {
        out.print(jsonPlan);
      }
    }
    out.close();
    out=null;
    return (0);
  }
 catch (  Exception e) {
    console.printError("Failed with exception " + e.getMessage(),"\n" + StringUtils.stringifyException(e));
    return (1);
  }
 finally {
    IOUtils.closeStream(out);
  }
}
