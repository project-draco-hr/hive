{
  if (displayedSet.contains(task)) {
    return null;
  }
  displayedSet.add(task);
  if (out != null) {
    out.print(indentString(indent));
    out.printf("Stage: %s\n",task.getId());
  }
  JSONObject jsonOutputPlan=outputPlan(task.getWork(),out,extended,jsonOutput,jsonOutput ? 0 : indent + 2);
  if (out != null) {
    out.println();
  }
  if (jsonOutput) {
    parentJSON.put(task.getId(),jsonOutputPlan);
  }
  if (task instanceof ConditionalTask && ((ConditionalTask)task).getListTasks() != null) {
    for (    Task<? extends Serializable> con : ((ConditionalTask)task).getListTasks()) {
      outputPlan(con,out,parentJSON,extended,jsonOutput,displayedSet,jsonOutput ? 0 : indent);
    }
  }
  if (task.getChildTasks() != null) {
    for (    Task<? extends Serializable> child : task.getChildTasks()) {
      outputPlan(child,out,parentJSON,extended,jsonOutput,displayedSet,jsonOutput ? 0 : indent);
    }
  }
  return null;
}
