{
  writeLock.lock();
  try {
    if (!this.isStopped.getAndSet(true)) {
      nodeEnablerCallable.shutdown();
      if (nodeEnablerFuture != null) {
        nodeEnablerFuture.cancel(true);
      }
      nodeEnabledExecutor.shutdownNow();
      timeoutExecutor.shutdown();
      if (timeoutFuture != null) {
        timeoutFuture.cancel(true);
        timeoutFuture=null;
      }
      timeoutExecutor.shutdownNow();
      delayedTaskSchedulerCallable.shutdown();
      if (delayedTaskSchedulerFuture != null) {
        delayedTaskSchedulerFuture.cancel(true);
      }
      delayedTaskSchedulerExecutor.shutdownNow();
      schedulerCallable.shutdown();
      if (schedulerFuture != null) {
        schedulerFuture.cancel(true);
      }
      schedulerExecutor.shutdownNow();
      if (registry != null) {
        registry.stop();
      }
      if (pauseMonitor != null) {
        pauseMonitor.stop();
      }
      if (metrics != null) {
        LlapMetricsSystem.shutdown();
      }
    }
  }
  finally {
    writeLock.unlock();
  }
}
