{
  Map<String,String> templateVariables=Maps.newHashMap(mTemplateDefaults);
  templateVariables.put("instanceName",drone.getInstanceName());
  templateVariables.put("localDir",drone.getLocalDirectory());
  RSyncResult result=new RSyncCommand(mRSyncCommandExecutor,drone.getPrivateKey(),drone.getUser(),drone.getHost(),drone.getInstance(),Templates.getTemplateResult(localFile,templateVariables),Templates.getTemplateResult(remoteFile,templateVariables),RSyncCommand.Type.FROM_LOCAL).call();
  if (result.getExitCode() != Constants.EXIT_CODE_SUCCESS) {
    throw new AbortDroneException("Drone " + drone + " exited with "+ result.getExitCode()+ ": "+ result);
  }
  if (result.getException() != null || result.getExitCode() != 0) {
    throw new SSHExecutionException(result);
  }
  return result;
}
