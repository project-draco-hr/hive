{
  Map<String,String> tableJobProperties=tableDesc.getJobProperties();
  String jobString=tableJobProperties.get(HCatConstants.HCAT_KEY_JOB_INFO);
  try {
    InputJobInfo inputJobInfo=(InputJobInfo)HCatUtil.deserialize(jobString);
    HCatTableInfo tableInfo=inputJobInfo.getTableInfo();
    String qualifiedTableName=HBaseHCatStorageHandler.getFullyQualifiedName(tableInfo);
    jobProperties.put(TableInputFormat.INPUT_TABLE,qualifiedTableName);
    Configuration jobConf=getConf();
    addHbaseResources(jobConf,jobProperties);
    Configuration copyOfConf=new Configuration(jobConf);
    HBaseConfiguration.addHbaseResources(copyOfConf);
    if (jobConf instanceof JobConf) {
      HBaseUtil.addHBaseDelegationToken((JobConf)jobConf);
    }
    String outputSchema=jobConf.get(HCatConstants.HCAT_KEY_OUTPUT_SCHEMA);
    jobProperties.put(TableInputFormat.SCAN_COLUMNS,getScanColumns(tableInfo,outputSchema));
    String serSnapshot=(String)inputJobInfo.getProperties().get(HBaseConstants.PROPERTY_TABLE_SNAPSHOT_KEY);
    if (serSnapshot == null) {
      HCatTableSnapshot snapshot=HBaseRevisionManagerUtil.createSnapshot(copyOfConf,qualifiedTableName,tableInfo);
      jobProperties.put(HBaseConstants.PROPERTY_TABLE_SNAPSHOT_KEY,HCatUtil.serialize(snapshot));
    }
    addOutputDependencyJars(jobConf);
    jobProperties.put("tmpjars",jobConf.get("tmpjars"));
  }
 catch (  IOException e) {
    throw new IllegalStateException("Error while configuring job properties",e);
  }
}
