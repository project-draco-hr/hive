{
  if (tree.getOperator() == ExpressionTree.Operator.LEAF) {
    int oldLeaf=tree.getLeaf();
    if (leafReorder[oldLeaf] == -1) {
      leafReorder[oldLeaf]=next++;
    }
  }
 else   if (tree.getChildren() != null) {
    for (    ExpressionTree child : tree.getChildren()) {
      next=compactLeaves(child,next,leafReorder);
    }
  }
  return next;
}
