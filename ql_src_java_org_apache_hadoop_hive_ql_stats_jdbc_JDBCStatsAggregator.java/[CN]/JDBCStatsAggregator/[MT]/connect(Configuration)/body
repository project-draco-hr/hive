{
  this.hiveconf=hiveconf;
  timeout=HiveConf.getIntVar(hiveconf,HiveConf.ConfVars.HIVE_STATS_JDBC_TIMEOUT);
  connectionString=HiveConf.getVar(hiveconf,HiveConf.ConfVars.HIVESTATSDBCONNECTIONSTRING);
  String driver=HiveConf.getVar(hiveconf,HiveConf.ConfVars.HIVESTATSJDBCDRIVER);
  maxRetries=HiveConf.getIntVar(hiveconf,HiveConf.ConfVars.HIVE_STATS_RETRIES_MAX);
  waitWindow=HiveConf.getIntVar(hiveconf,HiveConf.ConfVars.HIVE_STATS_RETRIES_WAIT);
  try {
    Class.forName(driver).newInstance();
  }
 catch (  Exception e) {
    LOG.error("Error during instantiating JDBC driver " + driver + ". ",e);
    return false;
  }
  String select="SELECT /* " + comment + " */ "+ " SUM("+ JDBCStatsSetupConstants.PART_STAT_ROW_COUNT_COLUMN_NAME+ ")"+ " FROM "+ JDBCStatsSetupConstants.PART_STAT_TABLE_NAME+ " WHERE "+ JDBCStatsSetupConstants.PART_STAT_ID_COLUMN_NAME+ " LIKE ? ESCAPE ?";
  String delete="DELETE /* " + comment + " */ "+ " FROM "+ JDBCStatsSetupConstants.PART_STAT_TABLE_NAME+ " WHERE "+ JDBCStatsSetupConstants.PART_STAT_ID_COLUMN_NAME+ " LIKE ? ESCAPE ?";
  DriverManager.setLoginTimeout(timeout);
  Utilities.SQLCommand<Void> setQueryTimeout=new Utilities.SQLCommand<Void>(){
    @Override public Void run(    PreparedStatement stmt) throws SQLException {
      stmt.setQueryTimeout(timeout);
      return null;
    }
  }
;
  for (int failures=0; ; failures++) {
    try {
      conn=Utilities.connectWithRetry(connectionString,waitWindow,maxRetries);
      selStmt=Utilities.prepareWithRetry(conn,select,waitWindow,maxRetries);
      delStmt=Utilities.prepareWithRetry(conn,delete,waitWindow,maxRetries);
      Utilities.executeWithRetry(setQueryTimeout,selStmt,waitWindow,failures);
      Utilities.executeWithRetry(setQueryTimeout,delStmt,waitWindow,failures);
      return true;
    }
 catch (    SQLRecoverableException e) {
      if (failures > maxRetries) {
        LOG.error("Error during JDBC connection and preparing statement: " + e);
        return false;
      }
      long waitTime=Utilities.getRandomWaitTime(waitWindow,failures,r);
      try {
        Thread.sleep(waitTime);
      }
 catch (      InterruptedException e1) {
      }
    }
catch (    SQLException e) {
      return false;
    }
  }
}
