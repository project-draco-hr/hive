{
  flushStripe();
  if (stripesAtLastFlush != stripes.size()) {
    if (callback != null) {
      callback.preFooterWrite(callbackContext);
    }
    int metaLength=writeMetadata();
    int footLength=writeFooter(rawWriter.getPos() - metaLength);
    rawWriter.writeByte(writePostScript(footLength,metaLength));
    stripesAtLastFlush=stripes.size();
    rawWriter.hflush();
  }
  return rawWriter.getPos();
}
