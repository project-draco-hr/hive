{
  try {
    final int dataNodes=1;
    final int taskTrackers=1;
    Configuration config=new Configuration();
    if (System.getProperty("hadoop.log.dir") == null) {
      System.setProperty("hadoop.log.dir","target/tmp/logs/");
    }
    m_dfs=new MiniDFSCluster(config,dataNodes,true,null);
    m_fileSys=m_dfs.getFileSystem();
    m_mr=new MiniMRCluster(taskTrackers,m_fileSys.getUri().toString(),1);
    File conf_dir=new File(System.getProperty("user.home"),"pigtest/conf/");
    conf_dir.mkdirs();
    File conf_file=new File(conf_dir,"hadoop-site.xml");
    m_conf=m_mr.createJobConf();
    m_conf.setInt("mapred.submit.replication",1);
    m_conf.set("dfs.datanode.address","0.0.0.0:0");
    m_conf.set("dfs.datanode.http.address","0.0.0.0:0");
    m_conf.writeXml(new FileOutputStream(conf_file));
    System.setProperty("cluster",m_conf.get("mapred.job.tracker"));
    System.setProperty("namenode",m_conf.get("fs.default.name"));
    System.setProperty("junit.hadoop.conf",conf_dir.getPath());
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
