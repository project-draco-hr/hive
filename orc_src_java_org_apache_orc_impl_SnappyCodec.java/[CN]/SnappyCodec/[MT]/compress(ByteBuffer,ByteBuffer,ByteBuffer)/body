{
  int inBytes=in.remaining();
  byte[] compressed=new byte[Snappy.maxCompressedLength(inBytes)];
  int outBytes=Snappy.compress(in.array(),in.arrayOffset() + in.position(),inBytes,compressed,0);
  if (outBytes < inBytes) {
    int remaining=out.remaining();
    if (remaining >= outBytes) {
      System.arraycopy(compressed,0,out.array(),out.arrayOffset() + out.position(),outBytes);
      out.position(out.position() + outBytes);
    }
 else {
      System.arraycopy(compressed,0,out.array(),out.arrayOffset() + out.position(),remaining);
      out.position(out.limit());
      System.arraycopy(compressed,remaining,overflow.array(),overflow.arrayOffset(),outBytes - remaining);
      overflow.position(outBytes - remaining);
    }
    return true;
  }
 else {
    return false;
  }
}
