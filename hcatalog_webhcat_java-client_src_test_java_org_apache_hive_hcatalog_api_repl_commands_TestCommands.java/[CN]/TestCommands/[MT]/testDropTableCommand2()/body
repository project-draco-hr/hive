{
  String dbName="cmd_testdb";
  String tableName="cmd_testtable";
  int evid=157;
  List<HCatFieldSchema> pcols=HCatSchemaUtils.getHCatSchema("b:string").getFields();
  List<HCatFieldSchema> cols=HCatSchemaUtils.getHCatSchema("a:int").getFields();
  Command testReplicatedDropCmd=new DropTableCommand(dbName,tableName,true,evid);
  client.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
  client.createDatabase(HCatCreateDBDesc.create(dbName).ifNotExists(false).build());
  Map<String,String> tprops=new HashMap<String,String>();
  tprops.put(ReplicationUtils.REPL_STATE_ID,String.valueOf(evid + 2));
  HCatTable table=(new HCatTable(dbName,tableName)).tblProps(tprops).cols(cols).partCols(pcols);
  client.createTable(HCatCreateTableDesc.create(table).build());
  HCatTable tableCreated=client.getTable(dbName,tableName);
  assertNotNull(tableCreated);
  Map<String,String> ptnDesc1=new HashMap<String,String>();
  ptnDesc1.put("b","test-older");
  Map<String,String> props1=new HashMap<String,String>();
  props1.put(ReplicationUtils.REPL_STATE_ID,String.valueOf(evid - 5));
  HCatPartition ptnToAdd1=(new HCatPartition(tableCreated,ptnDesc1,TestHCatClient.makePartLocation(tableCreated,ptnDesc1))).parameters(props1);
  client.addPartition(HCatAddPartitionDesc.create(ptnToAdd1).build());
  Map<String,String> ptnDesc2=new HashMap<String,String>();
  ptnDesc2.put("b","test-newer");
  Map<String,String> props2=new HashMap<String,String>();
  props2.put(ReplicationUtils.REPL_STATE_ID,String.valueOf(evid + 5));
  HCatPartition ptnToAdd2=(new HCatPartition(tableCreated,ptnDesc2,TestHCatClient.makePartLocation(tableCreated,ptnDesc2))).parameters(props2);
  client.addPartition(HCatAddPartitionDesc.create(ptnToAdd2).build());
  HCatPartition p1=client.getPartition(dbName,tableName,ptnDesc1);
  assertNotNull(p1);
  HCatPartition p2=client.getPartition(dbName,tableName,ptnDesc2);
  assertNotNull(p2);
  LOG.info("About to run :" + testReplicatedDropCmd.get().get(0));
  driver.run(testReplicatedDropCmd.get().get(0));
  HCatTable t_stillExists=client.getTable(dbName,tableName);
  assertNotNull(t_stillExists);
  HCatPartition p2_stillExists=client.getPartition(dbName,tableName,ptnDesc2);
  Exception onfe=null;
  try {
    HCatPartition p1_del=client.getPartition(dbName,tableName,ptnDesc1);
  }
 catch (  Exception e) {
    onfe=e;
  }
  assertNotNull(onfe);
  assertTrue(onfe instanceof ObjectNotFoundException);
}
