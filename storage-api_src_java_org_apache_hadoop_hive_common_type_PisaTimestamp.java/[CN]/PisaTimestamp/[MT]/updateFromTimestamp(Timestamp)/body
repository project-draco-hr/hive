{
  long timestampTime=timestamp.getTime();
  int nanos=timestamp.getNanos();
  if (timestampTime < 0 && nanos > 0) {
    timestampTime-=MILLISECONDS_PER_SECOND;
  }
  long epochSeconds=timestampTime / MILLISECONDS_PER_SECOND;
  nanoOfDay=(epochSeconds % SECONDS_PER_DAY) * NANOSECONDS_PER_SECOND + nanos;
  epochDay=epochSeconds / SECONDS_PER_DAY + (nanoOfDay / NANOSECONDS_PER_DAY);
  Preconditions.checkState(validateIntegrity(epochDay,nanoOfDay));
  return this;
}
