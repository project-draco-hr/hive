{
  HiveConf conf=new HiveConf();
  conf.setBoolVar(HiveConf.ConfVars.HIVE_SERVER2_METRICS_ENABLED,true);
  conf.setVar(HiveConf.ConfVars.HIVE_METRICS_REPORTER,MetricsReporting.JSON_FILE.name() + "," + MetricsReporting.JMX.name());
  MetricsFactory.init(conf);
  CodahaleMetrics metrics=(CodahaleMetrics)MetricsFactory.getInstance();
  objectStore.new GetDbHelper("foo",null,true,true){
    @Override protected Database getSqlResult(    ObjectStore.GetHelper<Database> ctx) throws MetaException {
      return null;
    }
    @Override protected Database getJdoResult(    ObjectStore.GetHelper<Database> ctx) throws MetaException, NoSuchObjectException {
      return null;
    }
  }
.run(false);
  String json=metrics.dumpJson();
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,MetricsConstant.DIRECTSQL_ERRORS,"");
  objectStore.new GetDbHelper("foo",null,true,true){
    @Override protected Database getSqlResult(    ObjectStore.GetHelper<Database> ctx) throws MetaException {
      throw new RuntimeException();
    }
    @Override protected Database getJdoResult(    ObjectStore.GetHelper<Database> ctx) throws MetaException, NoSuchObjectException {
      return null;
    }
  }
.run(false);
  json=metrics.dumpJson();
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,MetricsConstant.DIRECTSQL_ERRORS,1);
}
