{
  if (fname == null || conf == null) {
    return null;
  }
  final Configuration fConf=new Configuration(conf);
  final String finalFName=new String(fname);
  UserGroupInformation ugi=UserGroupInformation.getLoginUser();
  final FileSystem defaultFs=ugi.doAs(new PrivilegedExceptionAction<FileSystem>(){
    public FileSystem run() throws URISyntaxException, FileNotFoundException, IOException, InterruptedException {
      return FileSystem.get(new URI(finalFName),fConf);
    }
  }
);
  URI u=new URI(fname);
  Path p=new Path(u).makeQualified(defaultFs);
  if (hadoopFsIsMissing(defaultFs,p))   throw new FileNotFoundException("File " + fname + " does not exist.");
  return p;
}
