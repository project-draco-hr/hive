{
  SliderClient sliderClient=null;
  try {
    for (    String f : LlapDaemonConfiguration.DAEMON_CONFIGS) {
      conf.addResource(f);
    }
    conf.reloadConfiguration();
    for (    Map.Entry<Object,Object> props : options.getConf().entrySet()) {
      conf.set((String)props.getKey(),(String)props.getValue());
    }
    conf.set("yarn.timeline-service.entity-group-fs-store.retry-policy-spec",conf.get(CONFIG_TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_RETRY_POLICY_SPEC,CONFIG_TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_RETRY_POLICY_SPEC_DEFAULT));
    conf.setLong(YarnConfiguration.RESOURCEMANAGER_CONNECT_MAX_WAIT_MS,conf.getLong(CONFIG_YARN_RM_TIMEOUT_MAX_WAIT_MS,CONFIG_YARN_RM_TIMEOUT_MAX_WAIT_MS_DEFAULT));
    conf.setLong(YarnConfiguration.RESOURCEMANAGER_CONNECT_RETRY_INTERVAL_MS,conf.getLong(CONFIG_YARN_RM_RETRY_INTERVAL_MS,CONFIG_YARN_RM_RETRY_INTERVAL_MS_DEFAULT));
    conf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECT_MAX_RETRIES_KEY,conf.getInt(CONFIG_IPC_CLIENT_CONNECT_MAX_RETRIES,CONFIG_IPC_CLIENT_CONNECT_MAX_RETRIES_DEFAULT));
    conf.setLong(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECT_RETRY_INTERVAL_KEY,conf.getLong(CONFIG_IPC_CLIENT_CONNECT_RETRY_INTERVAL_MS,CONFIG_IPC_CLIENT_CONNECT_RETRY_INTERVAL_MS_DEFAULT));
    HiveConf.setVar(conf,HiveConf.ConfVars.HIVE_ZOOKEEPER_SESSION_TIMEOUT,(conf.getLong(CONFIG_LLAP_ZK_REGISTRY_TIMEOUT_MS,CONFIG_LLAP_ZK_REGISTRY_TIMEOUT_MS_DEFAULT) + "ms"));
    String appName;
    appName=options.getName();
    if (StringUtils.isEmpty(appName)) {
      appName=HiveConf.getVar(conf,HiveConf.ConfVars.LLAP_DAEMON_SERVICE_HOSTS);
      if (appName.startsWith("@") && appName.length() > 1) {
        appName=appName.substring(1);
      }
 else {
        appName=null;
      }
    }
    if (StringUtils.isEmpty(appName)) {
      String message="Invalid app name. This must be setup via config or passed in as a parameter." + " This tool works with clusters deployed by Slider/YARN";
      LOG.info(message);
      return ExitCode.INCORRECT_USAGE.getInt();
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug("Using appName: {}",appName);
    }
    try {
      sliderClient=createSliderClient();
    }
 catch (    LlapStatusCliException e) {
      logError(e);
      return e.getExitCode().getInt();
    }
    ApplicationReport appReport=null;
    try {
      appReport=getAppReport(appName,sliderClient,options.getFindAppTimeoutMs());
    }
 catch (    LlapStatusCliException e) {
      logError(e);
      return e.getExitCode().getInt();
    }
    ExitCode ret;
    try {
      ret=processAppReport(appReport,appStatusBuilder);
    }
 catch (    LlapStatusCliException e) {
      logError(e);
      return e.getExitCode().getInt();
    }
    if (ret != ExitCode.SUCCESS) {
      return ret.getInt();
    }
 else     if (EnumSet.of(State.APP_NOT_FOUND,State.COMPLETE,State.LAUNCHING).contains(appStatusBuilder.getState())) {
      return ExitCode.SUCCESS.getInt();
    }
 else {
      try {
        ret=populateAppStatusFromSlider(appName,sliderClient,appStatusBuilder);
      }
 catch (      LlapStatusCliException e) {
        logError(e);
        return e.getExitCode().getInt();
      }
    }
    if (ret != ExitCode.SUCCESS) {
      return ret.getInt();
    }
 else {
      try {
        ret=populateAppStatusFromLlapRegistry(appName,appStatusBuilder);
      }
 catch (      LlapStatusCliException e) {
        logError(e);
        return e.getExitCode().getInt();
      }
    }
    return ret.getInt();
  }
  finally {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Final AppState: " + appStatusBuilder.toString());
    }
    if (sliderClient != null) {
      sliderClient.stop();
    }
  }
}
