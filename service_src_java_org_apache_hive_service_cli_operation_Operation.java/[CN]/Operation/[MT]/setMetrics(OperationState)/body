{
  Metrics metrics=MetricsFactory.getInstance();
  if (metrics != null) {
    try {
      if (currentStateScope != null) {
        metrics.endScope(currentStateScope);
        currentStateScope=null;
      }
      if (scopeStates.contains(state)) {
        currentStateScope=metrics.createScope(MetricsConstant.OPERATION_PREFIX + state.toString());
      }
      if (terminalStates.contains(state)) {
        metrics.incrementCounter(MetricsConstant.COMPLETED_OPERATION_PREFIX + state.toString());
      }
    }
 catch (    IOException e) {
      LOG.warn("Error metrics",e);
    }
  }
}
