{
  XMLEncoder e=new XMLEncoder(out);
  e.setExceptionListener(new ExceptionListener(){
    public void exceptionThrown(    Exception e){
      LOG.warn(org.apache.hadoop.util.StringUtils.stringifyException(e));
      throw new RuntimeException("Cannot serialize the query plan",e);
    }
  }
);
  e.setPersistenceDelegate(ExpressionTypes.class,new EnumDelegate());
  e.setPersistenceDelegate(GroupByDesc.Mode.class,new EnumDelegate());
  e.setPersistenceDelegate(Operator.ProgressCounter.class,new EnumDelegate());
  e.setPersistenceDelegate(org.datanucleus.store.types.sco.backed.Map.class,new MapDelegate());
  e.setPersistenceDelegate(org.datanucleus.store.types.sco.backed.List.class,new ListDelegate());
  e.writeObject(plan);
  e.close();
}
