{
  try {
    FileSystem fs=FileSystem.get(job);
    Path planPath=new Path(HiveConf.getVar(job,HiveConf.ConfVars.SCRATCHDIR),"plan." + randGen.nextInt());
    FSDataOutputStream out=fs.create(planPath);
    serializeMapRedWork(w,out);
    HiveConf.setVar(job,HiveConf.ConfVars.PLAN,planPath.toString());
    DistributedCache.createSymlink(job);
    String uriWithLink=planPath.toUri().toString() + "#HIVE_PLAN" + sanitizedJobId(job);
    DistributedCache.addCacheFile(new URI(uriWithLink),job);
synchronized (Utilities.class) {
      w.initialize();
      gWorkMap.put(getJobName(job),w);
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw new RuntimeException(e);
  }
}
