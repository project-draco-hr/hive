{
  boolean foundCrChar=false;
  while (true) {
    int b;
    try {
      b=in.readByte();
    }
 catch (    EOFException e) {
      return StreamStatus.EOF;
    }
    if (Shell.WINDOWS) {
      if (foundCrChar && b != Utilities.newLineCode) {
        out.write(Utilities.carriageReturnCode);
        foundCrChar=false;
      }
      if (b == Utilities.carriageReturnCode) {
        foundCrChar=true;
        continue;
      }
    }
    if (b == Utilities.newLineCode) {
      return StreamStatus.TERMINATED;
    }
    out.write(b);
  }
}
