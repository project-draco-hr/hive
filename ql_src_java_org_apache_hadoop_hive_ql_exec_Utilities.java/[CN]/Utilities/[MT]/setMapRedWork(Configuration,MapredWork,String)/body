{
  try {
    if (!HiveConf.getVar(job,HiveConf.ConfVars.HADOOPJT).equals("local")) {
      Path planPath=new Path(hiveScratchDir,"plan." + randGen.nextInt());
      FileSystem fs=planPath.getFileSystem(job);
      FSDataOutputStream out=fs.create(planPath);
      serializeMapRedWork(w,out);
      HiveConf.setVar(job,HiveConf.ConfVars.PLAN,planPath.toString());
      DistributedCache.createSymlink(job);
      String uriWithLink=planPath.toUri().toString() + "#HIVE_PLAN" + sanitizedJobId(job);
      DistributedCache.addCacheFile(new URI(uriWithLink),job);
    }
    w.initialize();
    gWorkMap.put(getJobName(job),w);
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw new RuntimeException(e);
  }
}
