{
  FileSystem fs=specPath.getFileSystem(hconf);
  Path tmpPath=Utilities.toTempPath(specPath);
  Path taskTmpPath=Utilities.toTaskTempPath(specPath);
  if (success) {
    FileStatus[] statuses=HiveStatsUtils.getFileStatusRecurse(tmpPath,((dpCtx == null) ? 1 : dpCtx.getNumDPCols()),fs);
    if (statuses != null && statuses.length > 0) {
      List<Path> emptyBuckets=Utilities.removeTempOrDuplicateFiles(fs,statuses,dpCtx,conf,hconf);
      if (emptyBuckets.size() > 0) {
        createEmptyBuckets(hconf,emptyBuckets,conf,reporter);
      }
      log.info("Moving tmp dir: " + tmpPath + " to: "+ specPath);
      Utilities.renameOrMoveFiles(fs,tmpPath,specPath);
    }
  }
 else {
    fs.delete(tmpPath,true);
  }
  fs.delete(taskTmpPath,true);
}
