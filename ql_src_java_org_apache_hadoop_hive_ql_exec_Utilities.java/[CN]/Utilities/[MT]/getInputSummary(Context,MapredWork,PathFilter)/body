{
  long[] summary={0,0,0};
  for (  String path : work.getPathToAliases().keySet()) {
    try {
      Path p=new Path(path);
      if (filter != null && !filter.accept(p)) {
        continue;
      }
      ContentSummary cs=ctx.getCS(path);
      if (cs == null) {
        JobConf jobConf=new JobConf(ctx.getConf());
        PartitionDesc partDesc=work.getPathToPartitionInfo().get(p.toString());
        Class<? extends InputFormat> inputFormatCls=partDesc.getInputFileFormatClass();
        InputFormat inputFormatObj=HiveInputFormat.getInputFormatFromCache(inputFormatCls,jobConf);
        if (inputFormatObj instanceof ContentSummaryInputFormat) {
          cs=((ContentSummaryInputFormat)inputFormatObj).getContentSummary(p,jobConf);
        }
 else {
          FileSystem fs=p.getFileSystem(ctx.getConf());
          cs=fs.getContentSummary(p);
        }
        ctx.addCS(path,cs);
        LOG.info("Cache Content Summary for " + path + " length: "+ cs.getLength()+ " file count: "+ cs.getFileCount()+ " directory count: "+ cs.getDirectoryCount());
      }
      summary[0]+=cs.getLength();
      summary[1]+=cs.getFileCount();
      summary[2]+=cs.getDirectoryCount();
    }
 catch (    IOException e) {
      LOG.info("Cannot get size of " + path + ". Safely ignored.");
    }
  }
  return new ContentSummary(summary[0],summary[1],summary[2]);
}
