{
  PerfLogger perfLogger=PerfLogger.getPerfLogger();
  perfLogger.PerfLogBegin(CLASS_NAME,PerfLogger.SERIALIZE_PLAN);
  String serializationType=conf.get(HiveConf.ConfVars.PLAN_SERIALIZATION.varname,"kryo");
  LOG.info("Serializing " + plan.getClass().getSimpleName() + " via "+ serializationType);
  if ("javaXML".equalsIgnoreCase(serializationType)) {
    serializeObjectByJavaXML(plan,out);
  }
 else {
    if (cloningPlan) {
      serializeObjectByKryo(cloningQueryPlanKryo.get(),plan,out);
    }
 else {
      serializeObjectByKryo(runtimeSerializationKryo.get(),plan,out);
    }
  }
  perfLogger.PerfLogEnd(CLASS_NAME,PerfLogger.SERIALIZE_PLAN);
}
