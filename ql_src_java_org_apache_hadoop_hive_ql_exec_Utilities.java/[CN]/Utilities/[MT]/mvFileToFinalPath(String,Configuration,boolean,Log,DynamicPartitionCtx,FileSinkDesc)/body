{
  FileSystem fs=(new Path(specPath)).getFileSystem(hconf);
  Path tmpPath=Utilities.toTempPath(specPath);
  Path taskTmpPath=Utilities.toTaskTempPath(specPath);
  Path intermediatePath=new Path(tmpPath.getParent(),tmpPath.getName() + ".intermediate");
  Path finalPath=new Path(specPath);
  if (success) {
    if (fs.exists(tmpPath)) {
      log.info("Moving tmp dir: " + tmpPath + " to: "+ intermediatePath);
      Utilities.rename(fs,tmpPath,intermediatePath);
      ArrayList<String> emptyBuckets=Utilities.removeTempOrDuplicateFiles(fs,intermediatePath,dpCtx);
      if (emptyBuckets.size() > 0) {
        createEmptyBuckets(hconf,emptyBuckets,conf);
      }
      log.info("Moving tmp dir: " + intermediatePath + " to: "+ finalPath);
      Utilities.renameOrMoveFiles(fs,intermediatePath,finalPath);
    }
  }
 else {
    fs.delete(tmpPath,true);
  }
  fs.delete(taskTmpPath,true);
}
