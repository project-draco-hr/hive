{
  List<BatchType> batches=new ArrayList<BatchType>(pendingData.size());
synchronized (pendingData) {
    if (isStopped) {
      this.isStopped=true;
    }
    for (    BatchType ecb : pendingData.values()) {
      ++ecb.version;
      batches.add(ecb);
    }
    pendingData.clear();
  }
  for (  BatchType batch : batches) {
    upstreamFeedback.returnData(batch);
  }
}
