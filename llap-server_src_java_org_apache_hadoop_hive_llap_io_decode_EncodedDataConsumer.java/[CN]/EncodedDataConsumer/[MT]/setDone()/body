{
synchronized (pendingData) {
    if (!pendingData.isEmpty()) {
      throw new AssertionError("Not all data has been sent downstream: " + pendingData.size());
    }
  }
  downstreamConsumer.setDone();
}
