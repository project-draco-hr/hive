{
  SessionState ss=SessionState.get();
  String cmd_trimmed=cmd.trim();
  String[] tokens=cmd_trimmed.split("\\s+");
  String cmd_1=cmd_trimmed.substring(tokens[0].length()).trim();
  int ret=0;
  if (cmd_trimmed.toLowerCase().equals("quit") || cmd_trimmed.toLowerCase().equals("exit")) {
    System.exit(0);
  }
 else   if (cmd_trimmed.startsWith("!")) {
    String shell_cmd=cmd_trimmed.substring(1);
    try {
      Process executor=Runtime.getRuntime().exec(shell_cmd);
      StreamPrinter outPrinter=new StreamPrinter(executor.getInputStream(),null,ss.out);
      StreamPrinter errPrinter=new StreamPrinter(executor.getErrorStream(),null,ss.err);
      outPrinter.start();
      errPrinter.start();
      ret=executor.waitFor();
      if (ret != 0) {
        console.printError("Command failed with exit code = " + ret);
      }
    }
 catch (    Exception e) {
      console.printError("Exception raised from Shell command " + e.getLocalizedMessage(),org.apache.hadoop.util.StringUtils.stringifyException(e));
      ret=1;
    }
  }
 else   if (tokens[0].toLowerCase().equals("list")) {
    SessionState.ResourceType t;
    if (tokens.length < 2 || (t=SessionState.find_resource_type(tokens[1])) == null) {
      console.printError("Usage: list [" + StringUtils.join(SessionState.ResourceType.values(),"|") + "] [<value> [<value>]*]");
      ret=1;
    }
 else {
      List<String> filter=null;
      if (tokens.length >= 3) {
        System.arraycopy(tokens,2,tokens,0,tokens.length - 2);
        filter=Arrays.asList(tokens);
      }
      Set<String> s=ss.list_resource(t,filter);
      if (s != null && !s.isEmpty())       ss.out.println(StringUtils.join(s,"\n"));
    }
  }
 else {
    CommandProcessor proc=CommandProcessorFactory.get(tokens[0]);
    if (proc != null) {
      if (proc instanceof Driver) {
        Driver qp=(Driver)proc;
        PrintStream out=ss.out;
        long start=System.currentTimeMillis();
        ret=qp.run(cmd);
        if (ret != 0) {
          qp.close();
          return ret;
        }
        Vector<String> res=new Vector<String>();
        try {
          while (qp.getResults(res)) {
            for (            String r : res) {
              out.println(r);
            }
            res.clear();
            if (out.checkError()) {
              break;
            }
          }
        }
 catch (        IOException e) {
          console.printError("Failed with exception " + e.getClass().getName() + ":"+ e.getMessage(),"\n" + org.apache.hadoop.util.StringUtils.stringifyException(e));
          ret=1;
        }
        int cret=qp.close();
        if (ret == 0) {
          ret=cret;
        }
        long end=System.currentTimeMillis();
        if (end > start) {
          double timeTaken=(double)(end - start) / 1000.0;
          console.printInfo("Time taken: " + timeTaken + " seconds",null);
        }
      }
 else {
        ret=proc.run(cmd_1);
      }
    }
  }
  return ret;
}
