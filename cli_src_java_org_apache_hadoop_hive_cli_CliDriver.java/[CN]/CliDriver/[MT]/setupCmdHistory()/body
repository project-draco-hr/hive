{
  final String HISTORYFILE=".hivehistory";
  String historyDirectory=System.getProperty("user.home");
  PersistentHistory history=null;
  try {
    if ((new File(historyDirectory)).exists()) {
      String historyFile=historyDirectory + File.separator + HISTORYFILE;
      history=new FileHistory(new File(historyFile));
      reader.setHistory(history);
    }
 else {
      System.err.println("WARNING: Directory for Hive history file: " + historyDirectory + " does not exist.   History will not be available during this session.");
    }
  }
 catch (  Exception e) {
    System.err.println("WARNING: Encountered an error while trying to initialize Hive's " + "history file.  History will not be available during this session.");
    System.err.println(e.getMessage());
  }
  ShutdownHookManager.addShutdownHook(new Runnable(){
    @Override public void run(){
      History h=reader.getHistory();
      if (h instanceof FileHistory) {
        try {
          ((FileHistory)h).flush();
        }
 catch (        IOException e) {
          System.err.println("WARNING: Failed to write command history file: " + e.getMessage());
        }
      }
    }
  }
);
}
