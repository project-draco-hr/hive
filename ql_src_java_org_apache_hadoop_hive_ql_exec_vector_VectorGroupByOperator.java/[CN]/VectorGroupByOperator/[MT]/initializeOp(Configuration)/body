{
  List<ObjectInspector> objectInspectors=new ArrayList<ObjectInspector>();
  List<ExprNodeDesc> keysDesc=conf.getKeys();
  try {
    keyOutputWriters=new VectorExpressionWriter[keyExpressions.length];
    for (int i=0; i < keyExpressions.length; ++i) {
      keyOutputWriters[i]=VectorExpressionWriterFactory.genVectorExpressionWritable(keysDesc.get(i));
      objectInspectors.add(keyOutputWriters[i].getObjectInspector());
    }
    for (int i=0; i < aggregators.length; ++i) {
      aggregators[i].init(conf.getAggregators().get(i));
      objectInspectors.add(aggregators[i].getOutputObjectInspector());
    }
    if (!conf.getVectorDesc().isVectorGroupBatches()) {
      keyWrappersBatch=VectorHashKeyWrapperBatch.compileKeyWrapperBatch(keyExpressions);
      aggregationBatchInfo=new VectorAggregationBufferBatch();
      aggregationBatchInfo.compileAggregationBatchInfo(aggregators);
    }
    LOG.warn("VectorGroupByOperator is vector output " + isVectorOutput);
    List<String> outputFieldNames=conf.getOutputColumnNames();
    outputObjInspector=ObjectInspectorFactory.getStandardStructObjectInspector(outputFieldNames,objectInspectors);
    if (isVectorOutput) {
      vrbCtx=new VectorizedRowBatchCtx();
      vrbCtx.init(hconf,fileKey,(StructObjectInspector)outputObjInspector);
      outputBatch=vrbCtx.createVectorizedRowBatch();
      vectorColumnAssign=VectorColumnAssignFactory.buildAssigners(outputBatch,outputObjInspector,vOutContext.getColumnMap(),conf.getOutputColumnNames());
    }
  }
 catch (  HiveException he) {
    throw he;
  }
catch (  Throwable e) {
    throw new HiveException(e);
  }
  initializeChildren(hconf);
  forwardCache=new Object[keyExpressions.length + aggregators.length];
  if (keyExpressions.length == 0) {
    processingMode=this.new ProcessingModeGlobalAggregate();
  }
 else   if (conf.getVectorDesc().isVectorGroupBatches()) {
    processingMode=this.new ProcessingModeGroupBatches();
  }
 else {
    processingMode=this.new ProcessingModeHashAggregate();
  }
  processingMode.initialize(hconf);
}
