{
  PerfLogger perfLogger=SessionState.getPerfLogger();
  perfLogger.PerfLogBegin(CLASS_NAME,PerfLogger.RELEASE_LOCKS);
  HiveTxnManager txnMgr;
  if (txnManager == null) {
    SessionState ss=SessionState.get();
    txnMgr=ss.getTxnMgr();
  }
 else {
    txnMgr=txnManager;
  }
  if (txnMgr.isTxnOpen()) {
    if (commit) {
      txnMgr.commitTxn();
    }
 else {
      txnMgr.rollbackTxn();
    }
  }
 else {
    if (ctx != null && ctx.getHiveLocks() != null) {
      hiveLocks.addAll(ctx.getHiveLocks());
    }
    if (!hiveLocks.isEmpty()) {
      txnMgr.getLockManager().releaseLocks(hiveLocks);
    }
  }
  hiveLocks.clear();
  if (ctx != null) {
    ctx.setHiveLocks(null);
  }
  perfLogger.PerfLogEnd(CLASS_NAME,PerfLogger.RELEASE_LOCKS);
}
