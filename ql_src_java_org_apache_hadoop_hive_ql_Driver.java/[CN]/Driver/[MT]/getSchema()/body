{
  Schema schema;
  try {
    if (plan != null && plan.getPlan().getFetchTask() != null) {
      BaseSemanticAnalyzer sem=plan.getPlan();
      if (!sem.getFetchTaskInit()) {
        sem.setFetchTaskInit(true);
        sem.getFetchTask().initialize(conf);
      }
      FetchTask ft=(FetchTask)sem.getFetchTask();
      tableDesc td=ft.getTblDesc();
      if (td == null && ft.getWork() != null && ft.getWork().getPartDesc() != null) {
        if (ft.getWork().getPartDesc().size() > 0) {
          td=ft.getWork().getPartDesc().get(0).getTableDesc();
        }
      }
      if (td == null) {
        throw new Exception("No table description found for fetch task: " + ft);
      }
      String tableName="result";
      List<FieldSchema> lst=MetaStoreUtils.getFieldsFromDeserializer(tableName,td.getDeserializer());
      schema=new Schema(lst,null);
    }
 else {
      schema=new Schema();
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw e;
  }
  LOG.info("Returning Hive schema: " + schema);
  return schema;
}
