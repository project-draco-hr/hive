{
  Schema schema=null;
  try {
    if (plan == null) {
    }
 else     if (plan.getPlan().getResultSchema() != null) {
      List<FieldSchema> lst=plan.getPlan().getResultSchema();
      schema=new Schema(lst,null);
    }
 else     if (plan.getPlan().getFetchTask() != null) {
      BaseSemanticAnalyzer sem=plan.getPlan();
      if (!sem.getFetchTaskInit()) {
        sem.setFetchTaskInit(true);
        sem.getFetchTask().initialize(conf,plan,null);
      }
      FetchTask ft=(FetchTask)sem.getFetchTask();
      TableDesc td=ft.getTblDesc();
      if (td == null && ft.getWork() != null && ft.getWork().getPartDesc() != null) {
        if (ft.getWork().getPartDesc().size() > 0) {
          td=ft.getWork().getPartDesc().get(0).getTableDesc();
        }
      }
      if (td == null) {
        throw new Exception("No table description found for fetch task: " + ft);
      }
      String tableName="result";
      List<FieldSchema> lst=MetaStoreUtils.getFieldsFromDeserializer(tableName,td.getDeserializer());
      schema=new Schema(lst,null);
    }
    if (schema == null) {
      schema=new Schema();
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw e;
  }
  LOG.info("Returning Hive schema: " + schema);
  return schema;
}
