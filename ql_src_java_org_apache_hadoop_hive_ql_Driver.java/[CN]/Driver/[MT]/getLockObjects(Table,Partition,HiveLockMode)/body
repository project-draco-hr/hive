{
  List<LockObject> locks=new LinkedList<LockObject>();
  if (t != null) {
    locks.add(new LockObject(new HiveLockObject(t,plan.getQueryId()),mode));
    return locks;
  }
  if (p != null) {
    locks.add(new LockObject(new HiveLockObject(p,plan.getQueryId()),mode));
    mode=HiveLockMode.SHARED;
    String partName=p.getName();
    String partialName="";
    String[] partns=p.getName().split("/");
    for (int idx=0; idx < partns.length - 1; idx++) {
      String partn=partns[idx];
      partialName+=partialName + partn;
      locks.add(new LockObject(new HiveLockObject(new DummyPartition(p.getTable().getDbName() + "@" + p.getTable().getTableName()+ "@"+ partialName),plan.getQueryId()),mode));
      partialName+="/";
    }
    locks.add(new LockObject(new HiveLockObject(p.getTable(),plan.getQueryId()),mode));
  }
  return locks;
}
