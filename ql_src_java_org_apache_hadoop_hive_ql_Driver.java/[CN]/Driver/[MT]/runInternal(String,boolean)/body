{
  errorMessage=null;
  SQLState=null;
  downstreamError=null;
  if (!validateConfVariables()) {
    return createProcessorResponse(12);
  }
  HiveDriverRunHookContext hookContext=new HiveDriverRunHookContextImpl(conf,command);
  List<HiveDriverRunHook> driverRunHooks;
  try {
    driverRunHooks=getHooks(HiveConf.ConfVars.HIVE_DRIVER_RUN_HOOKS,HiveDriverRunHook.class);
    for (    HiveDriverRunHook driverRunHook : driverRunHooks) {
      driverRunHook.preDriverRun(hookContext);
    }
  }
 catch (  Exception e) {
    errorMessage="FAILED: Hive Internal Error: " + Utilities.getNameMessage(e);
    SQLState=ErrorMsg.findSQLState(e.getMessage());
    downstreamError=e;
    console.printError(errorMessage + "\n" + org.apache.hadoop.util.StringUtils.stringifyException(e));
    return createProcessorResponse(12);
  }
  PerfLogger perfLogger=PerfLogger.getPerfLogger(true);
  perfLogger.PerfLogBegin(CLASS_NAME,PerfLogger.DRIVER_RUN);
  perfLogger.PerfLogBegin(CLASS_NAME,PerfLogger.TIME_TO_SUBMIT);
  int ret;
  if (!alreadyCompiled) {
    ret=compileInternal(command);
    if (ret != 0) {
      return createProcessorResponse(ret);
    }
  }
 else {
    plan.setQueryStartTime(perfLogger.getStartTime(PerfLogger.DRIVER_RUN));
  }
  ctx.setHiveTxnManager(SessionState.get().getTxnMgr());
  if (requiresLock()) {
    ret=acquireLocksAndOpenTxn();
    if (ret != 0) {
      try {
        releaseLocksAndCommitOrRollback(ctx.getHiveLocks(),false);
      }
 catch (      LockException e) {
      }
      return createProcessorResponse(ret);
    }
  }
  ret=execute();
  if (ret != 0) {
    try {
      releaseLocksAndCommitOrRollback(ctx.getHiveLocks(),false);
    }
 catch (    LockException e) {
    }
    return createProcessorResponse(ret);
  }
  try {
    releaseLocksAndCommitOrRollback(ctx.getHiveLocks(),true);
  }
 catch (  LockException e) {
    errorMessage="FAILED: Hive Internal Error: " + Utilities.getNameMessage(e);
    SQLState=ErrorMsg.findSQLState(e.getMessage());
    downstreamError=e;
    console.printError(errorMessage + "\n" + org.apache.hadoop.util.StringUtils.stringifyException(e));
    return createProcessorResponse(12);
  }
  perfLogger.PerfLogEnd(CLASS_NAME,PerfLogger.DRIVER_RUN);
  perfLogger.close(LOG,plan);
  try {
    for (    HiveDriverRunHook driverRunHook : driverRunHooks) {
      driverRunHook.postDriverRun(hookContext);
    }
  }
 catch (  Exception e) {
    errorMessage="FAILED: Hive Internal Error: " + Utilities.getNameMessage(e);
    SQLState=ErrorMsg.findSQLState(e.getMessage());
    downstreamError=e;
    console.printError(errorMessage + "\n" + org.apache.hadoop.util.StringUtils.stringifyException(e));
    return createProcessorResponse(12);
  }
  return createProcessorResponse(ret);
}
