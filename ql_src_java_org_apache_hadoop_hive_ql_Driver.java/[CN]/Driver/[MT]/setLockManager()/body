{
  boolean supportConcurrency=conf.getBoolVar(HiveConf.ConfVars.HIVE_SUPPORT_CONCURRENCY);
  if (supportConcurrency) {
    String lockMgr=conf.getVar(HiveConf.ConfVars.HIVE_LOCK_MANAGER);
    if ((lockMgr == null) || (lockMgr.isEmpty())) {
      throw new SemanticException(ErrorMsg.LOCKMGR_NOT_SPECIFIED.getMsg());
    }
    try {
      hiveLockMgr=(HiveLockManager)ReflectionUtils.newInstance(conf.getClassByName(lockMgr),conf);
      hiveLockMgr.setContext(new HiveLockManagerCtx(conf));
    }
 catch (    Exception e) {
      if (hiveLockMgr != null) {
        try {
          hiveLockMgr.close();
        }
 catch (        LockException e1) {
        }
        hiveLockMgr=null;
      }
      throw new SemanticException(ErrorMsg.LOCKMGR_NOT_INITIALIZED.getMsg() + e.getMessage());
    }
  }
}
