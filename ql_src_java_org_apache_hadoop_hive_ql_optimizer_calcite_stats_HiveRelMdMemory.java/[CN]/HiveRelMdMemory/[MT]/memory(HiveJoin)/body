{
  Double memory=0.0;
  if (join.getJoinAlgorithm() == JoinAlgorithm.COMMON_JOIN) {
    final Double leftAvgRowSize=RelMetadataQuery.getAverageRowSize(join.getLeft());
    final Double leftRowCount=RelMetadataQuery.getRowCount(join.getLeft());
    if (leftAvgRowSize == null || leftRowCount == null) {
      return null;
    }
    memory+=leftAvgRowSize * leftRowCount;
    final Double rightAvgRowSize=RelMetadataQuery.getAverageRowSize(join.getRight());
    final Double rightRowCount=RelMetadataQuery.getRowCount(join.getRight());
    if (rightAvgRowSize == null || rightRowCount == null) {
      return null;
    }
    memory+=rightAvgRowSize * rightRowCount;
  }
 else   if (join.getJoinAlgorithm() == JoinAlgorithm.MAP_JOIN || join.getJoinAlgorithm() == JoinAlgorithm.BUCKET_JOIN) {
    RelNode inMemoryInput;
    if (join.getMapJoinStreamingSide() == MapJoinStreamingRelation.LEFT_RELATION) {
      inMemoryInput=join.getRight();
    }
 else     if (join.getMapJoinStreamingSide() == MapJoinStreamingRelation.RIGHT_RELATION) {
      inMemoryInput=join.getLeft();
    }
 else {
      return null;
    }
    final Double avgRowSize=RelMetadataQuery.getAverageRowSize(inMemoryInput);
    final Double rowCount=RelMetadataQuery.getRowCount(inMemoryInput);
    if (avgRowSize == null || rowCount == null) {
      return null;
    }
    memory=avgRowSize * rowCount;
  }
  return memory;
}
