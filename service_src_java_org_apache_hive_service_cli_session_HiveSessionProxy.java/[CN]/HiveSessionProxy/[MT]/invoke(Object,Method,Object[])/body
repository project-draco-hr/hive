{
  try {
    if (method.getDeclaringClass() == HiveSessionBase.class) {
      return invoke(method,args);
    }
    return ShimLoader.getHadoopShims().doAs(ugi,new PrivilegedExceptionAction<Object>(){
      @Override public Object run() throws HiveSQLException {
        return invoke(method,args);
      }
    }
);
  }
 catch (  UndeclaredThrowableException e) {
    Throwable innerException=e.getCause();
    if (innerException instanceof PrivilegedActionException) {
      throw innerException.getCause();
    }
 else {
      throw e.getCause();
    }
  }
}
