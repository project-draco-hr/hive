{
  boolean keysSame=true;
  while (keysSame && primary != null) {
    OrcStruct current=primary.nextRecord;
    recordIdentifier.set(primary.key);
    primary.next(extraValue);
    extraValue=current;
    if (primary.nextRecord == null || primary.key.compareTo(secondaryKey) > 0) {
      if (primary.nextRecord != null) {
        readers.put(primary.key,primary);
      }
      Map.Entry<ReaderKey,ReaderPair> entry=readers.pollFirstEntry();
      if (entry != null) {
        primary=entry.getValue();
        if (readers.isEmpty()) {
          secondaryKey=null;
        }
 else {
          secondaryKey=readers.firstKey();
        }
      }
 else {
        primary=null;
      }
    }
    if (!validTxnList.isTxnValid(((ReaderKey)recordIdentifier).getCurrentTransactionId())) {
      continue;
    }
    boolean isSameRow=prevKey.isSameRow((ReaderKey)recordIdentifier);
    if (collapse || isSameRow) {
      keysSame=(collapse && prevKey.compareRow(recordIdentifier) == 0) || (isSameRow);
      if (!keysSame) {
        prevKey.set(recordIdentifier);
      }
    }
 else {
      keysSame=false;
    }
    prev.linkFields(current);
  }
  return !keysSame;
}
