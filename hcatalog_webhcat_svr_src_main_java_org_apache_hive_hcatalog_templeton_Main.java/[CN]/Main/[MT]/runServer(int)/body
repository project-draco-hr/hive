{
  if (UserGroupInformation.isSecurityEnabled()) {
    UserGroupInformation.loginUserFromKeytab(conf.kerberosPrincipal(),conf.kerberosKeytab());
  }
  Server server=null;
  if (StringUtils.isEmpty(conf.jettyConfiguration())) {
    server=new Server(port);
  }
 else {
    FileInputStream jettyConf=new FileInputStream(conf.jettyConfiguration());
    XmlConfiguration configuration=new XmlConfiguration(jettyConf);
    server=(Server)configuration.configure();
  }
  ServletContextHandler root=new ServletContextHandler(server,"/");
  FilterHolder fHolder=makeAuthFilter();
  root.addFilter(fHolder,"/" + SERVLET_PATH + "/v1/ddl/*",FilterMapping.REQUEST);
  root.addFilter(fHolder,"/" + SERVLET_PATH + "/v1/pig/*",FilterMapping.REQUEST);
  root.addFilter(fHolder,"/" + SERVLET_PATH + "/v1/hive/*",FilterMapping.REQUEST);
  root.addFilter(fHolder,"/" + SERVLET_PATH + "/v1/sqoop/*",FilterMapping.REQUEST);
  root.addFilter(fHolder,"/" + SERVLET_PATH + "/v1/queue/*",FilterMapping.REQUEST);
  root.addFilter(fHolder,"/" + SERVLET_PATH + "/v1/jobs/*",FilterMapping.REQUEST);
  root.addFilter(fHolder,"/" + SERVLET_PATH + "/v1/mapreduce/*",FilterMapping.REQUEST);
  root.addFilter(fHolder,"/" + SERVLET_PATH + "/v1/status/*",FilterMapping.REQUEST);
  root.addFilter(fHolder,"/" + SERVLET_PATH + "/v1/version/*",FilterMapping.REQUEST);
  if (conf.getBoolean(AppConfig.XSRF_FILTER_ENABLED,false)) {
    root.addFilter(makeXSRFFilter(),"/" + SERVLET_PATH + "/*",FilterMapping.REQUEST);
    LOG.debug("XSRF filter enabled");
  }
 else {
    LOG.warn("XSRF filter disabled");
  }
  ServletHolder h=new ServletHolder(new ServletContainer(makeJerseyConfig()));
  root.addServlet(h,"/" + SERVLET_PATH + "/*");
  addRedirects(server);
  server.start();
  this.server=server;
  return server;
}
