{
  miniHS2=new MiniHS2(new HiveConf());
  confOverlay=new HashMap<String,String>();
  confOverlay.put(HiveConf.ConfVars.HIVE_SUPPORT_CONCURRENCY.varname,"false");
  confOverlay.put(HiveConf.ConfVars.SEMANTIC_ANALYZER_HOOK.varname,MetricCheckingHook.class.getName());
  miniHS2.start(confOverlay);
  File workDir=new File(System.getProperty("test.tmp.dir"));
  jsonReportFile=new File(workDir,"json_reporting");
  jsonReportFile.delete();
  HiveConf conf=new HiveConf();
  conf.setBoolVar(HiveConf.ConfVars.HIVE_SERVER2_METRICS_ENABLED,true);
  conf.setBoolVar(HiveConf.ConfVars.HIVE_SUPPORT_CONCURRENCY,false);
  conf.setVar(HiveConf.ConfVars.HIVE_METRICS_REPORTER,MetricsReporting.JSON_FILE.name() + "," + MetricsReporting.JMX.name());
  conf.setVar(HiveConf.ConfVars.HIVE_METRICS_JSON_FILE_LOCATION,jsonReportFile.toString());
  conf.setVar(HiveConf.ConfVars.HIVE_METRICS_JSON_FILE_INTERVAL,"100ms");
  MetricsFactory.init(conf);
}
