{
  String tableName="testMetrics";
  CLIServiceClient serviceClient=miniHS2.getServiceClient();
  SessionHandle sessHandle=serviceClient.openSession("foo","bar");
  serviceClient.executeStatement(sessHandle,"CREATE TABLE " + tableName + " (id INT)",confOverlay);
  CodahaleMetrics metrics=(CodahaleMetrics)MetricsFactory.getInstance();
  String json=metrics.dumpJson();
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.TIMER,"api_hs2_operation_INITIALIZED",1);
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.TIMER,"api_hs2_operation_PENDING",1);
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.TIMER,"api_hs2_operation_RUNNING",1);
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,"hs2_completed_operation_FINISHED",1);
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.TIMER,"api_hs2_sql_operation_PENDING",1);
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.TIMER,"api_hs2_sql_operation_RUNNING",1);
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,"hs2_completed_sql_operation_FINISHED",1);
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.TIMER,"api_Driver.run",1);
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,"active_calls_api_semanticAnalyze",0);
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,"active_calls_api_compile",0);
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,"active_calls_api_hs2_operation_RUNNING",0);
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,"active_calls_api_hs2_sql_operation_RUNNING",0);
  serviceClient.closeSession(sessHandle);
}
