{
  Table t=newTable("default","dp",true);
  Partition p=newPartition(t,"today");
  addDeltaFile(t,p,1L,22L,22);
  addDeltaFile(t,p,23L,24L,2);
  addBaseFile(t,p,25L,25);
  burnThroughTransactions(25);
  CompactionRequest rqst=new CompactionRequest("default","dp",CompactionType.MAJOR);
  rqst.setPartitionname("ds=today");
  txnHandler.compact(rqst);
  CompactionInfo ci=txnHandler.findNextToCompact("fred");
  txnHandler.markCompacted(ci);
  txnHandler.setRunAs(ci.id,System.getProperty("user.name"));
  ms.dropPartition("default","dp",Collections.singletonList("today"),true);
  startCleaner();
  ShowCompactResponse rsp=txnHandler.showCompact(new ShowCompactRequest());
  Assert.assertEquals(0,rsp.getCompactsSize());
}
