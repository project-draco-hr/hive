{
  List<String> resultList;
  try {
    resultList=client.executeCustomQuery(query);
  }
 catch (  NamingException e) {
    throw new AuthenticationException("LDAP Authentication failed for user",e);
  }
  if (resultList != null) {
    for (    String matchedDn : resultList) {
      String shortUserName=LdapUtils.getShortName(matchedDn);
      LOG.info("<queried user=" + shortUserName + ",user="+ user+ ">");
      if (shortUserName.equalsIgnoreCase(user) || matchedDn.equalsIgnoreCase(user)) {
        LOG.info("Authentication succeeded based on result set from LDAP query");
        return;
      }
    }
  }
  LOG.info("Authentication failed based on result set from custom LDAP query");
  throw new AuthenticationException("Authentication failed: LDAP query " + "from property returned no data");
}
