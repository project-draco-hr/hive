{
  URI relative=null;
  if (!parentSettable) {
    String dirInArchive=original.getPath();
    if (dirInArchive.length() > 1 && dirInArchive.charAt(0) == '/') {
      dirInArchive=dirInArchive.substring(1);
    }
    try {
      relative=new URI(null,null,dirInArchive,null);
    }
 catch (    URISyntaxException e) {
      throw new HiveException("Couldn't create har URI for location");
    }
  }
 else {
    relative=originalBase.relativize(original);
    if (relative.isAbsolute()) {
      throw new HiveException("Unable to relativize URI");
    }
  }
  return base.resolve(relative);
}
