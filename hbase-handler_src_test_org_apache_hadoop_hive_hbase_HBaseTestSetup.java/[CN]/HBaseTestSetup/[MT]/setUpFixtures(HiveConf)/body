{
  conf.set("hbase.master","local");
  String tmpdir=System.getProperty("user.dir") + "/../build/ql/tmp";
  hbaseRoot="file://" + tmpdir + "/hbase";
  conf.set("hbase.rootdir",hbaseRoot);
  zooKeeperCluster=new MiniZooKeeperCluster();
  zooKeeperPort=zooKeeperCluster.startup(new File(tmpdir,"zookeeper"));
  conf.set("hbase.zookeeper.property.clientPort",Integer.toString(zooKeeperPort));
  Configuration hbaseConf=HBaseConfiguration.create(conf);
  hbaseConf.setInt("hbase.master.port",findFreePort());
  hbaseConf.setInt("hbase.master.info.port",-1);
  hbaseConf.setInt("hbase.regionserver.port",findFreePort());
  hbaseConf.setInt("hbase.regionserver.info.port",-1);
  hbaseCluster=new MiniHBaseCluster(hbaseConf,NUM_REGIONSERVERS);
  conf.set("hbase.master",hbaseCluster.getMaster().getServerName().getHostAndPort());
  new HTable(hbaseConf,HConstants.META_TABLE_NAME);
  createHBaseTable(hbaseConf);
}
