{
  this.startTime=System.currentTimeMillis();
  this.threadName=Thread.currentThread().getName();
  Stopwatch sw=new Stopwatch().start();
  UserGroupInformation taskUgi=UserGroupInformation.createRemoteUser(request.getUser());
  taskUgi.addCredentials(credentials);
  Token<JobTokenIdentifier> jobToken=TokenCache.getSessionToken(credentials);
  Map<String,ByteBuffer> serviceConsumerMetadata=new HashMap<String,ByteBuffer>();
  serviceConsumerMetadata.put(TezConstants.TEZ_SHUFFLE_HANDLER_SERVICE_ID,TezCommonUtils.convertJobTokenToBytes(jobToken));
  Multimap<String,String> startedInputsMap=HashMultimap.create();
  UserGroupInformation taskOwner=UserGroupInformation.createRemoteUser(request.getTokenIdentifier());
  final InetSocketAddress address=NetUtils.createSocketAddrForHost(request.getAmHost(),request.getAmPort());
  SecurityUtil.setTokenService(jobToken,address);
  taskOwner.addToken(jobToken);
  umbilical=taskOwner.doAs(new PrivilegedExceptionAction<TezTaskUmbilicalProtocol>(){
    @Override public TezTaskUmbilicalProtocol run() throws Exception {
      return RPC.getProxy(TezTaskUmbilicalProtocol.class,TezTaskUmbilicalProtocol.versionID,address,conf);
    }
  }
);
  taskReporter=new TaskReporter(umbilical,confParams.amHeartbeatIntervalMsMax,confParams.amCounterHeartbeatInterval,confParams.amMaxEventsPerHeartbeat,new AtomicLong(0),request.getContainerIdString());
  taskRunner=new TezTaskRunner(conf,taskUgi,localDirs,Converters.getTaskSpecfromProto(request.getFragmentSpec()),umbilical,request.getAppAttemptNumber(),serviceConsumerMetadata,envMap,startedInputsMap,taskReporter,executor,objectRegistry,pid,executionContext,memoryAvailable);
  boolean shouldDie;
  try {
    shouldDie=!taskRunner.run();
    if (shouldDie) {
      LOG.info("Got a shouldDie notification via heartbeats. Shutting down");
      return new ContainerExecutionResult(ContainerExecutionResult.ExitStatus.SUCCESS,null,"Asked to die by the AM");
    }
  }
 catch (  IOException e) {
    return new ContainerExecutionResult(ContainerExecutionResult.ExitStatus.EXECUTION_FAILURE,e,"TaskExecutionFailure: " + e.getMessage());
  }
catch (  TezException e) {
    return new ContainerExecutionResult(ContainerExecutionResult.ExitStatus.EXECUTION_FAILURE,e,"TaskExecutionFailure: " + e.getMessage());
  }
 finally {
  }
  LOG.info("ExecutionTime for Container: " + request.getContainerIdString() + "="+ sw.stop().elapsedMillis());
  return new ContainerExecutionResult(ContainerExecutionResult.ExitStatus.SUCCESS,null,null);
}
