{
  if (maxPartitions < 0)   maxPartitions=Integer.MAX_VALUE;
  Collection<Partition> cached=partCache.getAllForTable(dbName,tableName);
  if (cached != null) {
    return maxPartitions < cached.size() ? new ArrayList<Partition>(cached).subList(0,maxPartitions) : new ArrayList<Partition>(cached);
  }
  byte[] keyPrefix=HBaseUtils.buildKeyWithTrailingSeparator(dbName,tableName);
  List<Partition> parts=scanPartitionsWithFilter(keyPrefix,HBaseUtils.getEndPrefix(keyPrefix),-1,null);
  partCache.put(dbName,tableName,parts,true);
  return maxPartitions < parts.size() ? parts.subList(0,maxPartitions) : parts;
}
