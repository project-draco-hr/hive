{
  buildRoleCache();
  Set<String> rolesFound=new HashSet<String>();
  for (  Map.Entry<String,HbaseMetastoreProto.RoleGrantInfoList> e : roleCache.entrySet()) {
    for (    HbaseMetastoreProto.RoleGrantInfo giw : e.getValue().getGrantInfoList()) {
      if (HBaseUtils.convertPrincipalTypes(giw.getPrincipalType()) == type && giw.getPrincipalName().equals(name)) {
        rolesFound.add(e.getKey());
        break;
      }
    }
  }
  List<Role> directRoles=new ArrayList<Role>(rolesFound.size());
  List<Get> gets=new ArrayList<Get>();
  HTableInterface htab=conn.getHBaseTable(ROLE_TABLE);
  for (  String roleFound : rolesFound) {
    byte[] key=HBaseUtils.buildKey(roleFound);
    Get g=new Get(key);
    g.addColumn(CATALOG_CF,CATALOG_COL);
    gets.add(g);
  }
  Result[] results=htab.get(gets);
  for (int i=0; i < results.length; i++) {
    byte[] serialized=results[i].getValue(CATALOG_CF,CATALOG_COL);
    if (serialized != null) {
      directRoles.add(HBaseUtils.deserializeRole(results[i].getRow(),serialized));
    }
  }
  return directRoles;
}
