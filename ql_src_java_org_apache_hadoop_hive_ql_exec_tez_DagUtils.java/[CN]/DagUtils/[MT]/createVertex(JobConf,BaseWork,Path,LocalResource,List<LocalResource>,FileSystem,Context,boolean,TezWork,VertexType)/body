{
  Vertex v=null;
  if (work instanceof MapWork) {
    v=createVertex(conf,(MapWork)work,appJarLr,additionalLr,fileSystem,scratchDir,ctx,vertexType);
  }
 else   if (work instanceof ReduceWork) {
    v=createVertex(conf,(ReduceWork)work,appJarLr,additionalLr,fileSystem,scratchDir,ctx);
  }
 else   if (work instanceof MergeJoinWork) {
    v=createVertex(conf,(MergeJoinWork)work,appJarLr,additionalLr,fileSystem,scratchDir,ctx,vertexType);
  }
 else {
    throw new HiveException(ErrorMsg.GENERIC_ERROR.getErrorCodedMsg());
  }
  if (work.isGatheringStats()) {
    StatsPublisher statsPublisher;
    StatsFactory factory=StatsFactory.newFactory(conf);
    if (factory != null) {
      statsPublisher=factory.getStatsPublisher();
      if (!statsPublisher.init(conf)) {
        if (HiveConf.getBoolVar(conf,HiveConf.ConfVars.HIVE_STATS_RELIABLE)) {
          throw new HiveException(ErrorMsg.STATSPUBLISHER_INITIALIZATION_ERROR.getErrorCodedMsg());
        }
      }
    }
  }
  if (!hasChildren) {
    v.addDataSink("out_" + work.getName(),new DataSinkDescriptor(OutputDescriptor.create(MROutput.class.getName()).setUserPayload(TezUtils.createUserPayloadFromConf(conf)),null,null));
  }
  return v;
}
