{
  while (nusedbins > nbins) {
    double smallestdiff=bins.get(1).x - bins.get(0).x;
    int smallestdiffloc=0, smallestdiffcount=1;
    for (int i=1; i < nusedbins - 1; i++) {
      double diff=bins.get(i + 1).x - bins.get(i).x;
      if (diff < smallestdiff) {
        smallestdiff=diff;
        smallestdiffloc=i;
        smallestdiffcount=1;
      }
 else {
        if (diff == smallestdiff && prng.nextDouble() <= (1.0 / ++smallestdiffcount)) {
          smallestdiffloc=i;
        }
      }
    }
    double d=bins.get(smallestdiffloc).y + bins.get(smallestdiffloc + 1).y;
    Coord smallestdiffbin=bins.get(smallestdiffloc);
    smallestdiffbin.x*=smallestdiffbin.y / d;
    smallestdiffbin.x+=bins.get(smallestdiffloc + 1).x / d * bins.get(smallestdiffloc + 1).y;
    smallestdiffbin.y=d;
    bins.remove(smallestdiffloc + 1);
    nusedbins--;
  }
}
