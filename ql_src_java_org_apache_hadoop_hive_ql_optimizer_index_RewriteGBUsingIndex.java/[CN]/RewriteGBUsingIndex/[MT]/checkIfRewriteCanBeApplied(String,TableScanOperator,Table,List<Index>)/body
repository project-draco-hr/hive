{
  RewriteCanApplyCtx canApplyCtx=RewriteCanApplyCtx.getInstance(parseContext);
  canApplyCtx.setAlias(alias);
  canApplyCtx.setBaseTableName(baseTable.getTableName());
  canApplyCtx.populateRewriteVars(topOp);
  Map<Index,Set<String>> indexTableMap=getIndexToKeysMap(indexes);
  for (  Map.Entry<Index,Set<String>> entry : indexTableMap.entrySet()) {
    Index index=entry.getKey();
    Set<String> indexKeyNames=entry.getValue();
    if (canApplyCtx.isIndexUsableForQueryBranchRewrite(index,indexKeyNames) && checkIfAllRewriteCriteriaIsMet(canApplyCtx)) {
      if (canApplyCtx.getAggFunction() == null) {
        canApplyCtx.setAggFunction("_count_of_" + StringUtils.join(",",indexKeyNames) + "");
      }
      canApplyCtx.setIndexTableName(index.getIndexTableName());
      tsOpToProcess.put(alias,canApplyCtx);
      return true;
    }
  }
  return false;
}
