{
  Map<String,Operator<?>> topOpMap=parseContext.getTopOps();
  Iterator<String> tsOpItr=tsOpToProcess.keySet().iterator();
  for (  Map.Entry<String,RewriteCanApplyCtx> entry : tsOpToProcess.entrySet()) {
    String alias=entry.getKey();
    RewriteCanApplyCtx canApplyCtx=entry.getValue();
    TableScanOperator topOp=(TableScanOperator)topOpMap.get(alias);
    RewriteQueryUsingAggregateIndexCtx rewriteQueryCtx=RewriteQueryUsingAggregateIndexCtx.getInstance(parseContext,hiveDb,canApplyCtx.getIndexTableName(),canApplyCtx.getAlias(),canApplyCtx.getAllColumns(),canApplyCtx.getAggFunction());
    rewriteQueryCtx.invokeRewriteQueryProc(topOp);
    parseContext=rewriteQueryCtx.getParseContext();
    parseContext.setOpParseCtx((LinkedHashMap<Operator<? extends OperatorDesc>,OpParseContext>)rewriteQueryCtx.getOpc());
  }
  LOG.info("Finished Rewriting query");
}
