{
  Map<String,Operator<? extends Serializable>> topOpMap=(HashMap<String,Operator<? extends Serializable>>)parseContext.getTopOps().clone();
  Iterator<String> tsOpItr=tsOpToProcess.keySet().iterator();
  while (tsOpItr.hasNext()) {
    baseTableName=tsOpItr.next();
    RewriteCanApplyCtx canApplyCtx=tsOpToProcess.get(baseTableName);
    TableScanOperator topOp=(TableScanOperator)topOpMap.get(baseTableName);
    RewriteQueryUsingAggregateIndexCtx rewriteQueryCtx=RewriteQueryUsingAggregateIndexCtx.getInstance(parseContext,hiveDb,indexTableName,baseTableName,canApplyCtx.getAggFunction());
    rewriteQueryCtx.invokeRewriteQueryProc(topOp);
    parseContext=rewriteQueryCtx.getParseContext();
    parseContext.setOpParseCtx((LinkedHashMap<Operator<? extends Serializable>,OpParseContext>)rewriteQueryCtx.getOpc());
  }
  LOG.info("Finished Rewriting query");
}
