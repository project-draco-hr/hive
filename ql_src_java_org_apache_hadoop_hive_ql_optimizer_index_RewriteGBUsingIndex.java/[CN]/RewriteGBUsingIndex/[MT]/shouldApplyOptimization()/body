{
  Map<Table,List<Index>> tableToIndex=getIndexesForRewrite();
  if (tableToIndex.isEmpty()) {
    LOG.debug("No Valid Index Found to apply Rewrite, " + "skipping " + getName() + " optimization");
    return false;
  }
  for (  Map.Entry<String,Operator<?>> entry : parseContext.getTopOps().entrySet()) {
    String alias=entry.getKey();
    TableScanOperator topOp=(TableScanOperator)entry.getValue();
    Table table=topOp.getConf().getTableMetadata();
    List<Index> indexes=tableToIndex.get(table);
    if (indexes.isEmpty()) {
      continue;
    }
    if (table.isPartitioned()) {
      if (!checkIfIndexBuiltOnAllTablePartitions(topOp,indexes)) {
        LOG.debug("Index is not built for all table partitions, " + "skipping " + getName() + " optimization");
        continue;
      }
    }
    checkIfRewriteCanBeApplied(alias,topOp,table,indexes);
  }
  return !tsOpToProcess.isEmpty();
}
