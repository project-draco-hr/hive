{
  JoinAlgorithm oldAlgo=join.getJoinAlgorithm();
  join.setJoinAlgorithm(TezSMBJoinAlgorithm.INSTANCE);
  final Double memoryWithinPhase=RelMetadataQuery.cumulativeMemoryWithinPhase(join);
  final Integer splitCount=RelMetadataQuery.splitCount(join);
  join.setJoinAlgorithm(oldAlgo);
  if (memoryWithinPhase == null || splitCount == null) {
    return null;
  }
  return memoryWithinPhase / splitCount;
}
