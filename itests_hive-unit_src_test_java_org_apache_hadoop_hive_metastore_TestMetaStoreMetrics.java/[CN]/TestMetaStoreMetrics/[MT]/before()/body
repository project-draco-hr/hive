{
  int port=MetaStoreUtils.findFreePort();
  jsonReportFile=new File(workDir,"json_reporting");
  jsonReportFile.delete();
  hiveConf=new HiveConf(TestMetaStoreMetrics.class);
  hiveConf.setVar(HiveConf.ConfVars.METASTOREURIS,"thrift://localhost:" + port);
  hiveConf.setIntVar(HiveConf.ConfVars.METASTORETHRIFTCONNECTIONRETRIES,3);
  hiveConf.setBoolVar(HiveConf.ConfVars.METASTORE_METRICS,true);
  hiveConf.setBoolVar(HiveConf.ConfVars.HIVE_SUPPORT_CONCURRENCY,false);
  hiveConf.setVar(HiveConf.ConfVars.HIVE_METRICS_REPORTER,MetricsReporting.JSON_FILE.name() + "," + MetricsReporting.JMX.name());
  hiveConf.setVar(HiveConf.ConfVars.HIVE_METRICS_JSON_FILE_LOCATION,jsonReportFile.toString());
  hiveConf.setVar(HiveConf.ConfVars.HIVE_METRICS_JSON_FILE_INTERVAL,"100ms");
  MetaStoreUtils.startMetaStore(port,ShimLoader.getHadoopThriftAuthBridge(),hiveConf);
  SessionState.start(new CliSessionState(hiveConf));
  driver=new Driver(hiveConf);
}
