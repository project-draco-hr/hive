{
  String json=metrics.dumpJson();
  int initialCount=(new Integer((MetricsTestUtils.getJsonNode(json,MetricsTestUtils.COUNTER,MetricsConstant.OPEN_CONNECTIONS)).asText())).intValue();
  HiveMetaStoreClient msc=new HiveMetaStoreClient(hiveConf);
  HiveMetaStoreClient msc2=new HiveMetaStoreClient(hiveConf);
  json=metrics.dumpJson();
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,MetricsConstant.OPEN_CONNECTIONS,initialCount + 2);
  msc.close();
  json=metrics.dumpJson();
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,MetricsConstant.OPEN_CONNECTIONS,initialCount + 1);
  msc2.close();
  json=metrics.dumpJson();
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,MetricsConstant.OPEN_CONNECTIONS,initialCount);
}
