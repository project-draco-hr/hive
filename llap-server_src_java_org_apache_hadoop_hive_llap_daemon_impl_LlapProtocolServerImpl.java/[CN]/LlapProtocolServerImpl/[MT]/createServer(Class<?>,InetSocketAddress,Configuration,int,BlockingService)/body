{
  RPC.setProtocolEngine(conf,pbProtocol,ProtobufRpcEngine.class);
  RPC.Builder builder=new RPC.Builder(conf).setProtocol(pbProtocol).setInstance(blockingService).setBindAddress(addr.getHostName()).setPort(addr.getPort()).setNumHandlers(numHandlers);
  if (zkSecretManager != null) {
    builder=builder.setSecretManager(zkSecretManager);
  }
  RPC.Server server=builder.build();
  if (conf.getBoolean(CommonConfigurationKeysPublic.HADOOP_SECURITY_AUTHORIZATION,false)) {
    server.refreshServiceAcl(conf,new LlapDaemonPolicyProvider());
  }
  return server;
}
