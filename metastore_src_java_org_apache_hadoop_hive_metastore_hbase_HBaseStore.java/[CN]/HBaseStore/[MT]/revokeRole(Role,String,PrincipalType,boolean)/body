{
  boolean commit=false;
  openTransaction();
  try {
    if (grantOption) {
      getHBase().dropPrincipalFromRole(role.getRoleName(),userName,principalType,grantOption);
    }
 else {
      Set<String> usersToRemap=findUsersToRemapRolesFor(role,userName,principalType);
      getHBase().dropPrincipalFromRole(role.getRoleName(),userName,principalType,grantOption);
      for (      String user : usersToRemap) {
        getHBase().buildRoleMapForUser(user);
      }
    }
    commit=true;
    return true;
  }
 catch (  IOException e) {
    LOG.error("Unable to revoke role " + role.getRoleName() + " from "+ userName,e);
    throw new MetaException("Unable to revoke role " + e.getMessage());
  }
 finally {
    commitOrRoleBack(commit);
  }
}
