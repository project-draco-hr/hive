{
  Preconditions.checkArgument(submitWorkRequestProto.getUsingTezAm() == false);
  String fragmentId=submitWorkRequestProto.getFragmentSpec().getFragmentIdentifierString();
  PendingEventData pendingEventData=new PendingEventData(new TaskHeartbeatInfo(fragmentId,llapHost,llapPort),tezEvents);
  pendingEvents.putIfAbsent(fragmentId,pendingEventData);
  timer.scheduleAtFixedRate(new HeartbeatCheckTask(),connectionTimeout,connectionTimeout,TimeUnit.MILLISECONDS);
  communicator.sendSubmitWork(submitWorkRequestProto,llapHost,llapPort,new LlapProtocolClientProxy.ExecuteRequestCallback<LlapDaemonProtocolProtos.SubmitWorkResponseProto>(){
    @Override public void setResponse(    LlapDaemonProtocolProtos.SubmitWorkResponseProto response){
      if (response.hasSubmissionState()) {
        if (response.getSubmissionState().equals(LlapDaemonProtocolProtos.SubmissionStateProto.REJECTED)) {
          String msg="Fragment: " + submitWorkRequestProto.getFragmentSpec().getFragmentIdentifierString() + " rejected. Server Busy.";
          LOG.info(msg);
          if (responder != null) {
            Throwable err=new RuntimeException(msg);
            responder.submissionFailed(submitWorkRequestProto.getFragmentSpec().getFragmentIdentifierString(),err);
          }
          return;
        }
      }
    }
    @Override public void indicateError(    Throwable t){
      String msg="Failed to submit: " + submitWorkRequestProto.getFragmentSpec().getFragmentIdentifierString();
      LOG.error(msg,t);
      Throwable err=new RuntimeException(msg,t);
      responder.submissionFailed(submitWorkRequestProto.getFragmentSpec().getFragmentIdentifierString(),err);
    }
  }
);
}
