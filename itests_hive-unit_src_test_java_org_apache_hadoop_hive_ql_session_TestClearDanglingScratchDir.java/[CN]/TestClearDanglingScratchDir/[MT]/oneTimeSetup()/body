{
  m_dfs=new MiniDFSCluster.Builder(new Configuration()).numDataNodes(1).format(true).build();
  conf=new HiveConf();
  if (Shell.WINDOWS) {
    WindowsPathUtil.convertPathsFromWindowsToHdfs(conf);
  }
  conf.set(HiveConf.ConfVars.HIVE_SCRATCH_DIR_LOCK.toString(),"true");
  conf.set(HiveConf.ConfVars.METASTORE_AUTO_CREATE_ALL.toString(),"true");
  LoggerFactory.getLogger("SessionState");
  conf.setVar(HiveConf.ConfVars.METASTOREWAREHOUSE,new Path(System.getProperty("test.tmp.dir"),"warehouse").toString());
  conf.set(CommonConfigurationKeysPublic.FS_DEFAULT_NAME_KEY,m_dfs.getFileSystem().getUri().toString());
  scratchDir=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.SCRATCHDIR));
  m_dfs.getFileSystem().mkdirs(scratchDir);
  m_dfs.getFileSystem().setPermission(scratchDir,new FsPermission("777"));
}
