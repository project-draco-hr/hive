{
  if (state.counts == null) {
    return null;
  }
  Set<Map.Entry<LongWritable,LongWritable>> entries=state.counts.entrySet();
  List<Map.Entry<LongWritable,LongWritable>> entriesList=new ArrayList<Map.Entry<LongWritable,LongWritable>>(entries);
  Collections.sort(entriesList,new MyComparator());
  long total=0;
  for (int i=0; i < entriesList.size(); i++) {
    LongWritable count=entriesList.get(i).getValue();
    total+=count.get();
    count.set(total);
  }
  long maxPosition=total - 1;
  if (results == null) {
    results=new ArrayList<DoubleWritable>();
    for (int i=0; i < state.percentiles.size(); i++) {
      results.add(new DoubleWritable());
    }
  }
  for (int i=0; i < state.percentiles.size(); i++) {
    double position=maxPosition * state.percentiles.get(i).get();
    results.get(i).set(getPercentile(entriesList,position));
  }
  return results;
}
