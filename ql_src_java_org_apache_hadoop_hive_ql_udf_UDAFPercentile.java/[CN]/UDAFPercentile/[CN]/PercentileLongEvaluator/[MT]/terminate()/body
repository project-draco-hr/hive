{
  if (state.counts == null) {
    return null;
  }
  Set<Map.Entry<LongWritable,LongWritable>> entries=state.counts.entrySet();
  List<Map.Entry<LongWritable,LongWritable>> entriesList=new ArrayList<Map.Entry<LongWritable,LongWritable>>(entries);
  Collections.sort(entriesList,new MyComparator());
  long total=0;
  for (int i=0; i < entriesList.size(); i++) {
    LongWritable count=entriesList.get(i).getValue();
    total+=count.get();
    count.set(total);
  }
  if (result == null) {
    result=new DoubleWritable();
  }
  long maxPosition=total - 1;
  double position=maxPosition * state.percentiles.get(0).get();
  result.set(getPercentile(entriesList,position));
  return result;
}
