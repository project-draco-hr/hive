{
  Logger logger=LogManager.getLogger("hive.ql.metadata.Hive");
  Level oldLevel=logger.getLevel();
  LoggerContext ctx=(LoggerContext)LogManager.getContext(false);
  Configuration config=ctx.getConfiguration();
  LoggerConfig loggerConfig=config.getLoggerConfig(logger.getName());
  loggerConfig.setLevel(Level.DEBUG);
  ctx.updateLoggers();
  StringAppender appender=StringAppender.createStringAppender("%m");
  appender.addToLogger(logger.getName(),Level.DEBUG);
  appender.start();
  try {
    hm.clearMetaCallTiming();
    hm.getAllDatabases();
    hm.dumpAndClearMetaCallTiming("test");
    String logStr=appender.getOutput();
    String expectedString="getAllDatabases_()=";
    Assert.assertTrue(logStr + " should contain <" + expectedString,logStr.contains(expectedString));
    appender.reset();
    hm.dumpAndClearMetaCallTiming("test");
    logStr=appender.getOutput();
    Assert.assertFalse(logStr + " should not contain <" + expectedString,logStr.contains(expectedString));
  }
  finally {
    loggerConfig.setLevel(oldLevel);
    ctx.updateLoggers();
    appender.removeFromLogger(logger.getName());
  }
}
