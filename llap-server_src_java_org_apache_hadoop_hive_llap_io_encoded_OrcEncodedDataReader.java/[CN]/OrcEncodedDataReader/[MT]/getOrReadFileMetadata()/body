{
  OrcFileMetadata metadata=null;
  if (fileId != null) {
    metadata=metadataCache.getFileMetadata(fileId);
    if (metadata != null) {
      counters.incrCounter(Counter.METADATA_CACHE_HIT);
      return metadata;
    }
    counters.incrCounter(Counter.METADATA_CACHE_MISS);
  }
  ensureOrcReader();
  metadata=new OrcFileMetadata(fileId == null ? fileId : 0,orcReader);
  return (fileId == null) ? metadata : metadataCache.putFileMetadata(metadata);
}
