{
  Set<String> hostsToTerminate=Sets.newHashSet();
  Set<Host> hostsNotRemoved=Sets.newHashSet();
  for (  Host host : executionContext.getBadHosts()) {
    hostsToTerminate.add(host.getName());
    if (!executionContext.removeHost(host)) {
      hostsNotRemoved.add(host);
    }
  }
  executionContext.clearBadHosts();
  if (!hostsToTerminate.isEmpty()) {
    LOG.info("Replacing " + hostsToTerminate);
    terminate(hostsToTerminate,true);
    Set<NodeMetadata> nodes=createNodes(hostsToTerminate.size());
    for (    NodeMetadata node : nodes) {
      executionContext.addHost(new Host(node.getHostname(),mUser,mSlaveLocalDirs,mNumThreads));
    }
  }
  Preconditions.checkState(hostsNotRemoved.isEmpty(),"Host " + hostsNotRemoved + " was in bad hosts but could not be removed");
}
