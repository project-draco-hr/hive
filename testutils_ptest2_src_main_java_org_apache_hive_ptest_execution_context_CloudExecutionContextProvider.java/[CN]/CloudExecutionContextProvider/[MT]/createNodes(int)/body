{
  Set<NodeMetadata> result=Sets.newHashSet();
  int attempts=0;
  int numRequired=numHosts;
  do {
    LOG.info("Attempting to create " + numRequired + " nodes");
    try {
      result.addAll(mCloudComputeService.createNodes(numRequired));
    }
 catch (    RunNodesException e) {
      LOG.warn("Error creating nodes",e);
      terminateInternal(e.getNodeErrors().keySet());
      result.addAll(e.getSuccessfulNodes());
    }
    result=verifyHosts(result);
    LOG.info("Successfully created " + result.size() + " nodes");
    numRequired=numHosts - result.size();
    if (numRequired > 0) {
      try {
        TimeUnit.SECONDS.sleep(++attempts * mRetrySleepInterval);
      }
 catch (      InterruptedException e) {
        throw new CreateHostsFailedException("Interrupted while trying to create hosts",e);
      }
    }
  }
 while (numRequired > 0);
  Preconditions.checkState(result.size() >= numHosts,"Results should always be >= numHosts " + numHosts + " => "+ result.size());
  return result;
}
