{
  String maskPattern="#### A masked pattern was here ####";
  String line;
  BufferedReader in;
  BufferedWriter out;
  in=new BufferedReader(new FileReader(fname));
  out=new BufferedWriter(new FileWriter(fname + ".orig"));
  while (null != (line=in.readLine())) {
    if (line.isEmpty() && Shell.WINDOWS) {
      continue;
    }
    out.write(line);
    out.write('\n');
  }
  in.close();
  out.close();
  in=new BufferedReader(new FileReader(fname + ".orig"));
  out=new BufferedWriter(new FileWriter(fname));
  boolean lastWasMasked=false;
  while (null != (line=in.readLine())) {
    for (    Pattern pattern : patterns) {
      line=pattern.matcher(line).replaceAll(maskPattern);
    }
    if (line.equals(maskPattern)) {
      if (!lastWasMasked) {
        out.write(line);
        out.write("\n");
        lastWasMasked=true;
      }
    }
 else {
      out.write(line);
      out.write("\n");
      lastWasMasked=false;
    }
  }
  in.close();
  out.close();
}
