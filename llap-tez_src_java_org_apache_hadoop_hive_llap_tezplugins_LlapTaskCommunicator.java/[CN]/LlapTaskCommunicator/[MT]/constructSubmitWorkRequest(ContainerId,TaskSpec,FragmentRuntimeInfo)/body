{
  SubmitWorkRequestProto.Builder builder=SubmitWorkRequestProto.newBuilder(BASE_SUBMIT_WORK_REQUEST);
  builder.setContainerIdString(containerId.toString());
  builder.setAmHost(getAddress().getHostName());
  builder.setAmPort(getAddress().getPort());
  Preconditions.checkState(currentQueryIdentifierProto.getDagIdentifier() == taskSpec.getTaskAttemptID().getTaskID().getVertexID().getDAGId().getId());
  ByteBuffer credentialsBinary=credentialMap.get(currentQueryIdentifierProto);
  if (credentialsBinary == null) {
    credentialsBinary=serializeCredentials(getContext().getCurrentDagInfo().getCredentials());
    credentialMap.putIfAbsent(currentQueryIdentifierProto,credentialsBinary.duplicate());
  }
 else {
    credentialsBinary=credentialsBinary.duplicate();
  }
  builder.setCredentialsBinary(ByteString.copyFrom(credentialsBinary));
  builder.setFragmentSpec(Converters.convertTaskSpecToProto(taskSpec));
  builder.setFragmentRuntimeInfo(fragmentRuntimeInfo);
  return builder.build();
}
