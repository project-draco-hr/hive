{
  CommandProcessorResponse cpr=driver.run("create table T8(a int, b int) clustered by(b) into 2 buckets stored as orc TBLPROPERTIES ('transactional'='true')");
  checkCmdOnDriver(cpr);
  cpr=driver.compileAndRespond("delete from T8 where b = 89");
  checkCmdOnDriver(cpr);
  txnMgr.openTxn("Fifer");
  txnMgr.acquireLocks(driver.getPlan(),ctx,"Fifer");
  cpr=driver.compileAndRespond("select a from T8");
  checkCmdOnDriver(cpr);
  HiveTxnManager txnMgr2=TxnManagerFactory.getTxnManagerFactory().getTxnManager(conf);
  txnMgr2.openTxn("Fiddler");
  txnMgr2.acquireLocks(driver.getPlan(),ctx,"Fiddler");
  checkCmdOnDriver(driver.compileAndRespond("update T8 set a = 1 where b = 1"));
  ((DbTxnManager)txnMgr2).acquireLocks(driver.getPlan(),ctx,"Practical",false);
  List<ShowLocksResponseElement> locks=getLocks();
  Assert.assertEquals("Unexpected lock count",3,locks.size());
  checkLock(LockType.SHARED_READ,LockState.ACQUIRED,"default","T8",null,locks);
  checkLock(LockType.SHARED_WRITE,LockState.ACQUIRED,"default","T8",null,locks);
  checkLock(LockType.SHARED_WRITE,LockState.WAITING,"default","T8",null,locks);
  txnMgr.rollbackTxn();
  ((DbLockManager)txnMgr2.getLockManager()).checkLock(locks.get(2).getLockid());
  locks=getLocks();
  Assert.assertEquals("Unexpected lock count",2,locks.size());
  checkLock(LockType.SHARED_READ,LockState.ACQUIRED,"default","T8",null,locks);
  checkLock(LockType.SHARED_WRITE,LockState.ACQUIRED,"default","T8",null,locks);
  txnMgr2.commitTxn();
  cpr=driver.run("drop table if exists T6");
  locks=getLocks();
  Assert.assertEquals("Unexpected number of locks found",0,locks.size());
  checkCmdOnDriver(cpr);
}
