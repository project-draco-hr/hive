{
switch (oi.getCategory()) {
case PRIMITIVE:
{
      PrimitiveObjectInspector poi=(PrimitiveObjectInspector)oi;
      if (o == null) {
        sb.append(nullStr);
      }
 else {
switch (poi.getPrimitiveCategory()) {
case BOOLEAN:
{
            boolean b=((BooleanObjectInspector)poi).get(o);
            sb.append(b ? "true" : "false");
            break;
          }
case BYTE:
{
          sb.append(((ByteObjectInspector)poi).get(o));
          break;
        }
case SHORT:
{
        sb.append(((ShortObjectInspector)poi).get(o));
        break;
      }
case INT:
{
      sb.append(((IntObjectInspector)poi).get(o));
      break;
    }
case LONG:
{
    sb.append(((LongObjectInspector)poi).get(o));
    break;
  }
case FLOAT:
{
  sb.append(((FloatObjectInspector)poi).get(o));
  break;
}
case DOUBLE:
{
sb.append(((DoubleObjectInspector)poi).get(o));
break;
}
case STRING:
{
sb.append('"');
sb.append(escapeString(((StringObjectInspector)poi).getPrimitiveJavaObject(o)));
sb.append('"');
break;
}
case TIMESTAMP:
{
sb.append('"');
sb.append(((TimestampObjectInspector)poi).getPrimitiveWritableObject(o));
sb.append('"');
break;
}
case BINARY:
{
BytesWritable bw=((BinaryObjectInspector)oi).getPrimitiveWritableObject(o);
Text txt=new Text();
txt.set(bw.getBytes(),0,bw.getLength());
sb.append(txt.toString());
break;
}
case DECIMAL:
{
sb.append(((HiveDecimalObjectInspector)oi).getPrimitiveJavaObject(o));
break;
}
default :
throw new RuntimeException("Unknown primitive type: " + poi.getPrimitiveCategory());
}
}
break;
}
case LIST:
{
ListObjectInspector loi=(ListObjectInspector)oi;
ObjectInspector listElementObjectInspector=loi.getListElementObjectInspector();
List<?> olist=loi.getList(o);
if (olist == null) {
sb.append(nullStr);
}
 else {
sb.append(LBRACKET);
for (int i=0; i < olist.size(); i++) {
if (i > 0) {
sb.append(COMMA);
}
buildJSONString(sb,olist.get(i),listElementObjectInspector,JSON_NULL);
}
sb.append(RBRACKET);
}
break;
}
case MAP:
{
MapObjectInspector moi=(MapObjectInspector)oi;
ObjectInspector mapKeyObjectInspector=moi.getMapKeyObjectInspector();
ObjectInspector mapValueObjectInspector=moi.getMapValueObjectInspector();
Map<?,?> omap=moi.getMap(o);
if (omap == null) {
sb.append(nullStr);
}
 else {
sb.append(LBRACE);
boolean first=true;
for (Object entry : omap.entrySet()) {
if (first) {
first=false;
}
 else {
sb.append(COMMA);
}
Map.Entry<?,?> e=(Map.Entry<?,?>)entry;
buildJSONString(sb,e.getKey(),mapKeyObjectInspector,JSON_NULL);
sb.append(COLON);
buildJSONString(sb,e.getValue(),mapValueObjectInspector,JSON_NULL);
}
sb.append(RBRACE);
}
break;
}
case STRUCT:
{
StructObjectInspector soi=(StructObjectInspector)oi;
List<? extends StructField> structFields=soi.getAllStructFieldRefs();
if (o == null) {
sb.append(nullStr);
}
 else {
sb.append(LBRACE);
for (int i=0; i < structFields.size(); i++) {
if (i > 0) {
sb.append(COMMA);
}
sb.append(QUOTE);
sb.append(structFields.get(i).getFieldName());
sb.append(QUOTE);
sb.append(COLON);
buildJSONString(sb,soi.getStructFieldData(o,structFields.get(i)),structFields.get(i).getFieldObjectInspector(),JSON_NULL);
}
sb.append(RBRACE);
}
break;
}
case UNION:
{
UnionObjectInspector uoi=(UnionObjectInspector)oi;
if (o == null) {
sb.append(nullStr);
}
 else {
sb.append(LBRACE);
sb.append(uoi.getTag(o));
sb.append(COLON);
buildJSONString(sb,uoi.getField(o),uoi.getObjectInspectors().get(uoi.getTag(o)),JSON_NULL);
sb.append(RBRACE);
}
break;
}
default :
throw new RuntimeException("Unknown type in ObjectInspector!");
}
}
