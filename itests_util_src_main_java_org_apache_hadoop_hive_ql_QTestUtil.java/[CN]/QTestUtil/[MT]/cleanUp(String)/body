{
  boolean canReuseSession=(tname == null) || !qNoSessionReuseQuerySet.contains(tname);
  if (!isSessionStateStarted) {
    startSessionState(canReuseSession);
  }
  if (System.getenv(QTEST_LEAVE_FILES) != null) {
    return;
  }
  if (!attemptingCacheUsage) {
    cleanupNonCacheUsage();
  }
 else {
    cleanupCacheUsage();
  }
  FunctionRegistry.unregisterTemporaryUDF("test_udaf");
  FunctionRegistry.unregisterTemporaryUDF("test_error");
}
