{
  for (  String dbName : db.getAllDatabases()) {
    SessionState.get().setCurrentDatabase(dbName);
    for (    String tblName : db.getAllTables()) {
      if (!DEFAULT_DATABASE_NAME.equals(dbName) || !srcTables.contains(tblName)) {
        Table tblObj=db.getTable(tblName);
        if (tblObj.isIndexTable()) {
          continue;
        }
        db.dropTable(dbName,tblName);
      }
 else {
        List<Index> indexes=db.getIndexes(dbName,tblName,(short)-1);
        if (indexes != null && indexes.size() > 0) {
          for (          Index index : indexes) {
            db.dropIndex(dbName,tblName,index.getIndexName(),true);
          }
        }
      }
    }
    if (!DEFAULT_DATABASE_NAME.equals(dbName)) {
      db.dropDatabase(dbName,true,true,true);
    }
  }
  try {
    Path p=new Path(testWarehouse);
    FileSystem fileSystem=p.getFileSystem(conf);
    for (    FileStatus status : fileSystem.listStatus(p)) {
      if (status.isDir() && !srcTables.contains(status.getPath().getName())) {
        fileSystem.delete(status.getPath(),true);
      }
    }
  }
 catch (  IllegalArgumentException e) {
  }
  SessionState.get().setCurrentDatabase(DEFAULT_DATABASE_NAME);
  List<String> roleNames=db.getAllRoleNames();
  for (  String roleName : roleNames) {
    if (!"PUBLIC".equalsIgnoreCase(roleName) && !"ADMIN".equalsIgnoreCase(roleName)) {
      db.dropRole(roleName);
    }
  }
  conf=new HiveConf(Driver.class);
  initConf();
  db=Hive.get(conf);
  setup.preTest(conf);
}
