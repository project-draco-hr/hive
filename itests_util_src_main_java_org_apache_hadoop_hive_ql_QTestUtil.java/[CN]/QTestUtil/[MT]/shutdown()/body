{
  if (System.getenv(QTEST_LEAVE_FILES) == null) {
    cleanUp();
  }
  if (clusterType == MiniClusterType.tez || clusterType == MiniClusterType.llap) {
    SessionState.get().getTezSession().close(false);
  }
  setup.tearDown();
  if (sparkSession != null) {
    try {
      SparkSessionManagerImpl.getInstance().closeSession(sparkSession);
    }
 catch (    Exception ex) {
      LOG.error("Error closing spark session.",ex);
    }
 finally {
      sparkSession=null;
    }
  }
  if (mr != null) {
    mr.shutdown();
    mr=null;
  }
  FileSystem.closeAll();
  if (dfs != null) {
    dfs.shutdown();
    dfs=null;
  }
}
