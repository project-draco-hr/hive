{
  String uriString=WindowsPathUtil.getHdfsUriString(fs.getUri().toString());
  if (clusterType.getCoreClusterType() == CoreClusterType.TEZ) {
    if (confDir != null && !confDir.isEmpty()) {
      conf.addResource(new URL("file://" + new File(confDir).toURI().getPath() + "/tez-site.xml"));
    }
    int numTrackers;
    if (EnumSet.of(MiniClusterType.llap,MiniClusterType.llap_local).contains(clusterType)) {
      llapCluster=LlapItUtils.startAndGetMiniLlapCluster(conf,setup.zooKeeperCluster,confDir);
      numTrackers=2;
    }
 else {
      numTrackers=4;
    }
    if (EnumSet.of(MiniClusterType.llap_local,MiniClusterType.tez_local).contains(clusterType)) {
      mr=shims.getLocalMiniTezCluster(conf,clusterType == MiniClusterType.llap_local);
    }
 else {
      mr=shims.getMiniTezCluster(conf,numTrackers,uriString);
    }
  }
 else   if (clusterType == MiniClusterType.miniSparkOnYarn) {
    mr=shims.getMiniSparkCluster(conf,4,uriString,1);
  }
 else   if (clusterType == MiniClusterType.mr) {
    mr=shims.getMiniMrCluster(conf,4,uriString,1);
  }
}
