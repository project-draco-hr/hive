{
  if (localMode) {
    Preconditions.checkState(clusterType == MiniClusterType.tez || clusterType == MiniClusterType.llap,"localMode can currently only be set for tez or llap");
  }
  String uriString=WindowsPathUtil.getHdfsUriString(fs.getUri().toString());
  if (clusterType == MiniClusterType.tez || clusterType == MiniClusterType.llap) {
    if (confDir != null && !confDir.isEmpty()) {
      conf.addResource(new URL("file://" + new File(confDir).toURI().getPath() + "/tez-site.xml"));
    }
    int numTrackers;
    if (clusterType == MiniClusterType.tez) {
      numTrackers=4;
    }
 else {
      llapCluster=LlapItUtils.startAndGetMiniLlapCluster(conf,setup.zooKeeperCluster,confDir);
      numTrackers=2;
    }
    if (localMode) {
      mr=shims.getLocalMiniTezCluster(conf,clusterType == MiniClusterType.llap);
    }
 else {
      mr=shims.getMiniTezCluster(conf,numTrackers,uriString);
    }
  }
 else   if (clusterType == MiniClusterType.miniSparkOnYarn) {
    mr=shims.getMiniSparkCluster(conf,4,uriString,1);
  }
 else   if (clusterType == MiniClusterType.mr || clusterType == MiniClusterType.encrypted) {
    mr=shims.getMiniMrCluster(conf,4,uriString,1);
  }
}
