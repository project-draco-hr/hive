{
  return new CliSessionState(conf){
    @Override public void setSparkSession(    SparkSession sparkSession){
      super.setSparkSession(sparkSession);
      if (sparkSession != null) {
        try {
          long endTime=System.currentTimeMillis() + 240000;
          while (sparkSession.getMemoryAndCores().getSecond() <= 1) {
            if (System.currentTimeMillis() >= endTime) {
              LOG.error("Timed out waiting for Spark cluster to init");
              break;
            }
            Thread.sleep(100);
          }
        }
 catch (        Exception e) {
          LOG.error(e);
        }
      }
    }
  }
;
}
