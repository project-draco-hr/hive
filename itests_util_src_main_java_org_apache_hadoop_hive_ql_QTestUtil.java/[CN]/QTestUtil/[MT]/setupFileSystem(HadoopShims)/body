{
  if (useLocalFs) {
    Preconditions.checkState(clusterType == MiniClusterType.tez || clusterType == MiniClusterType.llap,"useLocalFs can currently only be set for tez or llap");
  }
  if (clusterType != MiniClusterType.none && clusterType != MiniClusterType.spark) {
    int numDataNodes=4;
    if (clusterType == MiniClusterType.encrypted) {
      conf.set(SECURITY_KEY_PROVIDER_URI_NAME,getKeyProviderURI());
      conf.setInt("fs.trash.interval",50);
      dfs=shims.getMiniDfs(conf,numDataNodes,true,null);
      fs=dfs.getFileSystem();
      hes=shims.createHdfsEncryptionShim(fs,conf);
      LOG.info("key provider is initialized");
    }
 else {
      if (!useLocalFs) {
        dfs=shims.getMiniDfs(conf,numDataNodes,true,null);
        fs=dfs.getFileSystem();
      }
 else {
        fs=FileSystem.getLocal(conf);
      }
    }
  }
 else {
    fs=FileSystem.getLocal(conf);
  }
}
