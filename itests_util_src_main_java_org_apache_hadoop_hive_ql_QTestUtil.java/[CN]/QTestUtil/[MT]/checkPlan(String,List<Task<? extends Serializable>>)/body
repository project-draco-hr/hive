{
  if (tasks == null) {
    throw new Exception("Plan is null");
  }
  File planDir=new File(outDir,"plan");
  String planFile=outPath(planDir.toString(),tname + ".xml");
  File outf=null;
  outf=new File(logDir);
  outf=new File(outf,tname.concat(".xml"));
  FileOutputStream ofs=new FileOutputStream(outf);
  try {
    conf.set(HiveConf.ConfVars.PLAN_SERIALIZATION.varname,"javaXML");
    for (    Task<? extends Serializable> plan : tasks) {
      Utilities.serializePlan(plan,ofs,conf);
    }
    ofs.close();
    fixXml4JDK7(outf.getPath());
    maskPatterns(xmlPlanMask,outf.getPath());
    int exitVal=executeDiffCommand(outf.getPath(),planFile,true,false);
    if (exitVal != 0 && overWrite) {
      exitVal=overwriteResults(outf.getPath(),planFile);
    }
    return exitVal;
  }
  finally {
    conf.set(HiveConf.ConfVars.PLAN_SERIALIZATION.varname,"kryo");
    IOUtils.closeQuietly(ofs);
  }
}
