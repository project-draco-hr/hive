{
  if (ci.tooManyAborts) {
    LOG.debug("Found too many aborted transactions for " + ci.getFullPartitionName() + ", "+ "initiating major compaction");
    return CompactionType.MAJOR;
  }
  if (runJobAsSelf(runAs)) {
    return determineCompactionType(ci,txns,sd);
  }
 else {
    LOG.info("Going to initiate as user " + runAs);
    UserGroupInformation ugi=UserGroupInformation.createProxyUser(runAs,UserGroupInformation.getLoginUser());
    return ugi.doAs(new PrivilegedExceptionAction<CompactionType>(){
      @Override public CompactionType run() throws Exception {
        return determineCompactionType(ci,txns,sd);
      }
    }
);
  }
}
