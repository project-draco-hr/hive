{
  ensureWriter();
  OrcProto.Footer.Builder builder=OrcProto.Footer.newBuilder();
  builder.setContentLength(bodyLength);
  builder.setHeaderLength(headerLength);
  builder.setNumberOfRows(rowCount);
  builder.setRowIndexStride(rowIndexStride);
  writeTypes(builder,treeWriter);
  for (  OrcProto.StripeInformation stripe : stripes) {
    builder.addStripes(stripe);
  }
  writeFileStatistics(builder,treeWriter);
  for (  Map.Entry<String,ByteString> entry : userMetadata.entrySet()) {
    builder.addMetadata(OrcProto.UserMetadataItem.newBuilder().setName(entry.getKey()).setValue(entry.getValue()));
  }
  long startPosn=rawWriter.getPos();
  OrcProto.Footer footer=builder.build();
  footer.writeTo(protobufWriter);
  protobufWriter.flush();
  writer.flush();
  return (int)(rawWriter.getPos() - startPosn);
}
