{
  if (columnCount > COLUMN_COUNT_THRESHOLD) {
    final int outStreamBuffers=isCompressed ? 2 : 1;
    final int maxStreams=5;
    final long miscAllocation=(long)(0.1f * availableMem);
    final long remainingMem=availableMem - miscAllocation;
    int estBufferSize=(int)(remainingMem / (maxStreams * outStreamBuffers * columnCount));
    estBufferSize=getClosestBufferSize(estBufferSize);
    if (estBufferSize > bs) {
      estBufferSize=bs;
    }
    LOG.info("WIDE TABLE - Number of columns: " + columnCount + " Chosen compression buffer size: "+ estBufferSize);
    return estBufferSize;
  }
  return bs;
}
