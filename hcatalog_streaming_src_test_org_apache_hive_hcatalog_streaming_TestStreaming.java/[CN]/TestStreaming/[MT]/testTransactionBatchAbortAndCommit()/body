{
  String agentInfo="UT_" + Thread.currentThread().getName();
  HiveEndPoint endPt=new HiveEndPoint(metaStoreURI,dbName,tblName,partitionVals);
  StreamingConnection connection=endPt.newConnection(false,agentInfo);
  DelimitedInputWriter writer=new DelimitedInputWriter(fieldNames,",",endPt,connection);
  TransactionBatch txnBatch=connection.fetchTransactionBatch(10,writer);
  txnBatch.beginNextTransaction();
  txnBatch.write("1,Hello streaming".getBytes());
  txnBatch.write("2,Welcome to streaming".getBytes());
  ShowLocksResponse resp=msClient.showLocks(new ShowLocksRequest());
  Assert.assertEquals("LockCount",1,resp.getLocksSize());
  Assert.assertEquals("LockType",LockType.SHARED_READ,resp.getLocks().get(0).getType());
  Assert.assertEquals("LockState",LockState.ACQUIRED,resp.getLocks().get(0).getState());
  Assert.assertEquals("AgentInfo",agentInfo,resp.getLocks().get(0).getAgentInfo());
  txnBatch.abort();
  checkNothingWritten(partLoc);
  Assert.assertEquals(TransactionBatch.TxnState.ABORTED,txnBatch.getCurrentTransactionState());
  txnBatch.beginNextTransaction();
  txnBatch.write("1,Hello streaming".getBytes());
  txnBatch.write("2,Welcome to streaming".getBytes());
  txnBatch.commit();
  checkDataWritten(partLoc,1,10,1,1,"{1, Hello streaming}","{2, Welcome to streaming}");
  txnBatch.close();
  connection.close();
}
