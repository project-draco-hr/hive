{
  HiveEndPoint endPt=new HiveEndPoint(metaStoreURI,dbName,tblName,partitionVals);
  DelimitedInputWriter writer=new DelimitedInputWriter(fieldNames,",",endPt);
  StreamingConnection connection=endPt.newConnection(false);
  TransactionBatch txnBatch1=connection.fetchTransactionBatch(10,writer);
  txnBatch1.beginNextTransaction();
  DelimitedInputWriter writer2=new DelimitedInputWriter(fieldNames,",",endPt);
  TransactionBatch txnBatch2=connection.fetchTransactionBatch(10,writer2);
  txnBatch2.beginNextTransaction();
  txnBatch1.write("1,Hello streaming".getBytes());
  txnBatch2.write("3,Hello streaming - once again".getBytes());
  checkNothingWritten(partLoc);
  txnBatch2.commit();
  checkDataWritten(partLoc,11,20,1,1,"{3, Hello streaming - once again}");
  txnBatch1.commit();
  checkDataWritten(partLoc,1,20,1,2,"{1, Hello streaming}","{3, Hello streaming - once again}");
  txnBatch1.beginNextTransaction();
  txnBatch1.write("2,Welcome to streaming".getBytes());
  txnBatch2.beginNextTransaction();
  txnBatch2.write("4,Welcome to streaming - once again".getBytes());
  checkDataWritten(partLoc,1,20,1,2,"{1, Hello streaming}","{3, Hello streaming - once again}");
  txnBatch1.commit();
  checkDataWritten(partLoc,1,20,1,2,"{1, Hello streaming}","{2, Welcome to streaming}","{3, Hello streaming - once again}");
  txnBatch2.commit();
  checkDataWritten(partLoc,1,20,1,2,"{1, Hello streaming}","{2, Welcome to streaming}","{3, Hello streaming - once again}","{4, Welcome to streaming - once again}");
  Assert.assertEquals(TransactionBatch.TxnState.COMMITTED,txnBatch1.getCurrentTransactionState());
  Assert.assertEquals(TransactionBatch.TxnState.COMMITTED,txnBatch2.getCurrentTransactionState());
  txnBatch1.close();
  txnBatch2.close();
  connection.close();
}
