{
  HiveEndPoint endPt=new HiveEndPoint(metaStoreURI,dbName,tblName,partitionVals);
  DelimitedInputWriter writer=new DelimitedInputWriter(fieldNames,",",endPt);
  StreamingConnection connection=endPt.newConnection(true);
  TransactionBatch txnBatch=connection.fetchTransactionBatch(10,writer);
  txnBatch.beginNextTransaction();
  Assert.assertEquals(TransactionBatch.TxnState.OPEN,txnBatch.getCurrentTransactionState());
  txnBatch.write("1,Hello streaming".getBytes());
  txnBatch.commit();
  checkDataWritten(1,10,1,1,"{1, Hello streaming}");
  Assert.assertEquals(TransactionBatch.TxnState.COMMITTED,txnBatch.getCurrentTransactionState());
  txnBatch.beginNextTransaction();
  Assert.assertEquals(TransactionBatch.TxnState.OPEN,txnBatch.getCurrentTransactionState());
  txnBatch.write("2,Welcome to streaming".getBytes());
  checkDataWritten(1,10,1,1,"{1, Hello streaming}");
  txnBatch.commit();
  checkDataWritten(1,10,1,1,"{1, Hello streaming}","{2, Welcome to streaming}");
  txnBatch.close();
  Assert.assertEquals(TransactionBatch.TxnState.INACTIVE,txnBatch.getCurrentTransactionState());
  connection.close();
  endPt=new HiveEndPoint(metaStoreURI,dbName2,tblName2,null);
  writer=new DelimitedInputWriter(fieldNames,",",endPt);
  connection=endPt.newConnection(true);
  txnBatch=connection.fetchTransactionBatch(10,writer);
  txnBatch.beginNextTransaction();
  Assert.assertEquals(TransactionBatch.TxnState.OPEN,txnBatch.getCurrentTransactionState());
  txnBatch.write("1,Hello streaming".getBytes());
  txnBatch.commit();
  Assert.assertEquals(TransactionBatch.TxnState.COMMITTED,txnBatch.getCurrentTransactionState());
  connection.close();
}
