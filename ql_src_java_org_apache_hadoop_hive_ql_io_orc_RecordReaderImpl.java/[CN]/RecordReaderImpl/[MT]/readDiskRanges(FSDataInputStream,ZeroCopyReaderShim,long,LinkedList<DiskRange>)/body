{
  ListIterator<DiskRange> rangeIter=ranges.listIterator();
  while (rangeIter.hasNext()) {
    DiskRange range=rangeIter.next();
    if (range.hasData())     continue;
    rangeIter.remove();
    rangeIter.previous();
    int len=(int)(range.end - range.offset);
    long off=range.offset;
    file.seek(base + off);
    if (zcr != null) {
      while (len > 0) {
        ByteBuffer partial=zcr.readBuffer(len,false);
        ranges.add(new BufferChunk(partial,off));
        int read=partial.remaining();
        len-=read;
        off+=read;
      }
    }
 else {
      byte[] buffer=new byte[len];
      file.readFully(buffer,0,buffer.length);
      ranges.add(new BufferChunk(ByteBuffer.wrap(buffer),range.offset));
    }
  }
}
