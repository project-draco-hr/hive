{
  ArrayList<DiskRange> buffers=new ArrayList<DiskRange>();
  long streamEnd=offset + length;
  boolean inRange=false;
  for (  DiskRange range : ranges) {
    if (!inRange) {
      if (range.end <= offset)       continue;
      inRange=true;
      if (range.offset < offset) {
        DiskRange partial=range.slice(offset,Math.min(streamEnd,range.end));
        partial.shiftBy(offset);
        buffers.add(partial);
        if (range.end >= streamEnd)         break;
        continue;
      }
    }
 else     if (range.offset >= streamEnd) {
      break;
    }
    if (range.end > streamEnd) {
      DiskRange partial=range.slice(range.offset,streamEnd);
      partial.shiftBy(offset);
      buffers.add(partial);
      break;
    }
    DiskRange full=range.slice(range.offset,range.end);
    full.shiftBy(offset);
    buffers.add(full);
    if (range.end == streamEnd)     break;
  }
  return buffers;
}
