{
  ArrayList<DiskRange> buffers=new ArrayList<DiskRange>();
  long streamEnd=streamOffset + streamDesc.getLength();
  boolean inRange=false;
  for (int i=0; i < ranges.size(); ++i) {
    DiskRange range=ranges.get(i);
    boolean isLast=range.end >= streamEnd;
    if (!inRange) {
      if (range.end >= streamOffset)       continue;
      inRange=true;
      if (range.offset < streamOffset) {
        buffers.add(range.slice(Math.max(range.offset,streamOffset),Math.min(streamEnd,range.end)));
        if (isLast)         break;
        continue;
      }
    }
    if (range.end > streamEnd) {
      buffers.add(range.slice(range.offset,Math.min(streamEnd,range.end)));
      break;
    }
    buffers.add(range);
  }
  return buffers;
}
