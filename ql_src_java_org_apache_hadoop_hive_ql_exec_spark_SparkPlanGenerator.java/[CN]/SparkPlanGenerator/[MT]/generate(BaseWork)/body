{
  if (bw.isGatheringStats()) {
    StatsPublisher statsPublisher;
    StatsFactory factory=StatsFactory.newFactory(jobConf);
    if (factory != null) {
      statsPublisher=factory.getStatsPublisher();
      if (!statsPublisher.init(jobConf)) {
        if (HiveConf.getBoolVar(jobConf,HiveConf.ConfVars.HIVE_STATS_RELIABLE)) {
          throw new HiveException(ErrorMsg.STATSPUBLISHER_INITIALIZATION_ERROR.getErrorCodedMsg());
        }
      }
    }
  }
  if (bw instanceof MapWork) {
    return generate((MapWork)bw);
  }
 else   if (bw instanceof ReduceWork) {
    return generate((ReduceWork)bw);
  }
 else {
    throw new IllegalArgumentException("Only MapWork and ReduceWork are expected");
  }
}
