{
  perfLogger.PerfLogBegin(CLASS_NAME,PerfLogger.SPARK_BUILD_PLAN);
  SparkPlan sparkPlan=new SparkPlan();
  cloneToWork=sparkWork.getCloneToWork();
  workToTranMap.clear();
  workToParentWorkTranMap.clear();
  try {
    for (    BaseWork work : sparkWork.getAllWork()) {
      perfLogger.PerfLogBegin(CLASS_NAME,PerfLogger.SPARK_CREATE_TRAN + work.getName());
      SparkTran tran=generate(work,sparkWork);
      SparkTran parentTran=generateParentTran(sparkPlan,sparkWork,work);
      sparkPlan.addTran(tran);
      sparkPlan.connect(parentTran,tran);
      workToTranMap.put(work,tran);
      perfLogger.PerfLogEnd(CLASS_NAME,PerfLogger.SPARK_CREATE_TRAN + work.getName());
    }
  }
  finally {
    Utilities.clearWorkMap(jobConf);
  }
  perfLogger.PerfLogEnd(CLASS_NAME,PerfLogger.SPARK_BUILD_PLAN);
  return sparkPlan;
}
