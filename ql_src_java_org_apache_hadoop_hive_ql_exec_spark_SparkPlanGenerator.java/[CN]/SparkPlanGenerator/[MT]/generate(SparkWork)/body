{
  SparkPlan sparkPlan=new SparkPlan();
  Map<BaseWork,SparkTran> workToTranMap=new HashMap<BaseWork,SparkTran>();
  for (  BaseWork work : sparkWork.getAllWork()) {
    SparkTran tran;
    if (work instanceof MapWork) {
      MapInput mapInput=generateMapInput((MapWork)work);
      sparkPlan.addTran(mapInput);
      tran=generate((MapWork)work);
      sparkPlan.addTran(tran);
      sparkPlan.connect(mapInput,tran);
    }
 else     if (work instanceof ReduceWork) {
      List<BaseWork> parentWorks=sparkWork.getParents(work);
      tran=generate((ReduceWork)work);
      sparkPlan.addTran(tran);
      ShuffleTran shuffleTran=generate(sparkWork.getEdgeProperty(parentWorks.get(0),work));
      sparkPlan.addTran(shuffleTran);
      sparkPlan.connect(shuffleTran,tran);
      for (      BaseWork parentWork : parentWorks) {
        SparkTran parentTran=workToTranMap.get(parentWork);
        sparkPlan.connect(parentTran,shuffleTran);
      }
    }
 else {
      List<BaseWork> parentWorks=sparkWork.getParents(work);
      tran=new IdentityTran();
      sparkPlan.addTran(tran);
      for (      BaseWork parentWork : parentWorks) {
        SparkTran parentTran=workToTranMap.get(parentWork);
        sparkPlan.connect(parentTran,tran);
      }
    }
    workToTranMap.put(work,tran);
  }
  return sparkPlan;
}
