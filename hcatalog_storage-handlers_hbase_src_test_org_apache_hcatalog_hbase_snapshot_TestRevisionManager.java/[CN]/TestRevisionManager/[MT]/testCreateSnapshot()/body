{
  int port=getHbaseConf().getInt("hbase.zookeeper.property.clientPort",2181);
  String host=getHbaseConf().get("hbase.zookeeper.quorum");
  Configuration conf=RevisionManagerConfiguration.create(getHbaseConf());
  conf.set(RMConstants.ZOOKEEPER_DATADIR,"/rm_base");
  ZKBasedRevisionManager manager=new ZKBasedRevisionManager();
  manager.initialize(conf);
  manager.open();
  String tableName=newTableName("testTable");
  List<String> cfOne=Arrays.asList("cf1","cf2");
  List<String> cfTwo=Arrays.asList("cf2","cf3");
  Transaction tsx1=manager.beginWriteTransaction(tableName,cfOne);
  Transaction tsx2=manager.beginWriteTransaction(tableName,cfTwo);
  TableSnapshot snapshotOne=manager.createSnapshot(tableName);
  assertEquals(snapshotOne.getRevision("cf1"),0);
  assertEquals(snapshotOne.getRevision("cf2"),0);
  assertEquals(snapshotOne.getRevision("cf3"),1);
  List<String> cfThree=Arrays.asList("cf1","cf3");
  Transaction tsx3=manager.beginWriteTransaction(tableName,cfThree);
  manager.commitWriteTransaction(tsx1);
  TableSnapshot snapshotTwo=manager.createSnapshot(tableName);
  assertEquals(snapshotTwo.getRevision("cf1"),2);
  assertEquals(snapshotTwo.getRevision("cf2"),1);
  assertEquals(snapshotTwo.getRevision("cf3"),1);
  manager.commitWriteTransaction(tsx2);
  TableSnapshot snapshotThree=manager.createSnapshot(tableName);
  assertEquals(snapshotThree.getRevision("cf1"),2);
  assertEquals(snapshotThree.getRevision("cf2"),3);
  assertEquals(snapshotThree.getRevision("cf3"),2);
  manager.commitWriteTransaction(tsx3);
  TableSnapshot snapshotFour=manager.createSnapshot(tableName);
  assertEquals(snapshotFour.getRevision("cf1"),3);
  assertEquals(snapshotFour.getRevision("cf2"),3);
  assertEquals(snapshotFour.getRevision("cf3"),3);
}
