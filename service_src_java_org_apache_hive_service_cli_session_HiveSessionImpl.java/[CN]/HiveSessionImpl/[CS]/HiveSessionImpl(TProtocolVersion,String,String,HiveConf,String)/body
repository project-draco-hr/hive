{
  this.username=username;
  this.password=password;
  this.sessionHandle=new SessionHandle(protocol);
  this.hiveConf=new HiveConf(serverhiveConf);
  this.ipAddress=ipAddress;
  try {
    if (!hiveConf.getBoolVar(ConfVars.HIVE_SERVER2_ENABLE_DOAS) && hiveConf.getBoolVar(ConfVars.HIVE_SERVER2_MAP_FAIR_SCHEDULER_QUEUE)) {
      ShimLoader.getHadoopShims().refreshDefaultQueue(hiveConf,username);
    }
  }
 catch (  IOException e) {
    LOG.warn("Error setting scheduler queue: " + e,e);
  }
  hiveConf.set(ConfVars.HIVESESSIONID.varname,sessionHandle.getHandleIdentifier().toString());
  hiveConf.set(ListSinkOperator.OUTPUT_FORMATTER,FetchFormatter.ThriftFormatter.class.getName());
  hiveConf.setInt(ListSinkOperator.OUTPUT_PROTOCOL,protocol.getValue());
  sessionState=new SessionState(hiveConf,username);
  sessionState.setUserIpAddress(ipAddress);
  sessionState.setIsHiveServerQuery(true);
  lastAccessTime=System.currentTimeMillis();
  SessionState.start(sessionState);
}
