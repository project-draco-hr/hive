{
  boolean forceNoNulls=false;
  if (currentSegmentStart != -1) {
    if (!currentSegmentIsRepeating) {
      if (!currentSegmentHasNulls || canValuesFitIntoCurrentSegment(buffer,valueCount,currentSizeOf)) {
        return;
      }
      forceNoNulls=true;
    }
    finishCurrentSegment();
  }
  currentSegmentStart=valuesOffset;
  valuesOffset+=8;
  currentSegmentIsRepeating=false;
  valuesSinceBitmask=currentSegmentValues=0;
  currentSegmentHasNulls=!forceNoNulls && shouldNewSegmentHaveBitmasks(valueCount,nullsState,buffer,valuesOffset,currentSizeOf);
  if (!currentSegmentHasNulls) {
    currentBitmaskOffset=-1;
  }
 else {
    startNextBitmask(buffer);
  }
}
