{
  currentBitmaskOffset=valuesOffset;
  int spaceLeft=buffer.limit() - currentBitmaskOffset;
  valuesSinceBitmask=0;
  valuesOffset=currentBitmaskOffset;
  if (spaceLeft >= ChunkUtils.getFullBitmaskSize(currentSizeOf)) {
    currentBitmaskLimit=ChunkUtils.BITMASK_SIZE_BITS;
    valuesOffset+=ChunkUtils.BITMASK_SIZE_BYTES;
    return;
  }
  int incrementSize=8 + (currentSizeOf << 6);
  int incrementsThatFit=(spaceLeft / incrementSize);
  valuesOffset+=(incrementsThatFit << 3);
  currentBitmaskLimit=incrementsThatFit >>> 6;
  spaceLeft=(spaceLeft % incrementSize) - 8;
  if (spaceLeft >= currentSizeOf) {
    valuesOffset+=8;
    currentBitmaskLimit+=(spaceLeft / currentSizeOf);
  }
  if (currentBitmaskLimit == 0) {
    throw new AssertionError("Bitmask won't fit; caller should have checked that");
  }
}
