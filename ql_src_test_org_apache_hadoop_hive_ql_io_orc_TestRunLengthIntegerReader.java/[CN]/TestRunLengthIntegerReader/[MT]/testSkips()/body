{
  TestInStream.OutputCollector collect=new TestInStream.OutputCollector();
  RunLengthIntegerWriter out=new RunLengthIntegerWriter(new OutStream("test",100,null,collect),true);
  for (int i=0; i < 2048; ++i) {
    if (i < 1024) {
      out.write(i);
    }
 else {
      out.write(256 * i);
    }
  }
  out.flush();
  ByteBuffer inBuf=ByteBuffer.allocate(collect.buffer.size());
  collect.buffer.setByteBuffer(inBuf,0,collect.buffer.size());
  inBuf.flip();
  RunLengthIntegerReader in=new RunLengthIntegerReader(InStream.create(null,"test",new ByteBuffer[]{inBuf},new long[]{0},inBuf.remaining(),null,100),true);
  for (int i=0; i < 2048; i+=10) {
    int x=(int)in.next();
    if (i < 1024) {
      assertEquals(i,x);
    }
 else {
      assertEquals(256 * i,x);
    }
    if (i < 2038) {
      in.skip(9);
    }
    in.skip(0);
  }
}
