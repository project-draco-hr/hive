{
  VectorHashKeyWrapperBatch compiledKeyWrapperBatch=new VectorHashKeyWrapperBatch();
  compiledKeyWrapperBatch.keyExpressions=keyExpressions;
  int[] longIndices=new int[keyExpressions.length];
  int longIndicesIndex=0;
  int[] doubleIndices=new int[keyExpressions.length];
  int doubleIndicesIndex=0;
  int[] stringIndices=new int[keyExpressions.length];
  int stringIndicesIndex=0;
  KeyLookupHelper[] indexLookup=new KeyLookupHelper[keyExpressions.length];
  for (int i=0; i < keyExpressions.length; ++i) {
    indexLookup[i]=new KeyLookupHelper();
    String outputType=keyExpressions[i].getOutputType();
    if (outputType.equalsIgnoreCase("tinyint") || outputType.equalsIgnoreCase("smallint") || outputType.equalsIgnoreCase("int")|| outputType.equalsIgnoreCase("bigint")|| outputType.equalsIgnoreCase("timestamp")|| outputType.equalsIgnoreCase("boolean")) {
      longIndices[longIndicesIndex]=i;
      indexLookup[i].longIndex=longIndicesIndex;
      indexLookup[i].doubleIndex=-1;
      indexLookup[i].stringIndex=-1;
      ++longIndicesIndex;
    }
 else     if (outputType.equalsIgnoreCase("double") || outputType.equalsIgnoreCase("float")) {
      doubleIndices[doubleIndicesIndex]=i;
      indexLookup[i].longIndex=-1;
      indexLookup[i].doubleIndex=doubleIndicesIndex;
      indexLookup[i].stringIndex=-1;
      ++doubleIndicesIndex;
    }
 else     if (outputType.equalsIgnoreCase("string")) {
      indexLookup[i].longIndex=-1;
      indexLookup[i].doubleIndex=-1;
      stringIndices[i]=stringIndicesIndex;
      ++stringIndicesIndex;
    }
 else {
      throw new HiveException("Unsuported vector output type: " + outputType);
    }
  }
  compiledKeyWrapperBatch.indexLookup=indexLookup;
  compiledKeyWrapperBatch.longIndices=Arrays.copyOf(longIndices,longIndicesIndex);
  compiledKeyWrapperBatch.doubleIndices=Arrays.copyOf(doubleIndices,doubleIndicesIndex);
  compiledKeyWrapperBatch.stringIndices=Arrays.copyOf(stringIndices,stringIndicesIndex);
  compiledKeyWrapperBatch.vectorHashKeyWrappers=new VectorHashKeyWrapper[VectorizedRowBatch.DEFAULT_SIZE];
  for (int i=0; i < VectorizedRowBatch.DEFAULT_SIZE; ++i) {
    compiledKeyWrapperBatch.vectorHashKeyWrappers[i]=new VectorHashKeyWrapper(longIndicesIndex,doubleIndicesIndex,stringIndicesIndex);
  }
  return compiledKeyWrapperBatch;
}
