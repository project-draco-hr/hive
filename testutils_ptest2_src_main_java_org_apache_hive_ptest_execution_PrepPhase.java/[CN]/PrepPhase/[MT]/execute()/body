{
  long prepStart=System.currentTimeMillis();
  execLocally("mkdir -p $workingDir/scratch");
  execInstances("mkdir -p $localDir/$instanceName/logs $localDir/$instanceName/maven $localDir/$instanceName/scratch");
  execInstances("mkdir -p $localDir/$instanceName/ivy $localDir/$instanceName/${repositoryName}-source");
  if (mPatchFile != null) {
    File smartApplyPatch=new File(mScratchDir,"smart-apply-patch.sh");
    PrintWriter writer=new PrintWriter(smartApplyPatch);
    try {
      writer.write(Templates.readResource("smart-apply-patch.sh"));
      if (writer.checkError()) {
        throw new IOException("Error writing to " + smartApplyPatch);
      }
    }
  finally {
      writer.close();
    }
    execLocally("cp -f " + mPatchFile.getPath() + " $workingDir/scratch/build.patch");
  }
  long start;
  long elapsedTime;
  start=System.currentTimeMillis();
  File sourcePrepScript=new File(mScratchDir,"source-prep.sh");
  Templates.writeTemplateResult("source-prep.vm",sourcePrepScript,getTemplateDefaults());
  execLocally("bash " + sourcePrepScript.getPath());
  logger.debug("Deleting " + sourcePrepScript + ": "+ sourcePrepScript.delete());
  elapsedTime=TimeUnit.MINUTES.convert((System.currentTimeMillis() - start),TimeUnit.MILLISECONDS);
  logger.info("PERF: source prep took " + elapsedTime + " minutes");
  start=System.currentTimeMillis();
  rsyncFromLocalToRemoteInstances("$workingDir/${repositoryName}-source","$localDir/$instanceName/");
  elapsedTime=TimeUnit.MINUTES.convert((System.currentTimeMillis() - start),TimeUnit.MILLISECONDS);
  logger.info("PERF: rsync source took " + elapsedTime + " minutes");
  start=System.currentTimeMillis();
  rsyncFromLocalToRemoteInstances("$workingDir/maven","$localDir/$instanceName/");
  elapsedTime=TimeUnit.MINUTES.convert((System.currentTimeMillis() - start),TimeUnit.MILLISECONDS);
  logger.info("PERF: rsync maven took " + elapsedTime + " minutes");
  start=System.currentTimeMillis();
  rsyncFromLocalToRemoteInstances("$workingDir/ivy","$localDir/$instanceName/");
  elapsedTime=TimeUnit.MINUTES.convert((System.currentTimeMillis() - start),TimeUnit.MILLISECONDS);
  logger.info("PERF: rsync ivy took " + elapsedTime + " minutes");
  elapsedTime=TimeUnit.MINUTES.convert((System.currentTimeMillis() - prepStart),TimeUnit.MILLISECONDS);
  logger.info("PERF: prep phase took " + elapsedTime + " minutes");
}
