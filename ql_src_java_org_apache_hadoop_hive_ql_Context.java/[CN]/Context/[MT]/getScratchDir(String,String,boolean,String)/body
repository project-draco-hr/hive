{
  String fileSystem=scheme + ":" + authority;
  Path dir=fsScratchDirs.get(fileSystem + "-" + TaskRunner.getTaskRunnerID());
  if (dir == null) {
    Path dirPath=new Path(scheme,authority,scratchDir + "-" + TaskRunner.getTaskRunnerID());
    if (mkdir) {
      try {
        FileSystem fs=dirPath.getFileSystem(conf);
        dirPath=new Path(fs.makeQualified(dirPath).toString());
        FsPermission fsPermission=new FsPermission(Short.parseShort(scratchDirPermission.trim(),8));
        if (!Utilities.createDirsWithPermission(conf,dirPath,fsPermission)) {
          throw new RuntimeException("Cannot make directory: " + dirPath.toString());
        }
        if (isHDFSCleanup) {
          fs.deleteOnExit(dirPath);
        }
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
    }
    dir=dirPath;
    fsScratchDirs.put(fileSystem + "-" + TaskRunner.getTaskRunnerID(),dir);
  }
  return dir;
}
