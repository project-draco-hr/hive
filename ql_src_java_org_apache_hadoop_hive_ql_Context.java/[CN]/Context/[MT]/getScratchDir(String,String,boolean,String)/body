{
  String fileSystem=scheme + ":" + authority;
  String dir=fsScratchDirs.get(fileSystem + "-" + TaskRunner.getTaskRunnerID());
  if (dir == null) {
    Path dirPath=new Path(scheme,authority,scratchDir + "-" + TaskRunner.getTaskRunnerID());
    if (mkdir) {
      try {
        FileSystem fs=dirPath.getFileSystem(conf);
        dirPath=new Path(fs.makeQualified(dirPath).toString());
        if (!fs.mkdirs(dirPath)) {
          throw new RuntimeException("Cannot make directory: " + dirPath.toString());
        }
 else {
          FsPermission fsPermission=new FsPermission(Short.parseShort(scratchDirPermission.trim()));
          fs.setPermission(dirPath,fsPermission);
        }
        if (isHDFSCleanup) {
          fs.deleteOnExit(dirPath);
        }
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
    }
    dir=dirPath.toString();
    fsScratchDirs.put(fileSystem + "-" + TaskRunner.getTaskRunnerID(),dir);
  }
  return dir;
}
