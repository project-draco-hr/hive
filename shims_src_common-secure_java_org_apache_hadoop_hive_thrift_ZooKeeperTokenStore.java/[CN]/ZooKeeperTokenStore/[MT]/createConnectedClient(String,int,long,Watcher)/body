{
  final CountDownLatch connected=new CountDownLatch(1);
  Watcher connectWatcher=new Watcher(){
    @Override public void process(    WatchedEvent event){
switch (event.getState()) {
case SyncConnected:
        connected.countDown();
      break;
  }
  for (  Watcher w : watchers) {
    w.process(event);
  }
}
}
;
ZooKeeper zk=new ZooKeeper(connectString,sessionTimeout,connectWatcher);
if (connectTimeout > 0) {
try {
  if (!connected.await(connectTimeout,TimeUnit.MILLISECONDS)) {
    zk.close();
    throw new IOException("Timeout waiting for connection after " + connectTimeout + "ms");
  }
}
 catch (InterruptedException e) {
  throw new IOException("Error waiting for connection.",e);
}
}
return zk;
}
