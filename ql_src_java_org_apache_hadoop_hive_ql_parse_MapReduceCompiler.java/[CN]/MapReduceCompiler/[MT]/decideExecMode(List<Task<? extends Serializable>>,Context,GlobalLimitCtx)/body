{
  if (ctx.isExplainSkipExecution()) {
    return;
  }
  if (ctx.isLocalOnlyExecutionMode() || !conf.getBoolVar(HiveConf.ConfVars.LOCALMODEAUTO)) {
    return;
  }
  final Context lCtx=ctx;
  PathFilter p=new PathFilter(){
    @Override public boolean accept(    Path file){
      return !lCtx.isMRTmpFileURI(file.toUri().getPath());
    }
  }
;
  List<ExecDriver> mrtasks=Utilities.getMRTasks(rootTasks);
  boolean hasNonLocalJob=false;
  for (  ExecDriver mrtask : mrtasks) {
    try {
      ContentSummary inputSummary=Utilities.getInputSummary(ctx,mrtask.getWork().getMapWork(),p);
      int numReducers=getNumberOfReducers(mrtask.getWork(),conf);
      long estimatedInput;
      if (globalLimitCtx != null && globalLimitCtx.isEnable()) {
        long sizePerRow=HiveConf.getLongVar(conf,HiveConf.ConfVars.HIVELIMITMAXROWSIZE);
        estimatedInput=(globalLimitCtx.getGlobalOffset() + globalLimitCtx.getGlobalLimit()) * sizePerRow;
        long minSplitSize=HiveConf.getLongVar(conf,HiveConf.ConfVars.MAPREDMINSPLITSIZE);
        long estimatedNumMap=inputSummary.getLength() / minSplitSize + 1;
        estimatedInput=estimatedInput * (estimatedNumMap + 1);
      }
 else {
        estimatedInput=inputSummary.getLength();
      }
      if (LOG.isDebugEnabled()) {
        LOG.debug("Task: " + mrtask.getId() + ", Summary: "+ inputSummary.getLength()+ ","+ inputSummary.getFileCount()+ ","+ numReducers+ ", estimated Input: "+ estimatedInput);
      }
      if (MapRedTask.isEligibleForLocalMode(conf,numReducers,estimatedInput,inputSummary.getFileCount()) != null) {
        hasNonLocalJob=true;
        break;
      }
 else {
        mrtask.setLocalMode(true);
      }
    }
 catch (    IOException e) {
      throw new SemanticException(e);
    }
  }
  if (!hasNonLocalJob) {
    ctx.setOriginalTracker(ShimLoader.getHadoopShims().getJobLauncherRpcAddress(conf));
    ShimLoader.getHadoopShims().setJobLauncherRpcAddress(conf,"local");
    console.printInfo("Automatically selecting local only mode for query");
  }
}
