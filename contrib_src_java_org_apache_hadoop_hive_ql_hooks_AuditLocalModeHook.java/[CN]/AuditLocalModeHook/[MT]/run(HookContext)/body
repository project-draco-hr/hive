{
  HiveConf conf=hookContext.getConf();
  String command=StringEscapeUtils.escapeJava(SessionState.get().getCmd());
  QueryPlan plan=hookContext.getQueryPlan();
  String queryID=StringEscapeUtils.escapeJava(plan.getQueryId());
  int numLocalModeTask=0;
  int numMapRedTask=0;
  int numTask=0;
  List<TaskRunner> list=hookContext.getCompleteTaskList();
  numTask=list.size();
  for (  TaskRunner tskRunner : list) {
    Task tsk=tskRunner.getTask();
    if (tsk.isMapRedTask()) {
      if (tsk.isLocalMode()) {
        numLocalModeTask++;
      }
      numMapRedTask++;
    }
  }
  if (numLocalModeTask == 0) {
    return;
  }
  ArrayList<Object> sqlParams=new ArrayList<Object>();
  sqlParams.add(StringEscapeUtils.escapeJava(command));
  sqlParams.add(StringEscapeUtils.escapeJava(queryID));
  sqlParams.add(new Integer(numTask));
  sqlParams.add(new Integer(numMapRedTask));
  sqlParams.add(new Integer(numLocalModeTask));
  String sql="insert into audit_local set " + " command = ?, query_id = ?, num_tasks = ?, num_mapred_tasks = ?," + " num_local_mapred_tasks = ?";
  HookUtils.runInsert(conf,urlFactory,sql,sqlParams,HookUtils.getSqlNumRetry(conf));
}
