{
  try {
    List<HCatFieldSchema> partKeys=new ArrayList<HCatFieldSchema>();
    partKeys.add(HCatSchemaUtils.getHCatFieldSchema(new FieldSchema("emp_country",Constants.STRING_TYPE_NAME,"")));
    partKeys.add(HCatSchemaUtils.getHCatFieldSchema(new FieldSchema("emp_state",Constants.STRING_TYPE_NAME,"")));
    HCatSchema partitionSchema=new HCatSchema(partKeys);
    List<String> partitionVals=new ArrayList<String>();
    partitionVals.add("IN");
    partitionVals.add("TN");
    HCatEximOutputFormat.setOutput(job,dbName,tblName,outputLocation.toString(),partitionSchema,partitionVals,schema);
    job.waitForCompletion(true);
    HCatEximOutputCommitter committer=new HCatEximOutputCommitter(job,null);
    committer.cleanupJob(job);
    Path metadataPath=new Path(outputLocation,"_metadata");
    Map.Entry<Table,List<Partition>> rv=EximUtil.readMetaData(fs,metadataPath);
    Table table=rv.getKey();
    List<Partition> partitions=rv.getValue();
    assertEquals(dbName,table.getDbName());
    assertEquals(tblName,table.getTableName());
    assertTrue(EximUtil.schemaCompare(table.getSd().getCols(),HCatUtil.getFieldSchemaList(columns)));
    assertEquals("org.apache.hcatalog.rcfile.RCFileInputDriver",table.getParameters().get(HCatConstants.HCAT_ISD_CLASS));
    assertEquals("org.apache.hcatalog.rcfile.RCFileOutputDriver",table.getParameters().get(HCatConstants.HCAT_OSD_CLASS));
    assertEquals("org.apache.hadoop.hive.ql.io.RCFileInputFormat",table.getSd().getInputFormat());
    assertEquals("org.apache.hadoop.hive.ql.io.RCFileOutputFormat",table.getSd().getOutputFormat());
    assertEquals("org.apache.hadoop.hive.serde2.columnar.ColumnarSerDe",table.getSd().getSerdeInfo().getSerializationLib());
    assertEquals(2,table.getPartitionKeys().size());
    List<FieldSchema> partSchema=table.getPartitionKeys();
    assertEquals("emp_country",partSchema.get(0).getName());
    assertEquals("emp_state",partSchema.get(1).getName());
    assertEquals(1,partitions.size());
    Partition partition=partitions.get(0);
    assertEquals("IN",partition.getValues().get(0));
    assertEquals("TN",partition.getValues().get(1));
    assertEquals("org.apache.hcatalog.rcfile.RCFileInputDriver",partition.getParameters().get(HCatConstants.HCAT_ISD_CLASS));
    assertEquals("org.apache.hcatalog.rcfile.RCFileOutputDriver",partition.getParameters().get(HCatConstants.HCAT_OSD_CLASS));
  }
 catch (  Exception e) {
    System.out.println("Test failed with " + e.getMessage());
    e.printStackTrace();
    throw e;
  }
}
