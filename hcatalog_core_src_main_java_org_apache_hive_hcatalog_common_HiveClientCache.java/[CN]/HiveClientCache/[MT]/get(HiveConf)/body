{
  final HiveClientCacheKey cacheKey=HiveClientCacheKey.fromHiveConf(hiveConf,getThreadId());
  ICacheableMetaStoreClient cacheableHiveMetaStoreClient=null;
synchronized (CACHE_TEARDOWN_LOCK) {
    cacheableHiveMetaStoreClient=getOrCreate(cacheKey);
    cacheableHiveMetaStoreClient.acquire();
  }
  if (!cacheableHiveMetaStoreClient.isOpen()) {
synchronized (CACHE_TEARDOWN_LOCK) {
      hiveCache.invalidate(cacheKey);
      cacheableHiveMetaStoreClient.close();
      cacheableHiveMetaStoreClient=getOrCreate(cacheKey);
      cacheableHiveMetaStoreClient.acquire();
    }
  }
  return cacheableHiveMetaStoreClient;
}
