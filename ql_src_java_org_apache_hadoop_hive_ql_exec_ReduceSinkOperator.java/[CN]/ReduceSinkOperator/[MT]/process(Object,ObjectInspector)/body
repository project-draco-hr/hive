{
  try {
    if (cachedKeys == null) {
      cachedKeys=new Object[keyEval.length];
    }
    for (int i=0; i < keyEval.length; i++) {
      ExprNodeEvaluator e=keyEval[i];
      e.evaluate(row,rowInspector,tempInspectableObject);
      cachedKeys[i]=tempInspectableObject.o;
      if (keyObjectInspector == null) {
        keyFieldsObjectInspectors.add(tempInspectableObject.oi);
      }
    }
    if (keyObjectInspector == null) {
      keyObjectInspector=ObjectInspectorFactory.getStandardStructObjectInspector(ObjectInspectorUtils.getIntegerArray(keyFieldsObjectInspectors.size()),keyFieldsObjectInspectors);
    }
    if (keyIsText) {
      Text key=(Text)keySerializer.serialize(cachedKeys,keyObjectInspector);
      if (tag == -1) {
        keyWritable.set(key.getBytes(),0,key.getLength());
      }
 else {
        int keyLength=key.getLength();
        keyWritable.setSize(keyLength + 1);
        System.arraycopy(key.getBytes(),0,keyWritable.get(),0,keyLength);
        keyWritable.get()[keyLength]=tagByte[0];
      }
    }
 else {
      BytesWritable key=(BytesWritable)keySerializer.serialize(cachedKeys,keyObjectInspector);
      if (tag == -1) {
        keyWritable.set(key.get(),0,key.getSize());
      }
 else {
        int keyLength=key.getSize();
        keyWritable.setSize(keyLength + 1);
        System.arraycopy(key.get(),0,keyWritable.get(),0,keyLength);
        keyWritable.get()[keyLength]=tagByte[0];
      }
    }
    int keyHashCode=0;
    if (partitionEval.length == 0) {
      if (random == null) {
        random=new Random(12345);
      }
      keyHashCode=random.nextInt();
    }
 else {
      for (      ExprNodeEvaluator e : partitionEval) {
        e.evaluate(row,rowInspector,tempInspectableObject);
        keyHashCode=keyHashCode * 31 + (tempInspectableObject.o == null ? 0 : tempInspectableObject.o.hashCode());
      }
    }
    keyWritable.setHashCode(keyHashCode);
    if (cachedValues == null) {
      cachedValues=new Object[valueEval.length];
    }
    for (int i=0; i < valueEval.length; i++) {
      ExprNodeEvaluator e=valueEval[i];
      e.evaluate(row,rowInspector,tempInspectableObject);
      cachedValues[i]=tempInspectableObject.o;
      if (valueObjectInspector == null) {
        valueFieldsObjectInspectors.add(tempInspectableObject.oi);
      }
    }
    if (valueObjectInspector == null) {
      valueObjectInspector=ObjectInspectorFactory.getStandardStructObjectInspector(ObjectInspectorUtils.getIntegerArray(valueFieldsObjectInspectors.size()),valueFieldsObjectInspectors);
    }
    value=valueSerializer.serialize(cachedValues,valueObjectInspector);
  }
 catch (  SerDeException e) {
    throw new HiveException(e);
  }
  try {
    if (out != null)     out.collect(keyWritable,value);
  }
 catch (  IOException e) {
    throw new HiveException(e);
  }
}
