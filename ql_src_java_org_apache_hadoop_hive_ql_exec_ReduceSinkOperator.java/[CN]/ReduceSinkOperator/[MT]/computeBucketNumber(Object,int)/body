{
  int buckNum=0;
  if (conf.getWriteType() == AcidUtils.Operation.UPDATE || conf.getWriteType() == AcidUtils.Operation.DELETE) {
    Object recIdValue=acidRowInspector.getStructFieldData(row,recIdField);
    buckNum=bucketInspector.get(recIdInspector.getStructFieldData(recIdValue,bucketField));
    LOG.debug("Acid choosing bucket number " + buckNum);
  }
 else {
    for (int i=0; i < bucketEval.length; i++) {
      Object o=bucketEval[i].evaluate(row);
      buckNum=buckNum * 31 + ObjectInspectorUtils.hashCode(o,bucketObjectInspectors[i]);
    }
  }
  if (buckNum < 0) {
    buckNum=-1 * buckNum;
  }
  return buckNum % numBuckets;
}
