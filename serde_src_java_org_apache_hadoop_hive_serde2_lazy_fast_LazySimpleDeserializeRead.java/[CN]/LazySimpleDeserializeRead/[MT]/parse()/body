{
  int structByteEnd=end;
  int fieldId=0;
  int fieldByteBegin=start;
  int fieldByteEnd=start;
  while (fieldByteEnd <= structByteEnd) {
    if (fieldByteEnd == structByteEnd || bytes[fieldByteEnd] == separator) {
      if (lastColumnTakesRest && fieldId == fieldCount - 1) {
        fieldByteEnd=structByteEnd;
      }
      startPosition[fieldId]=fieldByteBegin;
      fieldId++;
      if (fieldId == fieldCount || fieldByteEnd == structByteEnd) {
        for (int i=fieldId; i <= fieldCount; i++) {
          startPosition[i]=fieldByteEnd + 1;
        }
        break;
      }
      fieldByteBegin=fieldByteEnd + 1;
      fieldByteEnd++;
    }
 else {
      if (isEscaped && bytes[fieldByteEnd] == escapeChar && fieldByteEnd + 1 < structByteEnd) {
        fieldByteEnd+=2;
      }
 else {
        fieldByteEnd++;
      }
    }
  }
  if (!extraFieldWarned && fieldByteEnd < structByteEnd) {
    doExtraFieldWarned();
  }
  if (!missingFieldWarned && fieldId < fieldCount) {
    doMissingFieldWarned(fieldId);
  }
}
