{
  isConnected=false;
  for (int attempt=0; !isConnected && attempt < retries; ++attempt) {
    if (attempt > 0 && retryDelaySeconds > 0) {
      try {
        LOG.info("Waiting " + retryDelaySeconds + " seconds before next connection attempt.");
        Thread.sleep(retryDelaySeconds * 1000);
      }
 catch (      InterruptedException ignore) {
      }
    }
    transport=new TSocket(store.getHost(),store.getPort());
    ((TSocket)transport).setTimeout(1000 * conf.getIntVar(ConfVars.METASTORE_CLIENT_SOCKET_TIMEOUT));
    boolean useSasl=conf.getBoolVar(HiveConf.ConfVars.METASTORE_USE_THRIFT_SASL);
    if (useSasl) {
      try {
        HadoopThriftAuthBridge.Client authBridge=ShimLoader.getHadoopThriftAuthBridge().createClient();
        String principalConfig=conf.getVar(HiveConf.ConfVars.METASTORE_KERBEROS_PRINCIPAL);
        transport=authBridge.createClientTransport(principalConfig,store.getHost(),"KERBEROS",transport);
      }
 catch (      IOException ioe) {
        LOG.error("Couldn't create client transport",ioe);
        throw new MetaException(ioe.toString());
      }
    }
    TProtocol protocol=new TBinaryProtocol(transport);
    client=new ThriftHiveMetastore.Client(protocol);
    try {
      transport.open();
      isConnected=true;
    }
 catch (    TTransportException e) {
      if (LOG.isDebugEnabled()) {
        LOG.warn("Failed to connect to the MetaStore Server...",e);
      }
 else {
        LOG.warn("Failed to connect to the MetaStore Server...");
      }
    }
  }
  if (!isConnected) {
    throw new MetaException("Could not connect to the MetaStore server!");
  }
}
