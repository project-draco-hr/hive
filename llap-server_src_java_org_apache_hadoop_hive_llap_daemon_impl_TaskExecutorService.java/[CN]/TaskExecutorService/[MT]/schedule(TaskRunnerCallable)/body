{
  TaskWrapper taskWrapper=new TaskWrapper(task);
  knownTasks.add(taskWrapper);
  TaskWrapper evictedTask;
  try {
    evictedTask=waitQueue.offer(taskWrapper);
  }
 catch (  RejectedExecutionException e) {
    knownTasks.remove(taskWrapper);
    throw e;
  }
  if (evictedTask == null) {
    if (isInfoEnabled) {
      LOG.info(task.getRequestId() + " added to wait queue.");
    }
    if (isDebugEnabled) {
      LOG.debug("Wait Queue: {}",waitQueue);
    }
  }
 else {
    evictedTask.maybeUnregisterForFinishedStateNotifications();
    evictedTask.getTaskRunnerCallable().killTask();
    if (isInfoEnabled) {
      LOG.info("{} evicted from wait queue in favor of {} because of lower priority",evictedTask.getRequestId(),task.getRequestId());
    }
  }
synchronized (lock) {
    lock.notify();
  }
}
