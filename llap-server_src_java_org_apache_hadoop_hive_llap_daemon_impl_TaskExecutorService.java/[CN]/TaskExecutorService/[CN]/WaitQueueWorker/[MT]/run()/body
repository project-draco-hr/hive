{
  try {
synchronized (waitLock) {
      while (waitQueue.isEmpty()) {
        waitLock.wait();
      }
    }
    while ((task=waitQueue.peek()) != null) {
synchronized (waitLock) {
        boolean shouldWait=false;
        if (task.canFinish()) {
          if (numSlotsAvailable.get() == 0 && preemptionQueue.isEmpty()) {
            shouldWait=true;
          }
        }
 else {
          if (numSlotsAvailable.get() == 0) {
            shouldWait=true;
          }
        }
        if (shouldWait) {
          waitLock.wait();
          continue;
        }
      }
      boolean scheduled=trySchedule(task);
      if (scheduled) {
        waitQueue.remove(task);
      }
synchronized (waitLock) {
        while (waitQueue.isEmpty()) {
          waitLock.wait();
        }
      }
    }
  }
 catch (  InterruptedException e) {
    LOG.info(WAIT_QUEUE_SCHEDULER_THREAD_NAME_FORMAT + " thread has been interrupted.");
  }
}
