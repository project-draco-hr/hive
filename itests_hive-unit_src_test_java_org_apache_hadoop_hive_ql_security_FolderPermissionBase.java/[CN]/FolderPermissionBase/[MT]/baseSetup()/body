{
  MiniDFSShim dfs=ShimLoader.getHadoopShims().getMiniDfs(conf,4,true,null);
  fs=dfs.getFileSystem();
  baseDfsDir=new Path(new Path(fs.getUri()),"/base");
  fs.mkdirs(baseDfsDir);
  warehouseDir=new Path(baseDfsDir,"warehouse");
  fs.mkdirs(warehouseDir);
  conf.setVar(ConfVars.METASTOREWAREHOUSE,warehouseDir.toString());
  dataFileDir=conf.get("test.data.files").replace('\\','/').replace("c:","");
  dataFilePath=new Path(dataFileDir,"kv1.txt");
  conf.setBoolVar(HiveConf.ConfVars.HIVE_SUPPORT_CONCURRENCY,false);
  conf.setBoolVar(HiveConf.ConfVars.HIVE_WAREHOUSE_SUBDIR_INHERIT_PERMS,true);
  conf.setVar(HiveConf.ConfVars.DYNAMICPARTITIONINGMODE,"nonstrict");
  int port=MetaStoreUtils.findFreePort();
  MetaStoreUtils.startMetaStore(port,ShimLoader.getHadoopThriftAuthBridge());
  SessionState.start(new CliSessionState(conf));
  driver=new Driver(conf);
  setupDataTable();
}
