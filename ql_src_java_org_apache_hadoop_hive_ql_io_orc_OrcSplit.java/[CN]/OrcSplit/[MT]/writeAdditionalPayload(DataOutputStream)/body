{
  boolean isFileIdLong=fileKey instanceof Long, isFileIdWritable=fileKey instanceof Writable;
  int flags=(hasBase ? BASE_FLAG : 0) | (isOriginal ? ORIGINAL_FLAG : 0) | (hasFooter ? FOOTER_FLAG : 0)| (isFileIdLong ? HAS_LONG_FILEID_FLAG : 0)| (isFileIdWritable ? HAS_SYNTHETIC_FILEID_FLAG : 0);
  out.writeByte(flags);
  out.writeInt(deltas.size());
  for (  AcidInputFormat.DeltaMetaData delta : deltas) {
    delta.write(out);
  }
  if (hasFooter) {
    OrcProto.FileTail fileTail=orcTail.getMinimalFileTail();
    byte[] tailBuffer=fileTail.toByteArray();
    int tailLen=tailBuffer.length;
    WritableUtils.writeVInt(out,tailLen);
    out.write(tailBuffer);
  }
  if (isFileIdLong) {
    out.writeLong(((Long)fileKey).longValue());
  }
 else   if (isFileIdWritable) {
    ((Writable)fileKey).write(out);
  }
  out.writeLong(fileLen);
}
