{
  if (isMetastoreRemote) {
    int metaStorePort=MetaStoreUtils.findFreePort();
    getHiveConf().setVar(ConfVars.METASTOREURIS,"thrift://localhost:" + metaStorePort);
    MetaStoreUtils.startMetaStore(metaStorePort,ShimLoader.getHadoopThriftAuthBridge(),getHiveConf());
  }
  hiveServer2=new HiveServer2();
  for (  Map.Entry<String,String> entry : confOverlay.entrySet()) {
    setConfProperty(entry.getKey(),entry.getValue());
  }
  hiveServer2.init(getHiveConf());
  hiveServer2.start();
  waitForStartup();
  setStarted(true);
}
