{
  CompactionRequest rqst=new CompactionRequest("foo","bar",CompactionType.MINOR);
  rqst.setPartitionname("ds=today");
  txnHandler.compact(rqst);
  long now=System.currentTimeMillis();
  CompactionInfo ci=txnHandler.findNextToCompact("fred");
  assertNotNull(ci);
  assertEquals("foo",ci.dbname);
  assertEquals("bar",ci.tableName);
  assertEquals("ds=today",ci.partName);
  assertEquals(CompactionType.MINOR,ci.type);
  assertNull(ci.runAs);
  assertNull(txnHandler.findNextToCompact("fred"));
  txnHandler.setRunAs(ci.id,"bob");
  ShowCompactResponse rsp=txnHandler.showCompact(new ShowCompactRequest());
  List<ShowCompactResponseElement> compacts=rsp.getCompacts();
  assertEquals(1,compacts.size());
  ShowCompactResponseElement c=compacts.get(0);
  assertEquals("foo",c.getDbname());
  assertEquals("bar",c.getTablename());
  assertEquals("ds=today",c.getPartitionname());
  assertEquals(CompactionType.MINOR,c.getType());
  assertEquals("working",c.getState());
  assertTrue(c.getStart() - 5000 < now && c.getStart() + 5000 > now);
  assertEquals("fred",c.getWorkerid());
  assertEquals("bob",c.getRunAs());
}
