{
  try {
    if (!HttpServer.isInstrumentationAccessAllowed(getServletContext(),request,response)) {
      return;
    }
    PrintWriter writer=null;
    String clusterName=HiveConf.getVar(getConfFromContext(),HiveConf.ConfVars.LLAP_DAEMON_SERVICE_HOSTS);
    try {
      response.setContentType("application/json; charset=utf8");
      response.setHeader(ACCESS_CONTROL_ALLOW_METHODS,"GET");
      response.setHeader(ACCESS_CONTROL_ALLOW_ORIGIN,"*");
      response.setHeader("Cache-Control","no-transform,public,max-age=60,s-maxage=60");
      writer=response.getWriter();
      if (clusterName != null) {
        clusterName=clusterName.trim();
      }
      if (clusterName == null || clusterName.isEmpty()) {
        writer.print("{\"LLAP\": \"No llap daemons configured. ");
        writer.print("Check hive.llap.daemon.service.hosts.\"}");
        return;
      }
      if (clusterName.startsWith("@")) {
        clusterName=clusterName.substring(1);
      }
      LOG.info("Retrieving info for cluster: " + clusterName);
      LlapStatusServiceDriver driver=new LlapStatusServiceDriver();
      int ret=driver.run(new LlapStatusOptionsProcessor.LlapStatusOptions(clusterName));
      if (ret == LlapStatusServiceDriver.ExitCode.SUCCESS.getInt()) {
        driver.outputJson(writer);
      }
    }
  finally {
      if (writer != null) {
        writer.close();
      }
    }
  }
 catch (  Exception e) {
    LOG.error("Caught exception while processing llap status request",e);
    response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
  }
}
