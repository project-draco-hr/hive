{
  SessionState ss=SessionState.get();
  if ((current_cluster == null) || (ss == null)) {
    return;
  }
  HiveOperation commandType=ss.getHiveOperation();
  if (!((commandType == HiveOperation.ALTERTABLE_ADDCOLS) || (commandType == HiveOperation.ALTERTABLE_REPLACECOLS) || (commandType == HiveOperation.ALTERTABLE_RENAMECOL)|| (commandType == HiveOperation.ALTERTABLE_RENAMEPART)|| (commandType == HiveOperation.ALTERTABLE_RENAME)|| (commandType == HiveOperation.ALTERTABLE_PROPERTIES)|| (commandType == HiveOperation.ALTERTABLE_SERIALIZER)|| (commandType == HiveOperation.ALTERTABLE_SERDEPROPERTIES)|| (commandType == HiveOperation.ALTERTABLE_CLUSTER_SORT)|| (commandType == HiveOperation.ALTERTABLE_FILEFORMAT))) {
    return;
  }
  if (commandType == HiveOperation.ALTERTABLE_PROPERTIES) {
    Map<String,String> newProps=((DDLWork)(hookContext.getQueryPlan().getRootTasks().get(0).getWork())).getAlterTblDesc().getProps();
    if (newProps.containsKey(HookUtils.TABLE_CREATION_CLUSTER) && (newProps.get(HookUtils.TABLE_CREATION_CLUSTER).equals(current_cluster))) {
      return;
    }
  }
  Set<WriteEntity> outputs=hookContext.getOutputs();
  for (  WriteEntity output : outputs) {
    Table table=output.getT();
    if (table != null) {
      String tableCreationCluster=table.getProperty(HookUtils.TABLE_CREATION_CLUSTER);
      if (tableCreationCluster != null && !tableCreationCluster.isEmpty() && !tableCreationCluster.equals(current_cluster)) {
        String exception="Table " + table.getTableName() + " cannot be modified.";
        exception+=" Table's cluster is " + tableCreationCluster + ",";
        exception+="whereas current package is " + current_cluster;
        throw new Exception(exception);
      }
    }
  }
}
