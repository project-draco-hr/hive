{
  MockRequest r1=createMockRequest(1,1,100,false,20000l);
  TaskExecutorServiceForTest taskExecutorService=new TaskExecutorServiceForTest(1,2,ShortestJobFirstComparator.class.getName(),true);
  taskExecutorService.init(new Configuration());
  taskExecutorService.start();
  try {
    Scheduler.SubmissionState submissionState=taskExecutorService.schedule(r1);
    assertEquals(Scheduler.SubmissionState.ACCEPTED,submissionState);
    awaitStartAndSchedulerRun(r1,taskExecutorService);
    TaskWrapper taskWrapper=taskExecutorService.preemptionQueue.peek();
    assertNotNull(taskWrapper);
    assertTrue(taskWrapper.isInPreemptionQueue());
    taskWrapper.finishableStateUpdated(true);
    TaskWrapper taskWrapper2=taskExecutorService.preemptionQueue.peek();
    assertNull(taskWrapper2);
    assertFalse(taskWrapper.isInPreemptionQueue());
    r1.complete();
    r1.awaitEnd();
  }
  finally {
    taskExecutorService.shutDown(false);
  }
}
