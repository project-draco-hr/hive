{
  MockRequest r1=new MockRequest(createRequest(1,2),false,100000);
  MockRequest r2=new MockRequest(createRequest(2,4),false,100000);
  MockRequest r3=new MockRequest(createRequest(3,6),false,1000000);
  MockRequest r4=new MockRequest(createRequest(4,8),false,1000000);
  MockRequest r5=new MockRequest(createRequest(5,10),false,1000000);
  BlockingQueue queue=new BoundedPriorityBlockingQueue(new TaskExecutorService.WaitQueueComparator(),4);
  queue.offer(r1);
  assertEquals(r1,queue.peek());
  queue.offer(r2);
  assertEquals(r1,queue.peek());
  queue.offer(r3);
  assertEquals(r1,queue.peek());
  queue.offer(r4);
  assertEquals(r1,queue.peek());
  assertEquals(false,queue.offer(r5));
  assertEquals(r1,queue.take());
  assertEquals(r2,queue.take());
  assertEquals(r3,queue.take());
  assertEquals(r4,queue.take());
  r1=new MockRequest(createRequest(1,2),true,100000);
  r2=new MockRequest(createRequest(2,4),true,100000);
  r3=new MockRequest(createRequest(3,6),true,1000000);
  r4=new MockRequest(createRequest(4,8),true,1000000);
  r5=new MockRequest(createRequest(5,10),true,1000000);
  queue=new BoundedPriorityBlockingQueue(new TaskExecutorService.WaitQueueComparator(),4);
  queue.offer(r1);
  assertEquals(r1,queue.peek());
  queue.offer(r2);
  assertEquals(r1,queue.peek());
  queue.offer(r3);
  assertEquals(r1,queue.peek());
  queue.offer(r4);
  assertEquals(r1,queue.peek());
  assertEquals(false,queue.offer(r5));
  assertEquals(r1,queue.take());
  assertEquals(r2,queue.take());
  assertEquals(r3,queue.take());
  assertEquals(r4,queue.take());
  r1=new MockRequest(createRequest(1,1),true,100000);
  r2=new MockRequest(createRequest(2,1),false,100000);
  r3=new MockRequest(createRequest(3,1),true,1000000);
  r4=new MockRequest(createRequest(4,1),false,1000000);
  r5=new MockRequest(createRequest(5,10),true,1000000);
  queue=new BoundedPriorityBlockingQueue(new TaskExecutorService.WaitQueueComparator(),4);
  queue.offer(r1);
  assertEquals(r1,queue.peek());
  queue.offer(r2);
  assertEquals(r1,queue.peek());
  queue.offer(r3);
  assertEquals(r1,queue.peek());
  queue.offer(r4);
  assertEquals(r1,queue.peek());
  assertEquals(false,queue.offer(r5));
  assertEquals(r1,queue.take());
  assertEquals(r3,queue.take());
  assertEquals(r4,queue.take());
  assertEquals(r2,queue.take());
  r1=new MockRequest(createRequest(1,2),true,100000);
  r2=new MockRequest(createRequest(2,4),false,100000);
  r3=new MockRequest(createRequest(3,6),true,1000000);
  r4=new MockRequest(createRequest(4,8),false,1000000);
  r5=new MockRequest(createRequest(5,10),true,1000000);
  queue=new BoundedPriorityBlockingQueue(new TaskExecutorService.WaitQueueComparator(),4);
  queue.offer(r1);
  assertEquals(r1,queue.peek());
  queue.offer(r2);
  assertEquals(r1,queue.peek());
  queue.offer(r3);
  assertEquals(r1,queue.peek());
  queue.offer(r4);
  assertEquals(r1,queue.peek());
  assertEquals(false,queue.offer(r5));
  assertEquals(r1,queue.take());
  assertEquals(r3,queue.take());
  assertEquals(r2,queue.take());
  assertEquals(r4,queue.take());
  r1=new MockRequest(createRequest(1,2),true,100000);
  r2=new MockRequest(createRequest(2,4),false,100000);
  r3=new MockRequest(createRequest(3,6),false,1000000);
  r4=new MockRequest(createRequest(4,8),false,1000000);
  r5=new MockRequest(createRequest(5,10),true,1000000);
  queue=new BoundedPriorityBlockingQueue(new TaskExecutorService.WaitQueueComparator(),4);
  queue.offer(r1);
  assertEquals(r1,queue.peek());
  queue.offer(r2);
  assertEquals(r1,queue.peek());
  queue.offer(r3);
  assertEquals(r1,queue.peek());
  queue.offer(r4);
  assertEquals(r1,queue.peek());
  assertEquals(false,queue.offer(r5));
  assertEquals(r1,queue.take());
  assertEquals(r2,queue.take());
  assertEquals(r3,queue.take());
  assertEquals(r4,queue.take());
  r1=new MockRequest(createRequest(1,2),false,100000);
  r2=new MockRequest(createRequest(2,4),true,100000);
  r3=new MockRequest(createRequest(3,6),true,1000000);
  r4=new MockRequest(createRequest(4,8),true,1000000);
  r5=new MockRequest(createRequest(5,10),true,1000000);
  queue=new BoundedPriorityBlockingQueue(new TaskExecutorService.WaitQueueComparator(),4);
  queue.offer(r1);
  assertEquals(r1,queue.peek());
  queue.offer(r2);
  assertEquals(r2,queue.peek());
  queue.offer(r3);
  assertEquals(r2,queue.peek());
  queue.offer(r4);
  assertEquals(r2,queue.peek());
  assertEquals(false,queue.offer(r5));
  assertEquals(r2,queue.take());
  assertEquals(r3,queue.take());
  assertEquals(r4,queue.take());
  assertEquals(r1,queue.take());
}
