{
  MockRequest r1=createMockRequest(1,1,100,true,20000l);
  TaskExecutorServiceForTest taskExecutorService=new TaskExecutorServiceForTest(1,2,ShortestJobFirstComparator.class.getName(),true);
  taskExecutorService.init(new Configuration());
  taskExecutorService.start();
  try {
    Scheduler.SubmissionState submissionState=taskExecutorService.schedule(r1);
    assertEquals(Scheduler.SubmissionState.ACCEPTED,submissionState);
    awaitStartAndSchedulerRun(r1,taskExecutorService);
    TaskWrapper taskWrapper=taskExecutorService.preemptionQueue.peek();
    assertNull(taskWrapper);
    assertEquals(1,taskExecutorService.knownTasks.size());
    taskWrapper=taskExecutorService.knownTasks.entrySet().iterator().next().getValue();
    assertFalse(taskWrapper.isInPreemptionQueue());
    taskWrapper.finishableStateUpdated(false);
    TaskWrapper taskWrapper2=taskExecutorService.preemptionQueue.peek();
    assertNotNull(taskWrapper2);
    assertTrue(taskWrapper2.isInPreemptionQueue());
    assertEquals(taskWrapper,taskWrapper2);
    r1.complete();
    r1.awaitEnd();
  }
  finally {
    taskExecutorService.shutDown(false);
  }
}
