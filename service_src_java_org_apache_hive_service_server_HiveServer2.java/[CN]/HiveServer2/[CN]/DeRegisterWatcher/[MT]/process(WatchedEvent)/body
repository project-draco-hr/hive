{
  if (event.getType().equals(Watcher.Event.EventType.NodeDeleted)) {
    if (znode != null) {
      try {
        znode.close();
        LOG.warn("This HiveServer2 instance is now de-registered from ZooKeeper. " + "The server will be shut down after the last client sesssion completes.");
      }
 catch (      IOException e) {
        LOG.error("Failed to close the persistent ephemeral znode",e);
      }
 finally {
        HiveServer2.this.setDeregisteredWithZooKeeper(true);
        if (cliService.getSessionManager().getOpenSessionCount() == 0) {
          LOG.warn("This instance of HiveServer2 has been removed from the list of server " + "instances available for dynamic service discovery. " + "The last client session has ended - will shutdown now.");
          HiveServer2.this.stop();
        }
      }
    }
  }
}
