{
  if (ShimLoader.getHadoopShims().isSecurityEnabled()) {
    String principal=ShimLoader.getHadoopShims().getResolvedPrincipal(hiveConf.getVar(ConfVars.HIVE_SERVER2_KERBEROS_PRINCIPAL));
    String keyTabFile=hiveConf.getVar(ConfVars.HIVE_SERVER2_KERBEROS_KEYTAB);
    if (principal.isEmpty()) {
      throw new IOException("HiveServer2 Kerberos principal is empty");
    }
    if (keyTabFile.isEmpty()) {
      throw new IOException("HiveServer2 Kerberos keytab is empty");
    }
    System.setProperty(ZooKeeperSaslClient.LOGIN_CONTEXT_NAME_KEY,ZooKeeperHiveHelper.SASL_LOGIN_CONTEXT_NAME);
    ZooKeeperHiveHelper.setUpJaasConfiguration(principal,keyTabFile);
    nodeAcls.addAll(Ids.READ_ACL_UNSAFE);
    nodeAcls.add(new ACL(Perms.ALL,Ids.AUTH_IDS));
  }
 else {
    nodeAcls.addAll(Ids.OPEN_ACL_UNSAFE);
  }
}
