{
  boolean success=false;
  boolean inheritPerms=HiveConf.getBoolVar(conf,HiveConf.ConfVars.HIVE_WAREHOUSE_SUBDIR_INHERIT_PERMS);
  String group=null;
  String permission=null;
  try {
    if (inheritPerms || replace) {
      try {
        FileStatus deststatus=fs.getFileStatus(destf);
        if (inheritPerms) {
          group=deststatus.getGroup();
          permission=Integer.toString(deststatus.getPermission().toShort(),8);
        }
        if (replace && deststatus.isDir()) {
          fs.delete(destf,true);
        }
      }
 catch (      FileNotFoundException ignore) {
        if (inheritPerms) {
          FileStatus deststatus=fs.getFileStatus(destf.getParent());
          group=deststatus.getGroup();
          permission=Integer.toString(deststatus.getPermission().toShort(),8);
        }
      }
    }
    if (!isSrcLocal) {
      success=fs.rename(srcf,destf);
    }
 else {
      fs.copyFromLocalFile(srcf,destf);
      success=true;
    }
    LOG.info((replace ? "Replacing src:" : "Renaming src:") + srcf.toString() + ";dest: "+ destf.toString()+ ";Status:"+ success);
  }
 catch (  IOException ioe) {
    throw new HiveException("Unable to move source " + srcf + " to destination "+ destf,ioe);
  }
  if (success && inheritPerms) {
    try {
      FsShell fshell=new FsShell();
      fshell.setConf(conf);
      fshell.run(new String[]{"-chgrp","-R",group,destf.toString()});
      fshell.run(new String[]{"-chmod","-R",permission,destf.toString()});
    }
 catch (    Exception e) {
      throw new HiveException("Unable to set permissions of " + destf,e);
    }
  }
  return success;
}
