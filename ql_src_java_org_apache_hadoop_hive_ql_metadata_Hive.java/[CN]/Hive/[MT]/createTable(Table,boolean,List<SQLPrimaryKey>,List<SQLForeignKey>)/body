{
  try {
    if (tbl.getDbName() == null || "".equals(tbl.getDbName().trim())) {
      tbl.setDbName(SessionState.get().getCurrentDatabase());
    }
    if (tbl.getCols().size() == 0 || tbl.getSd().getColsSize() == 0) {
      tbl.setFields(MetaStoreUtils.getFieldsFromDeserializer(tbl.getTableName(),tbl.getDeserializer()));
    }
    tbl.checkValidity(conf);
    if (tbl.getParameters() != null) {
      tbl.getParameters().remove(hive_metastoreConstants.DDL_TIME);
    }
    org.apache.hadoop.hive.metastore.api.Table tTbl=tbl.getTTable();
    PrincipalPrivilegeSet principalPrivs=new PrincipalPrivilegeSet();
    SessionState ss=SessionState.get();
    if (ss != null) {
      CreateTableAutomaticGrant grants=ss.getCreateTableGrants();
      if (grants != null) {
        principalPrivs.setUserPrivileges(grants.getUserGrants());
        principalPrivs.setGroupPrivileges(grants.getGroupGrants());
        principalPrivs.setRolePrivileges(grants.getRoleGrants());
        tTbl.setPrivileges(principalPrivs);
      }
    }
    if (primaryKeys == null && foreignKeys == null) {
      getMSC().createTable(tTbl);
    }
 else {
      getMSC().createTableWithConstraints(tTbl,primaryKeys,foreignKeys);
    }
  }
 catch (  AlreadyExistsException e) {
    if (!ifNotExists) {
      throw new HiveException(e);
    }
  }
catch (  Exception e) {
    throw new HiveException(e);
  }
}
