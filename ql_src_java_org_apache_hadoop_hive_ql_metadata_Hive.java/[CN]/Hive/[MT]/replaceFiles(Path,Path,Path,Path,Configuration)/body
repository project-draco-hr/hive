{
  FileSystem fs=null;
  FsShell fshell=new FsShell();
  fshell.setConf(conf);
  try {
    fs=FileSystem.get(srcf.toUri(),conf);
  }
 catch (  IOException e1) {
    throw new HiveException(e1.getMessage(),e1);
  }
  FileStatus[] srcs;
  try {
    srcs=fs.listStatus(srcf);
  }
 catch (  IOException e) {
    throw new HiveException("addFiles: filesystem error in check phase",e);
  }
  if (srcs == null) {
    LOG.info("No sources specified to move: " + srcf);
    return;
  }
  checkPaths(fs,srcs,destf,true);
  try {
    fs.mkdirs(tmppath);
    for (    FileStatus src : srcs) {
      FileStatus[] items=fs.listStatus(src.getPath());
      for (int j=0; j < items.length; j++) {
        if (!fs.rename(items[j].getPath(),new Path(tmppath,items[j].getPath().getName()))) {
          throw new HiveException("Error moving: " + items[j].getPath() + " into: "+ tmppath);
        }
      }
    }
    if (oldPath != null) {
      try {
        fshell.run(new String[]{"-rmr",oldPath.toUri().toString()});
      }
 catch (      Exception e) {
      }
    }
    try {
      fshell.run(new String[]{"-rmr",destf.toUri().toString()});
    }
 catch (    Exception e) {
    }
    if (!fs.mkdirs(destf.getParent())) {
      throw new HiveException("Unable to create destination directory: " + destf.getParent().toString());
    }
    boolean b=fs.rename(tmppath,destf);
    if (!b) {
      throw new HiveException("Unable to move results from " + tmppath + " to destination directory: "+ destf.getParent().toString());
    }
    LOG.debug("Renaming:" + tmppath.toString() + ",Status:"+ b);
  }
 catch (  IOException e) {
    throw new HiveException("replaceFiles: error while moving files from " + tmppath + " to "+ destf+ "!!!",e);
  }
}
