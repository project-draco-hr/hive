{
  try {
    Type type=hcatFS.getType();
switch (type) {
case BINARY:
      if (pigObj == null) {
        return null;
      }
    return ((DataByteArray)pigObj).get();
case STRUCT:
  if (pigObj == null) {
    return null;
  }
HCatSchema structSubSchema=hcatFS.getStructSubSchema();
List<Object> all=((Tuple)pigObj).getAll();
ArrayList<Object> converted=new ArrayList<Object>(all.size());
for (int i=0; i < all.size(); i++) {
converted.add(getJavaObj(all.get(i),structSubSchema.get(i)));
}
return converted;
case ARRAY:
if (pigObj == null) {
return null;
}
DataBag pigBag=(DataBag)pigObj;
HCatFieldSchema tupFS=hcatFS.getArrayElementSchema().get(0);
boolean needTuple=tupFS.getType() == Type.STRUCT;
List<Object> bagContents=new ArrayList<Object>((int)pigBag.size());
Iterator<Tuple> bagItr=pigBag.iterator();
while (bagItr.hasNext()) {
bagContents.add(getJavaObj(needTuple ? bagItr.next() : bagItr.next().get(0),tupFS));
}
return bagContents;
case MAP:
if (pigObj == null) {
return null;
}
Map<?,?> pigMap=(Map<?,?>)pigObj;
Map<Object,Object> typeMap=new HashMap<Object,Object>();
for (Entry<?,?> entry : pigMap.entrySet()) {
typeMap.put((String)entry.getKey(),getJavaObj(entry.getValue(),hcatFS.getMapValueSchema().get(0)));
}
return typeMap;
case STRING:
case INT:
case BIGINT:
case FLOAT:
case DOUBLE:
return pigObj;
case SMALLINT:
if (pigObj == null) {
return null;
}
if ((Integer)pigObj < Short.MIN_VALUE || (Integer)pigObj > Short.MAX_VALUE) {
throw new BackendException("Value " + pigObj + " is outside the bounds of column "+ hcatFS.getName()+ " with type "+ hcatFS.getType(),PigHCatUtil.PIG_EXCEPTION_CODE);
}
return ((Integer)pigObj).shortValue();
case TINYINT:
if (pigObj == null) {
return null;
}
if ((Integer)pigObj < Byte.MIN_VALUE || (Integer)pigObj > Byte.MAX_VALUE) {
throw new BackendException("Value " + pigObj + " is outside the bounds of column "+ hcatFS.getName()+ " with type "+ hcatFS.getType(),PigHCatUtil.PIG_EXCEPTION_CODE);
}
return ((Integer)pigObj).byteValue();
case BOOLEAN:
if (pigObj == null) {
LOG.debug("HCatBaseStorer.getJavaObj(BOOLEAN): obj null, bailing early");
return null;
}
if (pigObj instanceof String) {
if (((String)pigObj).trim().compareTo("0") == 0) {
return Boolean.FALSE;
}
if (((String)pigObj).trim().compareTo("1") == 0) {
return Boolean.TRUE;
}
throw new BackendException("Unexpected type " + type + " for value "+ pigObj+ (pigObj == null ? "" : " of class " + pigObj.getClass().getName()),PigHCatUtil.PIG_EXCEPTION_CODE);
}
return Boolean.parseBoolean(pigObj.toString());
default :
throw new BackendException("Unexpected type " + type + " for value "+ pigObj+ (pigObj == null ? "" : " of class " + pigObj.getClass().getName()),PigHCatUtil.PIG_EXCEPTION_CODE);
}
}
 catch (BackendException e) {
throw new BackendException((hcatFS.getName() == null ? " " : hcatFS.getName() + ".") + e.getMessage(),e.getCause() == null ? e : e.getCause());
}
}
