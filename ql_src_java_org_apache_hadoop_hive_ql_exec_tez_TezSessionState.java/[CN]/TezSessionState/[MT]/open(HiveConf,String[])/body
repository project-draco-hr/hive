{
  this.conf=conf;
  UserGroupInformation ugi;
  ugi=ShimLoader.getHadoopShims().getUGIForConf(conf);
  user=ShimLoader.getHadoopShims().getShortUserName(ugi);
  LOG.info("User of session id " + sessionId + " is "+ user);
  tezScratchDir=createTezDir(sessionId);
  String dir=tezScratchDir.toString();
  localizedResources=utils.localizeTempFilesFromConf(dir,conf);
  List<LocalResource> handlerLr=utils.localizeTempFiles(dir,conf,additionalFiles);
  if (handlerLr != null) {
    if (localizedResources == null) {
      localizedResources=handlerLr;
    }
 else {
      localizedResources.addAll(handlerLr);
    }
    additionalFilesNotFromConf=new HashSet<String>();
    for (    String originalFile : additionalFiles) {
      additionalFilesNotFromConf.add(originalFile);
    }
  }
  TezConfiguration tezConfig=new TezConfiguration(conf);
  tezConfig.set(TezConfiguration.TEZ_AM_STAGING_DIR,tezScratchDir.toUri().toString());
  appJarLr=createJarLocalResource(utils.getExecJarPathLocal());
  Map<String,LocalResource> commonLocalResources=new HashMap<String,LocalResource>();
  commonLocalResources.put(utils.getBaseName(appJarLr),appJarLr);
  if (localizedResources != null) {
    for (    LocalResource lr : localizedResources) {
      commonLocalResources.put(utils.getBaseName(lr),lr);
    }
  }
  Map<String,String> amEnv=new HashMap<String,String>();
  MRHelpers.updateEnvironmentForMRAM(conf,amEnv);
  AMConfiguration amConfig=new AMConfiguration(amEnv,commonLocalResources,tezConfig,null);
  TezSessionConfiguration sessionConfig=new TezSessionConfiguration(amConfig,tezConfig);
  session=new TezSession("HIVE-" + sessionId,sessionConfig);
  LOG.info("Opening new Tez Session (id: " + sessionId + ", scratch dir: "+ tezScratchDir+ ")");
  session.start();
  if (HiveConf.getBoolVar(conf,ConfVars.HIVE_PREWARM_ENABLED)) {
    int n=HiveConf.getIntVar(conf,ConfVars.HIVE_PREWARM_NUM_CONTAINERS);
    LOG.info("Prewarming " + n + " containers  (id: "+ sessionId+ ", scratch dir: "+ tezScratchDir+ ")");
    PreWarmContext context=utils.createPreWarmContext(sessionConfig,n,commonLocalResources);
    try {
      session.preWarm(context);
    }
 catch (    InterruptedException ie) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Hive Prewarm threw an exception ",ie);
      }
    }
  }
  conf.set("mapreduce.framework.name","yarn-tez");
  conf.set("mapreduce.tez.session.tokill-application-id",session.getApplicationId().toString());
  openSessions.add(this);
}
