{
  boolean useLocalTokenClient=isUsingLocalClient(conf);
  Token<LlapTokenIdentifier> token=null;
  if (useLocalTokenClient) {
    String clusterName=LlapUtil.generateClusterName(conf);
    final String clusterId=DaemonId.createClusterString(user,clusterName);
    try {
      token=localClientCache.get(clusterId,new Callable<LlapTokenLocalClient>(){
        @Override public LlapTokenLocalClient call() throws Exception {
          return new LlapTokenLocalClient(conf,clusterId);
        }
      }
).createToken(null,null);
    }
 catch (    ExecutionException e) {
      throw new IOException(e);
    }
  }
 else {
    token=new LlapTokenClientFactory(conf).createClient().getDelegationToken(null);
  }
  if (LOG.isInfoEnabled()) {
    LOG.info("Obtained a LLAP token: " + token);
  }
  return token;
}
