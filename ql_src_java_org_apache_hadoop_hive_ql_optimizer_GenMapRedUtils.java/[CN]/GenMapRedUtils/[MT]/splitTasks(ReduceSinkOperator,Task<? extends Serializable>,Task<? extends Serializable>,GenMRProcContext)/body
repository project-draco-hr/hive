{
  Task<? extends Serializable> currTask=task;
  mapredWork plan=(mapredWork)currTask.getWork();
  Operator<? extends Serializable> currTopOp=opProcCtx.getCurrTopOp();
  ParseContext parseCtx=opProcCtx.getParseCtx();
  oldTask.addDependentTask(currTask);
  String scratchDir=opProcCtx.getScratchDir();
  int randomid=opProcCtx.getRandomId();
  int pathid=opProcCtx.getPathId();
  String taskTmpDir=scratchDir + File.separator + randomid+ '.'+ pathid;
  pathid++;
  opProcCtx.setPathId(pathid);
  Operator<? extends Serializable> parent=op.getParentOperators().get(0);
  tableDesc tt_desc=PlanUtils.getBinaryTableDesc(PlanUtils.getFieldSchemasFromRowSchema(parent.getSchema(),"temporarycol"));
  Operator<? extends Serializable> fs_op=putOpInsertMap(OperatorFactory.get(new fileSinkDesc(taskTmpDir,tt_desc,parseCtx.getConf().getBoolVar(HiveConf.ConfVars.COMPRESSINTERMEDIATE)),parent.getSchema()),null,parseCtx);
  List<Operator<? extends Serializable>> childOpList=parent.getChildOperators();
  for (int pos=0; pos < childOpList.size(); pos++) {
    if (childOpList.get(pos) == op) {
      childOpList.set(pos,fs_op);
      break;
    }
  }
  List<Operator<? extends Serializable>> parentOpList=new ArrayList<Operator<? extends Serializable>>();
  parentOpList.add(parent);
  fs_op.setParentOperators(parentOpList);
  Operator<? extends Serializable> reducer=op.getChildOperators().get(0);
  String streamDesc;
  mapredWork cplan=(mapredWork)currTask.getWork();
  if (reducer.getClass() == JoinOperator.class) {
    String origStreamDesc;
    streamDesc="$INTNAME";
    origStreamDesc=streamDesc;
    int pos=0;
    while (cplan.getAliasToWork().get(streamDesc) != null)     streamDesc=origStreamDesc.concat(String.valueOf(++pos));
  }
 else   streamDesc=taskTmpDir;
  if (cplan.getPathToAliases().get(taskTmpDir) == null) {
    cplan.getPathToAliases().put(taskTmpDir,new ArrayList<String>());
  }
  cplan.getPathToAliases().get(taskTmpDir).add(streamDesc);
  cplan.getPathToPartitionInfo().put(taskTmpDir,new partitionDesc(tt_desc,null));
  cplan.getAliasToWork().put(streamDesc,op);
  setKeyAndValueDesc(cplan,op);
  if (reducer.getClass() == JoinOperator.class)   cplan.setNeedsTagging(true);
  currTopOp=null;
  String currAliasId=null;
  opProcCtx.setCurrTopOp(currTopOp);
  opProcCtx.setCurrAliasId(currAliasId);
  opProcCtx.setCurrTask(currTask);
}
