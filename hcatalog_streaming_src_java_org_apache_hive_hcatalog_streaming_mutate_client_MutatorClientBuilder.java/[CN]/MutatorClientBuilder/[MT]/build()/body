{
  String user=authenticatedUser == null ? System.getProperty("user.name") : authenticatedUser.getShortUserName();
  boolean secureMode=authenticatedUser == null ? false : authenticatedUser.hasKerberosCredentials();
  configuration=HiveConfFactory.newInstance(configuration,this.getClass(),metaStoreUri);
  IMetaStoreClient metaStoreClient;
  try {
    metaStoreClient=new UgiMetaStoreClientFactory(metaStoreUri,configuration,authenticatedUser,user,secureMode).newInstance(HCatUtil.getHiveMetastoreClient(configuration));
  }
 catch (  IOException e) {
    throw new ClientException("Could not create meta store client.",e);
  }
  return new MutatorClient(metaStoreClient,configuration,lockFailureListener,user,tables.values());
}
