{
  HiveServerHandler.LOG.info("Running the query: " + cmd);
  SessionState.get();
  String cmd_trimmed=cmd.trim();
  String[] tokens=cmd_trimmed.split("\\s");
  String cmd_1=cmd_trimmed.substring(tokens[0].length()).trim();
  int ret=0;
  String errorMessage="";
  String SQLState=null;
  try {
    CommandProcessor proc=CommandProcessorFactory.get(tokens[0]);
    CommandProcessorResponse response=null;
    if (proc != null) {
      if (proc instanceof Driver) {
        ((Driver)proc).destroy();
        isHiveQuery=true;
        response=driver.run(cmd);
      }
 else {
        isHiveQuery=false;
        response=proc.run(cmd_1);
      }
      ret=response.getResponseCode();
      SQLState=response.getSQLState();
      errorMessage=response.getErrorMessage();
    }
  }
 catch (  Exception e) {
    HiveServerException ex=new HiveServerException();
    ex.setMessage("Error running query: " + e.toString());
    throw ex;
  }
  if (ret != 0) {
    throw new HiveServerException("Query returned non-zero code: " + ret + ", cause: "+ errorMessage,ret,SQLState);
  }
}
