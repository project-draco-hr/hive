{
  HiveServerHandler.LOG.info("Running the query: " + cmd);
  SessionState ss=SessionState.get();
  String cmd_trimmed=cmd.trim();
  String[] tokens=cmd_trimmed.split("\\s");
  String cmd_1=cmd_trimmed.substring(tokens[0].length()).trim();
  int ret=0;
  String errorMessage="";
  String SQLState=null;
  try {
    CommandProcessor proc=CommandProcessorFactory.get(tokens[0]);
    if (proc != null) {
      if (proc instanceof Driver) {
        isHiveQuery=true;
        Driver.DriverResponse response=driver.runCommand(cmd);
        ret=response.getResponseCode();
        SQLState=response.getSQLState();
        errorMessage=response.getErrorMessage();
      }
 else {
        isHiveQuery=false;
        ret=proc.run(cmd_1);
      }
    }
  }
 catch (  Exception e) {
    HiveServerException ex=new HiveServerException();
    ex.setMessage("Error running query: " + e.toString());
    throw ex;
  }
  if (ret != 0) {
    throw new HiveServerException("Query returned non-zero code: " + ret + ", cause: "+ errorMessage,ret,SQLState);
  }
}
