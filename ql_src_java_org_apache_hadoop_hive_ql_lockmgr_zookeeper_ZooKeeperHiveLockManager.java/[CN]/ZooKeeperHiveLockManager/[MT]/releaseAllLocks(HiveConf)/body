{
  ZooKeeper zkpClient=null;
  try {
    int sessionTimeout=conf.getIntVar(HiveConf.ConfVars.HIVE_ZOOKEEPER_SESSION_TIMEOUT);
    String quorumServers=ZooKeeperHiveHelper.getQuorumServers(conf);
    Watcher dummyWatcher=new ZooKeeperHiveHelper.DummyWatcher();
    zkpClient=new ZooKeeper(quorumServers,sessionTimeout,dummyWatcher);
    String parent=conf.getVar(HiveConf.ConfVars.HIVE_ZOOKEEPER_NAMESPACE);
    List<HiveLock> locks=getLocks(conf,zkpClient,null,parent,false,false);
    Exception lastExceptionGot=null;
    if (locks != null) {
      for (      HiveLock lock : locks) {
        try {
          unlockPrimitive(conf,zkpClient,lock,parent);
        }
 catch (        Exception e) {
          lastExceptionGot=e;
        }
      }
    }
    if (lastExceptionGot != null) {
      throw lastExceptionGot;
    }
  }
 catch (  Exception e) {
    LOG.error("Failed to release all locks: ",e);
    throw new Exception(ErrorMsg.ZOOKEEPER_CLIENT_COULD_NOT_BE_INITIALIZED.getMsg());
  }
 finally {
    if (zkpClient != null) {
      zkpClient.close();
      zkpClient=null;
    }
  }
}
