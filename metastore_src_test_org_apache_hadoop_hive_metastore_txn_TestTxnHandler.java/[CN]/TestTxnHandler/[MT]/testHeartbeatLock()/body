{
  conf.setTimeVar(HiveConf.ConfVars.HIVE_TXN_TIMEOUT,1,TimeUnit.SECONDS);
  HeartbeatRequest h=new HeartbeatRequest();
  LockComponent comp=new LockComponent(LockType.EXCLUSIVE,LockLevel.DB,"mydb");
  comp.setTablename("mytable");
  comp.setPartitionname("mypartition");
  List<LockComponent> components=new ArrayList<LockComponent>(1);
  components.add(comp);
  LockRequest req=new LockRequest(components,"me","localhost");
  LockResponse res=txnHandler.lock(req);
  assertTrue(res.getState() == LockState.ACQUIRED);
  h.setLockid(res.getLockid());
  for (int i=0; i < 30; i++) {
    try {
      txnHandler.heartbeat(h);
    }
 catch (    NoSuchLockException e) {
      fail("Told there was no lock, when the heartbeat should have kept it.");
    }
  }
}
