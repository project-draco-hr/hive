{
  hiveConf=new HiveConf(this.getClass());
  hiveConf.setIntVar(ConfVars.HMSHANDLERATTEMPTS,4);
  hiveConf.setVar(ConfVars.HMSHANDLERINTERVAL,"1s");
  hiveConf.setVar(ConfVars.METASTORE_CONNECTION_DRIVER,FakeDerby.class.getName());
  hiveConf.setBoolVar(ConfVars.METASTORE_TRY_DIRECT_SQL,true);
  String jdbcUrl=hiveConf.get(ConfVars.METASTORECONNECTURLKEY.varname);
  jdbcUrl=jdbcUrl.replace("derby","fderby");
  hiveConf.setVar(ConfVars.METASTORECONNECTURLKEY,jdbcUrl);
  ObjectStore objStore=new ObjectStore();
  Exception savE=null;
  try {
    setInjectConnectFailure(5);
    objStore.setConf(hiveConf);
  }
 catch (  Exception e) {
    e.printStackTrace(System.err);
    savE=e;
  }
  assertEquals(1,getInjectConnectFailure());
  assertNotNull(savE);
  setInjectConnectFailure(0);
  objStore.setConf(hiveConf);
  assertEquals(0,getInjectConnectFailure());
}
