{
  DefaultExecutor executor=new DefaultExecutor();
  executor.setExitValues(null);
  int nbytes=appConf.getInt(AppConfig.EXEC_MAX_BYTES_NAME,-1);
  ByteArrayOutputStream outStream=new MaxByteArrayOutputStream(nbytes);
  ByteArrayOutputStream errStream=new MaxByteArrayOutputStream(nbytes);
  executor.setStreamHandler(new PumpStreamHandler(outStream,errStream));
  int timeout=appConf.getInt(AppConfig.EXEC_TIMEOUT_NAME,0);
  ExecuteWatchdog watchdog=new ExecuteWatchdog(timeout);
  executor.setWatchdog(watchdog);
  CommandLine cmd=makeCommandLine(program,args);
  LOG.info("Running: " + cmd);
  ExecBean res=new ExecBean();
  res.exitcode=executor.execute(cmd,execEnv(env));
  String enc=appConf.get(AppConfig.EXEC_ENCODING_NAME);
  res.stdout=outStream.toString(enc);
  res.stderr=errStream.toString(enc);
  try {
    watchdog.checkException();
  }
 catch (  Exception ex) {
    LOG.error("Command: " + cmd + " failed:",ex);
  }
  if (watchdog.killedProcess()) {
    String msg=" was terminated due to timeout(" + timeout + "ms).  See "+ AppConfig.EXEC_TIMEOUT_NAME+ " property";
    LOG.warn("Command: " + cmd + msg);
    res.stderr+=" Command " + msg;
  }
  return res;
}
