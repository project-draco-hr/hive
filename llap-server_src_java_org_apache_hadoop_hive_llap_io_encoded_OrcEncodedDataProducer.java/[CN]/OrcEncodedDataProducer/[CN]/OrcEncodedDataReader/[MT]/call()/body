{
  LlapIoImpl.LOG.info("Processing split for " + internedFilePath);
  if (isStopped)   return null;
  orcReader=null;
  OrcFileMetadata metadata=null;
  try {
    metadata=getOrReadFileMetadata();
    if (columnIds == null) {
      columnIds=createColumnIds(metadata);
    }
    determineStripesToRead(metadata.getStripes());
  }
 catch (  Throwable t) {
    consumer.setError(t);
    return null;
  }
  if (readState.length == 0) {
    consumer.setDone();
    return null;
  }
  int stride=metadata.getRowIndexStride();
  ArrayList<OrcStripeMetadata> stripeMetadatas=null;
  boolean[] globalIncludes=null;
  RecordReader[] stripeReaders=null;
  try {
    globalIncludes=OrcInputFormat.genIncludedColumns(metadata.getTypes(),columnIds,true);
    stripeReaders=new RecordReader[readState.length];
    if (sarg != null && stride != 0) {
      stripeMetadatas=readStripesMetadata(metadata,globalIncludes,stripeReaders);
    }
    determineRgsToRead(metadata.getStripes(),metadata.getTypes(),globalIncludes,stride,stripeMetadatas);
  }
 catch (  Throwable t) {
    cleanupReaders(stripeReaders);
    consumer.setError(t);
    return null;
  }
  if (isStopped) {
    cleanupReaders(stripeReaders);
    return null;
  }
  List<Integer>[] stripeColsToRead=null;
  if (cache != null) {
    try {
      stripeColsToRead=produceDataFromCache(metadata.getStripes(),stride);
    }
 catch (    Throwable t) {
      consumer.setError(t);
      cleanupReaders(stripeReaders);
      return null;
    }
  }
  try {
    for (int stripeIxMod=0; stripeIxMod < stripeReaders.length; ++stripeIxMod) {
      List<Integer> cols=stripeColsToRead == null ? null : stripeColsToRead[stripeIxMod];
      stripeReaders[stripeIxMod]=prepareStripeReader(stripeIxFrom + stripeIxMod,metadata,globalIncludes,cols,stripeReaders[stripeIxMod]);
    }
  }
 catch (  Throwable t) {
    consumer.setError(t);
    cleanupReaders(stripeReaders);
    return null;
  }
  OrcBatchKey stripeKey=new OrcBatchKey(internedFilePath,-1,0);
  for (int stripeIxMod=0; stripeIxMod < stripeReaders.length; ++stripeIxMod) {
    try {
      RecordReader stripeReader=stripeReaders[stripeIxMod];
      if (stripeReader == null)       continue;
      List<Integer> colsToRead=stripeColsToRead == null ? null : stripeColsToRead[stripeIxMod];
      boolean[] stripeIncludes=null;
      boolean[][] colRgs=readState[stripeIxMod];
      int stripeIx=stripeIxMod + stripeIxFrom;
      if (colsToRead == null || colsToRead.size() == colRgs.length) {
        colsToRead=columnIds;
        stripeIncludes=globalIncludes;
      }
 else {
        stripeIncludes=OrcInputFormat.genIncludedColumns(metadata.getTypes(),colsToRead,true);
        boolean[][] colRgs2=new boolean[colsToRead.size()][];
        for (int i=0, i2=-1; i < colRgs.length; ++i) {
          if (colRgs[i] == null)           continue;
          colRgs2[i2]=colRgs[i];
          ++i2;
        }
        colRgs=colRgs2;
      }
      OrcStripeMetadata stripeMetadata;
      if (stripeMetadatas != null) {
        stripeMetadata=stripeMetadatas.get(stripeIxMod);
      }
 else {
        stripeKey.stripeIx=stripeIx;
        stripeMetadata=metadataCache.getStripeMetadata(stripeKey);
        if (stripeMetadata == null) {
          stripeMetadata=new OrcStripeMetadata(stripeReader,stripeIncludes);
          metadataCache.putStripeMetadata(stripeKey,stripeMetadata);
          stripeKey=new OrcBatchKey(internedFilePath,-1,0);
        }
      }
      if (!stripeMetadata.hasAllIndexes(stripeIncludes)) {
        updateLoadedIndexes(stripeMetadata,stripeReader,stripeIncludes);
      }
      stripeReader.setMetadata(stripeMetadata.getRowIndexes(),stripeMetadata.getEncodings(),stripeMetadata.getStreams());
      Consumer<EncodedColumnBatch<OrcBatchKey>> consumer=(cache == null) ? this.consumer : this;
      stripeReader.readEncodedColumns(stripeIx,stripeIncludes,colRgs,lowLevelCache,consumer);
      stripeReader.close();
    }
 catch (    Throwable t) {
      consumer.setError(t);
      cleanupReaders(stripeReaders);
      return null;
    }
  }
  consumer.setDone();
  if (DebugUtils.isTraceMttEnabled()) {
    LlapIoImpl.LOG.info("done processing " + split);
  }
  return null;
}
