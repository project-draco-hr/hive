{
  if (User.isHBaseSecurityEnabled(conf)) {
    try {
      User curUser=User.getCurrent();
      Token<AuthenticationTokenIdentifier> authToken=getAuthToken(conf,curUser);
      Job job=new Job(conf);
      if (authToken == null) {
        curUser.obtainAuthTokenForJob(conf,job);
      }
 else {
        job.getCredentials().addToken(authToken.getService(),authToken);
      }
    }
 catch (    InterruptedException e) {
      throw new IOException("Error while obtaining hbase delegation token",e);
    }
  }
}
