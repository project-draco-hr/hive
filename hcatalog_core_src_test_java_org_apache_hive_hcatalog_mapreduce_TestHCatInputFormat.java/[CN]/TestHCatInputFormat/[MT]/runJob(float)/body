{
  Configuration conf=new Configuration();
  conf.setFloat(HCatConstants.HCAT_INPUT_BAD_RECORD_THRESHOLD_KEY,badRecordThreshold);
  Job job=new Job(conf);
  job.setJarByClass(this.getClass());
  job.setMapperClass(MyMapper.class);
  job.setInputFormatClass(HCatInputFormat.class);
  job.setOutputFormatClass(TextOutputFormat.class);
  HCatInputFormat.setInput(job,"default","test_bad_records");
  job.setMapOutputKeyClass(HCatRecord.class);
  job.setMapOutputValueClass(HCatRecord.class);
  job.setNumReduceTasks(0);
  Path path=new Path(TEST_DATA_DIR,"test_bad_record_handling_output");
  if (path.getFileSystem(conf).exists(path)) {
    path.getFileSystem(conf).delete(path,true);
  }
  TextOutputFormat.setOutputPath(job,path);
  return job.waitForCompletion(true);
}
