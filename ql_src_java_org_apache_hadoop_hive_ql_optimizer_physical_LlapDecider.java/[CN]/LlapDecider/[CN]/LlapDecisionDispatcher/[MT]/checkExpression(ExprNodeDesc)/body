{
  Deque<ExprNodeDesc> exprs=new LinkedList<ExprNodeDesc>();
  exprs.add(expr);
  while (!exprs.isEmpty()) {
    if (LOG.isDebugEnabled()) {
      LOG.debug(String.format("Checking '%s'",expr.getExprString()));
    }
    ExprNodeDesc cur=exprs.removeFirst();
    if (cur == null)     continue;
    if (cur.getChildren() != null) {
      exprs.addAll(cur.getChildren());
    }
    if (!doSkipUdfCheck && cur instanceof ExprNodeGenericFuncDesc) {
      ExprNodeGenericFuncDesc funcDesc=(ExprNodeGenericFuncDesc)cur;
      boolean isBuiltIn=FunctionRegistry.isBuiltInFuncExpr(funcDesc);
      if (!isBuiltIn) {
        if (!arePermanentFnsAllowed) {
          LOG.info("Not a built-in function: " + cur.getExprString() + " (permanent functions are disabled)");
          return false;
        }
        if (!FunctionRegistry.isPermanentFunction(funcDesc)) {
          LOG.info("Not a built-in or permanent function: " + cur.getExprString());
          return false;
        }
      }
    }
  }
  return true;
}
