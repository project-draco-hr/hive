{
  if (LOG.isTraceEnabled()) {
    LOG.trace("Registering for heartbeat: " + amLocation + ":"+ port+ " for queryIdentifier="+ queryIdentifier);
  }
  AMNodeInfo amNodeInfo;
synchronized (knownAppMasters) {
    LlapNodeId amNodeId=LlapNodeId.getInstance(amLocation,port);
    amNodeInfo=knownAppMasters.get(amNodeId);
    if (amNodeInfo == null) {
      amNodeInfo=new AMNodeInfo(amNodeId,user,jobToken,queryIdentifier,retryPolicy,retryTimeout,socketFactory,conf);
      knownAppMasters.put(amNodeId,amNodeInfo);
      amNodeInfo.setNextHeartbeatTime(System.currentTimeMillis() + heartbeatInterval);
      pendingHeartbeatQueeu.add(amNodeInfo);
    }
    amNodeInfo.setCurrentQueryIdentifier(queryIdentifier);
    amNodeInfo.incrementAndGetTaskCount();
  }
}
