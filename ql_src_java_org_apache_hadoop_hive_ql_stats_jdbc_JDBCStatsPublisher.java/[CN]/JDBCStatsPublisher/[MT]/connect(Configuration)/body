{
  this.hiveconf=hiveconf;
  maxRetries=HiveConf.getIntVar(hiveconf,HiveConf.ConfVars.HIVE_STATS_RETRIES_MAX);
  waitWindow=HiveConf.getIntVar(hiveconf,HiveConf.ConfVars.HIVE_STATS_RETRIES_WAIT);
  connectionString=HiveConf.getVar(hiveconf,HiveConf.ConfVars.HIVESTATSDBCONNECTIONSTRING);
  timeout=HiveConf.getIntVar(hiveconf,HiveConf.ConfVars.HIVE_STATS_JDBC_TIMEOUT);
  String driver=HiveConf.getVar(hiveconf,HiveConf.ConfVars.HIVESTATSJDBCDRIVER);
  try {
    Class.forName(driver).newInstance();
  }
 catch (  Exception e) {
    LOG.error("Error during instantiating JDBC driver " + driver + ". ",e);
    return false;
  }
  String update="UPDATE /* " + comment + " */ "+ JDBCStatsSetupConstants.PART_STAT_TABLE_NAME+ " SET "+ JDBCStatsSetupConstants.PART_STAT_ROW_COUNT_COLUMN_NAME+ "= ? "+ " WHERE "+ JDBCStatsSetupConstants.PART_STAT_ID_COLUMN_NAME+ " = ? "+ " AND ? > ( SELECT TEMP."+ JDBCStatsSetupConstants.PART_STAT_ROW_COUNT_COLUMN_NAME+ " FROM ( "+ " SELECT "+ JDBCStatsSetupConstants.PART_STAT_ROW_COUNT_COLUMN_NAME+ " FROM "+ JDBCStatsSetupConstants.PART_STAT_TABLE_NAME+ " WHERE "+ JDBCStatsSetupConstants.PART_STAT_ID_COLUMN_NAME+ " = ?) TEMP )";
  String insert="INSERT INTO /* " + comment + " */ "+ JDBCStatsSetupConstants.PART_STAT_TABLE_NAME+ " VALUES (?, ?)";
  DriverManager.setLoginTimeout(timeout);
  Utilities.SQLCommand<Void> setQueryTimeout=new Utilities.SQLCommand<Void>(){
    @Override public Void run(    PreparedStatement stmt) throws SQLException {
      stmt.setQueryTimeout(timeout);
      return null;
    }
  }
;
  for (int failures=0; ; failures++) {
    try {
      conn=Utilities.connectWithRetry(connectionString,waitWindow,maxRetries);
      updStmt=Utilities.prepareWithRetry(conn,update,waitWindow,maxRetries);
      insStmt=Utilities.prepareWithRetry(conn,insert,waitWindow,maxRetries);
      Utilities.executeWithRetry(setQueryTimeout,updStmt,waitWindow,maxRetries);
      Utilities.executeWithRetry(setQueryTimeout,insStmt,waitWindow,maxRetries);
      return true;
    }
 catch (    SQLRecoverableException e) {
      if (failures >= maxRetries) {
        LOG.error("Error during JDBC connection to " + connectionString + ". ",e);
        return false;
      }
      long waitTime=Utilities.getRandomWaitTime(waitWindow,failures,r);
      try {
        Thread.sleep(waitTime);
      }
 catch (      InterruptedException e1) {
      }
    }
catch (    SQLException e) {
      return false;
    }
  }
}
