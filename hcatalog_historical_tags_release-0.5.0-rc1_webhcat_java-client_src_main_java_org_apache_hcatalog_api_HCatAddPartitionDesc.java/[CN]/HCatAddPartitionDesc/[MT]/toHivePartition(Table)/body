{
  Partition hivePtn=new Partition();
  hivePtn.setDbName(this.dbName);
  hivePtn.setTableName(this.tableName);
  List<String> pvals=new ArrayList<String>();
  for (  FieldSchema field : hiveTable.getPartitionKeys()) {
    String val=partSpec.get(field.getName());
    if (val == null || val.length() == 0) {
      throw new HCatException("create partition: Value for key " + field.getName() + " is null or empty");
    }
    pvals.add(val);
  }
  hivePtn.setValues(pvals);
  StorageDescriptor sd=new StorageDescriptor(hiveTable.getSd());
  hivePtn.setSd(sd);
  hivePtn.setParameters(hiveTable.getParameters());
  if (this.location != null) {
    hivePtn.getSd().setLocation(this.location);
  }
 else {
    String partName;
    try {
      partName=Warehouse.makePartName(hiveTable.getPartitionKeys(),pvals);
      LOG.info("Setting partition location to :" + partName);
    }
 catch (    MetaException e) {
      throw new HCatException("Exception while creating partition name.",e);
    }
    Path partPath=new Path(hiveTable.getSd().getLocation(),partName);
    hivePtn.getSd().setLocation(partPath.toString());
  }
  hivePtn.setCreateTime((int)(System.currentTimeMillis() / 1000));
  hivePtn.setLastAccessTimeIsSet(false);
  return hivePtn;
}
