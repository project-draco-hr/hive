{
  LlapDaemonConfiguration daemonConf=new LlapDaemonConfiguration();
  int rpcPort=daemonConf.getInt(LlapDaemonConfiguration.LLAP_DAEMON_RPC_PORT,LlapDaemonConfiguration.LLAP_DAEMON_RPC_PORT_DEFAULT);
  int numHandlers=daemonConf.getInt(LlapDaemonConfiguration.LLAP_DAEMON_RPC_NUM_HANDLERS,LlapDaemonConfiguration.LLAP_DAEMON_RPC_NUM_HANDLERS_DEFAULT);
  LlapDaemonProtocolServerImpl server=new LlapDaemonProtocolServerImpl(numHandlers,mock(ContainerRunner.class),new AtomicReference<InetSocketAddress>(),rpcPort);
  try {
    server.init(new Configuration());
    server.start();
    InetSocketAddress serverAddr=server.getBindAddress();
    LlapDaemonProtocolBlockingPB client=new LlapDaemonProtocolClientImpl(new Configuration(),serverAddr.getHostName(),serverAddr.getPort());
    client.submitWork(null,SubmitWorkRequestProto.newBuilder().setAmHost("amhost").setAmPort(2000).build());
  }
  finally {
    server.stop();
  }
}
