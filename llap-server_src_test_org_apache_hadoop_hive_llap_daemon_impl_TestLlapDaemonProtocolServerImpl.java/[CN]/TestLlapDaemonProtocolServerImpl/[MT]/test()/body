{
  LlapDaemonConfiguration daemonConf=new LlapDaemonConfiguration();
  LlapDaemonProtocolServerImpl server=new LlapDaemonProtocolServerImpl(daemonConf,mock(ContainerRunner.class),new AtomicReference<InetSocketAddress>());
  try {
    server.init(new Configuration());
    server.start();
    InetSocketAddress serverAddr=server.getBindAddress();
    LlapDaemonProtocolBlockingPB client=new LlapDaemonProtocolClientImpl(new Configuration(),serverAddr.getHostName(),serverAddr.getPort());
    client.runContainer(null,RunContainerRequestProto.newBuilder().setAmHost("amhost").setAmPort(2000).build());
  }
  finally {
    server.stop();
  }
}
