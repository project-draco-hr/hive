{
  LlapConfiguration daemonConf=new LlapConfiguration();
  int rpcPort=HiveConf.getIntVar(daemonConf,ConfVars.LLAP_DAEMON_RPC_PORT);
  int numHandlers=HiveConf.getIntVar(daemonConf,ConfVars.LLAP_DAEMON_RPC_NUM_HANDLERS);
  LlapDaemonProtocolServerImpl server=new LlapDaemonProtocolServerImpl(numHandlers,mock(ContainerRunner.class),new AtomicReference<InetSocketAddress>(),new AtomicReference<InetSocketAddress>(),rpcPort,rpcPort + 1);
  try {
    server.init(new Configuration());
    server.start();
    InetSocketAddress serverAddr=server.getBindAddress();
    LlapDaemonProtocolBlockingPB client=new LlapDaemonProtocolClientImpl(new Configuration(),serverAddr.getHostName(),serverAddr.getPort(),null,null);
    client.submitWork(null,SubmitWorkRequestProto.newBuilder().setAmHost("amhost").setAmPort(2000).build());
  }
  finally {
    server.stop();
  }
}
