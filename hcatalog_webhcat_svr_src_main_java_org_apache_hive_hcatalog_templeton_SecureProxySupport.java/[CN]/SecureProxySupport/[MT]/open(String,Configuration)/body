{
  close();
  if (isEnabled) {
    this.user=user;
    File t=File.createTempFile("templeton",null);
    tokenPath=new Path(t.toURI());
    Token[] fsToken=getFSDelegationToken(user,conf);
    String hcatTokenStr;
    try {
      hcatTokenStr=buildHcatDelegationToken(user);
    }
 catch (    Exception e) {
      throw new IOException(e);
    }
    if (hcatTokenStr == null) {
      LOG.error("open(" + user + ") token=null");
    }
    Token<?> msToken=new Token();
    msToken.decodeFromUrlString(hcatTokenStr);
    msToken.setService(new Text(HCAT_SERVICE));
    writeProxyDelegationTokens(fsToken,msToken,conf,user,tokenPath);
  }
  return tokenPath;
}
