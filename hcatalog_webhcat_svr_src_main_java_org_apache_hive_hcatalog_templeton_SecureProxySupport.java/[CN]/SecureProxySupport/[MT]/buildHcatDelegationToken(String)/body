{
  final HiveConf c=new HiveConf();
  final IMetaStoreClient client=HCatUtil.getHiveMetastoreClient(c);
  LOG.info("user: " + user + " loginUser: "+ UserGroupInformation.getLoginUser().getUserName());
  final TokenWrapper twrapper=new TokenWrapper();
  final UserGroupInformation ugi=UgiFactory.getUgi(user);
  String s=ugi.doAs(new PrivilegedExceptionAction<String>(){
    public String run() throws IOException, MetaException, TException {
      String u=ugi.getUserName();
      return client.getDelegationToken(c.getUser(),u);
    }
  }
);
  return s;
}
