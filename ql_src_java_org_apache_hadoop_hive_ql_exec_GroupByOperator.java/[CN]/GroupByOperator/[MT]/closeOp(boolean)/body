{
  if (!abort) {
    try {
      if (hashAggr && counterNameToEnum != null) {
        incrCounter(counterNameHashOut,numRowsHashTbl);
      }
      if (firstRow && (keyFields.length == 0)) {
        firstRow=false;
        for (int ai=0; ai < aggregations.length; ai++) {
          Object[] o;
          if (aggregationParameterFields[ai].length > 0) {
            o=new Object[aggregationParameterFields[ai].length];
          }
 else {
            o=null;
          }
          for (int pi=0; pi < aggregationParameterFields[ai].length; pi++) {
            o[pi]=null;
          }
          aggregationEvaluators[ai].aggregate(aggregations[ai],o);
        }
        forward(new Object[0],aggregations);
      }
 else {
        if (hashAggregations != null) {
          LOG.info("Begin Hash Table flush at close: size = " + hashAggregations.size());
          Iterator iter=hashAggregations.entrySet().iterator();
          while (iter.hasNext()) {
            Map.Entry<KeyWrapper,AggregationBuffer[]> m=(Map.Entry)iter.next();
            forward(m.getKey().getKeyArray(),m.getValue());
            iter.remove();
          }
          hashAggregations.clear();
        }
 else         if (aggregations != null) {
          if (currentKeys != null) {
            forward(currentKeys.getKeyArray(),aggregations);
          }
          currentKeys=null;
        }
 else {
        }
      }
    }
 catch (    Exception e) {
      e.printStackTrace();
      throw new HiveException(e);
    }
  }
}
