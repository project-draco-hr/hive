{
  countAfterReport=0;
  if (complete) {
    Iterator<Map.Entry<KeyWrapper,AggregationBuffer[]>> iter=hashAggregations.entrySet().iterator();
    while (iter.hasNext()) {
      Map.Entry<KeyWrapper,AggregationBuffer[]> m=iter.next();
      forward(m.getKey().getKeyArray(),m.getValue());
    }
    hashAggregations.clear();
    hashAggregations=null;
    if (isLogInfoEnabled) {
      LOG.info("Hash Table completed flushed");
    }
    return;
  }
  int oldSize=hashAggregations.size();
  if (isLogInfoEnabled) {
    LOG.info("Hash Tbl flush: #hash table = " + oldSize);
  }
  Iterator<Map.Entry<KeyWrapper,AggregationBuffer[]>> iter=hashAggregations.entrySet().iterator();
  int numDel=0;
  while (iter.hasNext()) {
    Map.Entry<KeyWrapper,AggregationBuffer[]> m=iter.next();
    forward(m.getKey().getKeyArray(),m.getValue());
    iter.remove();
    numDel++;
    if (numDel * 10 >= oldSize) {
      if (isLogInfoEnabled) {
        LOG.info("Hash Table flushed: new size = " + hashAggregations.size());
      }
      return;
    }
  }
}
