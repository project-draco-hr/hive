{
  PTFPersistence.lock(lock.writeLock());
  currentSize=0;
  try {
    for (int i=0; i < partitions.size() - 1; i++) {
      ByteBasedList p=partitions.get(i);
      reusableFiles.add(((PersistentByteBasedList)p).getFile());
    }
    ByteBasedList memstore=partitions.get(partitions.size() - 1);
    memstore.reset(0);
    partitions.clear();
    partitionOffsets.clear();
    partitions.add(memstore);
    partitionOffsets.add(0);
  }
  finally {
    lock.writeLock().unlock();
  }
}
