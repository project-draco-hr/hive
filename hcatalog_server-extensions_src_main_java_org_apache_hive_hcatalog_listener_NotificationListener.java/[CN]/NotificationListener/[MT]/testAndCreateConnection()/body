{
  if (conn != null) {
    session.remove();
    if (!isConnectionHealthy()) {
      try {
        conn.close();
      }
 catch (      Exception e) {
        LOG.error("Unable to close bad JMS connection, ignored error",e);
      }
      conn=createConnection();
    }
  }
 else {
    conn=createConnection();
  }
  try {
    session.set(createSession());
  }
 catch (  JMSException e) {
    LOG.error("Couldn't create JMS session, ignored the error",e);
  }
}
