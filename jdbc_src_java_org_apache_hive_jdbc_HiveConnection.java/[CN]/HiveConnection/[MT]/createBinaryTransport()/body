{
  transport=new TSocket(host,port);
  if (!sessConfMap.containsKey(HIVE_AUTH_TYPE) || !sessConfMap.get(HIVE_AUTH_TYPE).equals(HIVE_AUTH_SIMPLE)) {
    try {
      if (sessConfMap.containsKey(HIVE_AUTH_PRINCIPAL)) {
        Map<String,String> saslProps=new HashMap<String,String>();
        SaslQOP saslQOP=SaslQOP.AUTH;
        if (sessConfMap.containsKey(HIVE_AUTH_QOP)) {
          try {
            saslQOP=SaslQOP.fromString(sessConfMap.get(HIVE_AUTH_QOP));
          }
 catch (          IllegalArgumentException e) {
            throw new SQLException("Invalid " + HIVE_AUTH_QOP + " parameter. "+ e.getMessage(),"42000",e);
          }
        }
        saslProps.put(Sasl.QOP,saslQOP.toString());
        saslProps.put(Sasl.SERVER_AUTH,"true");
        transport=KerberosSaslHelper.getKerberosTransport(sessConfMap.get(HIVE_AUTH_PRINCIPAL),host,transport,saslProps);
      }
 else {
        String userName=sessConfMap.get(HIVE_AUTH_USER);
        if ((userName == null) || userName.isEmpty()) {
          userName=HIVE_ANONYMOUS_USER;
        }
        String passwd=sessConfMap.get(HIVE_AUTH_PASSWD);
        if ((passwd == null) || passwd.isEmpty()) {
          passwd=HIVE_ANONYMOUS_PASSWD;
        }
        transport=PlainSaslHelper.getPlainTransport(userName,passwd,transport);
      }
    }
 catch (    SaslException e) {
      throw new SQLException("Could not create secure connection to " + jdbcURI + ": "+ e.getMessage()," 08S01",e);
    }
  }
  return transport;
}
