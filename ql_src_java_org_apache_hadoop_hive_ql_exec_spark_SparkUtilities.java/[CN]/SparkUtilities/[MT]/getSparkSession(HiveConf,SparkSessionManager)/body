{
  SparkSession sparkSession=SessionState.get().getSparkSession();
  HiveConf sessionConf=SessionState.get().getConf();
  if (sessionConf.getSparkConfigUpdated() || conf.getSparkConfigUpdated()) {
    sparkSessionManager.closeSession(sparkSession);
    sparkSession=null;
    conf.setSparkConfigUpdated(false);
    sessionConf.setSparkConfigUpdated(false);
  }
  sparkSession=sparkSessionManager.getSession(sparkSession,conf,true);
  SessionState.get().setSparkSession(sparkSession);
  return sparkSession;
}
