{
  Boolean newPhase=RelMetadataQuery.isPhaseTransition(rel);
  if (newPhase == null) {
    return null;
  }
  if (newPhase) {
    final Double averageRowSize=RelMetadataQuery.getAverageRowSize(rel);
    final Double rowCount=RelMetadataQuery.getRowCount(rel);
    if (averageRowSize == null || rowCount == null) {
      return null;
    }
    final Double totalSize=averageRowSize * rowCount;
    final Double splitCount=totalSize / maxSplitSize;
    return splitCount.intValue();
  }
  Integer splitCount=0;
  for (  RelNode input : rel.getInputs()) {
    splitCount+=RelMetadataQuery.splitCount(input);
  }
  return splitCount;
}
