{
  int magicLength=OrcFile.MAGIC.length();
  int fullLength=magicLength + 1;
  if (psLen < fullLength || buffer.remaining() < fullLength) {
    throw new FileFormatException("Malformed ORC file " + path + ". Invalid postscript length "+ psLen);
  }
  int offset=buffer.arrayOffset() + buffer.position() + buffer.limit() - fullLength;
  byte[] array=buffer.array();
  if (!Text.decode(array,offset,magicLength).equals(OrcFile.MAGIC)) {
    byte[] header=new byte[magicLength];
    in.readFully(0,header,0,magicLength);
    if (!Text.decode(header,0,magicLength).equals(OrcFile.MAGIC)) {
      throw new FileFormatException("Malformed ORC file " + path + ". Invalid postscript.");
    }
  }
}
