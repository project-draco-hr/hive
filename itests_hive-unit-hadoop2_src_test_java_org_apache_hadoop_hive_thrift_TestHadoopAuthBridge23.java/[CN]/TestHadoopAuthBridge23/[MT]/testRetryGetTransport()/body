{
  TTransport inputTransport=Mockito.mock(TTransport.class);
  TTransport expectedTransport=Mockito.mock(TTransport.class);
  TTransportFactory mockWrapped=Mockito.mock(TTransportFactory.class);
  UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
  when(mockWrapped.getTransport(any(TTransport.class))).thenThrow(new RuntimeException(new TTransportException())).thenThrow(new RuntimeException(new TTransportException())).thenReturn(expectedTransport);
  TTransportFactory factory=new HadoopThriftAuthBridge.Server.TUGIAssumingTransportFactory(mockWrapped,ugi,3);
  TTransport transport=factory.getTransport(inputTransport);
  assertEquals(expectedTransport,transport);
  verify(mockWrapped,times(3)).getTransport(any(TTransport.class));
}
