{
  Exception expectedException=new RuntimeException(new TTransportException());
  TTransport inputTransport=Mockito.mock(TTransport.class);
  TTransportFactory mockWrapped=Mockito.mock(TTransportFactory.class);
  UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
  when(mockWrapped.getTransport(any(TTransport.class))).thenThrow(expectedException);
  try {
    TTransportFactory factory=new HadoopThriftAuthBridge.Server.TUGIAssumingTransportFactory(mockWrapped,ugi,3);
    factory.getTransport(inputTransport);
  }
 catch (  Exception e) {
    assertEquals(expectedException,e);
  }
 finally {
    verify(mockWrapped,times(3)).getTransport(any(TTransport.class));
  }
}
