{
  OperationHandle operationHandle=client.executeStatementAsync(sessionHandle,sql,null);
  boolean isQueryRunning=true;
  long pollTimeout=System.currentTimeMillis() + 100000;
  OperationStatus opStatus;
  OperationState state=null;
  RowSet rowSetAccumulated=null;
  StringBuilder logs=new StringBuilder();
  while (isQueryRunning) {
    if (System.currentTimeMillis() > pollTimeout) {
      break;
    }
    opStatus=client.getOperationStatus(operationHandle);
    Assert.assertNotNull(opStatus);
    state=opStatus.getState();
    rowSetAccumulated=client.fetchResults(operationHandle,FetchOrientation.FETCH_NEXT,1000,FetchType.LOG);
    for (    Object[] row : rowSetAccumulated) {
      logs.append(row[0]);
    }
    if (state == OperationState.CANCELED || state == OperationState.CLOSED || state == OperationState.FINISHED || state == OperationState.ERROR) {
      isQueryRunning=false;
    }
    Thread.sleep(10);
  }
  Assert.assertEquals("Query should be finished",OperationState.FINISHED,state);
  verifyFetchedLog(logs.toString());
  RowSet rowSet=client.fetchResults(operationHandle,FetchOrientation.FETCH_FIRST,1000,FetchType.LOG);
  verifyFetchedLog(rowSet);
}
