{
  SessionHandle sessionHandleCleanup=setupSession();
  OperationHandle operationHandle=client.executeStatement(sessionHandleCleanup,sql,null);
  RowSet rowSetLog=client.fetchResults(operationHandle,FetchOrientation.FETCH_FIRST,1000,FetchType.LOG);
  verifyFetchedLog(rowSetLog);
  File sessionLogDir=new File(hiveConf.getVar(HiveConf.ConfVars.HIVE_SERVER2_LOGGING_OPERATION_LOG_LOCATION) + File.separator + sessionHandleCleanup.getHandleIdentifier());
  File operationLogFile=new File(sessionLogDir,operationHandle.getHandleIdentifier().toString());
  client.closeOperation(operationHandle);
  try {
    client.fetchResults(operationHandle,FetchOrientation.FETCH_FIRST,1000,FetchType.LOG);
    Assert.fail("Fetch should fail");
  }
 catch (  HiveSQLException e) {
    Assert.assertTrue(e.getMessage().contains("Invalid OperationHandle:"));
  }
  if (operationLogFile.exists()) {
    Assert.fail("Operation log file should be deleted.");
  }
  client.closeSession(sessionHandleCleanup);
  if (sessionLogDir.exists()) {
    Assert.fail("Session log dir should be deleted.");
  }
}
