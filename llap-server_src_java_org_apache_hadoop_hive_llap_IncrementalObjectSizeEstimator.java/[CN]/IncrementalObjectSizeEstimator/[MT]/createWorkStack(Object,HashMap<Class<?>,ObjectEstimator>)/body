{
  Deque<Object> stack=new ArrayDeque<Object>(32);
  Class<?> rootClass=rootObj.getClass();
  if (Class.class.equals(rootClass)) {
    rootClass=(Class<?>)rootObj;
    rootObj=null;
  }
 else {
    if (rootClass.isArray() && !rootClass.getComponentType().isPrimitive()) {
      addArrayEstimator(byType,stack,null,rootObj);
    }
 else     if (Collection.class.isAssignableFrom(rootClass)) {
      addCollectionEstimator(byType,stack,null,rootClass,rootObj);
    }
 else     if (Map.class.isAssignableFrom(rootClass)) {
      addMapEstimator(byType,stack,null,rootClass,rootObj);
    }
  }
  addToProcessing(byType,stack,rootObj,rootClass);
  return stack;
}
