{
  CompactionRequest rqst=new CompactionRequest("foo","bar",CompactionType.MINOR);
  rqst.setPartitionname("ds=today");
  txnHandler.compact(rqst);
  assertEquals(0,txnHandler.findReadyToClean().size());
  CompactionInfo ci=txnHandler.findNextToCompact("fred");
  assertNotNull(ci);
  assertEquals(0,txnHandler.findReadyToClean().size());
  txnHandler.markCompacted(ci);
  assertNull(txnHandler.findNextToCompact("fred"));
  List<CompactionInfo> toClean=txnHandler.findReadyToClean();
  assertEquals(1,toClean.size());
  assertNull(txnHandler.findNextToCompact("fred"));
  ShowCompactResponse rsp=txnHandler.showCompact(new ShowCompactRequest());
  List<ShowCompactResponseElement> compacts=rsp.getCompacts();
  assertEquals(1,compacts.size());
  ShowCompactResponseElement c=compacts.get(0);
  assertEquals("foo",c.getDbname());
  assertEquals("bar",c.getTablename());
  assertEquals("ds=today",c.getPartitionname());
  assertEquals(CompactionType.MINOR,c.getType());
  assertEquals("ready for cleaning",c.getState());
  assertNull(c.getWorkerid());
}
