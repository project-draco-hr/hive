{
  CompactionRequest rqst=new CompactionRequest("foo","bar",CompactionType.MINOR);
  rqst.setPartitionname("ds=today");
  txnHandler.compact(rqst);
  rqst=new CompactionRequest("foo","bar",CompactionType.MINOR);
  rqst.setPartitionname("ds=yesterday");
  txnHandler.compact(rqst);
  long now=System.currentTimeMillis();
  boolean expectToday=false;
  CompactionInfo ci=txnHandler.findNextToCompact("fred");
  assertNotNull(ci);
  assertEquals("foo",ci.dbname);
  assertEquals("bar",ci.tableName);
  if ("ds=today".equals(ci.partName))   expectToday=false;
 else   if ("ds=yesterday".equals(ci.partName))   expectToday=true;
 else   fail("partition name should have been today or yesterday but was " + ci.partName);
  assertEquals(CompactionType.MINOR,ci.type);
  ci=txnHandler.findNextToCompact("fred");
  assertNotNull(ci);
  assertEquals("foo",ci.dbname);
  assertEquals("bar",ci.tableName);
  if (expectToday)   assertEquals("ds=today",ci.partName);
 else   assertEquals("ds=yesterday",ci.partName);
  assertEquals(CompactionType.MINOR,ci.type);
  assertNull(txnHandler.findNextToCompact("fred"));
  ShowCompactResponse rsp=txnHandler.showCompact(new ShowCompactRequest());
  List<ShowCompactResponseElement> compacts=rsp.getCompacts();
  assertEquals(2,compacts.size());
  for (  ShowCompactResponseElement e : compacts) {
    assertEquals("working",e.getState());
    assertTrue(e.getStart() - 5000 < now && e.getStart() + 5000 > now);
    assertEquals("fred",e.getWorkerid());
  }
}
