{
  jobInfo=HCatOutputFormat.getJobInfo(context);
  this.context=context;
  partColsToDel=jobInfo.getPosOfPartCols();
  dynamicPartitioningUsed=jobInfo.getTableInfo().isDynamicPartitioningUsed();
  dynamicPartCols=jobInfo.getPosOfDynPartCols();
  maxDynamicPartitions=jobInfo.getMaxDynamicPartitions();
  if ((partColsToDel == null) || (dynamicPartitioningUsed && (dynamicPartCols == null))) {
    throw new HCatException("It seems that setSchema() is not called on " + "HCatOutputFormat. Please make sure that method is called.");
  }
  if (!dynamicPartitioningUsed) {
    this.storageDriver=HCatOutputFormat.getOutputDriverInstance(context,jobInfo);
    this.baseWriter=storageDriver.getOutputFormat().getRecordWriter(context);
    this.baseDynamicStorageDrivers=null;
    this.baseDynamicWriters=null;
  }
 else {
    this.baseDynamicStorageDrivers=new HashMap<Integer,HCatOutputStorageDriver>();
    this.baseDynamicWriters=new HashMap<Integer,RecordWriter<? super WritableComparable<?>,? super Writable>>();
    this.storageDriver=null;
    this.baseWriter=null;
  }
}
