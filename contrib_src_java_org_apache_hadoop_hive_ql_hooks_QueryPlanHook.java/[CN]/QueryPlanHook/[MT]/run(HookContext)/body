{
  assert(hookContext.getHookType() == HookContext.HookType.POST_EXEC_HOOK);
  String queryId="";
  SessionState sess=SessionState.get();
  if (sess != null) {
    conf=sess.getConf();
    queryId=conf.getVar(HiveConf.ConfVars.HIVEQUERYID);
    HiveOperation op=sess.getHiveOperation();
    if ((op == null) || ((!op.equals(HiveOperation.CREATETABLE_AS_SELECT)) && (!op.equals(HiveOperation.CREATEVIEW)) && (!op.equals(HiveOperation.LOAD))&& (!op.equals(HiveOperation.QUERY)))) {
      return;
    }
  }
 else {
    return;
  }
  List<Task<? extends Serializable>> rootTasks=hookContext.getQueryPlan().getRootTasks();
  if ((rootTasks == null) || (rootTasks.isEmpty())) {
    return;
  }
  ExplainWork explainWork=new ExplainWork(null,rootTasks,null,false,true);
  JSONObject queryPlan=ExplainTask.getJSONPlan(null,explainWork);
  List<Object> sqlParams=new ArrayList<Object>();
  sqlParams.add(StringEscapeUtils.escapeJava(queryId));
  sqlParams.add(StringEscapeUtils.escapeJava(queryPlan.toString()));
  String sql="insert into query_plan_log set queryId = ?, queryPlan = ?";
  if (urlFactory == null) {
    urlFactory=getQueryPlanUrlFactory(conf);
    if (urlFactory == null) {
      throw new RuntimeException("DB parameters not set!");
    }
  }
  HookUtils.runInsert(conf,urlFactory,sql,sqlParams,HookUtils.getSqlNumRetry(conf));
}
