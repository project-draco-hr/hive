{
  TypeDescription schema=TypeDescription.createStruct().addField("outer",TypeDescription.createUnion().addUnionChild(TypeDescription.createInt()).addUnionChild(TypeDescription.createLong()));
  Writer writer=OrcFile.createWriter(testFilePath,OrcFile.writerOptions(conf).setSchema(schema));
  VectorizedRowBatch batch=schema.createRowBatch();
  batch.size=1024;
  UnionColumnVector outer=(UnionColumnVector)batch.cols[0];
  batch.cols[0].noNulls=false;
  for (int r=0; r < 1024; ++r) {
    if (r < 200) {
      outer.isNull[r]=true;
    }
 else     if (r < 300) {
      outer.tags[r]=0;
    }
 else     if (r < 400) {
      outer.tags[r]=1;
    }
 else     if (r < 600) {
      outer.isNull[r]=true;
    }
 else     if (r < 800) {
      outer.tags[r]=1;
    }
 else     if (r < 1000) {
      outer.isNull[r]=true;
    }
 else {
      outer.tags[r]=1;
    }
    ((LongColumnVector)outer.fields[0]).vector[r]=r;
    ((LongColumnVector)outer.fields[1]).vector[r]=-r;
  }
  writer.addRowBatch(batch);
  writer.close();
  Reader reader=OrcFile.createReader(testFilePath,OrcFile.readerOptions(conf));
  RecordReader rows=reader.rows();
  batch=reader.getSchema().createRowBatch(1024);
  UnionColumnVector union=(UnionColumnVector)batch.cols[0];
  LongColumnVector ints=(LongColumnVector)union.fields[0];
  LongColumnVector longs=(LongColumnVector)union.fields[1];
  assertEquals(true,rows.nextBatch(batch));
  assertEquals(1024,batch.size);
  for (int r=0; r < 1024; ++r) {
    if (r < 200) {
      assertEquals("row " + r,true,union.isNull[r]);
    }
 else     if (r < 300) {
      assertEquals("row " + r,false,union.isNull[r]);
      assertEquals("row " + r,0,union.tags[r]);
      assertEquals("row " + r,r,ints.vector[r]);
    }
 else     if (r < 400) {
      assertEquals("row " + r,false,union.isNull[r]);
      assertEquals("row " + r,1,union.tags[r]);
      assertEquals("row " + r,-r,longs.vector[r]);
    }
 else     if (r < 600) {
      assertEquals("row " + r,true,union.isNull[r]);
    }
 else     if (r < 800) {
      assertEquals("row " + r,false,union.isNull[r]);
      assertEquals("row " + r,1,union.tags[r]);
      assertEquals("row " + r,-r,longs.vector[r]);
    }
 else     if (r < 1000) {
      assertEquals("row " + r,true,union.isNull[r]);
    }
 else {
      assertEquals("row " + r,false,union.isNull[r]);
      assertEquals("row " + r,1,union.tags[r]);
      assertEquals("row " + r,-r,longs.vector[r]);
    }
  }
  assertEquals(false,rows.nextBatch(batch));
}
