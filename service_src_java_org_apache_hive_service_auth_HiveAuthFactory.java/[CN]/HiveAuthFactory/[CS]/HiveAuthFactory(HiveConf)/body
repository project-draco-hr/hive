{
  this.conf=conf;
  transportMode=conf.getVar(HiveConf.ConfVars.HIVE_SERVER2_TRANSPORT_MODE);
  authTypeStr=conf.getVar(HiveConf.ConfVars.HIVE_SERVER2_AUTHENTICATION);
  if ("http".equalsIgnoreCase(transportMode)) {
    if (authTypeStr == null) {
      authTypeStr=AuthTypes.NOSASL.getAuthName();
    }
  }
 else {
    if (authTypeStr == null) {
      authTypeStr=AuthTypes.NONE.getAuthName();
    }
    if (authTypeStr.equalsIgnoreCase(AuthTypes.KERBEROS.getAuthName()) && ShimLoader.getHadoopShims().isSecureShimImpl()) {
      saslServer=ShimLoader.getHadoopThriftAuthBridge().createServer(conf.getVar(ConfVars.HIVE_SERVER2_KERBEROS_KEYTAB),conf.getVar(ConfVars.HIVE_SERVER2_KERBEROS_PRINCIPAL));
      try {
        saslServer.startDelegationTokenSecretManager(conf,null);
      }
 catch (      IOException e) {
        throw new TTransportException("Failed to start token manager",e);
      }
    }
  }
}
