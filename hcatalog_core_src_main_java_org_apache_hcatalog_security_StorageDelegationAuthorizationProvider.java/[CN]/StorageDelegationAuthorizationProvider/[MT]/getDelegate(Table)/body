{
  HiveStorageHandler handler=table.getStorageHandler();
  if (handler != null) {
    if (handler instanceof HCatStorageHandler) {
      return ((HCatStorageHandler)handler).getAuthorizationProvider();
    }
 else {
      String authProviderClass=authProviders.get(handler.getClass().getCanonicalName());
      if (authProviderClass != null) {
        try {
          ReflectionUtils.newInstance(getConf().getClassByName(authProviderClass),getConf());
        }
 catch (        ClassNotFoundException ex) {
          throw new HiveException("Cannot instantiate delegation AuthotizationProvider");
        }
      }
      throw new HiveException(String.format("Storage Handler for table:%s is not an instance " + "of HCatStorageHandler",table.getTableName()));
    }
  }
 else {
    return hdfsAuthorizer;
  }
}
