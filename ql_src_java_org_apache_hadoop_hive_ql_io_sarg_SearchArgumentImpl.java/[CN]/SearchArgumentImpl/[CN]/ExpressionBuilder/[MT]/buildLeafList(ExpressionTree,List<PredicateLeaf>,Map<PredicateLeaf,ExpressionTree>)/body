{
  if (expr.children != null) {
    for (int i=0; i < expr.children.size(); ++i) {
      expr.children.set(i,buildLeafList(expr.children.get(i),leafCache,lookup));
    }
  }
 else   if (expr.operator == ExpressionTree.Operator.LEAF) {
    PredicateLeaf leaf=leafCache.get(expr.leaf);
    ExpressionTree val=lookup.get(leaf);
    if (val == null) {
      val=new ExpressionTree(leaves.size());
      lookup.put(leaf,val);
      leaves.add(leaf);
    }
    return val;
  }
  return expr;
}
