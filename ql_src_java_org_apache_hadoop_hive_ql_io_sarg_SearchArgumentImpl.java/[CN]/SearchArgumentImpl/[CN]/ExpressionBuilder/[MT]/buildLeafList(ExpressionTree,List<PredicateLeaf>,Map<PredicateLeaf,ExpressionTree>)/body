{
  if (expr.getChildren() != null) {
    for (int i=0; i < expr.getChildren().size(); ++i) {
      expr.getChildren().set(i,buildLeafList(expr.getChildren().get(i),leafCache,lookup));
    }
  }
 else   if (expr.getOperator() == ExpressionTree.Operator.LEAF) {
    PredicateLeaf leaf=leafCache.get(expr.getLeaf());
    ExpressionTree val=lookup.get(leaf);
    if (val == null) {
      val=new ExpressionTree(leaves.size());
      lookup.put(leaf,val);
      leaves.add(leaf);
    }
    return val;
  }
  return expr;
}
