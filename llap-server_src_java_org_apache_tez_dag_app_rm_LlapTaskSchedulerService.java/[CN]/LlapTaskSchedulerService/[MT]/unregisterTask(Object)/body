{
  writeLock.lock();
  try {
    TaskInfo taskInfo=knownTasks.remove(task);
    if (taskInfo != null) {
      if (taskInfo.assigned) {
        int priority=taskInfo.priority.getPriority();
        Set<TaskInfo> tasksAtPriority=runningTasks.get(priority);
        Preconditions.checkState(tasksAtPriority != null,"runningTasks should contain an entry if the task was in running state. Caused by task: {}",task);
        tasksAtPriority.remove(taskInfo);
        if (tasksAtPriority.isEmpty()) {
          runningTasks.remove(priority);
        }
      }
    }
 else {
      LOG.warn("Could not find TaskInfo for task: {}. Not removing it from the running set",task);
    }
    return taskInfo;
  }
  finally {
    writeLock.unlock();
  }
}
