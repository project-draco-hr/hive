{
  SelectHostResult selectHostResult=selectHost(taskInfo);
  if (selectHostResult.scheduleResult == ScheduleResult.SCHEDULED) {
    NodeServiceInstancePair nsPair=selectHostResult.nodeServiceInstancePair;
    Container container=containerFactory.createContainer(resourcePerExecutor,taskInfo.priority,nsPair.getServiceInstance().getHost(),nsPair.getServiceInstance().getRpcPort());
    writeLock.lock();
    try {
      LOG.info("Assigned task {} to container {}",taskInfo,container.getId());
      dagStats.registerTaskAllocated(taskInfo.requestedHosts,taskInfo.requestedRacks,nsPair.getServiceInstance().getHost());
      taskInfo.setAssignmentInfo(nsPair.getServiceInstance(),container.getId(),clock.getTime());
      registerRunningTask(taskInfo);
      nsPair.getNodeInfo().registerTaskScheduled();
    }
  finally {
      writeLock.unlock();
    }
    getContext().taskAllocated(taskInfo.task,taskInfo.clientCookie,container);
  }
  return selectHostResult.scheduleResult;
}
