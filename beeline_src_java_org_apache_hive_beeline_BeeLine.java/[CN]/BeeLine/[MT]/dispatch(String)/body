{
  if (line == null) {
    exit=true;
    return true;
  }
  if (line.trim().length() == 0) {
    return true;
  }
  if (isComment(line)) {
    return true;
  }
  line=line.trim();
  if (scriptOutputFile != null) {
    scriptOutputFile.addLine(line);
  }
  if (isHelpRequest(line)) {
    line="!help";
  }
  if (line.startsWith(COMMAND_PREFIX)) {
    Map<String,CommandHandler> cmdMap=new TreeMap<String,CommandHandler>();
    line=line.substring(1);
    for (int i=0; i < commandHandlers.length; i++) {
      String match=commandHandlers[i].matches(line);
      if (match != null) {
        CommandHandler prev=cmdMap.put(match,commandHandlers[i]);
        if (prev != null) {
          return error(loc("multiple-matches",Arrays.asList(prev.getName(),commandHandlers[i].getName())));
        }
      }
    }
    if (cmdMap.size() == 0) {
      return error(loc("unknown-command",line));
    }
    if (cmdMap.size() > 1) {
      CommandHandler handler=cmdMap.get(line);
      if (handler == null) {
        return error(loc("multiple-matches",cmdMap.keySet().toString()));
      }
      return handler.execute(line);
    }
    return cmdMap.values().iterator().next().execute(line);
  }
 else {
    return commands.sql(line);
  }
}
