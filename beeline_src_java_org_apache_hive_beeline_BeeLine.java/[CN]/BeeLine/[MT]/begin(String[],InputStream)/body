{
  int status=ERRNO_OK;
  try {
    getOpts().load();
  }
 catch (  Exception e) {
  }
  if (!(initArgs(args))) {
    usage();
    return ERRNO_ARGS;
  }
  ConsoleReader reader=null;
  boolean runningScript=(getOpts().getScriptFile() != null);
  if (runningScript) {
    try {
      FileInputStream scriptStream=new FileInputStream(getOpts().getScriptFile());
      reader=getConsoleReader(scriptStream);
    }
 catch (    Throwable t) {
      handleException(t);
      commands.quit(null);
      status=ERRNO_OTHER;
    }
  }
 else {
    reader=getConsoleReader(inputStream);
  }
  try {
    info(getApplicationTitle());
  }
 catch (  Exception e) {
  }
  while (!exit) {
    try {
      if (!dispatch(reader.readLine(getPrompt())) && runningScript) {
        commands.quit(null);
        status=ERRNO_OTHER;
      }
    }
 catch (    EOFException eof) {
      commands.quit(null);
    }
catch (    Throwable t) {
      handleException(t);
      status=ERRNO_OTHER;
    }
  }
  commands.closeall(null);
  return status;
}
