{
  if (message instanceof Protocol.CancelJob) {
    Protocol.CancelJob cj=(Protocol.CancelJob)message;
    JobWrapper<?> job=activeJobs.get(cj.id);
    if (job == null || !cancelJob(job)) {
      LOG.info("Requested to cancel an already finished job.");
    }
  }
 else   if (message instanceof DisassociatedEvent) {
    LOG.debug("Shutting down due to DisassociatedEvent.");
    shutdown(null);
  }
 else   if (message instanceof Protocol.EndSession) {
    LOG.debug("Shutting down due to EndSession request.");
    shutdown(null);
  }
 else   if (message instanceof Protocol.JobRequest) {
    Protocol.JobRequest req=(Protocol.JobRequest)message;
    LOG.info("Received job request {}",req.id);
    JobWrapper<?> wrapper=new JobWrapper<Serializable>(req);
    activeJobs.put(req.id,wrapper);
    wrapper.submit();
  }
}
