{
  assert(hookType == HookContext.HookType.POST_EXEC_HOOK || hookType == HookContext.HookType.ON_FAILURE_HOOK);
  String command="";
  String commandType="";
  String user_info="";
  String inputStr="";
  String outputStr="";
  String queryId="";
  String querySrc="";
  String startTimeStr="";
  String packageName="";
  if (sess != null) {
    command=StringEscapeUtils.escapeJava(sess.getCmd());
    commandType=StringEscapeUtils.escapeJava(sess.getCommandType());
    setHiveConf(sess.getConf());
    queryId=conf.getVar(HiveConf.ConfVars.HIVEQUERYID);
    querySrc=conf.get(JobStatsHook.HIVE_QUERY_SOURCE,"");
    packageName=conf.get(FBHiveConf.FB_CURRENT_CLUSTER);
  }
  if (ugi != null) {
    user_info=StringEscapeUtils.escapeJava(ugi.getUserName());
  }
  if (inputs != null) {
    inputStr=entitiesToString(inputs);
  }
  if (outputs != null) {
    outputStr=entitiesToString(outputs);
  }
  Long startTimeMillis=PerfLogger.getPerfLogger().getStartTime(PerfLogger.DRIVER_RUN);
  if (startTimeMillis != null) {
    Date startTime=new Date(startTimeMillis.longValue());
    startTimeStr=new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(startTime);
  }
 else {
    LOG.error("Start time was null in ReplicationHook");
  }
  ArrayList<Object> sqlParams=new ArrayList<Object>();
  sqlParams.add(StringEscapeUtils.escapeJava(command));
  sqlParams.add(StringEscapeUtils.escapeJava(commandType));
  sqlParams.add(StringEscapeUtils.escapeJava(inputStr));
  sqlParams.add(outputStr);
  sqlParams.add(StringEscapeUtils.escapeJava(queryId));
  sqlParams.add(StringEscapeUtils.escapeJava(user_info));
  sqlParams.add(StringEscapeUtils.escapeJava(querySrc));
  sqlParams.add(startTimeStr);
  sqlParams.add(packageName);
  String sql="";
  if (hookType == HookContext.HookType.POST_EXEC_HOOK) {
    sql="insert into snc1_command_log set command = ?, command_type = ?, inputs = ?, " + "outputs = ?, queryId = ?, user_info = ?, query_src = ?, start_time = ?, " + "package_name = ?";
  }
 else   if (hookType == HookContext.HookType.ON_FAILURE_HOOK) {
    List<String> errors=((CachingPrintStream)sess.err).getOutput();
    String localErrorString="";
    if (!errors.isEmpty()) {
      JSONObject localErrorObj=new JSONObject();
      localErrorObj.put("localErrors",errors);
      localErrorString=localErrorObj.toString();
    }
    sqlParams.add(localErrorString);
    sql="insert into snc1_failed_command_log set command = ?, command_type = ?, inputs = ?, " + "outputs = ?, queryId = ?, user_info = ?, query_src = ?, start_time = ?, " + "package_name = ?, local_errors = ?";
  }
  HookUtils.runInsert(conf,urlFactory,sql,sqlParams,HookUtils.getSqlNumRetry(conf));
}
