{
  Configuration conf=ss.getConf();
  String tblName=conf.get(HCatConstants.HCAT_CREATE_TBL_NAME,"");
  if (tblName.isEmpty()) {
    tblName=conf.get("import.destination.table","");
    conf.set("import.destination.table","");
  }
  String dbName=conf.get(HCatConstants.HCAT_CREATE_DB_NAME,"");
  String grp=conf.get(HCatConstants.HCAT_GROUP,null);
  String permsStr=conf.get(HCatConstants.HCAT_PERMS,null);
  if (tblName.isEmpty() && dbName.isEmpty()) {
    return 0;
  }
  if (null == grp && null == permsStr) {
    return 0;
  }
  FsPermission perms=FsPermission.valueOf(permsStr);
  if (!tblName.isEmpty()) {
    Hive db=null;
    try {
      db=Hive.get();
      Table tbl=db.getTable(tblName);
      Path tblPath=tbl.getPath();
      FileSystem fs=tblPath.getFileSystem(conf);
      if (null != perms) {
        fs.setPermission(tblPath,perms);
      }
      if (null != grp) {
        fs.setOwner(tblPath,null,grp);
      }
      return 0;
    }
 catch (    Exception e) {
      ss.err.println(String.format("Failed to set permissions/groups on TABLE: <%s> %s",tblName,e.getMessage()));
      try {
        if (null != db) {
          db.dropTable(tblName);
        }
      }
 catch (      HiveException he) {
        ss.err.println(String.format("Failed to drop TABLE <%s> after failing to set permissions/groups on it. %s",tblName,e.getMessage()));
      }
      return 1;
    }
  }
 else {
    if (dbName.isEmpty() || dbName.equals(MetaStoreUtils.DEFAULT_DATABASE_NAME)) {
      return 0;
    }
 else {
      try {
        Hive db=Hive.get();
        Path dbPath=new Warehouse(conf).getDatabasePath(db.getDatabase(dbName));
        FileSystem fs=dbPath.getFileSystem(conf);
        if (perms != null) {
          fs.setPermission(dbPath,perms);
        }
        if (null != grp) {
          fs.setOwner(dbPath,null,grp);
        }
        return 0;
      }
 catch (      Exception e) {
        ss.err.println(String.format("Failed to set permissions and/or group on DB: <%s> %s",dbName,e.getMessage()));
        try {
          Hive.get().dropDatabase(dbName);
        }
 catch (        Exception e1) {
          ss.err.println(String.format("Failed to drop DB <%s> after failing to set permissions/group on it. %s",dbName,e1.getMessage()));
        }
        return 1;
      }
    }
  }
}
