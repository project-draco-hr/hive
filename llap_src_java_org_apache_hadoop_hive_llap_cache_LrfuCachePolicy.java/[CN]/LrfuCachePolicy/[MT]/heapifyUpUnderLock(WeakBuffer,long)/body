{
  int ix=buffer.indexInHeap;
  double priority=buffer.isLockedInHeap ? Double.MAX_VALUE : buffer.priority;
  while (true) {
    if (ix == 0)     break;
    int parentIx=(ix - 1) >>> 1;
    WeakBuffer parent=heap[parentIx];
    double parentPri=getHeapifyPriority(parent,time);
    if (priority >= parentPri)     break;
    heap[ix]=parent;
    parent.indexInHeap=ix;
    ix=parentIx;
  }
  buffer.indexInHeap=ix;
  heap[ix]=buffer;
}
