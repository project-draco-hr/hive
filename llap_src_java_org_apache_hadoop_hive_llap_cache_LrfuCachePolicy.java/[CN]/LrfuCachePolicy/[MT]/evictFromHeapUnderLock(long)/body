{
  if (heapSize == 0)   return null;
  WeakBuffer result=heap[0];
  if (!result.invalidate()) {
    if (DebugUtils.isTraceCachingEnabled()) {
      Llap.LOG.info("Failed to invalidate head " + result.toString() + "; size = "+ heapSize);
    }
    return null;
  }
  if (DebugUtils.isTraceCachingEnabled()) {
    Llap.LOG.info("Evicting " + result + " at "+ time);
  }
  result.indexInHeap=-1;
  --heapSize;
  WeakBuffer newRoot=heap[heapSize];
  newRoot.indexInHeap=0;
  if (newRoot.lastUpdate != time && !newRoot.isLockedInHeap) {
    newRoot.priority=expirePriority(time,newRoot.lastUpdate,newRoot.priority);
    newRoot.lastUpdate=time;
  }
  heapifyDownUnderLock(newRoot,time);
  return result;
}
