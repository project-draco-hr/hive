{
  String connectionClassName=System.getProperty(HiveConf.ConfVars.METASTORE_HBASE_CONNECTION_CLASS.varname);
  boolean testingTephra=connectionClassName != null && connectionClassName.equals(TephraHBaseConnection.class.getName());
  if (testingTephra) {
    LOG.info("Testing with Tephra");
  }
  utility=new HBaseTestingUtility();
  utility.startMiniCluster();
  conf=new HiveConf(utility.getConfiguration(),HBaseIntegrationTests.class);
  admin=utility.getHBaseAdmin();
  for (  String tableName : HBaseReadWrite.tableNames) {
    List<byte[]> families=HBaseReadWrite.columnFamilies.get(tableName);
    HTableDescriptor desc=new HTableDescriptor(TableName.valueOf(tableName));
    for (    byte[] family : families) {
      HColumnDescriptor columnDesc=new HColumnDescriptor(family);
      if (testingTephra)       columnDesc.setMaxVersions(Integer.MAX_VALUE);
      desc.addFamily(columnDesc);
    }
    if (testingTephra)     desc.addCoprocessor(TransactionProcessor.class.getName());
    admin.createTable(desc);
  }
  admin.close();
}
