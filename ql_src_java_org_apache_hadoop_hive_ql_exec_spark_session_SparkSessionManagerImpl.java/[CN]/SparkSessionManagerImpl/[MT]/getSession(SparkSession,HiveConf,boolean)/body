{
  if (!inited) {
    init();
  }
  if (existingSession != null) {
    if (canReuseSession(existingSession,conf)) {
      if (!existingSession.isOpen() && doOpen) {
        existingSession.open(conf);
      }
      Preconditions.checkState(createdSessions.contains(existingSession));
      if (LOG.isDebugEnabled()) {
        LOG.debug(String.format("Existing session (%s) is reused.",existingSession.getSessionId()));
      }
      return existingSession;
    }
 else {
      closeSession(existingSession);
    }
  }
  SparkSession sparkSession=new SparkSessionImpl();
  createdSessions.add(sparkSession);
  if (doOpen) {
    sparkSession.open(conf);
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug(String.format("New session (%s) is created.",sparkSession.getSessionId()));
  }
  return sparkSession;
}
