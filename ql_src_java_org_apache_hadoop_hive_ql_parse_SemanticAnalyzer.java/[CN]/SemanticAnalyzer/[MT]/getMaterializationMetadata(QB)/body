{
  try {
    gatherCTEReferences(qb,rootClause);
    int threshold=HiveConf.getIntVar(conf,HiveConf.ConfVars.HIVE_CTE_MATERIALIZE_THRESHOLD);
    for (    CTEClause cte : Sets.newHashSet(aliasToCTEs.values())) {
      if (threshold >= 0 && cte.reference >= threshold) {
        cte.materialize=true;
      }
    }
  }
 catch (  HiveException e) {
    LOG.error(org.apache.hadoop.util.StringUtils.stringifyException(e));
    if (e instanceof SemanticException) {
      throw (SemanticException)e;
    }
    throw new SemanticException(e.getMessage(),e);
  }
}
