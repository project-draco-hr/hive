{
  RowResolver inputRR=opParseCtx.get(input).getRR();
  ASTNode partitionExprs=qb.getParseInfo().getClusterByForClause(dest);
  if (partitionExprs == null) {
    partitionExprs=qb.getParseInfo().getDistributeByForClause(dest);
  }
  ArrayList<exprNodeDesc> partitionCols=new ArrayList<exprNodeDesc>();
  if (partitionExprs != null) {
    int ccount=partitionExprs.getChildCount();
    for (int i=0; i < ccount; ++i) {
      ASTNode cl=(ASTNode)partitionExprs.getChild(i);
      partitionCols.add(genExprNodeDesc(cl,inputRR));
    }
  }
  ASTNode sortExprs=qb.getParseInfo().getClusterByForClause(dest);
  if (sortExprs == null) {
    sortExprs=qb.getParseInfo().getSortByForClause(dest);
  }
  ArrayList<exprNodeDesc> sortCols=new ArrayList<exprNodeDesc>();
  StringBuilder order=new StringBuilder();
  if (sortExprs != null) {
    int ccount=sortExprs.getChildCount();
    for (int i=0; i < ccount; ++i) {
      ASTNode cl=(ASTNode)sortExprs.getChild(i);
      if (cl.getType() == HiveParser.TOK_TABSORTCOLNAMEASC) {
        order.append("+");
        cl=(ASTNode)cl.getChild(0);
      }
 else       if (cl.getType() == HiveParser.TOK_TABSORTCOLNAMEDESC) {
        order.append("-");
        cl=(ASTNode)cl.getChild(0);
      }
 else {
        order.append("+");
      }
      exprNodeDesc exprNode=genExprNodeDesc(cl,inputRR);
      sortCols.add(exprNode);
    }
  }
  Map<String,exprNodeDesc> colExprMap=new HashMap<String,exprNodeDesc>();
  ArrayList<exprNodeDesc> valueCols=new ArrayList<exprNodeDesc>();
  for (  ColumnInfo colInfo : inputRR.getColumnInfos()) {
    valueCols.add(new exprNodeColumnDesc(colInfo.getType(),colInfo.getInternalName()));
    colExprMap.put(colInfo.getInternalName(),valueCols.get(valueCols.size() - 1));
  }
  Operator interim=putOpInsertMap(OperatorFactory.getAndMakeChild(PlanUtils.getReduceSinkDesc(sortCols,valueCols,-1,partitionCols,order.toString(),numReducers),new RowSchema(inputRR.getColumnInfos()),input),inputRR);
  interim.setColumnExprMap(colExprMap);
  RowResolver out_rwsch=new RowResolver();
  RowResolver interim_rwsch=inputRR;
  Integer pos=Integer.valueOf(0);
  for (  ColumnInfo colInfo : interim_rwsch.getColumnInfos()) {
    String[] info=interim_rwsch.reverseLookup(colInfo.getInternalName());
    out_rwsch.put(info[0],info[1],new ColumnInfo(pos.toString(),colInfo.getType()));
    pos=Integer.valueOf(pos.intValue() + 1);
  }
  Operator output=putOpInsertMap(OperatorFactory.getAndMakeChild(new extractDesc(new exprNodeColumnDesc(String.class,Utilities.ReduceField.VALUE.toString())),new RowSchema(out_rwsch.getColumnInfos()),interim),out_rwsch);
  LOG.debug("Created ReduceSink Plan for clause: " + dest + " row schema: "+ out_rwsch.toString());
  return output;
}
