{
  if (joinCond == null) {
    return;
  }
switch (joinCond.getToken().getType()) {
case HiveParser.KW_OR:
    throw new SemanticException(ErrorMsg.INVALID_JOIN_CONDITION_3.getMsg(joinCond));
case HiveParser.KW_AND:
  parseJoinCondition(joinTree,(ASTNode)joinCond.getChild(0),leftSrc,type);
parseJoinCondition(joinTree,(ASTNode)joinCond.getChild(1),leftSrc,type);
break;
case HiveParser.EQUAL_NS:
case HiveParser.EQUAL:
ASTNode leftCondn=(ASTNode)joinCond.getChild(0);
ArrayList<String> leftCondAl1=new ArrayList<String>();
ArrayList<String> leftCondAl2=new ArrayList<String>();
parseJoinCondPopulateAlias(joinTree,leftCondn,leftCondAl1,leftCondAl2,null);
ASTNode rightCondn=(ASTNode)joinCond.getChild(1);
ArrayList<String> rightCondAl1=new ArrayList<String>();
ArrayList<String> rightCondAl2=new ArrayList<String>();
parseJoinCondPopulateAlias(joinTree,rightCondn,rightCondAl1,rightCondAl2,null);
if (((leftCondAl1.size() != 0) && (leftCondAl2.size() != 0)) || ((rightCondAl1.size() != 0) && (rightCondAl2.size() != 0))) {
throw new SemanticException(ErrorMsg.INVALID_JOIN_CONDITION_1.getMsg(joinCond));
}
if (leftCondAl1.size() != 0) {
if ((rightCondAl1.size() != 0) || ((rightCondAl1.size() == 0) && (rightCondAl2.size() == 0))) {
if (type.equals(JoinType.LEFTOUTER) || type.equals(JoinType.FULLOUTER)) {
if (conf.getBoolVar(HiveConf.ConfVars.HIVEOUTERJOINSUPPORTSFILTERS)) {
joinTree.getFilters().get(0).add(joinCond);
}
 else {
LOG.warn(ErrorMsg.OUTERJOIN_USES_FILTERS);
joinTree.getFiltersForPushing().get(0).add(joinCond);
}
}
 else {
joinTree.getFiltersForPushing().get(0).add(joinCond);
}
}
 else if (rightCondAl2.size() != 0) {
populateAliases(leftCondAl1,leftCondAl2,leftCondn,joinTree,leftSrc);
populateAliases(rightCondAl1,rightCondAl2,rightCondn,joinTree,leftSrc);
boolean nullsafe=joinCond.getToken().getType() == HiveParser.EQUAL_NS;
joinTree.getNullSafes().add(nullsafe);
}
}
 else if (leftCondAl2.size() != 0) {
if ((rightCondAl2.size() != 0) || ((rightCondAl1.size() == 0) && (rightCondAl2.size() == 0))) {
if (type.equals(JoinType.RIGHTOUTER) || type.equals(JoinType.FULLOUTER)) {
if (conf.getBoolVar(HiveConf.ConfVars.HIVEOUTERJOINSUPPORTSFILTERS)) {
joinTree.getFilters().get(1).add(joinCond);
}
 else {
LOG.warn(ErrorMsg.OUTERJOIN_USES_FILTERS);
joinTree.getFiltersForPushing().get(1).add(joinCond);
}
}
 else {
joinTree.getFiltersForPushing().get(1).add(joinCond);
}
}
 else if (rightCondAl1.size() != 0) {
populateAliases(leftCondAl1,leftCondAl2,leftCondn,joinTree,leftSrc);
populateAliases(rightCondAl1,rightCondAl2,rightCondn,joinTree,leftSrc);
boolean nullsafe=joinCond.getToken().getType() == HiveParser.EQUAL_NS;
joinTree.getNullSafes().add(nullsafe);
}
}
 else if (rightCondAl1.size() != 0) {
if (type.equals(JoinType.LEFTOUTER) || type.equals(JoinType.FULLOUTER)) {
if (conf.getBoolVar(HiveConf.ConfVars.HIVEOUTERJOINSUPPORTSFILTERS)) {
joinTree.getFilters().get(0).add(joinCond);
}
 else {
LOG.warn(ErrorMsg.OUTERJOIN_USES_FILTERS);
joinTree.getFiltersForPushing().get(0).add(joinCond);
}
}
 else {
joinTree.getFiltersForPushing().get(0).add(joinCond);
}
}
 else {
if (type.equals(JoinType.RIGHTOUTER) || type.equals(JoinType.FULLOUTER)) {
if (conf.getBoolVar(HiveConf.ConfVars.HIVEOUTERJOINSUPPORTSFILTERS)) {
joinTree.getFilters().get(1).add(joinCond);
}
 else {
LOG.warn(ErrorMsg.OUTERJOIN_USES_FILTERS);
joinTree.getFiltersForPushing().get(1).add(joinCond);
}
}
 else {
joinTree.getFiltersForPushing().get(1).add(joinCond);
}
}
break;
default :
boolean isFunction=(joinCond.getType() == HiveParser.TOK_FUNCTION);
int childrenBegin=(isFunction ? 1 : 0);
ArrayList<ArrayList<String>> leftAlias=new ArrayList<ArrayList<String>>(joinCond.getChildCount() - childrenBegin);
ArrayList<ArrayList<String>> rightAlias=new ArrayList<ArrayList<String>>(joinCond.getChildCount() - childrenBegin);
for (int ci=0; ci < joinCond.getChildCount() - childrenBegin; ci++) {
ArrayList<String> left=new ArrayList<String>();
ArrayList<String> right=new ArrayList<String>();
leftAlias.add(left);
rightAlias.add(right);
}
for (int ci=childrenBegin; ci < joinCond.getChildCount(); ci++) {
parseJoinCondPopulateAlias(joinTree,(ASTNode)joinCond.getChild(ci),leftAlias.get(ci - childrenBegin),rightAlias.get(ci - childrenBegin),null);
}
boolean leftAliasNull=true;
for (ArrayList<String> left : leftAlias) {
if (left.size() != 0) {
leftAliasNull=false;
break;
}
}
boolean rightAliasNull=true;
for (ArrayList<String> right : rightAlias) {
if (right.size() != 0) {
rightAliasNull=false;
break;
}
}
if (!leftAliasNull && !rightAliasNull) {
throw new SemanticException(ErrorMsg.INVALID_JOIN_CONDITION_1.getMsg(joinCond));
}
if (!leftAliasNull) {
if (type.equals(JoinType.LEFTOUTER) || type.equals(JoinType.FULLOUTER)) {
if (conf.getBoolVar(HiveConf.ConfVars.HIVEOUTERJOINSUPPORTSFILTERS)) {
joinTree.getFilters().get(0).add(joinCond);
}
 else {
LOG.warn(ErrorMsg.OUTERJOIN_USES_FILTERS);
joinTree.getFiltersForPushing().get(0).add(joinCond);
}
}
 else {
joinTree.getFiltersForPushing().get(0).add(joinCond);
}
}
 else {
if (type.equals(JoinType.RIGHTOUTER) || type.equals(JoinType.FULLOUTER)) {
if (conf.getBoolVar(HiveConf.ConfVars.HIVEOUTERJOINSUPPORTSFILTERS)) {
joinTree.getFilters().get(1).add(joinCond);
}
 else {
LOG.warn(ErrorMsg.OUTERJOIN_USES_FILTERS);
joinTree.getFiltersForPushing().get(1).add(joinCond);
}
}
 else {
joinTree.getFiltersForPushing().get(1).add(joinCond);
}
}
break;
}
}
