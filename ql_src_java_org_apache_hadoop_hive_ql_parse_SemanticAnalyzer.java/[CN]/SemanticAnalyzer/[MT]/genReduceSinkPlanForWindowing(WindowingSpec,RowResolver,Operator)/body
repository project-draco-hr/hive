{
  ArrayList<ExprNodeDesc> partCols=new ArrayList<ExprNodeDesc>();
  ArrayList<ExprNodeDesc> orderCols=new ArrayList<ExprNodeDesc>();
  StringBuilder order=new StringBuilder();
  for (  PartitionExpression partCol : spec.getQueryPartitionSpec().getExpressions()) {
    ExprNodeDesc partExpr=genExprNodeDesc(partCol.getExpression(),inputRR);
    if (ExprNodeDescUtils.indexOf(partExpr,partCols) < 0) {
      partCols.add(partExpr);
      orderCols.add(partExpr);
      order.append('+');
    }
  }
  if (spec.getQueryOrderSpec() != null) {
    for (    OrderExpression orderCol : spec.getQueryOrderSpec().getExpressions()) {
      ExprNodeDesc orderExpr=genExprNodeDesc(orderCol.getExpression(),inputRR);
      char orderChar=orderCol.getOrder() == PTFInvocationSpec.Order.ASC ? '+' : '-';
      int index=ExprNodeDescUtils.indexOf(orderExpr,orderCols);
      if (index >= 0) {
        order.setCharAt(index,orderChar);
        continue;
      }
      orderCols.add(genExprNodeDesc(orderCol.getExpression(),inputRR));
      order.append(orderChar);
    }
  }
  return genReduceSinkPlan(input,partCols,orderCols,order.toString(),-1,Operation.NOT_ACID);
}
