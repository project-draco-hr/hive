{
  ASTNode child=ast;
  this.ast=ast;
  viewsExpanded=new ArrayList<String>();
  LOG.info("Starting Semantic Analysis");
  processPositionAlias(ast);
  if (ast.getToken().getType() == HiveParser.TOK_CREATETABLE) {
    if ((child=analyzeCreateTable(ast,qb)) == null) {
      return;
    }
  }
 else {
    SessionState.get().setCommandType(HiveOperation.QUERY);
  }
  if (ast.getToken().getType() == HiveParser.TOK_CREATEVIEW || ast.getToken().getType() == HiveParser.TOK_ALTERVIEW_AS) {
    child=analyzeCreateView(ast,qb);
    SessionState.get().setCommandType(HiveOperation.CREATEVIEW);
    if (child == null) {
      return;
    }
    viewSelect=child;
    viewsExpanded.add(db.getCurrentDatabase() + "." + createVwDesc.getViewName());
  }
  if (!doPhase1(child,qb,initPhase1Ctx())) {
    return;
  }
  LOG.info("Completed phase 1 of Semantic Analysis");
  getMetaData(qb);
  LOG.info("Completed getting MetaData in Semantic Analysis");
  Operator sinkOp=genPlan(qb);
  resultSchema=convertRowSchemaToViewSchema(opParseCtx.get(sinkOp).getRowResolver());
  if (createVwDesc != null) {
    saveViewDefinition();
    validateCreateView(createVwDesc);
    ctx.setResDir(null);
    ctx.setResFile(null);
    return;
  }
  ParseContext pCtx=new ParseContext(conf,qb,child,opToPartPruner,opToPartList,topOps,topSelOps,opParseCtx,joinContext,smbMapJoinContext,topToTable,loadTableWork,loadFileWork,ctx,idToTableNameMap,destTableId,uCtx,listMapJoinOpsNoReducer,groupOpToInputTables,prunedPartitions,opToSamplePruner,globalLimitCtx,nameToSplitSample,inputs,rootTasks,opToPartToSkewedPruner,viewAliasToInput);
  if (HiveConf.getBoolVar(this.conf,HiveConf.ConfVars.HIVE_STATS_COLLECT_TABLEKEYS) == true) {
    TableAccessAnalyzer tableAccessAnalyzer=new TableAccessAnalyzer(pCtx);
    setTableAccessInfo(tableAccessAnalyzer.analyzeTableAccess());
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("\n" + Operator.toString(pCtx.getTopOps().values()));
  }
  Optimizer optm=new Optimizer();
  optm.setPctx(pCtx);
  optm.initialize(conf);
  pCtx=optm.optimize();
  if (LOG.isDebugEnabled()) {
    LOG.debug("\n" + Operator.toString(pCtx.getTopOps().values()));
  }
  if (HiveConf.getBoolVar(this.conf,HiveConf.ConfVars.HIVE_STATS_COLLECT_SCANCOLS) == true) {
    ColumnAccessAnalyzer columnAccessAnalyzer=new ColumnAccessAnalyzer(pCtx);
    setColumnAccessInfo(columnAccessAnalyzer.analyzeColumnAccess());
  }
  genMapRedTasks(pCtx);
  LOG.info("Completed plan generation");
  return;
}
