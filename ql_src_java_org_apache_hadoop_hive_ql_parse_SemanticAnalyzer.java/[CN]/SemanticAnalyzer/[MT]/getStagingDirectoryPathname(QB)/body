{
  Path stagingPath=null, tablePath;
  tablePath=getStrongestEncryptedTablePath(qb);
  if (tablePath != null && isPathEncrypted(tablePath)) {
    if ("hdfs".equals(tablePath.toUri().getScheme())) {
      if (isPathReadOnly(tablePath)) {
        Path tmpPath=ctx.getMRTmpPath();
        if (comparePathKeyStrength(tablePath,tmpPath) < 0) {
          throw new HiveException("Read-only encrypted tables cannot be read " + "if the scratch directory is not encrypted (or encryption is weak)");
        }
 else {
          stagingPath=tmpPath;
        }
      }
    }
 else {
      LOG.debug("Encryption is not applicable to table path " + tablePath.toString());
    }
    if (stagingPath == null) {
      stagingPath=ctx.getMRTmpPath(tablePath.toUri());
    }
  }
 else {
    stagingPath=ctx.getMRTmpPath();
  }
  return stagingPath;
}
