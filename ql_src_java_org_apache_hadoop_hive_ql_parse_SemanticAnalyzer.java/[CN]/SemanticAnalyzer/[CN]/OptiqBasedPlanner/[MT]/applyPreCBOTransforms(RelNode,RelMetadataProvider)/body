{
  HepProgramBuilder programBuilder=new HepProgramBuilder();
  programBuilder.addRuleInstance(HivePushFilterPastJoinRule.FILTER_ON_JOIN);
  programBuilder.addRuleInstance(HivePushFilterPastJoinRule.JOIN);
  HepPlanner planner=new HepPlanner(programBuilder.build());
  List<RelMetadataProvider> list=Lists.newArrayList();
  list.add(mdProvider);
  planner.registerMetadataProviders(list);
  RelMetadataProvider chainedProvider=ChainedRelMetadataProvider.of(list);
  basePlan.getCluster().setMetadataProvider(new CachingRelMetadataProvider(chainedProvider,planner));
  planner.setRoot(basePlan);
  basePlan=planner.findBestExp();
  HiveRelFieldTrimmer fieldTrimmer=new HiveRelFieldTrimmer(null);
  basePlan=fieldTrimmer.trim(basePlan);
  return basePlan;
}
