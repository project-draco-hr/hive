{
  RowResolver gbInputRR=this.relToHiveRR.get(srcRel);
  ImmutableMap<String,Integer> posMap=this.relToHiveColNameCalcitePosMap.get(srcRel);
  RexNodeConverter converter=new RexNodeConverter(this.cluster,srcRel.getRowType(),posMap,0,false);
  final List<RexNode> gbChildProjLst=Lists.newArrayList();
  final HashMap<String,Integer> rexNodeToPosMap=new HashMap<String,Integer>();
  final List<Integer> groupSetPositions=Lists.newArrayList();
  Integer gbIndx=0;
  RexNode rnd;
  for (  ExprNodeDesc key : gbExprs) {
    rnd=converter.convert(key);
    gbChildProjLst.add(rnd);
    groupSetPositions.add(gbIndx);
    rexNodeToPosMap.put(rnd.toString(),gbIndx);
    gbIndx++;
  }
  final ImmutableBitSet groupSet=ImmutableBitSet.of(groupSetPositions);
  List<AggregateCall> aggregateCalls=Lists.newArrayList();
  int i=aggInfoLst.size();
  for (  AggInfo agg : aggInfoLst) {
    aggregateCalls.add(convertGBAgg(agg,srcRel,gbChildProjLst,converter,rexNodeToPosMap,gbChildProjLst.size()));
  }
  if (gbChildProjLst.isEmpty()) {
    gbChildProjLst.add(this.cluster.getRexBuilder().makeInputRef(srcRel,0));
  }
  RelNode gbInputRel=HiveProject.create(srcRel,gbChildProjLst,null);
  HiveRelNode aggregateRel=null;
  try {
    aggregateRel=new HiveAggregate(cluster,cluster.traitSetOf(HiveRelNode.CONVENTION),gbInputRel,false,groupSet,null,aggregateCalls);
  }
 catch (  InvalidRelException e) {
    throw new SemanticException(e);
  }
  return aggregateRel;
}
