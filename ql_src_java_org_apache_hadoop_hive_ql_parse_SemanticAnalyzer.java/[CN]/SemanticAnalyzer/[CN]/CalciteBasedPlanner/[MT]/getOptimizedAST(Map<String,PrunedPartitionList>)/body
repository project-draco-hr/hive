{
  ASTNode calciteOptimizedAST=null;
  RelNode optimizedCalcitePlan=null;
  this.partitionCache=partitionCache;
  try {
    optimizedCalcitePlan=Frameworks.withPlanner(this,Frameworks.newConfigBuilder().typeSystem(new HiveTypeSystemImpl()).build());
  }
 catch (  Exception e) {
    rethrowCalciteException(e);
    throw new AssertionError("rethrowCalciteException didn't throw for " + e.getMessage());
  }
  calciteOptimizedAST=ASTConverter.convert(optimizedCalcitePlan,topLevelFieldSchema);
  return calciteOptimizedAST;
}
