{
  if (hadoopVersion == null) {
    System.out.println("detecting hadoop.version from loaded libs");
    try {
      String hadoopPropsLoc="/META-INF/maven/org.apache.hadoop/hadoop-hdfs/pom.properties";
      URL hadoopPropsURL=getClass().getResource(hadoopPropsLoc);
      if (hadoopPropsURL == null) {
        throw new RuntimeException("failed to get hadoop properties: " + hadoopPropsLoc);
      }
      try (InputStream is=hadoopPropsURL.openStream()){
        Properties props=new Properties();
        props.load(is);
        hadoopVersion=props.getProperty("version");
        if (hadoopVersion == null) {
          throw new RuntimeException("version property not found");
        }
      }
 catch (      IOException e) {
        throw new RuntimeException("unable to extract hadoop.version from: " + hadoopPropsURL,e);
      }
    }
 catch (    Exception e) {
      throw new RuntimeException("can't get hadoop.version ; specify manually using hadoop.version property!");
    }
  }
  return hadoopVersion;
}
