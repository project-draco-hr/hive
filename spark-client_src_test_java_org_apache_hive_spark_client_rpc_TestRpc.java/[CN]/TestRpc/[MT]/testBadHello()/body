{
  RpcServer server=autoClose(new RpcServer(emptyConfig));
  Future<Rpc> serverRpcFuture=server.registerClient("client","newClient",new TestDispatcher());
  NioEventLoopGroup eloop=new NioEventLoopGroup();
  Future<Rpc> clientRpcFuture=Rpc.createClient(emptyConfig,eloop,"localhost",server.getPort(),"client","wrongClient",new TestDispatcher());
  try {
    autoClose(clientRpcFuture.get(10,TimeUnit.SECONDS));
    fail("Should have failed to create client with wrong secret.");
  }
 catch (  ExecutionException ee) {
    assertTrue("Unexpected exception: " + ee.getCause(),ee.getCause() instanceof SaslException);
  }
  serverRpcFuture.cancel(true);
}
