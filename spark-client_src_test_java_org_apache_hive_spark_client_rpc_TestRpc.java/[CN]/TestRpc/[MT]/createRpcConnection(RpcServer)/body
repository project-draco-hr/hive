{
  String secret=server.createSecret();
  Future<Rpc> serverRpcFuture=server.registerClient(secret,new TestDispatcher());
  NioEventLoopGroup eloop=new NioEventLoopGroup();
  Future<Rpc> clientRpcFuture=Rpc.createClient(emptyConfig,eloop,"localhost",server.getPort(),secret,new TestDispatcher());
  Rpc serverRpc=autoClose(serverRpcFuture.get(10,TimeUnit.SECONDS));
  Rpc clientRpc=autoClose(clientRpcFuture.get(10,TimeUnit.SECONDS));
  return new Rpc[]{serverRpc,clientRpc};
}
