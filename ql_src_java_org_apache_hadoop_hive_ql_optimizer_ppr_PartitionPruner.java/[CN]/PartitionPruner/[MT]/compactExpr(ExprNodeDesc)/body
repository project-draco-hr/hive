{
  if (expr == null) {
    return null;
  }
  if (expr instanceof ExprNodeConstantDesc) {
    if (isBooleanExpr(expr)) {
      return expr;
    }
 else {
      throw new IllegalStateException("Unexpected non-null ExprNodeConstantDesc: " + expr.getExprString());
    }
  }
 else   if (expr instanceof ExprNodeGenericFuncDesc) {
    GenericUDF udf=((ExprNodeGenericFuncDesc)expr).getGenericUDF();
    boolean isAnd=udf instanceof GenericUDFOPAnd;
    boolean isOr=udf instanceof GenericUDFOPOr;
    if (isAnd || isOr) {
      List<ExprNodeDesc> children=expr.getChildren();
      ExprNodeDesc left=children.get(0);
      children.set(0,compactExpr(left));
      ExprNodeDesc right=children.get(1);
      children.set(1,compactExpr(right));
      if (isTrueExpr(children.get(0)) && isTrueExpr(children.get(1))) {
        return new ExprNodeConstantDesc(Boolean.TRUE);
      }
 else       if (isTrueExpr(children.get(0))) {
        return isAnd ? children.get(1) : new ExprNodeConstantDesc(Boolean.TRUE);
      }
 else       if (isTrueExpr(children.get(1))) {
        return isAnd ? children.get(0) : new ExprNodeConstantDesc(Boolean.TRUE);
      }
 else       if (isFalseExpr(children.get(0)) && isFalseExpr(children.get(1))) {
        return new ExprNodeConstantDesc(Boolean.FALSE);
      }
 else       if (isFalseExpr(children.get(0))) {
        return isAnd ? new ExprNodeConstantDesc(Boolean.FALSE) : children.get(1);
      }
 else       if (isFalseExpr(children.get(1))) {
        return isAnd ? new ExprNodeConstantDesc(Boolean.FALSE) : children.get(0);
      }
    }
    return expr;
  }
 else {
    throw new IllegalStateException("Unexpected type of ExprNodeDesc: " + expr.getExprString());
  }
}
