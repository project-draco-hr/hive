{
  if (expr instanceof ExprNodeConstantDesc) {
    if (((ExprNodeConstantDesc)expr).getValue() == null) {
      return null;
    }
 else {
      throw new IllegalStateException("Unexpected non-null ExprNodeConstantDesc: " + expr.getExprString());
    }
  }
 else   if (expr instanceof ExprNodeGenericFuncDesc) {
    GenericUDF udf=((ExprNodeGenericFuncDesc)expr).getGenericUDF();
    boolean isAnd=udf instanceof GenericUDFOPAnd;
    if (isAnd || udf instanceof GenericUDFOPOr) {
      List<ExprNodeDesc> children=expr.getChildren();
      ExprNodeDesc left=children.get(0);
      children.set(0,compactExpr(left));
      ExprNodeDesc right=children.get(1);
      children.set(1,compactExpr(right));
      if (children.get(0) == null && children.get(1) == null) {
        return null;
      }
 else       if (children.get(0) == null) {
        return isAnd ? children.get(1) : null;
      }
 else       if (children.get(1) == null) {
        return isAnd ? children.get(0) : null;
      }
    }
    return (ExprNodeGenericFuncDesc)expr;
  }
 else {
    throw new IllegalStateException("Unexpected type of ExprNodeDesc: " + expr.getExprString());
  }
}
