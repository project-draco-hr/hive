{
  Map<PrimitiveObjectInspector,ExprNodeEvaluator> handle=PartExprEvalUtils.prepareExpr(prunerExpr,columnNames,vcs);
  List<String> values=new ArrayList<String>(columnNames.size());
  Object evalArg=values;
  boolean hasVC=vcs != null && !vcs.isEmpty();
  if (hasVC) {
    Object[] objectWithPart=new Object[2];
    objectWithPart[0]=values;
    evalArg=objectWithPart;
  }
  boolean hasUnknownPartitions=false;
  Iterator<String> partIter=partNames.iterator();
  while (partIter.hasNext()) {
    String partName=partIter.next();
    LinkedHashMap<String,String> partSpec=Warehouse.makeSpecFromName(partName);
    values.clear();
    values.addAll(partSpec.values());
    Boolean isNeeded=(Boolean)PartExprEvalUtils.evaluateExprOnPart(handle,evalArg);
    boolean isUnknown=(isNeeded == null);
    if (!isUnknown && !isNeeded) {
      partIter.remove();
      continue;
    }
    if (isUnknown && values.contains(defaultPartitionName)) {
      LOG.debug("skipping default/bad partition: " + partName);
      partIter.remove();
      continue;
    }
    hasUnknownPartitions|=isUnknown;
    LOG.debug("retained " + (isUnknown ? "unknown " : "") + "partition: "+ partName);
  }
  return hasUnknownPartitions;
}
