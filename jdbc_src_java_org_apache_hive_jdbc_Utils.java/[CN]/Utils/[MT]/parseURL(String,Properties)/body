{
  JdbcConnectionParams connParams=new JdbcConnectionParams();
  if (!uri.startsWith(URL_PREFIX)) {
    throw new JdbcUriParseException("Bad URL format: Missing prefix " + URL_PREFIX);
  }
  if (uri.equalsIgnoreCase(URL_PREFIX)) {
    connParams.setEmbeddedMode(true);
    return connParams;
  }
  String dummyAuthorityString="dummyhost:00000";
  String suppliedAuthorities=getAuthorities(uri,connParams);
  if ((suppliedAuthorities == null) || (suppliedAuthorities.isEmpty())) {
    connParams.setEmbeddedMode(true);
  }
 else {
    LOG.info("Supplied authorities: " + suppliedAuthorities);
    String[] authorityList=suppliedAuthorities.split(",");
    connParams.setSuppliedAuthorityList(authorityList);
    uri=uri.replace(suppliedAuthorities,dummyAuthorityString);
  }
  URI jdbcURI=URI.create(uri.substring(URI_JDBC_PREFIX.length()));
  Pattern pattern=Pattern.compile("([^;]*)=([^;]*)[;]?");
  String sessVars=jdbcURI.getPath();
  if ((sessVars != null) && !sessVars.isEmpty()) {
    String dbName="";
    sessVars=sessVars.substring(1);
    if (!sessVars.contains(";")) {
      dbName=sessVars;
    }
 else {
      dbName=sessVars.substring(0,sessVars.indexOf(';'));
      sessVars=sessVars.substring(sessVars.indexOf(';') + 1);
      if (sessVars != null) {
        Matcher sessMatcher=pattern.matcher(sessVars);
        while (sessMatcher.find()) {
          if (connParams.getSessionVars().put(sessMatcher.group(1),sessMatcher.group(2)) != null) {
            throw new JdbcUriParseException("Bad URL format: Multiple values for property " + sessMatcher.group(1));
          }
        }
      }
    }
    if (!dbName.isEmpty()) {
      connParams.setDbName(dbName);
    }
  }
  String confStr=jdbcURI.getQuery();
  if (confStr != null) {
    Matcher confMatcher=pattern.matcher(confStr);
    while (confMatcher.find()) {
      connParams.getHiveConfs().put(confMatcher.group(1),confMatcher.group(2));
    }
  }
  String varStr=jdbcURI.getFragment();
  if (varStr != null) {
    Matcher varMatcher=pattern.matcher(varStr);
    while (varMatcher.find()) {
      connParams.getHiveVars().put(varMatcher.group(1),varMatcher.group(2));
    }
  }
  for (  Map.Entry<Object,Object> kv : info.entrySet()) {
    if ((kv.getKey() instanceof String)) {
      String key=(String)kv.getKey();
      if (key.startsWith(JdbcConnectionParams.HIVE_VAR_PREFIX)) {
        connParams.getHiveVars().put(key.substring(JdbcConnectionParams.HIVE_VAR_PREFIX.length()),info.getProperty(key));
      }
 else       if (key.startsWith(JdbcConnectionParams.HIVE_CONF_PREFIX)) {
        connParams.getHiveConfs().put(key.substring(JdbcConnectionParams.HIVE_CONF_PREFIX.length()),info.getProperty(key));
      }
    }
  }
  if (info.containsKey(JdbcConnectionParams.AUTH_USER)) {
    connParams.getSessionVars().put(JdbcConnectionParams.AUTH_USER,info.getProperty(JdbcConnectionParams.AUTH_USER));
    if (info.containsKey(JdbcConnectionParams.AUTH_PASSWD)) {
      connParams.getSessionVars().put(JdbcConnectionParams.AUTH_PASSWD,info.getProperty(JdbcConnectionParams.AUTH_PASSWD));
    }
  }
  if (info.containsKey(JdbcConnectionParams.AUTH_TYPE)) {
    connParams.getSessionVars().put(JdbcConnectionParams.AUTH_TYPE,info.getProperty(JdbcConnectionParams.AUTH_TYPE));
  }
  String newUsage;
  String usageUrlBase="jdbc:hive2://<host>:<port>/dbName;";
  newUsage=usageUrlBase + JdbcConnectionParams.AUTH_QOP + "=<qop_value>";
  handleParamDeprecation(connParams.getSessionVars(),connParams.getSessionVars(),JdbcConnectionParams.AUTH_QOP_DEPRECATED,JdbcConnectionParams.AUTH_QOP,newUsage);
  newUsage=usageUrlBase + JdbcConnectionParams.TRANSPORT_MODE + "=<transport_mode_value>";
  handleParamDeprecation(connParams.getHiveConfs(),connParams.getSessionVars(),JdbcConnectionParams.TRANSPORT_MODE_DEPRECATED,JdbcConnectionParams.TRANSPORT_MODE,newUsage);
  newUsage=usageUrlBase + JdbcConnectionParams.HTTP_PATH + "=<http_path_value>";
  handleParamDeprecation(connParams.getHiveConfs(),connParams.getSessionVars(),JdbcConnectionParams.HTTP_PATH_DEPRECATED,JdbcConnectionParams.HTTP_PATH,newUsage);
  if (connParams.isEmbeddedMode()) {
    connParams.setHost(jdbcURI.getHost());
    connParams.setPort(jdbcURI.getPort());
  }
 else {
    configureConnParams(connParams);
    String authorityStr=connParams.getHost() + ":" + connParams.getPort();
    LOG.info("Resolved authority: " + authorityStr);
    uri=uri.replace(dummyAuthorityString,authorityStr);
    connParams.setJdbcUriString(uri);
  }
  return connParams;
}
