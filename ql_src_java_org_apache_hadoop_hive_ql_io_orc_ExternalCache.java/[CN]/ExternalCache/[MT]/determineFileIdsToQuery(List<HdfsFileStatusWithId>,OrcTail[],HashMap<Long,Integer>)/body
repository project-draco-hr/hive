{
  for (int i=0; i < result.length; ++i) {
    if (result[i] != null)     continue;
    HdfsFileStatusWithId file=files.get(i);
    final FileStatus fs=file.getFileStatus();
    Long fileId=file.getFileId();
    if (fileId == null) {
      if (!isInTest) {
        if (!isWarnLogged || isDebugEnabled) {
          LOG.warn("Not using metastore cache because fileId is missing: " + fs.getPath());
          isWarnLogged=true;
        }
        continue;
      }
      fileId=generateTestFileId(fs,files,i);
      LOG.info("Generated file ID " + fileId + " at "+ i);
    }
    posMap.put(fileId,i);
  }
  return Lists.newArrayList(posMap.keySet());
}
