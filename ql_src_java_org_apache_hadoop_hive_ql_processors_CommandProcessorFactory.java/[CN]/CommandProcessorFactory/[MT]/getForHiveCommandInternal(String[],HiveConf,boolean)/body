{
  HiveCommand hiveCommand=HiveCommand.find(cmd,testOnly);
  if (hiveCommand == null || isBlank(cmd[0])) {
    return null;
  }
  if (conf == null) {
    conf=new HiveConf();
  }
  Set<String> availableCommands=new HashSet<String>();
  for (  String availableCommand : conf.getVar(HiveConf.ConfVars.HIVE_SECURITY_COMMAND_WHITELIST).split(",")) {
    availableCommands.add(availableCommand.toLowerCase().trim());
  }
  if (!availableCommands.contains(cmd[0].trim().toLowerCase())) {
    throw new SQLException("Insufficient privileges to execute " + cmd[0],"42000");
  }
switch (hiveCommand) {
case SET:
    return new SetProcessor();
case RESET:
  return new ResetProcessor();
case DFS:
SessionState ss=SessionState.get();
return new DfsProcessor(ss.getConf());
case ADD:
return new AddResourceProcessor();
case LIST:
return new ListResourceProcessor();
case DELETE:
return new DeleteResourceProcessor();
case COMPILE:
return new CompileProcessor();
case RELOAD:
return new ReloadProcessor();
case CRYPTO:
try {
return new CryptoProcessor(SessionState.get().getHdfsEncryptionShim(),conf);
}
 catch (HiveException e) {
throw new SQLException("Fail to start the command processor due to the exception: ",e);
}
default :
throw new AssertionError("Unknown HiveCommand " + hiveCommand);
}
}
