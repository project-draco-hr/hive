{
  try {
    if (dynamicPartitioningUsed) {
      discoverPartitions(context);
    }
    org.apache.hadoop.mapred.JobContext mapRedJobContext=HCatMapRedUtil.createJobContext(context);
    if (getBaseOutputCommitter() != null && !dynamicPartitioningUsed) {
      getBaseOutputCommitter().abortJob(mapRedJobContext,state);
    }
 else     if (dynamicPartitioningUsed) {
      for (      JobContext currContext : contextDiscoveredByPath.values()) {
        try {
          new JobConf(currContext.getConfiguration()).getOutputCommitter().abortJob(currContext,state);
        }
 catch (        Exception e) {
          throw new IOException(e);
        }
      }
    }
    Path src;
    OutputJobInfo jobInfo=HCatOutputFormat.getJobInfo(context);
    if (dynamicPartitioningUsed) {
      src=new Path(getPartitionRootLocation(jobInfo.getLocation(),jobInfo.getTableInfo().getTable().getPartitionKeysSize()));
    }
 else {
      src=new Path(jobInfo.getLocation());
    }
    FileSystem fs=src.getFileSystem(context.getConfiguration());
    LOG.info("Job failed. Cleaning up temporary directory [{}].",src);
    fs.delete(src,true);
  }
  finally {
    cancelDelegationTokens(context);
  }
}
