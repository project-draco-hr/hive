{
  final Path finalOutputPath=getFinalPath(file,srcDir,destDir);
  if (fs.isFile(file)) {
    if (dryRun) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Testing if moving file: [" + file + "] to ["+ finalOutputPath+ "] would cause a problem");
      }
      if (fs.exists(finalOutputPath)) {
        throw new HCatException(ErrorType.ERROR_MOVE_FAILED,"Data already exists in " + finalOutputPath + ", duplicate publish not possible.");
      }
    }
 else {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Moving file: [ " + file + "] to ["+ finalOutputPath+ "]");
      }
      if (!fs.rename(file,finalOutputPath)) {
        if (!fs.delete(finalOutputPath,true)) {
          throw new HCatException(ErrorType.ERROR_MOVE_FAILED,"Failed to delete existing path " + finalOutputPath);
        }
        if (!fs.rename(file,finalOutputPath)) {
          throw new HCatException(ErrorType.ERROR_MOVE_FAILED,"Failed to move output to " + finalOutputPath);
        }
      }
    }
  }
 else   if (fs.getFileStatus(file).isDir()) {
    FileStatus[] children=fs.listStatus(file);
    if (children != null && children.length > 0) {
      FileStatus firstChild=children[0];
      if (firstChild.isDir()) {
        for (        FileStatus child : children) {
          moveTaskOutputs(fs,child.getPath(),srcDir,destDir,dryRun);
        }
      }
 else {
        if (!dryRun) {
          if (dynamicPartitioningUsed) {
            final Path parentDir=finalOutputPath.getParent();
            fs.mkdirs(parentDir);
            if (LOG.isDebugEnabled()) {
              LOG.debug("Moving directory: " + file + " to "+ parentDir);
            }
            if (!fs.rename(file,parentDir)) {
              final String msg="Failed to move file: " + file + " to "+ parentDir;
              LOG.error(msg);
              throw new HCatException(ErrorType.ERROR_MOVE_FAILED,msg);
            }
          }
 else {
            for (            FileStatus child : children) {
              moveTaskOutputs(fs,child.getPath(),srcDir,destDir,dryRun);
            }
          }
        }
 else {
          if (fs.exists(finalOutputPath)) {
            throw new HCatException(ErrorType.ERROR_MOVE_FAILED,"Data already exists in " + finalOutputPath + ", duplicate publish not possible.");
          }
        }
      }
    }
  }
 else {
    final String msg="Unknown file type being asked to be moved, erroring out";
    throw new HCatException(ErrorType.ERROR_MOVE_FAILED,msg);
  }
}
