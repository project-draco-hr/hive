{
  String userName=getUserName(req);
  SessionHandle sessionHandle=null;
  if (cliService.getHiveConf().getVar(ConfVars.HIVE_SERVER2_AUTHENTICATION).equals(HiveAuthFactory.AuthTypes.KERBEROS.toString()) && cliService.getHiveConf().getBoolVar(ConfVars.HIVE_SERVER2_ENABLE_DOAS)) {
    String delegationTokenStr=null;
    try {
      delegationTokenStr=cliService.getDelegationTokenFromMetaStore(userName);
    }
 catch (    UnsupportedOperationException e) {
    }
    sessionHandle=cliService.openSessionWithImpersonation(userName,req.getPassword(),req.getConfiguration(),delegationTokenStr);
  }
 else {
    sessionHandle=cliService.openSession(userName,req.getPassword(),req.getConfiguration());
  }
  return sessionHandle;
}
