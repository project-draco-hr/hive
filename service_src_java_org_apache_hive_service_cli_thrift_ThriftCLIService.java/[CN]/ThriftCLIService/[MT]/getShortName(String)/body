{
  String ret=null;
  if (userName != null) {
    if (hiveAuthFactory != null && hiveAuthFactory.isSASLKerberosUser()) {
      KerberosNameShim fullKerberosName=ShimLoader.getHadoopShims().getKerberosNameShim(userName);
      ret=fullKerberosName.getShortName();
    }
 else {
      int indexOfDomainMatch=ServiceUtils.indexOfDomainMatch(userName);
      ret=(indexOfDomainMatch <= 0) ? userName : userName.substring(0,indexOfDomainMatch);
    }
  }
  return ret;
}
