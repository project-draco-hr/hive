{
  LOG.info("Client protocol version: " + req.getClient_protocol());
  TOpenSessionResp resp=new TOpenSessionResp();
  try {
    SessionHandle sessionHandle=getSessionHandle(req,resp);
    resp.setSessionHandle(sessionHandle.toTSessionHandle());
    resp.setConfiguration(new HashMap<String,String>());
    resp.setStatus(OK_STATUS);
    ThriftCLIServerContext context=(ThriftCLIServerContext)currentServerContext.get();
    if (context != null) {
      context.setSessionHandle(sessionHandle);
    }
    LOG.info("Opened a session, current sessions: " + sessionCount.incrementAndGet());
  }
 catch (  Exception e) {
    LOG.warn("Error opening session: ",e);
    resp.setStatus(HiveSQLException.toTStatus(e));
  }
  return resp;
}
