{
  String userName;
  if (hiveAuthFactory != null && hiveAuthFactory.getRemoteUser() != null) {
    userName=hiveAuthFactory.getRemoteUser();
  }
 else {
    userName=SessionManager.getUserName();
  }
  if (userName == null) {
    userName=req.getUsername();
  }
  return getProxyUser(userName,req.getConfiguration(),getIpAddress());
}
