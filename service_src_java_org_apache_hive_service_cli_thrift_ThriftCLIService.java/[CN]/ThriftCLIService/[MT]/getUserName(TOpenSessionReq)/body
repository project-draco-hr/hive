{
  String userName=null;
  if (hiveAuthFactory != null) {
    userName=hiveAuthFactory.getRemoteUser();
  }
  if (userName == null) {
    userName=TSetIpAddressProcessor.getUserName();
  }
  if (userName == null) {
    userName=req.getUsername();
  }
  return getProxyUser(userName,req.getConfiguration(),getIpAddress());
}
