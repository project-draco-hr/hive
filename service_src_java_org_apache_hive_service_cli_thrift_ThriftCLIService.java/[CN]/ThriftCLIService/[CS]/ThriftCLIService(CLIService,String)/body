{
  super(serviceName);
  this.cliService=service;
  currentServerContext=new ThreadLocal<ServerContext>();
  serverEventHandler=new TServerEventHandler(){
    @Override public ServerContext createContext(    TProtocol input,    TProtocol output){
      Metrics metrics=MetricsFactory.getInstance();
      if (metrics != null) {
        try {
          metrics.incrementCounter(MetricsConstant.OPEN_CONNECTIONS);
          metrics.incrementCounter(MetricsConstant.CUMULATIVE_CONNECTION_COUNT);
        }
 catch (        Exception e) {
          LOG.warn("Error Reporting JDO operation to Metrics system",e);
        }
      }
      return new ThriftCLIServerContext();
    }
    @Override public void deleteContext(    ServerContext serverContext,    TProtocol input,    TProtocol output){
      Metrics metrics=MetricsFactory.getInstance();
      if (metrics != null) {
        try {
          metrics.decrementCounter(MetricsConstant.OPEN_CONNECTIONS);
        }
 catch (        Exception e) {
          LOG.warn("Error Reporting JDO operation to Metrics system",e);
        }
      }
      ThriftCLIServerContext context=(ThriftCLIServerContext)serverContext;
      SessionHandle sessionHandle=context.getSessionHandle();
      if (sessionHandle != null) {
        LOG.info("Session disconnected without closing properly, close it now");
        try {
          cliService.closeSession(sessionHandle);
        }
 catch (        HiveSQLException e) {
          LOG.warn("Failed to close session: " + e,e);
        }
      }
    }
    @Override public void preServe(){
    }
    @Override public void processContext(    ServerContext serverContext,    TTransport input,    TTransport output){
      currentServerContext.set(serverContext);
    }
  }
;
}
