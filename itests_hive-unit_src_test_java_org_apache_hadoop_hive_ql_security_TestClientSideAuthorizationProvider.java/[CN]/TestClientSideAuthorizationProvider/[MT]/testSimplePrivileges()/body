{
  String dbName=getTestDbName();
  String tblName=getTestTableName();
  String userName=ugi.getUserName();
  allowCreateDatabase(userName);
  CommandProcessorResponse ret=driver.run("create database " + dbName);
  assertEquals(0,ret.getResponseCode());
  Database db=msc.getDatabase(dbName);
  String dbLocn=db.getLocationUri();
  disallowCreateDatabase(userName);
  validateCreateDb(db,dbName);
  disallowCreateInDb(dbName,userName,dbLocn);
  driver.run("use " + dbName);
  ret=driver.run(String.format("create table %s (a string) partitioned by (b string)",tblName));
  assertNoPrivileges(ret);
  allowCreateInDb(dbName,userName,dbLocn);
  driver.run("use " + dbName);
  ret=driver.run(String.format("create table %s (a string) partitioned by (b string)",tblName));
  assertEquals(0,ret.getResponseCode());
  Table tbl=msc.getTable(dbName,tblName);
  validateCreateTable(tbl,tblName,dbName);
  String fakeUser="mal";
  List<String> fakeGroupNames=new ArrayList<String>();
  fakeGroupNames.add("groupygroup");
  InjectableDummyAuthenticator.injectUserName(fakeUser);
  InjectableDummyAuthenticator.injectGroupNames(fakeGroupNames);
  InjectableDummyAuthenticator.injectMode(true);
  ret=driver.run(String.format("create table %s (a string) partitioned by (b string)",tblName + "mal"));
  assertNoPrivileges(ret);
  disallowCreateInTbl(tbl.getTableName(),userName,tbl.getSd().getLocation());
  ret=driver.run("alter table " + tblName + " add partition (b='2011')");
  assertNoPrivileges(ret);
  InjectableDummyAuthenticator.injectMode(false);
  allowCreateInTbl(tbl.getTableName(),userName,tbl.getSd().getLocation());
  ret=driver.run("alter table " + tblName + " add partition (b='2011')");
  assertEquals(0,ret.getResponseCode());
  allowDropOnTable(tblName,userName,tbl.getSd().getLocation());
  allowDropOnDb(dbName,userName,db.getLocationUri());
  driver.run("drop database if exists " + getTestDbName() + " cascade");
}
