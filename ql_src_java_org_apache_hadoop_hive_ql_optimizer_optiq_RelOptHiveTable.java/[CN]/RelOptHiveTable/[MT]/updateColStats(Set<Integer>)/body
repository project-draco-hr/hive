{
  List<String> nonPartColNamesThatRqrStats=new ArrayList<String>();
  List<Integer> nonPartColIndxsThatRqrStats=new ArrayList<Integer>();
  List<String> partColNamesThatRqrStats=new ArrayList<String>();
  List<Integer> partColIndxsThatRqrStats=new ArrayList<Integer>();
  Set<String> colNamesFailedStats=new HashSet<String>();
  ColumnInfo tmp;
  for (  Integer pi : projIndxLst) {
    if (m_hiveColStatsMap.get(pi) == null) {
      if ((tmp=m_hiveNonPartitionColsMap.get(pi)) != null) {
        nonPartColNamesThatRqrStats.add(tmp.getInternalName());
        nonPartColIndxsThatRqrStats.add(pi);
      }
 else       if ((tmp=m_hivePartitionColsMap.get(pi)) != null) {
        partColNamesThatRqrStats.add(tmp.getInternalName());
        partColIndxsThatRqrStats.add(pi);
      }
 else {
        String logMsg="Unable to find Column Index: " + pi + ", in "+ m_hiveTblMetadata.getCompleteName();
        LOG.error(logMsg);
        throw new RuntimeException(logMsg);
      }
    }
  }
  if (nonPartColNamesThatRqrStats.size() > 0) {
    List<ColStatistics> hiveColStats;
    if (partitionList == null) {
      hiveColStats=StatsUtils.getTableColumnStats(m_hiveTblMetadata,m_hiveNonPartitionCols,nonPartColNamesThatRqrStats);
      if (hiveColStats == null) {
        colNamesFailedStats.addAll(nonPartColNamesThatRqrStats);
      }
 else       if (hiveColStats.size() != nonPartColNamesThatRqrStats.size()) {
        Set<String> setOfFiledCols=new HashSet<String>(nonPartColNamesThatRqrStats);
        Set<String> setOfObtainedColStats=new HashSet<String>();
        for (        ColStatistics cs : hiveColStats) {
          setOfObtainedColStats.add(cs.getColumnName());
        }
        setOfFiledCols.removeAll(setOfObtainedColStats);
        colNamesFailedStats.addAll(setOfFiledCols);
      }
    }
 else {
      try {
        Statistics stats=StatsUtils.collectStatistics(m_hiveConf,partitionList,m_hiveTblMetadata,m_hiveNonPartitionCols,nonPartColNamesThatRqrStats,true,true);
        m_rowCount=stats.getNumRows();
        hiveColStats=new ArrayList<ColStatistics>();
        for (        String c : nonPartColNamesThatRqrStats) {
          ColStatistics cs=stats.getColumnStatisticsFromColName(c);
          if (cs != null) {
            hiveColStats.add(cs);
          }
 else {
            colNamesFailedStats.add(c);
          }
        }
      }
 catch (      HiveException e) {
        String logMsg="Collecting stats failed.";
        LOG.error(logMsg);
        throw new RuntimeException(logMsg);
      }
    }
    if (hiveColStats != null && hiveColStats.size() == nonPartColNamesThatRqrStats.size()) {
      for (int i=0; i < hiveColStats.size(); i++) {
        m_hiveColStatsMap.put(nonPartColIndxsThatRqrStats.get(i),hiveColStats.get(i));
      }
    }
  }
  if (colNamesFailedStats.isEmpty() && !partColNamesThatRqrStats.isEmpty()) {
    if (m_numPartitions == null) {
      try {
        if (partitionList != null) {
          m_numPartitions=partitionList.getPartitions().size();
        }
 else {
          m_numPartitions=Hive.get().getPartitionNames(m_hiveTblMetadata.getDbName(),m_hiveTblMetadata.getTableName(),(short)-1).size();
        }
      }
 catch (      HiveException e) {
        String logMsg="Could not get stats, number of Partitions for " + m_hiveTblMetadata.getCompleteName();
        LOG.error(logMsg);
        throw new RuntimeException(logMsg);
      }
    }
    ColStatistics cStats=null;
    for (int i=0; i < partColNamesThatRqrStats.size(); i++) {
      cStats=new ColStatistics(m_hiveTblMetadata.getTableName(),partColNamesThatRqrStats.get(i),m_hivePartitionColsMap.get(partColIndxsThatRqrStats.get(i)).getTypeName());
      cStats.setCountDistint(m_numPartitions);
      m_hiveColStatsMap.put(partColIndxsThatRqrStats.get(i),cStats);
    }
  }
  if (!colNamesFailedStats.isEmpty()) {
    String logMsg="No Stats for " + m_hiveTblMetadata.getCompleteName() + ", Columns: "+ getColNamesForLogging(colNamesFailedStats);
    LOG.error(logMsg);
    throw new RuntimeException(logMsg);
  }
}
