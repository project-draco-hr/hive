{
  if (range == null)   return null;
  DiskRangeList prev=range.prev;
  if (prev == null) {
    prev=new MutateHelper(range);
  }
  while (range != null) {
    if (range.hasData()) {
      range=range.next;
      continue;
    }
    int len=(int)(range.getEnd() - range.getOffset());
    long off=range.getOffset();
    if (zcr != null) {
      file.seek(base + off);
      boolean hasReplaced=false;
      while (len > 0) {
        ByteBuffer partial=zcr.readBuffer(len,false);
        BufferChunk bc=new BufferChunk(partial,off);
        if (!hasReplaced) {
          range.replaceSelfWith(bc);
          hasReplaced=true;
        }
 else {
          range.insertAfter(bc);
        }
        range=bc;
        int read=partial.remaining();
        len-=read;
        off+=read;
      }
    }
 else {
      byte[] buffer=new byte[len];
      file.readFully((base + off),buffer,0,buffer.length);
      ByteBuffer bb=null;
      if (doForceDirect) {
        bb=ByteBuffer.allocateDirect(len);
        bb.put(buffer);
        bb.position(0);
        bb.limit(len);
      }
 else {
        bb=ByteBuffer.wrap(buffer);
      }
      range=range.replaceSelfWith(new BufferChunk(bb,range.getOffset()));
    }
    range=range.next;
  }
  return prev.next;
}
