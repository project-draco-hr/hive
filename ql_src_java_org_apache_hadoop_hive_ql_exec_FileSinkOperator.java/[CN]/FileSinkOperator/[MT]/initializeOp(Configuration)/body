{
  try {
    this.hconf=hconf;
    filesCreated=false;
    isNativeTable=!conf.getTableInfo().isNonNative();
    multiFileSpray=conf.isMultiFileSpray();
    totalFiles=conf.getTotalFiles();
    numFiles=conf.getNumFiles();
    dpCtx=conf.getDynPartCtx();
    lbCtx=conf.getLbCtx();
    fsp=prevFsp=null;
    valToPaths=new HashMap<String,FSPaths>();
    taskId=Utilities.getTaskId(hconf);
    initializeSpecPath();
    fs=specPath.getFileSystem(hconf);
    hiveOutputFormat=conf.getTableInfo().getOutputFileFormatClass().newInstance();
    isCompressed=conf.getCompressed();
    parent=Utilities.toTempPath(conf.getDirName());
    statsCollectRawDataSize=conf.isStatsCollectRawDataSize();
    statsFromRecordWriter=new boolean[numFiles];
    serializer=(Serializer)conf.getTableInfo().getDeserializerClass().newInstance();
    serializer.initialize(null,conf.getTableInfo().getProperties());
    outputClass=serializer.getSerializedClass();
    timeOut=hconf.getInt("mapred.healthChecker.script.timeout",600000) / 2;
    if (hconf instanceof JobConf) {
      jc=(JobConf)hconf;
    }
 else {
      jc=new JobConf(hconf);
    }
    if (multiFileSpray) {
      partitionEval=new ExprNodeEvaluator[conf.getPartitionCols().size()];
      int i=0;
      for (      ExprNodeDesc e : conf.getPartitionCols()) {
        partitionEval[i++]=ExprNodeEvaluatorFactory.get(e);
      }
      partitionObjectInspectors=initEvaluators(partitionEval,outputObjInspector);
      prtner=(HivePartitioner<HiveKey,Object>)ReflectionUtils.newInstance(jc.getPartitionerClass(),null);
    }
    row_count=new LongWritable();
    if (dpCtx != null) {
      dpSetup();
    }
    if (lbCtx != null) {
      lbSetup();
    }
    int numPart=0;
    int numBuck=0;
    if (conf.getPartitionCols() != null && !conf.getPartitionCols().isEmpty()) {
      numPart=conf.getPartitionCols().size();
    }
    if (conf.getDpSortState().equals(DPSortState.PARTITION_BUCKET_SORTED)) {
      numBuck=1;
    }
    numKeyColToRead=numPart + numBuck;
    keys=Lists.newArrayListWithCapacity(numKeyColToRead);
    keyWritables=Lists.newArrayListWithCapacity(numKeyColToRead);
    if (!bDynParts) {
      fsp=new FSPaths(specPath);
      if (!this.isSkewedStoredAsSubDirectories) {
        valToPaths.put("",fsp);
      }
    }
    if (conf.getWriteType() == AcidUtils.Operation.UPDATE || conf.getWriteType() == AcidUtils.Operation.DELETE) {
      recIdField=((StructObjectInspector)outputObjInspector).getAllStructFieldRefs().get(0);
      recIdInspector=(StructObjectInspector)recIdField.getFieldObjectInspector();
      bucketField=recIdInspector.getAllStructFieldRefs().get(1);
      bucketInspector=(IntObjectInspector)bucketField.getFieldObjectInspector();
    }
    initializeChildren(hconf);
  }
 catch (  HiveException e) {
    throw e;
  }
catch (  Exception e) {
    e.printStackTrace();
    throw new HiveException(e);
  }
}
