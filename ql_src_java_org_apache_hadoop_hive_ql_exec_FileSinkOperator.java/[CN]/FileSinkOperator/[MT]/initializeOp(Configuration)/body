{
  try {
    this.hconf=hconf;
    filesCreated=false;
    isNativeTable=!conf.getTableInfo().isNonNative();
    isTemporary=conf.isTemporary();
    multiFileSpray=conf.isMultiFileSpray();
    totalFiles=conf.getTotalFiles();
    numFiles=conf.getNumFiles();
    dpCtx=conf.getDynPartCtx();
    lbCtx=conf.getLbCtx();
    fsp=prevFsp=null;
    valToPaths=new HashMap<String,FSPaths>();
    taskId=Utilities.getTaskId(hconf);
    initializeSpecPath();
    fs=specPath.getFileSystem(hconf);
    hiveOutputFormat=HiveFileFormatUtils.getHiveOutputFormat(hconf,conf.getTableInfo());
    isCompressed=conf.getCompressed();
    parent=Utilities.toTempPath(conf.getDirName());
    statsCollectRawDataSize=conf.isStatsCollectRawDataSize();
    statsFromRecordWriter=new boolean[numFiles];
    serializer=(Serializer)conf.getTableInfo().getDeserializerClass().newInstance();
    serializer.initialize(hconf,conf.getTableInfo().getProperties());
    outputClass=serializer.getSerializedClass();
    if (isLogInfoEnabled) {
      LOG.info("Using serializer : " + serializer + " and formatter : "+ hiveOutputFormat+ (isCompressed ? " with compression" : ""));
    }
    timeOut=hconf.getInt("mapred.healthChecker.script.timeout",600000) / 2;
    if (hconf instanceof JobConf) {
      jc=(JobConf)hconf;
    }
 else {
      jc=new JobConf(hconf);
    }
    if (multiFileSpray) {
      partitionEval=new ExprNodeEvaluator[conf.getPartitionCols().size()];
      int i=0;
      for (      ExprNodeDesc e : conf.getPartitionCols()) {
        partitionEval[i++]=ExprNodeEvaluatorFactory.get(e);
      }
      partitionObjectInspectors=initEvaluators(partitionEval,outputObjInspector);
      prtner=(HivePartitioner<HiveKey,Object>)ReflectionUtils.newInstance(jc.getPartitionerClass(),null);
    }
    if (dpCtx != null) {
      dpSetup();
    }
    if (lbCtx != null) {
      lbSetup();
    }
    if (!bDynParts) {
      fsp=new FSPaths(specPath);
      if (!this.isSkewedStoredAsSubDirectories) {
        valToPaths.put("",fsp);
      }
    }
    final StoragePolicyValue tmpStorage=StoragePolicyValue.lookup(HiveConf.getVar(hconf,HIVE_TEMPORARY_TABLE_STORAGE));
    if (isTemporary && fsp != null && tmpStorage != StoragePolicyValue.DEFAULT) {
      final Path outputPath=fsp.taskOutputTempPath;
      StoragePolicyShim shim=ShimLoader.getHadoopShims().getStoragePolicyShim(fs);
      if (shim != null) {
        fs.mkdirs(outputPath);
        shim.setStoragePolicy(outputPath,tmpStorage);
      }
    }
    if (conf.getWriteType() == AcidUtils.Operation.UPDATE || conf.getWriteType() == AcidUtils.Operation.DELETE) {
      recIdField=((StructObjectInspector)outputObjInspector).getAllStructFieldRefs().get(0);
      recIdInspector=(StructObjectInspector)recIdField.getFieldObjectInspector();
      bucketField=recIdInspector.getAllStructFieldRefs().get(1);
      bucketInspector=(IntObjectInspector)bucketField.getFieldObjectInspector();
    }
    numRows=0;
    String context=jc.get(Operator.CONTEXT_NAME_KEY,"");
    if (context != null && !context.isEmpty()) {
      context="_" + context.replace(" ","_");
    }
    statsMap.put(Counter.RECORDS_OUT + context,row_count);
    initializeChildren(hconf);
  }
 catch (  HiveException e) {
    throw e;
  }
catch (  Exception e) {
    e.printStackTrace();
    throw new HiveException(e);
  }
}
