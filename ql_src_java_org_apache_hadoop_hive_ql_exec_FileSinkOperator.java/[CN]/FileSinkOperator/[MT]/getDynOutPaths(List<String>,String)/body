{
  FSPaths fp;
  String dpDir=getDynPartDirectory(row,dpColNames,numDynParts);
  if (dpDir != null) {
    dpDir=appendListBucketingDirName(lbDirName,dpDir);
    FSPaths fsp2=valToPaths.get(dpDir);
    if (fsp2 == null) {
      if (valToPaths.size() > maxPartitions) {
        throw new HiveFatalException(ErrorMsg.DYNAMIC_PARTITIONS_TOO_MANY_PER_NODE_ERROR.getErrorCodedMsg() + "Maximum was set to: " + maxPartitions);
      }
      fsp2=createNewPaths(dpDir);
    }
    fp=fsp2;
  }
 else {
    fp=fsp;
  }
  return fp;
}
