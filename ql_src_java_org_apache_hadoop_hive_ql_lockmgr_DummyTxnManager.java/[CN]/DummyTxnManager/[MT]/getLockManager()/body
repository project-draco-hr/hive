{
  if (lockMgr == null) {
    boolean supportConcurrency=conf.getBoolVar(HiveConf.ConfVars.HIVE_SUPPORT_CONCURRENCY);
    if (supportConcurrency) {
      String lockMgrName=conf.getVar(HiveConf.ConfVars.HIVE_LOCK_MANAGER);
      if ((lockMgrName == null) || (lockMgrName.isEmpty())) {
        throw new LockException(ErrorMsg.LOCKMGR_NOT_SPECIFIED.getMsg());
      }
      try {
        LOG.info("Creating lock manager of type " + lockMgrName);
        lockMgr=(HiveLockManager)ReflectionUtils.newInstance(conf.getClassByName(lockMgrName),conf);
        lockMgr.setContext(new HiveLockManagerCtx(conf));
      }
 catch (      Exception e) {
        if (lockMgr != null) {
          try {
            lockMgr.close();
          }
 catch (          LockException e1) {
          }
          lockMgr=null;
        }
        throw new LockException(ErrorMsg.LOCKMGR_NOT_INITIALIZED.getMsg() + e.getMessage());
      }
    }
 else {
      LOG.info("Concurrency mode is disabled, not creating a lock manager");
      return null;
    }
  }
  lockMgr.refresh();
  return lockMgr;
}
