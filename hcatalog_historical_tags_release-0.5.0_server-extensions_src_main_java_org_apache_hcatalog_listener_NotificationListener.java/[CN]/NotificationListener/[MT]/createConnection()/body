{
  Context jndiCntxt;
  try {
    jndiCntxt=new InitialContext();
    ConnectionFactory connFac=(ConnectionFactory)jndiCntxt.lookup("ConnectionFactory");
    Connection conn=connFac.createConnection();
    conn.start();
    conn.setExceptionListener(new ExceptionListener(){
      @Override public void onException(      JMSException jmse){
        LOG.error(jmse.toString());
      }
    }
);
    session=conn.createSession(true,Session.SESSION_TRANSACTED);
  }
 catch (  NamingException e) {
    LOG.error("JNDI error while setting up Message Bus connection. " + "Please make sure file named 'jndi.properties' is in " + "classpath and contains appropriate key-value pairs.",e);
  }
catch (  JMSException e) {
    LOG.error("Failed to initialize connection to message bus",e);
  }
catch (  Throwable t) {
    LOG.error("Unable to connect to JMS provider",t);
  }
}
