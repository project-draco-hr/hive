{
  Table tbl=new Table(crtTbl.getTableName());
  if (crtTbl.getPartCols() != null) {
    tbl.setPartCols(crtTbl.getPartCols());
  }
  if (crtTbl.getNumBuckets() != -1) {
    tbl.setNumBuckets(crtTbl.getNumBuckets());
  }
  if (crtTbl.getStorageHandler() != null) {
    tbl.setProperty(org.apache.hadoop.hive.metastore.api.Constants.META_TABLE_STORAGE,crtTbl.getStorageHandler());
  }
  HiveStorageHandler storageHandler=tbl.getStorageHandler();
  if (crtTbl.getSerName() != null) {
    tbl.setSerializationLib(crtTbl.getSerName());
  }
 else {
    if (crtTbl.getFieldDelim() != null) {
      tbl.setSerdeParam(Constants.FIELD_DELIM,crtTbl.getFieldDelim());
      tbl.setSerdeParam(Constants.SERIALIZATION_FORMAT,crtTbl.getFieldDelim());
    }
    if (crtTbl.getFieldEscape() != null) {
      tbl.setSerdeParam(Constants.ESCAPE_CHAR,crtTbl.getFieldEscape());
    }
    if (crtTbl.getCollItemDelim() != null) {
      tbl.setSerdeParam(Constants.COLLECTION_DELIM,crtTbl.getCollItemDelim());
    }
    if (crtTbl.getMapKeyDelim() != null) {
      tbl.setSerdeParam(Constants.MAPKEY_DELIM,crtTbl.getMapKeyDelim());
    }
    if (crtTbl.getLineDelim() != null) {
      tbl.setSerdeParam(Constants.LINE_DELIM,crtTbl.getLineDelim());
    }
  }
  if (crtTbl.getMapProp() != null) {
    Iterator<Entry<String,String>> iter=crtTbl.getMapProp().entrySet().iterator();
    while (iter.hasNext()) {
      Entry<String,String> m=(Entry<String,String>)iter.next();
      tbl.setSerdeParam(m.getKey(),m.getValue());
    }
  }
  if (crtTbl.getSerName() == null) {
    if (storageHandler == null) {
      LOG.info("Default to LazySimpleSerDe for table " + crtTbl.getTableName());
      tbl.setSerializationLib(org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.class.getName());
    }
 else {
      String serDeClassName=storageHandler.getSerDeClass().getName();
      LOG.info("Use StorageHandler-supplied " + serDeClassName + " for table "+ crtTbl.getTableName());
      tbl.setSerializationLib(serDeClassName);
    }
  }
 else {
    validateSerDe(crtTbl.getSerName());
  }
  if (crtTbl.getCols() != null) {
    tbl.setFields(crtTbl.getCols());
  }
  if (crtTbl.getBucketCols() != null) {
    tbl.setBucketCols(crtTbl.getBucketCols());
  }
  if (crtTbl.getSortCols() != null) {
    tbl.setSortCols(crtTbl.getSortCols());
  }
  if (crtTbl.getComment() != null) {
    tbl.setProperty("comment",crtTbl.getComment());
  }
  if (crtTbl.getLocation() != null) {
    tbl.setDataLocation(new Path(crtTbl.getLocation()).toUri());
  }
  tbl.setInputFormatClass(crtTbl.getInputFormat());
  tbl.setOutputFormatClass(crtTbl.getOutputFormat());
  tbl.getTTable().getSd().setInputFormat(tbl.getInputFormatClass().getName());
  tbl.getTTable().getSd().setOutputFormat(tbl.getOutputFormatClass().getName());
  if (crtTbl.isExternal()) {
    tbl.setProperty("EXTERNAL","TRUE");
    tbl.setTableType(TableType.EXTERNAL_TABLE);
  }
  if ((tbl.getBucketCols() != null) && (tbl.getSortCols() != null)) {
    List<String> bucketCols=tbl.getBucketCols();
    List<Order> sortCols=tbl.getSortCols();
    if ((sortCols.size() > 0) && (sortCols.size() >= bucketCols.size())) {
      boolean found=true;
      Iterator<String> iterBucketCols=bucketCols.iterator();
      while (iterBucketCols.hasNext()) {
        String bucketCol=iterBucketCols.next();
        boolean colFound=false;
        for (int i=0; i < bucketCols.size(); i++) {
          if (bucketCol.equals(sortCols.get(i).getCol())) {
            colFound=true;
            break;
          }
        }
        if (colFound == false) {
          found=false;
          break;
        }
      }
      if (found) {
        tbl.setProperty("SORTBUCKETCOLSPREFIX","TRUE");
      }
    }
  }
  int rc=setGenericTableAttributes(tbl);
  if (rc != 0) {
    return rc;
  }
  db.createTable(tbl,crtTbl.getIfNotExists());
  work.getOutputs().add(new WriteEntity(tbl));
  return 0;
}
