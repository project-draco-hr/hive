{
  String colPath=descTbl.getColumnPath();
  String tableName=descTbl.getTableName();
  Table tbl=db.getTable(tableName,false);
  if (tbl == null) {
    throw new HiveException(ErrorMsg.INVALID_TABLE,tableName);
  }
  Partition part=null;
  if (descTbl.getPartSpec() != null) {
    part=db.getPartition(tbl,descTbl.getPartSpec(),false);
    if (part == null) {
      throw new HiveException(ErrorMsg.INVALID_PARTITION,StringUtils.join(descTbl.getPartSpec().keySet(),','),tableName);
    }
    tbl=part.getTable();
  }
  DataOutputStream outStream=getOutputStream(descTbl.getResFile());
  try {
    LOG.info("DDLTask: got data for " + tbl.getTableName());
    List<FieldSchema> cols=null;
    List<ColumnStatisticsObj> colStats=null;
    Deserializer deserializer=tbl.getDeserializer(true);
    if (deserializer instanceof AbstractSerDe) {
      String errorMsgs=((AbstractSerDe)deserializer).getConfigurationErrors();
      if (errorMsgs != null && !errorMsgs.isEmpty()) {
        throw new SQLException(errorMsgs);
      }
    }
    if (colPath.equals(tableName)) {
      cols=(part == null || tbl.getTableType() == TableType.VIRTUAL_VIEW) ? tbl.getCols() : part.getCols();
      if (!descTbl.isFormatted()) {
        cols.addAll(tbl.getPartCols());
      }
    }
 else {
      cols=Hive.getFieldsFromDeserializer(colPath,deserializer);
      if (descTbl.isFormatted()) {
        String colName=colPath.split("\\.")[1];
        String[] dbTab=Utilities.getDbTableName(tableName);
        List<String> colNames=new ArrayList<String>();
        colNames.add(colName.toLowerCase());
        if (null == part) {
          colStats=db.getTableColumnStatistics(dbTab[0].toLowerCase(),dbTab[1].toLowerCase(),colNames);
        }
 else {
          List<String> partitions=new ArrayList<String>();
          partitions.add(part.getName());
          colStats=db.getPartitionColumnStatistics(dbTab[0].toLowerCase(),dbTab[1].toLowerCase(),partitions,colNames).get(part.getName());
        }
      }
    }
    PrimaryKeyInfo pkInfo=null;
    ForeignKeyInfo fkInfo=null;
    if (descTbl.isExt() || descTbl.isFormatted()) {
      pkInfo=db.getPrimaryKeys(tbl.getDbName(),tbl.getTableName());
      fkInfo=db.getForeignKeys(tbl.getDbName(),tbl.getTableName());
    }
    fixDecimalColumnTypeName(cols);
    boolean isOutputPadded=!SessionState.get().isHiveServerQuery();
    formatter.describeTable(outStream,colPath,tableName,tbl,part,cols,descTbl.isFormatted(),descTbl.isExt(),descTbl.isPretty(),isOutputPadded,colStats,pkInfo,fkInfo);
    LOG.info("DDLTask: written data for " + tbl.getTableName());
  }
 catch (  SQLException e) {
    throw new HiveException(e,ErrorMsg.GENERIC_ERROR,tableName);
  }
 finally {
    IOUtils.closeStream(outStream);
  }
  return 0;
}
