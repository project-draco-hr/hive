{
  assert(isArchived(p) == false);
  Map<String,String> params=p.getParameters();
  URI parentUri=parentDir.toUri();
  String parentHost=parentUri.getHost();
  String harHost=null;
  if (parentHost == null) {
    harHost="";
  }
 else {
    harHost=parentUri.getScheme() + "-" + parentHost;
  }
  URI harUri=null;
  if (dirInArchive.length() == 0) {
    harUri=new URI("har",parentUri.getUserInfo(),harHost,parentUri.getPort(),getArchiveDirOnly(parentDir,archiveName),parentUri.getQuery(),parentUri.getFragment());
  }
 else {
    harUri=new URI("har",parentUri.getUserInfo(),harHost,parentUri.getPort(),new Path(getArchiveDirOnly(parentDir,archiveName),dirInArchive).toUri().getPath(),parentUri.getQuery(),parentUri.getFragment());
  }
  setIsArchived(p,true);
  setOriginalLocation(p,parentDir.toString());
  p.setLocation(harUri.toString());
}
