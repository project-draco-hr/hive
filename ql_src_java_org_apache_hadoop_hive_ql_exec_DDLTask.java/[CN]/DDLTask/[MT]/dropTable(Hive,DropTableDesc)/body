{
  Table tbl=null;
  try {
    tbl=db.getTable(dropTbl.getTableName());
  }
 catch (  InvalidTableException e) {
  }
  if (dropTbl.getPartSpecs() == null) {
    if (tbl != null) {
      if (tbl.isView()) {
        if (!dropTbl.getExpectView()) {
          if (dropTbl.getIfExists()) {
            return 0;
          }
          throw new HiveException("Cannot drop a view with DROP TABLE");
        }
      }
 else {
        if (dropTbl.getExpectView()) {
          if (dropTbl.getIfExists()) {
            return 0;
          }
          throw new HiveException("Cannot drop a base table with DROP VIEW");
        }
      }
    }
    if (tbl != null && !tbl.canDrop()) {
      throw new HiveException("Table " + tbl.getTableName() + " is protected from being dropped");
    }
    if (tbl != null && tbl.isPartitioned()) {
      List<Partition> listPartitions=db.getPartitions(tbl);
      for (      Partition p : listPartitions) {
        if (!p.canDrop()) {
          throw new HiveException("Table " + tbl.getTableName() + " Partition"+ p.getName()+ " is protected from being dropped");
        }
      }
    }
    db.dropTable(dropTbl.getTableName());
    if (tbl != null) {
      work.getOutputs().add(new WriteEntity(tbl));
    }
  }
 else {
    if (tbl != null) {
      validateAlterTableType(tbl,AlterTableDesc.AlterTableTypes.DROPPARTITION,dropTbl.getExpectView());
    }
    List<String> partitionNames=db.getPartitionNames(dropTbl.getTableName(),(short)-1);
    Set<Map<String,String>> partitions=new HashSet<Map<String,String>>();
    for (    String partitionName : partitionNames) {
      try {
        partitions.add(Warehouse.makeSpecFromName(partitionName));
      }
 catch (      MetaException e) {
        LOG.warn("Unrecognized partition name from metastore: " + partitionName);
      }
    }
    List<Partition> partsToDelete=new ArrayList<Partition>();
    for (    Map<String,String> partSpec : dropTbl.getPartSpecs()) {
      Iterator<Map<String,String>> it=partitions.iterator();
      while (it.hasNext()) {
        Map<String,String> part=it.next();
        boolean match=true;
        for (        Map.Entry<String,String> item : partSpec.entrySet()) {
          if (!item.getValue().equals(part.get(item.getKey()))) {
            match=false;
            break;
          }
        }
        if (match) {
          Partition p=db.getPartition(tbl,part,false);
          if (!p.canDrop()) {
            throw new HiveException("Table " + tbl.getTableName() + " Partition "+ p.getName()+ " is protected from being dropped");
          }
          partsToDelete.add(p);
          it.remove();
        }
      }
    }
    for (    Partition partition : partsToDelete) {
      console.printInfo("Dropping the partition " + partition.getName());
      db.dropPartition(dropTbl.getTableName(),partition.getValues(),true);
      work.getOutputs().add(new WriteEntity(partition));
    }
  }
  return 0;
}
