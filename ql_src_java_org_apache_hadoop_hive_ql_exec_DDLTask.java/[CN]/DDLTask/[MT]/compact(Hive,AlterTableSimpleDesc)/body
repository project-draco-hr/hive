{
  Table tbl=db.getTable(desc.getTableName());
  String partName=null;
  if (desc.getPartSpec() == null) {
    if (tbl.isPartitioned()) {
      throw new HiveException(ErrorMsg.NO_COMPACTION_PARTITION);
    }
  }
 else {
    Map<String,String> partSpec=desc.getPartSpec();
    List<Partition> partitions=db.getPartitions(tbl,partSpec);
    if (partitions.size() > 1) {
      throw new HiveException(ErrorMsg.TOO_MANY_COMPACTION_PARTITIONS);
    }
 else     if (partitions.size() == 0) {
      throw new HiveException(ErrorMsg.INVALID_PARTITION_SPEC);
    }
    partName=partitions.get(0).getName();
  }
  db.compact(tbl.getDbName(),tbl.getTableName(),partName,desc.getCompactionType());
  console.printInfo("Compaction enqueued.");
  return 0;
}
