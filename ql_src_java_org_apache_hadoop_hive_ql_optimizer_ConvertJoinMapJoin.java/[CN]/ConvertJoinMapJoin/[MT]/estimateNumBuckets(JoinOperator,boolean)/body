{
  int numBuckets=-1;
  int estimatedBuckets=-1;
  for (  Operator<? extends OperatorDesc> parentOp : joinOp.getParentOperators()) {
    if (parentOp.getOpTraits().getNumBuckets() > 0) {
      numBuckets=(numBuckets < parentOp.getOpTraits().getNumBuckets()) ? parentOp.getOpTraits().getNumBuckets() : numBuckets;
    }
    if (parentOp instanceof ReduceSinkOperator) {
      ReduceSinkOperator rs=(ReduceSinkOperator)parentOp;
      estimatedBuckets=(estimatedBuckets < rs.getConf().getNumReducers()) ? rs.getConf().getNumReducers() : estimatedBuckets;
    }
  }
  if (!useOpTraits) {
    numBuckets=-1;
  }
  if (numBuckets <= 0) {
    numBuckets=estimatedBuckets;
    if (numBuckets <= 0) {
      numBuckets=1;
    }
  }
  return numBuckets;
}
