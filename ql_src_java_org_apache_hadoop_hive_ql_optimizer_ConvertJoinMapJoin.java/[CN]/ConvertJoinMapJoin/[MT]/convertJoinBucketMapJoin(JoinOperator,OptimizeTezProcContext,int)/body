{
  TezBucketJoinProcCtx tezBucketJoinProcCtx=new TezBucketJoinProcCtx(context.conf);
  if (!checkConvertJoinBucketMapJoin(joinOp,context,bigTablePosition,tezBucketJoinProcCtx)) {
    LOG.info("Check conversion to bucket map join failed.");
    return false;
  }
  MapJoinOperator mapJoinOp=convertJoinMapJoin(joinOp,context,bigTablePosition);
  MapJoinDesc joinDesc=mapJoinOp.getConf();
  joinDesc.setBucketMapJoin(true);
  OpTraits opTraits=new OpTraits(joinOp.getOpTraits().getBucketColNames(),tezBucketJoinProcCtx.getNumBuckets());
  mapJoinOp.setOpTraits(opTraits);
  setNumberOfBucketsOnChildren(mapJoinOp);
  Map<String,Integer> bigTableBucketNumMapping=new HashMap<String,Integer>();
  bigTableBucketNumMapping.put(joinDesc.getBigTableAlias(),tezBucketJoinProcCtx.getNumBuckets());
  joinDesc.setBigTableBucketNumMapping(bigTableBucketNumMapping);
  LOG.info("Setting legacy map join to " + (!tezBucketJoinProcCtx.isSubQuery()));
  joinDesc.setCustomBucketMapJoin(!tezBucketJoinProcCtx.isSubQuery());
  return true;
}
