{
  ReduceSinkDesc reduceConf=reduce.getConf();
  Map<String,ExprNodeDesc> oldMap=reduce.getColumnExprMap();
  LOG.info("RS " + reduce.getIdentifier() + " oldColExprMap: "+ oldMap);
  RowResolver oldRR=cppCtx.getOpToParseCtxMap().get(reduce).getRowResolver();
  ArrayList<ColumnInfo> old_signature=oldRR.getRowSchema().getSignature();
  ArrayList<ColumnInfo> signature=new ArrayList<ColumnInfo>(old_signature);
  List<String> valueColNames=reduceConf.getOutputValueColumnNames();
  ArrayList<String> newValueColNames=new ArrayList<String>();
  List<ExprNodeDesc> keyExprs=reduceConf.getKeyCols();
  List<ExprNodeDesc> valueExprs=reduceConf.getValueCols();
  ArrayList<ExprNodeDesc> newValueExprs=new ArrayList<ExprNodeDesc>();
  for (int i=0; i < retainFlags.length; i++) {
    String outputCol=valueColNames.get(i);
    ExprNodeDesc outputColExpr=valueExprs.get(i);
    if (!retainFlags[i]) {
      String[] nm=oldRR.reverseLookup(outputCol);
      if (nm == null) {
        outputCol=Utilities.ReduceField.VALUE.toString() + "." + outputCol;
        nm=oldRR.reverseLookup(outputCol);
      }
      if (nm == null) {
        continue;
      }
      if (ExprNodeDescUtils.indexOf(outputColExpr,keyExprs) == -1) {
        ColumnInfo colInfo=oldRR.getFieldMap(nm[0]).remove(nm[1]);
        oldRR.getInvRslvMap().remove(colInfo.getInternalName());
        oldMap.remove(outputCol);
        signature.remove(colInfo);
      }
    }
 else {
      newValueColNames.add(outputCol);
      newValueExprs.add(outputColExpr);
    }
  }
  oldRR.getRowSchema().setSignature(signature);
  reduce.getSchema().setSignature(signature);
  reduceConf.setOutputValueColumnNames(newValueColNames);
  reduceConf.setValueCols(newValueExprs);
  TableDesc newValueTable=PlanUtils.getReduceValueTableDesc(PlanUtils.getFieldSchemasFromColumnList(reduceConf.getValueCols(),newValueColNames,0,""));
  reduceConf.setValueSerializeInfo(newValueTable);
  LOG.info("RS " + reduce.getIdentifier() + " newColExprMap: "+ oldMap);
}
