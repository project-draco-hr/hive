{
  Thread.setDefaultUncaughtExceptionHandler(new LlapDaemonUncaughtExceptionHandler());
  LlapDaemon llapDaemon=null;
  try {
    LlapDaemonConfiguration daemonConf=new LlapDaemonConfiguration();
    int numExecutors=HiveConf.getIntVar(daemonConf,ConfVars.LLAP_DAEMON_NUM_EXECUTORS);
    String localDirList=HiveConf.getVar(daemonConf,ConfVars.LLAP_DAEMON_WORK_DIRS);
    if (localDirList == null || localDirList.isEmpty()) {
      localDirList=daemonConf.get("yarn.nodemanager.local-dirs");
    }
    String[] localDirs=(localDirList == null || localDirList.isEmpty()) ? new String[0] : StringUtils.getTrimmedStrings(localDirList);
    int rpcPort=HiveConf.getIntVar(daemonConf,ConfVars.LLAP_DAEMON_RPC_PORT);
    int mngPort=HiveConf.getIntVar(daemonConf,ConfVars.LLAP_MANAGEMENT_RPC_PORT);
    int shufflePort=daemonConf.getInt(ShuffleHandler.SHUFFLE_PORT_CONFIG_KEY,ShuffleHandler.DEFAULT_SHUFFLE_PORT);
    long executorMemoryBytes=HiveConf.getIntVar(daemonConf,ConfVars.LLAP_DAEMON_MEMORY_PER_INSTANCE_MB) * 1024l * 1024l;
    long ioMemoryBytes=HiveConf.getSizeVar(daemonConf,ConfVars.LLAP_IO_MEMORY_MAX_SIZE);
    boolean isDirectCache=HiveConf.getBoolVar(daemonConf,ConfVars.LLAP_ALLOCATOR_DIRECT);
    boolean llapIoEnabled=HiveConf.getBoolVar(daemonConf,HiveConf.ConfVars.LLAP_IO_ENABLED);
    llapDaemon=new LlapDaemon(daemonConf,numExecutors,executorMemoryBytes,llapIoEnabled,isDirectCache,ioMemoryBytes,localDirs,rpcPort,mngPort,shufflePort);
    LOG.info("Adding shutdown hook for LlapDaemon");
    ShutdownHookManager.addShutdownHook(new CompositeServiceShutdownHook(llapDaemon),1);
    llapDaemon.init(daemonConf);
    llapDaemon.start();
    LOG.info("Started LlapDaemon");
  }
 catch (  Throwable t) {
    LOG.warn("Failed to start LLAP Daemon with exception",t);
    if (llapDaemon != null) {
      llapDaemon.shutdown();
    }
    System.exit(-1);
  }
}
