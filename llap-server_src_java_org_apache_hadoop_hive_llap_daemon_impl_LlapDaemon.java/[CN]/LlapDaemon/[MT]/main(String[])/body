{
  Thread.setDefaultUncaughtExceptionHandler(new LlapDaemonUncaughtExceptionHandler());
  LlapDaemon llapDaemon=null;
  try {
    LlapDaemonConfiguration daemonConf=new LlapDaemonConfiguration();
    String containerIdStr=System.getenv(ApplicationConstants.Environment.CONTAINER_ID.name());
    String appName=null;
    if (containerIdStr != null && !containerIdStr.isEmpty()) {
      daemonConf.set(ConfVars.LLAP_DAEMON_CONTAINER_ID.varname,containerIdStr);
      appName=ConverterUtils.toContainerId(containerIdStr).getApplicationAttemptId().getApplicationId().toString();
    }
 else {
      daemonConf.unset(ConfVars.LLAP_DAEMON_CONTAINER_ID.varname);
      LOG.error("Cannot find " + ApplicationConstants.Environment.CONTAINER_ID.toString() + "; LLAP tokens may grant access to subsequent instances of the cluster with"+ " the same name");
      appName=null;
    }
    int numExecutors=HiveConf.getIntVar(daemonConf,ConfVars.LLAP_DAEMON_NUM_EXECUTORS);
    String localDirList=LlapUtil.getDaemonLocalDirList(daemonConf);
    String[] localDirs=(localDirList == null || localDirList.isEmpty()) ? new String[0] : StringUtils.getTrimmedStrings(localDirList);
    int rpcPort=HiveConf.getIntVar(daemonConf,ConfVars.LLAP_DAEMON_RPC_PORT);
    int mngPort=HiveConf.getIntVar(daemonConf,ConfVars.LLAP_MANAGEMENT_RPC_PORT);
    int shufflePort=daemonConf.getInt(ShuffleHandler.SHUFFLE_PORT_CONFIG_KEY,ShuffleHandler.DEFAULT_SHUFFLE_PORT);
    int webPort=HiveConf.getIntVar(daemonConf,ConfVars.LLAP_DAEMON_WEB_PORT);
    long executorMemoryBytes=HiveConf.getIntVar(daemonConf,ConfVars.LLAP_DAEMON_MEMORY_PER_INSTANCE_MB) * 1024l * 1024l;
    long ioMemoryBytes=HiveConf.getSizeVar(daemonConf,ConfVars.LLAP_IO_MEMORY_MAX_SIZE);
    boolean isDirectCache=HiveConf.getBoolVar(daemonConf,ConfVars.LLAP_ALLOCATOR_DIRECT);
    boolean isLlapIo=HiveConf.getBoolVar(daemonConf,HiveConf.ConfVars.LLAP_IO_ENABLED,true);
    llapDaemon=new LlapDaemon(daemonConf,numExecutors,executorMemoryBytes,isLlapIo,isDirectCache,ioMemoryBytes,localDirs,rpcPort,mngPort,shufflePort,webPort,appName);
    LOG.info("Adding shutdown hook for LlapDaemon");
    ShutdownHookManager.addShutdownHook(new CompositeServiceShutdownHook(llapDaemon),1);
    llapDaemon.init(daemonConf);
    llapDaemon.start();
    LOG.info("Started LlapDaemon");
  }
 catch (  Throwable t) {
    LOG.warn("Failed to start LLAP Daemon with exception",t);
    if (llapDaemon != null) {
      llapDaemon.shutdown();
    }
    System.exit(-1);
  }
}
