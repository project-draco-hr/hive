{
  Thread.setDefaultUncaughtExceptionHandler(new LlapDaemonUncaughtExceptionHandler());
  LlapDaemon llapDaemon=null;
  try {
    LlapConfiguration daemonConf=new LlapConfiguration();
    int numExecutors=daemonConf.getInt(LlapConfiguration.LLAP_DAEMON_NUM_EXECUTORS,LlapConfiguration.LLAP_DAEMON_NUM_EXECUTORS_DEFAULT);
    String[] localDirs=daemonConf.getTrimmedStrings(LlapConfiguration.LLAP_DAEMON_WORK_DIRS);
    int rpcPort=daemonConf.getInt(LlapConfiguration.LLAP_DAEMON_RPC_PORT,LlapConfiguration.LLAP_DAEMON_RPC_PORT_DEFAULT);
    int shufflePort=daemonConf.getInt(ShuffleHandler.SHUFFLE_PORT_CONFIG_KEY,ShuffleHandler.DEFAULT_SHUFFLE_PORT);
    long executorMemoryBytes=daemonConf.getInt(LlapConfiguration.LLAP_DAEMON_MEMORY_PER_INSTANCE_MB,LlapConfiguration.LLAP_DAEMON_MEMORY_PER_INSTANCE_MB_DEFAULT) * 1024l * 1024l;
    long cacheMemoryBytes=HiveConf.getLongVar(daemonConf,HiveConf.ConfVars.LLAP_ORC_CACHE_MAX_SIZE);
    boolean isDirectCache=HiveConf.getBoolVar(daemonConf,HiveConf.ConfVars.LLAP_ORC_CACHE_ALLOCATE_DIRECT);
    boolean llapIoEnabled=HiveConf.getBoolVar(daemonConf,HiveConf.ConfVars.LLAP_IO_ENABLED);
    llapDaemon=new LlapDaemon(daemonConf,numExecutors,executorMemoryBytes,llapIoEnabled,isDirectCache,cacheMemoryBytes,localDirs,rpcPort,shufflePort);
    LOG.info("Adding shutdown hook for LlapDaemon");
    ShutdownHookManager.addShutdownHook(new CompositeServiceShutdownHook(llapDaemon),1);
    llapDaemon.init(daemonConf);
    llapDaemon.start();
    LOG.info("Started LlapDaemon");
  }
 catch (  Throwable t) {
    LOG.warn("Failed to start LLAP Daemon with exception",t);
    if (llapDaemon != null) {
      llapDaemon.shutdown();
    }
    System.exit(-1);
  }
}
