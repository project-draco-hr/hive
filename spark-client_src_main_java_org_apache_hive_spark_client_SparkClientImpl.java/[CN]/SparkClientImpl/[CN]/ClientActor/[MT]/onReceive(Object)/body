{
  if (message instanceof Protocol.Error) {
    Protocol.Error e=(Protocol.Error)message;
    LOG.error("Error report from remote driver.",e.cause);
  }
 else   if (message instanceof Protocol.Hello) {
    Protocol.Hello hello=(Protocol.Hello)message;
    LOG.info("Received hello from {}",hello.remoteUrl);
    remoteRef=select(hello.remoteUrl);
synchronized (SparkClientImpl.this) {
      SparkClientImpl.this.notifyAll();
    }
  }
 else   if (message instanceof Protocol.JobMetrics) {
    Protocol.JobMetrics jm=(Protocol.JobMetrics)message;
    JobHandleImpl<?> handle=jobs.get(jm.jobId);
    if (handle != null) {
      handle.getMetrics().addMetrics(jm.sparkJobId,jm.stageId,jm.taskId,jm.metrics);
    }
 else {
      LOG.warn("Received metrics for unknown job {}",jm.jobId);
    }
  }
 else   if (message instanceof Protocol.JobResult) {
    Protocol.JobResult jr=(Protocol.JobResult)message;
    JobHandleImpl<?> handle=jobs.remove(jr.id);
    if (handle != null) {
      LOG.info("Received result for {}",jr.id);
      handle.setSparkCounters(jr.sparkCounters);
      handle.complete(jr.result,jr.error);
    }
 else {
      LOG.warn("Received result for unknown job {}",jr.id);
    }
  }
 else   if (message instanceof Protocol.JobSubmitted) {
    Protocol.JobSubmitted jobSubmitted=(Protocol.JobSubmitted)message;
    JobHandleImpl<?> handle=jobs.get(jobSubmitted.clientJobId);
    if (handle != null) {
      LOG.info("Received spark job ID: {} for {}",jobSubmitted.sparkJobId,jobSubmitted.clientJobId);
      handle.getSparkJobIds().add(jobSubmitted.sparkJobId);
    }
 else {
      LOG.warn("Received spark job ID: {} for unknown job {}",jobSubmitted.sparkJobId,jobSubmitted.clientJobId);
    }
  }
}
