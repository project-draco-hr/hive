{
  if (isAlive) {
    isAlive=false;
    try {
      protocol.endSession().get(10,TimeUnit.SECONDS);
    }
 catch (    TimeoutException te) {
      LOG.warn("Timed out waiting for driver to respond to stop request.");
    }
catch (    Exception e) {
      LOG.warn("Exception while waiting for end session reply.",e);
    }
 finally {
      driverRpc.close();
    }
  }
  long endTime=System.currentTimeMillis() + DEFAULT_SHUTDOWN_TIMEOUT;
  try {
    driverThread.join(DEFAULT_SHUTDOWN_TIMEOUT);
  }
 catch (  InterruptedException ie) {
    LOG.debug("Interrupted before driver thread was finished.");
  }
  if (endTime - System.currentTimeMillis() <= 0) {
    LOG.debug("Shut down time out.");
    driverThread.interrupt();
  }
}
