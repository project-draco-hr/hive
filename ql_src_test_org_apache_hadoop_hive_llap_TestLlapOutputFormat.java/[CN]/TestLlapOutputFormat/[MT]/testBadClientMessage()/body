{
  JobConf job=new JobConf();
  String id="foobar";
  job.set(LlapOutputFormat.LLAP_OF_ID_KEY,id);
  LlapOutputFormat format=new LlapOutputFormat();
  Socket socket=new Socket("localhost",service.getPort());
  LOG.debug("Socket connected");
  OutputStream socketStream=socket.getOutputStream();
  LlapOutputSocketInitMessage.newBuilder().setFragmentId(id).build().writeDelimitedTo(socketStream);
  LlapOutputSocketInitMessage.newBuilder().setFragmentId(id).build().writeDelimitedTo(socketStream);
  socketStream.flush();
  Thread.sleep(3000);
  LOG.debug("Data written");
  try {
    format.getRecordWriter(null,job,null,null);
    Assert.fail("Didn't throw");
  }
 catch (  IOException ex) {
  }
}
