{
  AccumuloConnectionParameters cnxnParams=getConnectionParams(job);
  final String tableName=job.get(AccumuloSerDeParameters.TABLE_NAME);
  Preconditions.checkNotNull(tableName,"Expected Accumulo table name to be provided in job configuration");
  try {
    if (cnxnParams.useMockInstance()) {
      setMockInstanceWithErrorChecking(job,cnxnParams.getAccumuloInstanceName());
    }
 else {
      setZooKeeperInstanceWithErrorChecking(job,cnxnParams.getAccumuloInstanceName(),cnxnParams.getZooKeepers(),cnxnParams.useSasl());
    }
    if (cnxnParams.useSasl()) {
      UserGroupInformation ugi=getCurrentUser();
      if (!hasKerberosCredentials(ugi)) {
        getHelper().addTokenFromUserToJobConf(ugi,job);
      }
 else {
        try {
          Connector connector=cnxnParams.getConnector();
          AuthenticationToken token=getHelper().getDelegationToken(connector);
          setConnectorInfoWithErrorChecking(job,cnxnParams.getAccumuloUserName(),token);
          Token<? extends TokenIdentifier> accumuloToken=getHelper().getHadoopToken(token);
          log.info("Adding Hadoop Token for Accumulo to Job's Credentials");
          getHelper().mergeTokenIntoJobConf(job,accumuloToken);
          if (!ugi.addToken(accumuloToken)) {
            throw new IOException("Failed to add Accumulo Token to UGI");
          }
        }
 catch (        AccumuloException|AccumuloSecurityException e) {
          throw new IOException("Failed to acquire Accumulo DelegationToken",e);
        }
      }
    }
 else {
      setConnectorInfoWithErrorChecking(job,cnxnParams.getAccumuloUserName(),new PasswordToken(cnxnParams.getAccumuloPassword()));
    }
    setDefaultAccumuloTableName(job,tableName);
  }
 catch (  AccumuloSecurityException e) {
    log.error("Could not connect to Accumulo with provided credentials",e);
    throw new IOException(e);
  }
}
