{
  EncodedDataProducer<BatchKey> edp=getEncodedDataProducer();
  final EncodedDataConsumer edc;
  if (edp instanceof OrcEncodedDataProducer) {
    edc=new OrcEncodedDataConsumer(this,consumer,columnIds.size());
  }
 else {
    edc=new EncodedDataConsumer(this,consumer,columnIds.size());
  }
  EncodedDataReader<BatchKey> reader=edp.createReader(split,columnIds,sarg,columnNames,edc);
  edc.init(reader);
  UncaughtErrorHandler errorHandler=new UncaughtErrorHandler(edc);
  ListenableFuture<Void> future=executor.submit(reader);
  Futures.addCallback(future,errorHandler);
  return edc;
}
