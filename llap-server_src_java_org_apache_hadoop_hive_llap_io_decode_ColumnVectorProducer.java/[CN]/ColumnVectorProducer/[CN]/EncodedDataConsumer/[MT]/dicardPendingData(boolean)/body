{
  List<ColumnBuffer> dataToDiscard=new ArrayList<ColumnBuffer>(pendingData.size() * colCount);
  List<EncodedColumnBatch> batches=new ArrayList<EncodedColumnBatch>(pendingData.size());
synchronized (pendingData) {
    if (isStopped) {
      this.isStopped=true;
    }
    batches.addAll(pendingData.values());
    pendingData.clear();
  }
  for (  EncodedColumnBatch batch : batches) {
synchronized (batch) {
      for (      ColumnBuffer b : batch.columnDatas) {
        dataToDiscard.add(b);
      }
      batch.columnDatas=null;
    }
  }
  for (  ColumnBuffer data : dataToDiscard) {
    upstreamFeedback.returnData(data);
  }
}
