{
  List<LlapBuffer> dataToDiscard=new ArrayList<LlapBuffer>(pendingData.size() * colCount);
  List<EncodedColumnBatch> batches=new ArrayList<EncodedColumnBatch>(pendingData.size());
synchronized (pendingData) {
    if (isStopped) {
      this.isStopped=true;
    }
    batches.addAll(pendingData.values());
    pendingData.clear();
  }
  for (  EncodedColumnBatch batch : batches) {
synchronized (batch) {
      for (      LlapBuffer b : batch.columnDatas) {
        dataToDiscard.add(b);
      }
      batch.columnDatas=null;
    }
  }
  for (  LlapBuffer data : dataToDiscard) {
    upstreamFeedback.returnData(data);
  }
}
