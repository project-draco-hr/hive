{
  try {
    System.out.println("StatsPublisher - basic functionality");
    StatsPublisher statsPublisher=Utilities.getStatsPublisher((JobConf)conf);
    assertNotNull(statsPublisher);
    StatsCollectionContext sc=new StatsCollectionContext(conf);
    assertTrue(statsPublisher.init(sc));
    assertTrue(statsPublisher.connect(sc));
    StatsAggregator statsAggregator=factory.getStatsAggregator();
    assertNotNull(statsAggregator);
    assertTrue(statsAggregator.connect(sc));
    fillStatMap("200","1000");
    assertTrue(statsPublisher.publishStat("file_00000_a",stats));
    fillStatMap("300","2000");
    assertTrue(statsPublisher.publishStat("file_00000_b",stats));
    fillStatMap("400","3000");
    assertTrue(statsPublisher.publishStat("file_00001_a",stats));
    fillStatMap("500","4000");
    assertTrue(statsPublisher.publishStat("file_00001_b",stats));
    String rows0=statsAggregator.aggregateStats("file_00000",StatsSetupConst.ROW_COUNT);
    assertEquals("500",rows0);
    String usize0=statsAggregator.aggregateStats("file_00000",StatsSetupConst.RAW_DATA_SIZE);
    assertEquals("3000",usize0);
    String rows1=statsAggregator.aggregateStats("file_00001",StatsSetupConst.ROW_COUNT);
    assertEquals("900",rows1);
    String usize1=statsAggregator.aggregateStats("file_00001",StatsSetupConst.RAW_DATA_SIZE);
    assertEquals("7000",usize1);
    String rowsX=statsAggregator.aggregateStats("file_00002",StatsSetupConst.ROW_COUNT);
    assertEquals("0",rowsX);
    String usizeX=statsAggregator.aggregateStats("file_00002",StatsSetupConst.RAW_DATA_SIZE);
    assertEquals("0",usizeX);
    assertTrue(statsAggregator.cleanUp("file_0000"));
    assertTrue(statsPublisher.closeConnection(sc));
    assertTrue(statsAggregator.closeConnection(sc));
    System.out.println("StatsPublisher - basic functionality - OK");
  }
 catch (  Throwable e) {
    e.printStackTrace();
    throw e;
  }
}
