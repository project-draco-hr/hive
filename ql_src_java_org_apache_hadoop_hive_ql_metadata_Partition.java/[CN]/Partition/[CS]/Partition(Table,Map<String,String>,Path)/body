{
  List<String> pvals=new ArrayList<String>();
  for (  FieldSchema field : tbl.getPartCols()) {
    String val=partSpec.get(field.getName());
    if (val == null) {
      throw new HiveException("partition spec is invalid. field.getName() does not exist in input.");
    }
    pvals.add(val);
  }
  org.apache.hadoop.hive.metastore.api.Partition tpart=new org.apache.hadoop.hive.metastore.api.Partition();
  tpart.setDbName(tbl.getDbName());
  tpart.setTableName(tbl.getTableName());
  tpart.setValues(pvals);
  StorageDescriptor sd=new StorageDescriptor();
  try {
    TMemoryBuffer buffer=new TMemoryBuffer(1024);
    TBinaryProtocol prot=new TBinaryProtocol(buffer);
    tbl.getTTable().getSd().write(prot);
    sd.read(prot);
  }
 catch (  TException e) {
    LOG.error("Could not create a copy of StorageDescription");
    throw new HiveException("Could not create a copy of StorageDescription");
  }
  tpart.setSd(sd);
  if (location != null) {
    tpart.getSd().setLocation(location.toString());
  }
 else {
    tpart.getSd().setLocation(null);
  }
  initialize(tbl,tpart);
}
