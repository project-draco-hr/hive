{
  boolean isTezExecEngine=HiveConf.getVar(hiveConf,HiveConf.ConfVars.HIVE_EXECUTION_ENGINE).equals("tez");
  boolean isSparkExecEngine=HiveConf.getVar(hiveConf,HiveConf.ConfVars.HIVE_EXECUTION_ENGINE).equals("spark");
  boolean bucketMapJoinOptimizer=false;
  transformations=new ArrayList<Transform>();
  transformations.add(new HiveOpConverterPostProc());
  Set<String> postExecHooks=Sets.newHashSet(Splitter.on(",").trimResults().omitEmptyStrings().split(Strings.nullToEmpty(HiveConf.getVar(hiveConf,HiveConf.ConfVars.POSTEXECHOOKS))));
  if (postExecHooks.contains("org.apache.hadoop.hive.ql.hooks.PostExecutePrinter") || postExecHooks.contains("org.apache.hadoop.hive.ql.hooks.LineageLogger")) {
    transformations.add(new Generator());
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEPOINTLOOKUPOPTIMIZER) && !pctx.getContext().isCboSucceeded()) {
    final int min=HiveConf.getIntVar(hiveConf,HiveConf.ConfVars.HIVEPOINTLOOKUPOPTIMIZERMIN);
    transformations.add(new PointLookupOptimizer(min));
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEPARTITIONCOLUMNSEPARATOR)) {
    transformations.add(new PartitionColumnsSeparator());
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTPPD) && !pctx.getContext().isCboSucceeded()) {
    transformations.add(new PredicateTransitivePropagate());
    if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTCONSTANTPROPAGATION)) {
      transformations.add(new ConstantPropagate());
    }
    transformations.add(new SyntheticJoinPredicate());
    transformations.add(new PredicatePushDown());
  }
 else   if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTPPD) && pctx.getContext().isCboSucceeded()) {
    transformations.add(new SyntheticJoinPredicate());
    transformations.add(new SimplePredicatePushDown());
    transformations.add(new RedundantDynamicPruningConditionsRemoval());
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTCONSTANTPROPAGATION) && !pctx.getContext().isCboSucceeded()) {
    transformations.add(new ConstantPropagate());
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.DYNAMICPARTITIONING) && HiveConf.getVar(hiveConf,HiveConf.ConfVars.DYNAMICPARTITIONINGMODE).equals("nonstrict") && HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTSORTDYNAMICPARTITION)&& !HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTLISTBUCKETING)) {
    transformations.add(new SortedDynPartitionOptimizer());
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTPPD)) {
    transformations.add(new PartitionPruner());
    transformations.add(new PartitionConditionRemover());
    if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTLISTBUCKETING)) {
      transformations.add(new ListBucketingPruner());
    }
    if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTCONSTANTPROPAGATION) && !pctx.getContext().isCboSucceeded()) {
      transformations.add(new ConstantPropagate());
    }
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTGROUPBY) || HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVE_MAP_GROUPBY_SORT)) {
    transformations.add(new GroupByOptimizer());
  }
  transformations.add(new ColumnPruner());
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVE_OPTIMIZE_SKEWJOIN_COMPILETIME)) {
    if (!isTezExecEngine) {
      transformations.add(new SkewJoinOptimizer());
    }
 else {
      LOG.warn("Skew join is currently not supported in tez! Disabling the skew join optimization.");
    }
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTGBYUSINGINDEX)) {
    transformations.add(new RewriteGBUsingIndex());
  }
  transformations.add(new SamplePruner());
  MapJoinProcessor mapJoinProcessor=isSparkExecEngine ? new SparkMapJoinProcessor() : new MapJoinProcessor();
  transformations.add(mapJoinProcessor);
  if ((HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTBUCKETMAPJOIN)) && !isTezExecEngine && !isSparkExecEngine) {
    transformations.add(new BucketMapJoinOptimizer());
    bucketMapJoinOptimizer=true;
  }
  if ((HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTSORTMERGEBUCKETMAPJOIN)) && !isTezExecEngine && !isSparkExecEngine) {
    if (!bucketMapJoinOptimizer) {
      transformations.add(new BucketMapJoinOptimizer());
    }
    transformations.add(new SortedMergeBucketMapJoinOptimizer());
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTIMIZEBUCKETINGSORTING)) {
    transformations.add(new BucketingSortingReduceSinkOptimizer());
  }
  transformations.add(new UnionProcessor());
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.NWAYJOINREORDER)) {
    transformations.add(new JoinReorder());
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.TEZ_OPTIMIZE_BUCKET_PRUNING) && HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTPPD) && HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTINDEXFILTER)) {
    final boolean compatMode=HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.TEZ_OPTIMIZE_BUCKET_PRUNING_COMPAT);
    transformations.add(new FixedBucketPruningOptimizer(compatMode));
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTREDUCEDEDUPLICATION) || pctx.hasAcidWrite()) {
    transformations.add(new ReduceSinkDeDuplication());
  }
  transformations.add(new NonBlockingOpDeDupProc());
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEIDENTITYPROJECTREMOVER) && !HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVE_CBO_RETPATH_HIVEOP)) {
    transformations.add(new IdentityProjectRemover());
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVELIMITOPTENABLE)) {
    transformations.add(new GlobalLimitOptimizer());
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTCORRELATION) && !HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEGROUPBYSKEW) && !HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVE_OPTIMIZE_SKEWJOIN_COMPILETIME)&& !isTezExecEngine) {
    transformations.add(new CorrelationOptimizer());
  }
  if (HiveConf.getFloatVar(hiveConf,HiveConf.ConfVars.HIVELIMITPUSHDOWNMEMORYUSAGE) > 0) {
    transformations.add(new LimitPushdownOptimizer());
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEOPTIMIZEMETADATAQUERIES)) {
    transformations.add(new StatsOptimizer());
  }
  if (pctx.getContext().getExplain() && !isTezExecEngine && !isSparkExecEngine) {
    transformations.add(new AnnotateWithStatistics());
    transformations.add(new AnnotateWithOpTraits());
  }
  if (!HiveConf.getVar(hiveConf,HiveConf.ConfVars.HIVEFETCHTASKCONVERSION).equals("none")) {
    transformations.add(new SimpleFetchOptimizer());
  }
  if (HiveConf.getBoolVar(hiveConf,HiveConf.ConfVars.HIVEFETCHTASKAGGR)) {
    transformations.add(new SimpleFetchAggregation());
  }
}
