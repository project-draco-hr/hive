{
  String[] expectedLogs={"Compiling command","Completed compiling command","Starting Semantic Analysis","Semantic Analysis Completed","Executing command","Completed executing command"};
  String sql="select count(*) from " + tableName;
  HiveStatement stmt=(HiveStatement)con.createStatement();
  assertNotNull("Statement is null",stmt);
  stmt.executeQuery(sql);
  List<String> logs=stmt.getQueryLog(false,10000);
  stmt.close();
  verifyFetchedLog(logs,expectedLogs);
  final HiveStatement statement=(HiveStatement)con.createStatement();
  assertNotNull("Statement is null",statement);
  statement.setFetchSize(10000);
  final List<String> incrementalLogs=new ArrayList<String>();
  Runnable logThread=new Runnable(){
    @Override public void run(){
      while (statement.hasMoreLogs()) {
        try {
          incrementalLogs.addAll(statement.getQueryLog());
          Thread.sleep(500);
        }
 catch (        SQLException e) {
          LOG.error("Failed getQueryLog. Error message: " + e.getMessage());
          fail("error in getting log thread");
        }
catch (        InterruptedException e) {
          LOG.error("Getting log thread is interrupted. Error message: " + e.getMessage());
          fail("error in getting log thread");
        }
      }
    }
  }
;
  Thread thread=new Thread(logThread);
  thread.setDaemon(true);
  thread.start();
  statement.executeQuery(sql);
  thread.interrupt();
  thread.join(10000);
  List<String> remainingLogs;
  do {
    remainingLogs=statement.getQueryLog();
    incrementalLogs.addAll(remainingLogs);
  }
 while (remainingLogs.size() > 0);
  statement.close();
  verifyFetchedLog(incrementalLogs,expectedLogs);
}
