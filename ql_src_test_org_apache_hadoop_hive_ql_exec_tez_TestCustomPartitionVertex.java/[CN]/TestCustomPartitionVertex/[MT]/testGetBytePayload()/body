{
  int numBuckets=10;
  VertexManagerPluginContext context=mock(VertexManagerPluginContext.class);
  CustomVertexConfiguration vertexConf=new CustomVertexConfiguration(numBuckets,TezWork.VertexType.INITIALIZED_EDGES);
  DataOutputBuffer dob=new DataOutputBuffer();
  vertexConf.write(dob);
  UserPayload payload=UserPayload.create(ByteBuffer.wrap(dob.getData()));
  when(context.getUserPayload()).thenReturn(payload);
  CustomPartitionVertex vm=new CustomPartitionVertex(context);
  vm.initialize();
  Multimap<Integer,Integer> routingTable=HashMultimap.<Integer,Integer>create();
  payload=vm.getBytePayload(routingTable);
  CustomEdgeConfiguration edgeConf=new CustomEdgeConfiguration();
  DataInputByteBuffer dibb=new DataInputByteBuffer();
  dibb.reset(payload.getPayload());
  edgeConf.readFields(dibb);
  assertEquals(numBuckets,edgeConf.getNumBuckets());
}
