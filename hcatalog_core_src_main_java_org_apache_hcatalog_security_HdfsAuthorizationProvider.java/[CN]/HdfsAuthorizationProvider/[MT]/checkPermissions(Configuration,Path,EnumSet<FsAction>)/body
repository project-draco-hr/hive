{
  if (path == null) {
    throw new IllegalArgumentException("path is null");
  }
  HadoopShims shims=ShimLoader.getHadoopShims();
  final UserGroupInformation ugi;
  if (conf.get(PROXY_USER_NAME) != null) {
    ugi=UserGroupInformation.createRemoteUser(conf.get(PROXY_USER_NAME));
  }
 else {
    ugi=shims.getUGIForConf(conf);
  }
  final String user=shims.getShortUserName(ugi);
  final FileSystem fs=path.getFileSystem(conf);
  if (fs.exists(path)) {
    checkPermissions(fs,path,actions,user,ugi.getGroupNames());
  }
 else   if (path.getParent() != null) {
    Path par=path.getParent();
    while (par != null) {
      if (fs.exists(par)) {
        break;
      }
      par=par.getParent();
    }
    checkPermissions(fs,par,actions,user,ugi.getGroupNames());
  }
}
