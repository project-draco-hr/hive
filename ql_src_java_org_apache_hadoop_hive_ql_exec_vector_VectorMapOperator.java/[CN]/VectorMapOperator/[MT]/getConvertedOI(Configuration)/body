{
  Map<TableDesc,StructObjectInspector> tableDescOI=new HashMap<TableDesc,StructObjectInspector>();
  Set<TableDesc> identityConverterTableDesc=new HashSet<TableDesc>();
  try {
    for (    String onefile : conf.getMapWork().getPathToAliases().keySet()) {
      PartitionDesc pd=conf.getMapWork().getPathToPartitionInfo().get(onefile);
      TableDesc tableDesc=pd.getTableDesc();
      Properties tblProps=tableDesc.getProperties();
      Properties partProps=(pd.getPartSpec() == null || pd.getPartSpec().isEmpty()) ? tblProps : pd.getProperties();
      Class sdclass=pd.getDeserializerClass();
      if (sdclass == null) {
        String className=pd.getSerdeClassName();
        if ((className == null) || (className.isEmpty())) {
          throw new HiveException("SerDe class or the SerDe class name is not set for table: " + pd.getProperties().getProperty("name"));
        }
        sdclass=hconf.getClassByName(className);
      }
      Deserializer partDeserializer=(Deserializer)sdclass.newInstance();
      partDeserializer.initialize(hconf,partProps);
      StructObjectInspector partRawRowObjectInspector=(StructObjectInspector)partDeserializer.getObjectInspector();
      StructObjectInspector tblRawRowObjectInspector=tableDescOI.get(tableDesc);
      if ((tblRawRowObjectInspector == null) || (identityConverterTableDesc.contains(tableDesc))) {
        sdclass=tableDesc.getDeserializerClass();
        if (sdclass == null) {
          String className=tableDesc.getSerdeClassName();
          if ((className == null) || (className.isEmpty())) {
            throw new HiveException("SerDe class or the SerDe class name is not set for table: " + tableDesc.getProperties().getProperty("name"));
          }
          sdclass=hconf.getClassByName(className);
        }
        Deserializer tblDeserializer=(Deserializer)sdclass.newInstance();
        tblDeserializer.initialize(hconf,tblProps);
        tblRawRowObjectInspector=(StructObjectInspector)ObjectInspectorConverters.getConvertedOI(partRawRowObjectInspector,(StructObjectInspector)tblDeserializer.getObjectInspector());
        if (identityConverterTableDesc.contains(tableDesc)) {
          if (!partRawRowObjectInspector.equals(tblRawRowObjectInspector)) {
            identityConverterTableDesc.remove(tableDesc);
          }
        }
 else         if (partRawRowObjectInspector.equals(tblRawRowObjectInspector)) {
          identityConverterTableDesc.add(tableDesc);
        }
        tableDescOI.put(tableDesc,tblRawRowObjectInspector);
      }
    }
  }
 catch (  Exception e) {
    throw new HiveException(e);
  }
  return tableDescOI;
}
