{
  result.clear();
  long ref=findKeyRefToRead(key,length,readPos);
  if (ref == 0) {
    return 0;
  }
  boolean hasList=Ref.hasList(ref);
  long lrPtrOffset=hasList ? writeBuffers.getReadPoint(readPos) : 0;
  writeBuffers.setReadPoint(getFirstRecordLengthsOffset(ref,readPos),readPos);
  int valueLength=(int)writeBuffers.readVLong(readPos);
  result.add(new WriteBuffers.ByteSegmentRef(Ref.getOffset(ref) - valueLength,valueLength));
  byte stateByte=Ref.getStateByte(ref);
  if (!hasList) {
    return stateByte;
  }
  long nextTailOffset=writeBuffers.readNByteLong(lrPtrOffset,5,readPos);
  while (nextTailOffset > 0) {
    writeBuffers.setReadPoint(nextTailOffset,readPos);
    valueLength=(int)writeBuffers.readVLong(readPos);
    result.add(new WriteBuffers.ByteSegmentRef(nextTailOffset - valueLength,valueLength));
    long delta=writeBuffers.readVLong(readPos);
    nextTailOffset=delta == 0 ? 0 : (nextTailOffset - delta);
  }
  return stateByte;
}
