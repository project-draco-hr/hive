{
  Path rootHDFSDirPath=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.SCRATCHDIR));
  FsPermission expectedHDFSDirPermission=new FsPermission("777");
  FileSystem fs=rootHDFSDirPath.getFileSystem(conf);
  if (!fs.exists(rootHDFSDirPath)) {
    Utilities.createDirsWithPermission(conf,rootHDFSDirPath,expectedHDFSDirPermission,true);
  }
  FsPermission currentHDFSDirPermission=fs.getFileStatus(rootHDFSDirPath).getPermission();
  LOG.debug("HDFS root scratch dir: " + rootHDFSDirPath + ", permission: "+ currentHDFSDirPermission);
  if (!expectedHDFSDirPermission.equals(fs.getFileStatus(rootHDFSDirPath).getPermission())) {
    throw new RuntimeException("The root scratch dir: " + rootHDFSDirPath + " on HDFS should be writable. Current permissions are: "+ currentHDFSDirPermission);
  }
  return rootHDFSDirPath;
}
