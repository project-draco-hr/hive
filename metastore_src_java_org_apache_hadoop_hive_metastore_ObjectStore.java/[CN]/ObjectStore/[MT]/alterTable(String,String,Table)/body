{
  boolean success=false;
  try {
    openTransaction();
    name=name.toLowerCase();
    dbname=dbname.toLowerCase();
    MTable newt=this.getMTable(newTable.getDbName(),newTable.getTableName());
    if (newt != null) {
      if (!newTable.getTableName().equals(name) || !newTable.getDbName().equals(dbname)) {
        throw new InvalidObjectException("new table " + newTable.getDbName() + " already exists");
      }
    }
    newt=convertToMTable(newTable);
    if (newt == null) {
      throw new InvalidObjectException("new table is invalid");
    }
    MTable oldt=this.getMTable(dbname,name);
    if (oldt == null) {
      throw new MetaException("table " + name + " doesn't exist");
    }
    oldt.setTableName(newt.getTableName().toLowerCase());
    oldt.setParameters(newt.getParameters());
    oldt.setOwner(newt.getOwner());
    oldt.setSd(newt.getSd());
    oldt.setDatabase(newt.getDatabase());
    oldt.setRetention(newt.getRetention());
    success=commitTransaction();
  }
  finally {
    if (!success) {
      rollbackTransaction();
      success=false;
    }
  }
}
