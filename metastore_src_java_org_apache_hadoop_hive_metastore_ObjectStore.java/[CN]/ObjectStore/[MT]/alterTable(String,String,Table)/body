{
  boolean success=false;
  try {
    openTransaction();
    name=HiveStringUtils.normalizeIdentifier(name);
    dbname=HiveStringUtils.normalizeIdentifier(dbname);
    MTable newt=convertToMTable(newTable);
    if (newt == null) {
      throw new InvalidObjectException("new table is invalid");
    }
    MTable oldt=getMTable(dbname,name);
    if (oldt == null) {
      throw new MetaException("table " + name + " doesn't exist");
    }
    oldt.setDatabase(newt.getDatabase());
    oldt.setTableName(HiveStringUtils.normalizeIdentifier(newt.getTableName()));
    oldt.setParameters(newt.getParameters());
    oldt.setOwner(newt.getOwner());
    copyMSD(newt.getSd(),oldt.getSd());
    oldt.setRetention(newt.getRetention());
    oldt.setPartitionKeys(newt.getPartitionKeys());
    oldt.setTableType(newt.getTableType());
    oldt.setLastAccessTime(newt.getLastAccessTime());
    oldt.setViewOriginalText(newt.getViewOriginalText());
    oldt.setViewExpandedText(newt.getViewExpandedText());
    success=commitTransaction();
  }
  finally {
    if (!success) {
      rollbackTransaction();
    }
  }
}
