{
  boolean commited=false;
  try {
    openTransaction();
    MTable mtbl=convertToMTable(tbl);
    pm.makePersistent(mtbl);
    PrincipalPrivilegeSet principalPrivs=tbl.getPrivileges();
    List<Object> toPersistPrivObjs=new ArrayList<Object>();
    if (principalPrivs != null) {
      int now=(int)(System.currentTimeMillis() / 1000);
      Map<String,List<PrivilegeGrantInfo>> userPrivs=principalPrivs.getUserPrivileges();
      putPersistentPrivObjects(mtbl,toPersistPrivObjs,now,userPrivs,PrincipalType.USER);
      Map<String,List<PrivilegeGrantInfo>> groupPrivs=principalPrivs.getGroupPrivileges();
      putPersistentPrivObjects(mtbl,toPersistPrivObjs,now,groupPrivs,PrincipalType.GROUP);
      Map<String,List<PrivilegeGrantInfo>> rolePrivs=principalPrivs.getRolePrivileges();
      putPersistentPrivObjects(mtbl,toPersistPrivObjs,now,rolePrivs,PrincipalType.ROLE);
    }
    pm.makePersistentAll(toPersistPrivObjs);
    commited=commitTransaction();
  }
  finally {
    if (!commited) {
      rollbackTransaction();
    }
  }
}
