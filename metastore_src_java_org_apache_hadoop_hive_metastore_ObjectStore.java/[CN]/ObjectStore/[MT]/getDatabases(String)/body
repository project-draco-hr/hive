{
  if (pattern == null || pattern.equals("*")) {
    return getAllDatabases();
  }
  boolean commited=false;
  List<String> databases=null;
  Query query=null;
  try {
    openTransaction();
    String[] subpatterns=pattern.trim().split("\\|");
    String queryStr="select name from org.apache.hadoop.hive.metastore.model.MDatabase where (";
    boolean first=true;
    for (    String subpattern : subpatterns) {
      subpattern="(?i)" + subpattern.replaceAll("\\*",".*");
      if (!first) {
        queryStr=queryStr + " || ";
      }
      queryStr=queryStr + " name.matches(\"" + subpattern+ "\")";
      first=false;
    }
    queryStr=queryStr + ")";
    query=pm.newQuery(queryStr);
    query.setResult("name");
    query.setOrdering("name ascending");
    Collection<?> names=(Collection<?>)query.execute();
    databases=new ArrayList<String>();
    for (Iterator<?> i=names.iterator(); i.hasNext(); ) {
      databases.add((String)i.next());
    }
    commited=commitTransaction();
  }
  finally {
    if (!commited) {
      rollbackTransaction();
    }
    if (query != null) {
      query.closeAll();
    }
  }
  return databases;
}
