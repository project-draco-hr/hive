{
  boolean success=false;
  List<MPartition> mparts=null;
  try {
    openTransaction();
    LOG.debug("Executing listMPartitionsByFilter");
    dbName=dbName.toLowerCase();
    tableName=tableName.toLowerCase();
    MTable mtable=getMTable(dbName,tableName);
    if (mtable == null) {
      throw new NoSuchObjectException("Specified database/table does not exist : " + dbName + "."+ tableName);
    }
    Map<String,String> params=new HashMap<String,String>();
    String queryFilterString=makeQueryFilterString(mtable,filter,params);
    Query query=pm.newQuery(MPartition.class,queryFilterString);
    if (maxParts >= 0) {
      query.setRange(0,maxParts);
    }
    LOG.debug("Filter specified is " + filter + ","+ " JDOQL filter is "+ queryFilterString);
    params.put("t1",tableName.trim());
    params.put("t2",dbName.trim());
    String parameterDeclaration=makeParameterDeclarationString(params);
    query.declareParameters(parameterDeclaration);
    query.setOrdering("partitionName ascending");
    mparts=(List<MPartition>)query.executeWithMap(params);
    LOG.debug("Done executing query for listMPartitionsByFilter");
    pm.retrieveAll(mparts);
    success=commitTransaction();
    LOG.debug("Done retrieving all objects for listMPartitionsByFilter");
  }
  finally {
    if (!success) {
      rollbackTransaction();
    }
  }
  return mparts;
}
