{
  if (isSchemaVerified.get()) {
    return;
  }
  boolean strictValidation=HiveConf.getBoolVar(getConf(),HiveConf.ConfVars.METASTORE_SCHEMA_VERIFICATION);
  String schemaVer=getMetaStoreSchemaVersion();
  if (schemaVer == null) {
    if (strictValidation) {
      throw new MetaException("Version information not found in metastore. ");
    }
 else {
      LOG.warn("Version information not found in metastore. " + HiveConf.ConfVars.METASTORE_SCHEMA_VERIFICATION.toString() + " is not enabled so recording the schema version "+ MetaStoreSchemaInfo.getHiveSchemaVersion());
      setMetaStoreSchemaVersion(MetaStoreSchemaInfo.getHiveSchemaVersion(),"Set by MetaStore " + USER + "@"+ HOSTNAME);
    }
  }
 else {
    if (schemaVer.equalsIgnoreCase(MetaStoreSchemaInfo.getHiveSchemaVersion())) {
      LOG.debug("Found expected HMS version of " + schemaVer);
    }
 else {
      if (strictValidation) {
        throw new MetaException("Hive Schema version " + MetaStoreSchemaInfo.getHiveSchemaVersion() + " does not match metastore's schema version "+ schemaVer+ " Metastore is not upgraded or corrupt");
      }
 else {
        LOG.error("Version information found in metastore differs " + schemaVer + " from expected schema version "+ MetaStoreSchemaInfo.getHiveSchemaVersion()+ ". Schema verififcation is disabled "+ HiveConf.ConfVars.METASTORE_SCHEMA_VERIFICATION+ " so setting version.");
        setMetaStoreSchemaVersion(MetaStoreSchemaInfo.getHiveSchemaVersion(),"Set by MetaStore " + USER + "@"+ HOSTNAME);
      }
    }
  }
  isSchemaVerified.set(true);
  return;
}
