{
  if (isSchemaVerified.get()) {
    return;
  }
  boolean strictValidation=HiveConf.getBoolVar(getConf(),HiveConf.ConfVars.METASTORE_SCHEMA_VERIFICATION);
  String schemaVer=getMetaStoreSchemaVersion();
  if (schemaVer == null) {
    if (strictValidation) {
      throw new MetaException("Version information not found in metastore. ");
    }
 else {
      LOG.warn("Version information not found in metastore. " + HiveConf.ConfVars.METASTORE_SCHEMA_VERIFICATION.toString() + " is not enabled so recording the schema version "+ MetaStoreSchemaInfo.getHiveSchemaVersion());
      setMetaStoreSchemaVersion(MetaStoreSchemaInfo.getHiveSchemaVersion(),"Set by MetaStore");
    }
  }
 else {
    if (strictValidation) {
      if (!schemaVer.equalsIgnoreCase(MetaStoreSchemaInfo.getHiveSchemaVersion())) {
        throw new MetaException("Hive Schema version " + MetaStoreSchemaInfo.getHiveSchemaVersion() + " does not match metastore's schema version "+ schemaVer+ " Metastore is not upgraded or corrupt");
      }
 else {
        LOG.warn("Metastore version was " + schemaVer + " "+ HiveConf.ConfVars.METASTORE_SCHEMA_VERIFICATION.toString()+ " is not enabled so recording the new schema version "+ MetaStoreSchemaInfo.getHiveSchemaVersion());
        setMetaStoreSchemaVersion(MetaStoreSchemaInfo.getHiveSchemaVersion(),"Set by MetaStore");
      }
    }
  }
  isSchemaVerified.set(true);
  return;
}
