{
  int count=0;
  Query query=pm.newQuery(MDatabase.class);
  List<MDatabase> mDBs=(List<MDatabase>)query.execute();
  pm.retrieveAll(mDBs);
  LOG.info("Looking for location in DB_LOCATION_URI field in DBS table...");
  for (  MDatabase mDB : mDBs) {
    URI locationURI=null;
    try {
      locationURI=new URI(mDB.getLocationUri());
    }
 catch (    URISyntaxException e) {
      LOG.error("Encountered error while validating location URI" + e.getLocalizedMessage());
    }
    if (locationURI != null) {
      if (shouldUpdateURI(locationURI,oldLoc)) {
        String dbLoc=mDB.getLocationUri().replaceAll(oldLoc.toString(),newLoc.toString());
        if (dryRun) {
          updateLocations.put(locationURI.toString(),dbLoc);
        }
 else {
          mDB.setLocationUri(dbLoc);
        }
        count++;
      }
    }
  }
  LOG.info("Found  " + count + " records to update");
  return count;
}
