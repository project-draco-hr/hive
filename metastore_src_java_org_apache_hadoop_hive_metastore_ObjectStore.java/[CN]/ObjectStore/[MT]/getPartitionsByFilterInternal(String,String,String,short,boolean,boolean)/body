{
  final ExpressionTree tree=(filter != null && !filter.isEmpty()) ? getFilterParser(filter).tree : ExpressionTree.EMPTY_TREE;
  return new GetListHelper<Partition>(dbName,tblName,allowSql,allowJdo){
    @Override protected List<Partition> getSqlResult(    GetHelper<List<Partition>> ctx) throws MetaException {
      List<Partition> parts=directSql.getPartitionsViaSqlFilter(ctx.getTable(),tree,(maxParts < 0) ? null : (int)maxParts);
      if (parts == null) {
        ctx.disableDirectSql();
      }
      return parts;
    }
    @Override protected List<Partition> getJdoResult(    GetHelper<List<Partition>> ctx) throws MetaException, NoSuchObjectException {
      return getPartitionsViaOrmFilter(ctx.getTable(),tree,maxParts,true);
    }
  }
.run(true);
}
