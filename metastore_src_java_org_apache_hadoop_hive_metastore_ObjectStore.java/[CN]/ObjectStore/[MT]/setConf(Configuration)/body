{
  pmfPropLock.lock();
  try {
    isInitialized=false;
    hiveConf=conf;
    Properties propsFromConf=getDataSourceProps(conf);
    boolean propsChanged=!propsFromConf.equals(prop);
    if (propsChanged) {
      pmf=null;
      prop=null;
    }
    assert(!isActiveTransaction());
    shutdown();
    pm=null;
    directSql=null;
    expressionProxy=null;
    openTrasactionCalls=0;
    currentTransaction=null;
    transactionStatus=TXN_STATUS.NO_STATE;
    initialize(propsFromConf);
    String partitionValidationRegex=hiveConf.get(HiveConf.ConfVars.METASTORE_PARTITION_NAME_WHITELIST_PATTERN.name());
    if (partitionValidationRegex != null && partitionValidationRegex.equals("")) {
      partitionValidationPattern=Pattern.compile(partitionValidationRegex);
    }
 else {
      partitionValidationPattern=null;
    }
    if (!isInitialized) {
      throw new RuntimeException("Unable to create persistence manager. Check dss.log for details");
    }
 else {
      LOG.info("Initialized ObjectStore");
    }
  }
  finally {
    pmfPropLock.unlock();
  }
}
