{
  String fsLoc=hcatConf.get("fs.default.name");
  Path tblPath=new Path(fsLoc,tblLocation);
  String tblName="junit_pigstorage";
  tblPath.getFileSystem(hcatConf).copyFromLocalFile(new Path(anyExistingFileInCurDir),tblPath);
  hcatDriver.run("drop table " + tblName);
  CommandProcessorResponse resp;
  String createTable="create table " + tblName + " (a string) partitioned by (b string) stored as TEXTFILE";
  resp=hcatDriver.run(createTable);
  assertEquals(0,resp.getResponseCode());
  assertNull(resp.getErrorMessage());
  resp=hcatDriver.run("alter table " + tblName + " add partition (b='2010-10-10') location '"+ new Path(fsLoc,"/tmp/test_pig")+ "'");
  assertEquals(0,resp.getResponseCode());
  assertNull(resp.getErrorMessage());
  resp=hcatDriver.run("alter table " + tblName + " partition (b='2010-10-10') set fileformat TEXTFILE");
  assertEquals(0,resp.getResponseCode());
  assertNull(resp.getErrorMessage());
  resp=hcatDriver.run("desc extended " + tblName + " partition (b='2010-10-10')");
  assertEquals(0,resp.getResponseCode());
  assertNull(resp.getErrorMessage());
  PigServer server=new PigServer(ExecType.LOCAL,hcatConf.getAllProperties());
  UDFContext.getUDFContext().setClientSystemProps();
  server.registerQuery(" a = load '" + tblName + "' using "+ HCatLoader.class.getName()+ ";");
  Iterator<Tuple> itr=server.openIterator("a");
  boolean result=compareWithFile(itr,anyExistingFileInCurDir,2,"2010-10-10",null);
  assertTrue(result);
  server.registerQuery("a = load '" + tblPath.toString() + "' using PigStorage() as (a:chararray);");
  server.store("a",tblName,HCatStorer.class.getName() + "('b=2010-10-11')");
  server.registerQuery("a = load '" + warehouseDir + "/"+ tblName+ "/b=2010-10-11' using PigStorage() as (a:chararray);");
  itr=server.openIterator("a");
  result=compareWithFile(itr,anyExistingFileInCurDir,1,"2010-10-11",null);
  assertTrue(result);
  server.registerQuery("a = load '" + tblPath.toString() + "' using PigStorage() as (a:chararray);");
  server.registerQuery("store a into '" + tblName + "' using "+ HCatStorer.class.getName()+ "('b=2010-11-01');");
  server.registerQuery("store a into '" + tblName + "' using "+ HCatStorer.class.getName()+ "('b=2010-11-02');");
  server.registerQuery("a = load '" + warehouseDir + "/"+ tblName+ "/b=2010-11-01' using PigStorage() as (a:chararray);");
  itr=server.openIterator("a");
  result=compareWithFile(itr,anyExistingFileInCurDir,1,"2010-11-01",null);
  assertTrue(result);
  server.registerQuery("a = load '" + warehouseDir + "/"+ tblName+ "/b=2010-11-02' using PigStorage() as (a:chararray);");
  itr=server.openIterator("a");
  result=compareWithFile(itr,anyExistingFileInCurDir,1,"2010-11-02",null);
  assertTrue(result);
  hcatDriver.run("drop table " + tblName);
}
