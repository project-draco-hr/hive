{
  long startTime=Time.monotonicNow();
  long timeLeft=timeout;
  while (timeLeft > 0) {
    signalSchedulerRun();
    awaitSchedulerRun(Math.min(200,timeLeft));
    if (ts.dagStats.numTotalAllocations != previousAllocations) {
      throw new IllegalStateException("NumTotalAllocations expected to stay at " + previousAllocations + ". Actual="+ ts.dagStats.numTotalAllocations);
    }
    timeLeft=(startTime + timeout) - Time.monotonicNow();
  }
}
