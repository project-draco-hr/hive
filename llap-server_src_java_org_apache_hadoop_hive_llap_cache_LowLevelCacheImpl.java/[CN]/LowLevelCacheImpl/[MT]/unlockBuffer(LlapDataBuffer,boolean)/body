{
  boolean isLastDecref=(buffer.decRef() == 0);
  if (handleLastDecRef && isLastDecref) {
    if (buffer.declaredCachedLength != LlapDataBuffer.UNKNOWN_CACHED_LENGTH) {
      cachePolicy.notifyUnlock(buffer);
    }
 else {
      if (LlapIoImpl.CACHE_LOGGER.isTraceEnabled()) {
        LlapIoImpl.CACHE_LOGGER.trace("Deallocating {} that was not cached",buffer);
      }
      allocator.deallocate(buffer);
    }
  }
  metrics.decrCacheNumLockedBuffers();
}
