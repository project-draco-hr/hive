{
  boolean isLastDecref=(buffer.decRef() == 0);
  if (handleLastDecRef && isLastDecref) {
    if (buffer.declaredCachedLength != LlapDataBuffer.UNKNOWN_CACHED_LENGTH) {
      cachePolicy.notifyUnlock(buffer);
    }
 else {
      if (DebugUtils.isTraceCachingEnabled()) {
        LlapIoImpl.LOG.info("Deallocating " + buffer + " that was not cached");
      }
      allocator.deallocate(buffer);
    }
  }
  metrics.decrCacheNumLockedBuffers();
}
