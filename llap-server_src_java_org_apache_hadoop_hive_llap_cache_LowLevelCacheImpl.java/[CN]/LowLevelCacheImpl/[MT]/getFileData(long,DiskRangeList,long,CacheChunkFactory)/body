{
  if (ranges == null)   return null;
  FileCache subCache=cache.get(fileId);
  if (subCache == null || !subCache.incRef()) {
    metrics.incrCacheRequestedBytes(ranges.getTotalLength());
    return ranges;
  }
  try {
    DiskRangeList prev=ranges.prev;
    if (prev == null) {
      prev=new DiskRangeListMutateHelper(ranges);
    }
    DiskRangeList current=ranges;
    while (current != null) {
      metrics.incrCacheRequestedBytes(current.getLength());
      DiskRangeList next=current.next;
      getOverlappingRanges(baseOffset,current,subCache.cache,factory);
      current=next;
    }
    return prev.next;
  }
  finally {
    subCache.decRef();
  }
}
