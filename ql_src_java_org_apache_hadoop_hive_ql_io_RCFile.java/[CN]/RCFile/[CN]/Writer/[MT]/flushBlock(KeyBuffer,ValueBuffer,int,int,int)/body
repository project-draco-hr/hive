{
  checkAndWriteSync();
  out.writeInt(recordLen);
  out.writeInt(keyLength);
  if (this.isCompressed()) {
    keyCompressionBuffer.reset();
    keyDeflateFilter.resetState();
    keyBuffer.write(keyDeflateOut);
    keyDeflateOut.flush();
    keyDeflateFilter.finish();
    compressedKeyLen=keyCompressionBuffer.getLength();
    out.writeInt(compressedKeyLen);
    out.write(keyCompressionBuffer.getData(),0,compressedKeyLen);
  }
 else {
    out.writeInt(compressedKeyLen);
    keyBuffer.write(out);
  }
  valueBuffer.write(out);
}
