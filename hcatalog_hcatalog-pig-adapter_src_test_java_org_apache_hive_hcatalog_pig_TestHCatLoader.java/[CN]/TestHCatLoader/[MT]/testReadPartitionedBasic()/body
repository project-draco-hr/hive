{
  PigServer server=new PigServer(ExecType.LOCAL);
  driver.run("select * from " + PARTITIONED_TABLE);
  ArrayList<String> valuesReadFromHiveDriver=new ArrayList<String>();
  driver.getResults(valuesReadFromHiveDriver);
  assertEquals(basicInputData.size(),valuesReadFromHiveDriver.size());
  server.registerQuery("W = load '" + PARTITIONED_TABLE + "' using org.apache.hive.hcatalog.pig.HCatLoader();");
  Schema dumpedWSchema=server.dumpSchema("W");
  List<FieldSchema> Wfields=dumpedWSchema.getFields();
  assertEquals(3,Wfields.size());
  assertTrue(Wfields.get(0).alias.equalsIgnoreCase("a"));
  assertTrue(Wfields.get(0).type == DataType.INTEGER);
  assertTrue(Wfields.get(1).alias.equalsIgnoreCase("b"));
  assertTrue(Wfields.get(1).type == DataType.CHARARRAY);
  assertTrue(Wfields.get(2).alias.equalsIgnoreCase("bkt"));
  assertTrue(Wfields.get(2).type == DataType.CHARARRAY);
  Iterator<Tuple> WIter=server.openIterator("W");
  Collection<Pair<Integer,String>> valuesRead=new ArrayList<Pair<Integer,String>>();
  while (WIter.hasNext()) {
    Tuple t=WIter.next();
    assertTrue(t.size() == 3);
    assertNotNull(t.get(0));
    assertNotNull(t.get(1));
    assertNotNull(t.get(2));
    assertTrue(t.get(0).getClass() == Integer.class);
    assertTrue(t.get(1).getClass() == String.class);
    assertTrue(t.get(2).getClass() == String.class);
    valuesRead.add(new Pair<Integer,String>((Integer)t.get(0),(String)t.get(1)));
    if ((Integer)t.get(0) < 2) {
      assertEquals("0",t.get(2));
    }
 else {
      assertEquals("1",t.get(2));
    }
  }
  assertEquals(valuesReadFromHiveDriver.size(),valuesRead.size());
  server.registerQuery("P1 = load '" + PARTITIONED_TABLE + "' using org.apache.hive.hcatalog.pig.HCatLoader();");
  server.registerQuery("P1filter = filter P1 by bkt == '0';");
  Iterator<Tuple> P1Iter=server.openIterator("P1filter");
  int count1=0;
  while (P1Iter.hasNext()) {
    Tuple t=P1Iter.next();
    assertEquals("0",t.get(2));
    assertEquals(1,t.get(0));
    count1++;
  }
  assertEquals(3,count1);
  server.registerQuery("P2 = load '" + PARTITIONED_TABLE + "' using org.apache.hive.hcatalog.pig.HCatLoader();");
  server.registerQuery("P2filter = filter P2 by bkt == '1';");
  Iterator<Tuple> P2Iter=server.openIterator("P2filter");
  int count2=0;
  while (P2Iter.hasNext()) {
    Tuple t=P2Iter.next();
    assertEquals("1",t.get(2));
    assertTrue(((Integer)t.get(0)) > 1);
    count2++;
  }
  assertEquals(6,count2);
}
