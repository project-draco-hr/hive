{
  if (writePos.bufferIndex == -1) {
    return;
  }
  if (writePos.offset < (wbSize * 0.8)) {
    byte[] smallerBuffer=new byte[writePos.offset];
    System.arraycopy(writePos.buffer,0,smallerBuffer,0,writePos.offset);
    writeBuffers.set(writePos.bufferIndex,smallerBuffer);
  }
  if (writePos.bufferIndex + 1 < writeBuffers.size()) {
    writeBuffers.subList(writePos.bufferIndex + 1,writeBuffers.size()).clear();
  }
  clearState();
}
