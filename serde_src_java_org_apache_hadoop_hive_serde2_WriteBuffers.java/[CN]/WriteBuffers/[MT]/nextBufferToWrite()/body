{
  if (currentWriteBufferIndex == (writeBuffers.size() - 1)) {
    if ((1 + writeBuffers.size()) * wbSize > maxSize) {
      throw new RuntimeException("Too much memory used by write buffers");
    }
    writeBuffers.add(new byte[wbSize]);
  }
  ++currentWriteBufferIndex;
  currentWriteBuffer=writeBuffers.get(currentWriteBufferIndex);
  currentWriteOffset=0;
}
