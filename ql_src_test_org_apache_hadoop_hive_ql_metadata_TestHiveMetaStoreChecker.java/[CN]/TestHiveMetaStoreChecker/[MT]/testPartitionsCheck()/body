{
  Database db=new Database();
  db.setName(dbName);
  hive.createDatabase(db);
  Table table=new Table(dbName,tableName);
  table.setDbName(dbName);
  table.setInputFormatClass(TextInputFormat.class);
  table.setOutputFormatClass(HiveIgnoreKeyTextOutputFormat.class);
  table.setPartCols(partCols);
  hive.createTable(table);
  table=hive.getTable(dbName,tableName);
  for (  Map<String,String> partSpec : parts) {
    hive.createPartition(table,partSpec);
  }
  CheckResult result=new CheckResult();
  checker.checkMetastore(dbName,tableName,null,result);
  assertEquals(Collections.<String>emptyList(),result.getTablesNotInMs());
  assertEquals(Collections.<String>emptyList(),result.getTablesNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotInMs());
  List<Partition> partitions=hive.getPartitions(table);
  assertEquals(2,partitions.size());
  Partition partToRemove=partitions.get(0);
  Path partToRemovePath=partToRemove.getDataLocation();
  fs=partToRemovePath.getFileSystem(hive.getConf());
  fs.delete(partToRemovePath,true);
  result=new CheckResult();
  checker.checkMetastore(dbName,tableName,null,result);
  assertEquals(Collections.<String>emptyList(),result.getTablesNotInMs());
  assertEquals(Collections.<String>emptyList(),result.getTablesNotOnFs());
  assertEquals(1,result.getPartitionsNotOnFs().size());
  assertEquals(partToRemove.getName(),result.getPartitionsNotOnFs().get(0).getPartitionName());
  assertEquals(partToRemove.getTable().getTableName(),result.getPartitionsNotOnFs().get(0).getTableName());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotInMs());
  List<Map<String,String>> partsCopy=new ArrayList<Map<String,String>>();
  partsCopy.add(partitions.get(1).getSpec());
  result=new CheckResult();
  checker.checkMetastore(dbName,tableName,partsCopy,result);
  assertEquals(Collections.<String>emptyList(),result.getTablesNotInMs());
  assertEquals(Collections.<String>emptyList(),result.getTablesNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotInMs());
  fs.mkdirs(partToRemovePath);
  Path fakePart=new Path(table.getDataLocation().toString(),"fakepartition=fakevalue");
  fs.mkdirs(fakePart);
  fs.deleteOnExit(fakePart);
  checker.checkMetastore(dbName,tableName,null,result);
  assertEquals(Collections.<String>emptyList(),result.getTablesNotInMs());
  assertEquals(Collections.<String>emptyList(),result.getTablesNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotOnFs());
  assertEquals(1,result.getPartitionsNotInMs().size());
  assertEquals(fakePart.getName(),result.getPartitionsNotInMs().get(0).getPartitionName());
  hive.dropTable(dbName,tableName,true,true);
  hive.createTable(table);
  result=new CheckResult();
  checker.checkMetastore(dbName,null,null,result);
  assertEquals(Collections.<String>emptyList(),result.getTablesNotInMs());
  assertEquals(Collections.<String>emptyList(),result.getTablesNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotInMs());
  System.err.println("Test completed - partition check");
}
