{
  CheckResult result=new CheckResult();
  checker.checkMetastore(dbName,null,null,result);
  assertEquals(Collections.<String>emptyList(),result.getTablesNotInMs());
  assertEquals(Collections.<String>emptyList(),result.getTablesNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotInMs());
  result=new CheckResult();
  checker.checkMetastore(dbName,tableName,null,result);
  assertEquals(1,result.getTablesNotInMs().size());
  assertEquals(tableName,result.getTablesNotInMs().get(0));
  assertEquals(Collections.<String>emptyList(),result.getTablesNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotInMs());
  Database db=new Database();
  db.setName(dbName);
  hive.createDatabase(db);
  Table table=new Table(dbName,tableName);
  table.setDbName(dbName);
  table.setInputFormatClass(TextInputFormat.class);
  table.setOutputFormatClass(HiveIgnoreKeyTextOutputFormat.class);
  hive.createTable(table);
  result=new CheckResult();
  checker.checkMetastore(dbName,null,null,result);
  assertEquals(Collections.<String>emptyList(),result.getTablesNotInMs());
  assertEquals(Collections.<String>emptyList(),result.getTablesNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotInMs());
  result=new CheckResult();
  checker.checkMetastore(dbName,tableName,null,result);
  assertEquals(Collections.<String>emptyList(),result.getTablesNotInMs());
  assertEquals(Collections.<String>emptyList(),result.getTablesNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotInMs());
  fs=table.getPath().getFileSystem(hive.getConf());
  fs.delete(table.getPath(),true);
  result=new CheckResult();
  checker.checkMetastore(dbName,tableName,null,result);
  assertEquals(Collections.<String>emptyList(),result.getTablesNotInMs());
  ;
  assertEquals(1,result.getTablesNotOnFs().size());
  assertEquals(tableName,result.getTablesNotOnFs().get(0));
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotInMs());
  fs.mkdirs(table.getPath());
  Path fakeTable=table.getPath().getParent().suffix(Path.SEPARATOR + "faketable");
  fs.mkdirs(fakeTable);
  fs.deleteOnExit(fakeTable);
  result=new CheckResult();
  checker.checkMetastore(dbName,null,null,result);
  assertEquals(1,result.getTablesNotInMs().size());
  assertEquals(fakeTable.getName(),result.getTablesNotInMs().get(0));
  assertEquals(Collections.<String>emptyList(),result.getTablesNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotInMs());
  hive.dropTable(dbName,tableName);
  table.setProperty("EXTERNAL","TRUE");
  hive.createTable(table);
  result=new CheckResult();
  checker.checkMetastore(dbName,null,null,result);
  assertEquals(Collections.<String>emptyList(),result.getTablesNotInMs());
  assertEquals(Collections.<String>emptyList(),result.getTablesNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotOnFs());
  assertEquals(Collections.<String>emptyList(),result.getPartitionsNotInMs());
}
