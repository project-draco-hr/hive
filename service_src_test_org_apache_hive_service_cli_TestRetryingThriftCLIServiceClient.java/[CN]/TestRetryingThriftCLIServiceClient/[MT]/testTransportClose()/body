{
  hiveConf.setIntVar(HiveConf.ConfVars.HIVE_SERVER2_THRIFT_CLIENT_CONNECTION_RETRY_LIMIT,0);
  try {
    startHiveServer();
    RetryingThriftCLIServiceClient.CLIServiceClientWrapper client=RetryingThriftCLIServiceClientTest.newRetryingCLIServiceClient(hiveConf);
    client.closeTransport();
    try {
      client.openSession("anonymous","anonymous");
      fail("Shouldn't be able to open session when transport is closed.");
    }
 catch (    HiveSQLException ignored) {
    }
  }
  finally {
    hiveConf.setIntVar(HiveConf.ConfVars.HIVE_SERVER2_THRIFT_CLIENT_CONNECTION_RETRY_LIMIT,3);
    stopHiveServer();
  }
}
