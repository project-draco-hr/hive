{
  boolean useOptimized=useOptimizedKeyBasedOnPrev(key);
  if (useOptimized || key == null) {
    if (keyObject.length <= 8) {
      output=serializeRow(output,keyObject,keyOIs,null);
      return MapJoinKeyBytes.fromBytes(key,mayReuseKey,Arrays.copyOf(output.getData(),output.getLength()));
    }
    if (useOptimized) {
      throw new HiveException("Failed to serialize " + Arrays.toString(keyObject) + " even though optimized keys are used");
    }
  }
  MapJoinKeyObject result=mayReuseKey ? (MapJoinKeyObject)key : new MapJoinKeyObject();
  result.setKeyObjects(keyObject);
  return result;
}
