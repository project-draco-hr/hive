{
  PrintStream printStream=System.out;
  OutputStreamWriter out=new OutputStreamWriter(printStream,"UTF-8");
  RecordReader rows=reader.rows();
  try {
    TypeDescription schema=reader.getSchema();
    VectorizedRowBatch batch=schema.createRowBatch();
    while (rows.nextBatch(batch)) {
      for (int r=0; r < batch.size; ++r) {
        JSONWriter writer=new JSONWriter(out);
        printRow(writer,batch,schema,r);
        out.write("\n");
        out.flush();
        if (printStream.checkError()) {
          throw new IOException("Error encountered when writing to stdout.");
        }
      }
    }
  }
  finally {
    rows.close();
  }
}
