{
  State s=(State)agg;
  FirstValueBuffer fb=(FirstValueBuffer)s.wrappedBuf;
  ValIndexPair r=fb.skipNulls && s.valueChain.size() == 0 ? null : s.valueChain.getFirst();
  for (int i=0; i < s.numFollowing; i++) {
    s.results.add(r == null ? null : r.val);
    s.numRows++;
    if (r != null) {
      int fIdx=(Integer)r.idx;
      if (s.numPreceding != BoundarySpec.UNBOUNDED_AMOUNT && s.numRows > fIdx + s.numPreceding + s.numFollowing && !s.valueChain.isEmpty()) {
        s.valueChain.removeFirst();
        r=!s.valueChain.isEmpty() ? s.valueChain.getFirst() : r;
      }
    }
  }
  return null;
}
