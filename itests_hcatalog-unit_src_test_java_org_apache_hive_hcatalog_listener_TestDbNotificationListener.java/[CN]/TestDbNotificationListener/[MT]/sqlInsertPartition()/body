{
  driver.run("create table sip (c int) partitioned by (ds string)");
  driver.run("insert into table sip partition (ds = 'today') values (1)");
  driver.run("insert into table sip partition (ds = 'today') values (2)");
  driver.run("insert into table sip partition (ds) values (3, 'today')");
  driver.run("alter table sip add partition (ds = 'yesterday')");
  driver.run("insert into table sip partition (ds = 'yesterday') values (2)");
  driver.run("insert into table sip partition (ds) values (3, 'yesterday')");
  driver.run("insert into table sip partition (ds) values (3, 'tomorrow')");
  driver.run("alter table sip drop partition (ds = 'tomorrow')");
  driver.run("insert into table sip partition (ds) values (42, 'todaytwo')");
  driver.run("insert overwrite table sip partition(ds='todaytwo') select c from sip where 'ds'='today'");
  NotificationEventResponse rsp=msClient.getNextNotification(firstEventId,0,null);
  for (  NotificationEvent ne : rsp.getEvents())   LOG.debug("EVENT: " + ne.getMessage());
  assertEquals(24,rsp.getEventsSize());
  NotificationEvent event=rsp.getEvents().get(1);
  assertEquals(firstEventId + 2,event.getEventId());
  assertEquals(HCatConstants.HCAT_ADD_PARTITION_EVENT,event.getEventType());
  event=rsp.getEvents().get(3);
  assertEquals(firstEventId + 4,event.getEventId());
  assertEquals(HCatConstants.HCAT_INSERT_EVENT,event.getEventType());
  assertTrue(event.getMessage().matches(".*\"files\":\\[\"pfile.*"));
  event=rsp.getEvents().get(6);
  assertEquals(firstEventId + 7,event.getEventId());
  assertEquals(HCatConstants.HCAT_INSERT_EVENT,event.getEventType());
  assertTrue(event.getMessage().matches(".*\"files\":\\[\"pfile.*"));
  event=rsp.getEvents().get(9);
  assertEquals(firstEventId + 10,event.getEventId());
  assertEquals(HCatConstants.HCAT_ADD_PARTITION_EVENT,event.getEventType());
  event=rsp.getEvents().get(10);
  assertEquals(firstEventId + 11,event.getEventId());
  assertEquals(HCatConstants.HCAT_INSERT_EVENT,event.getEventType());
  assertTrue(event.getMessage().matches(".*\"files\":\\[\"pfile.*"));
  event=rsp.getEvents().get(13);
  assertEquals(firstEventId + 14,event.getEventId());
  assertEquals(HCatConstants.HCAT_INSERT_EVENT,event.getEventType());
  assertTrue(event.getMessage().matches(".*\"files\":\\[\"pfile.*"));
  event=rsp.getEvents().get(16);
  assertEquals(firstEventId + 17,event.getEventId());
  assertEquals(HCatConstants.HCAT_ADD_PARTITION_EVENT,event.getEventType());
  event=rsp.getEvents().get(18);
  assertEquals(firstEventId + 19,event.getEventId());
  assertEquals(HCatConstants.HCAT_DROP_PARTITION_EVENT,event.getEventType());
  event=rsp.getEvents().get(19);
  assertEquals(firstEventId + 20,event.getEventId());
  assertEquals(HCatConstants.HCAT_ADD_PARTITION_EVENT,event.getEventType());
  event=rsp.getEvents().get(20);
  assertEquals(firstEventId + 21,event.getEventId());
  assertEquals(HCatConstants.HCAT_ALTER_PARTITION_EVENT,event.getEventType());
  assertTrue(event.getMessage().matches(".*\"ds\":\"todaytwo\".*"));
  event=rsp.getEvents().get(21);
  assertEquals(firstEventId + 22,event.getEventId());
  assertEquals(HCatConstants.HCAT_INSERT_EVENT,event.getEventType());
  assertTrue(event.getMessage().matches(".*\"files\":\\[\\].*"));
  event=rsp.getEvents().get(22);
  assertEquals(firstEventId + 23,event.getEventId());
  assertEquals(HCatConstants.HCAT_ALTER_PARTITION_EVENT,event.getEventType());
  assertTrue(event.getMessage().matches(".*\"ds\":\"todaytwo\".*"));
  event=rsp.getEvents().get(23);
  assertEquals(firstEventId + 24,event.getEventId());
  assertEquals(HCatConstants.HCAT_ALTER_PARTITION_EVENT,event.getEventType());
  assertTrue(event.getMessage().matches(".*\"ds\":\"todaytwo\".*"));
}
