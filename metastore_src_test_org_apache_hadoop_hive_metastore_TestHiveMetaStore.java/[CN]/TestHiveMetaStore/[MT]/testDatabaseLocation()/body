{
  try {
    silentDropDatabase(TEST_DB1_NAME);
    Database db=new Database();
    db.setName(TEST_DB1_NAME);
    String dbLocation=HiveConf.getVar(hiveConf,HiveConf.ConfVars.METASTOREWAREHOUSE) + "/_testDB_create_";
    db.setLocationUri(dbLocation);
    client.createDatabase(db);
    db=client.getDatabase(TEST_DB1_NAME);
    assertEquals("name of returned db is different from that of inserted db",TEST_DB1_NAME,db.getName());
    assertEquals("location of the returned db is different from that of inserted db",warehouse.getDnsPath(new Path(dbLocation)).toString(),db.getLocationUri());
    client.dropDatabase(TEST_DB1_NAME);
    silentDropDatabase(TEST_DB1_NAME);
    db=new Database();
    db.setName(TEST_DB1_NAME);
    dbLocation=HiveConf.getVar(hiveConf,HiveConf.ConfVars.METASTOREWAREHOUSE) + "/test/_testDB_create_";
    FileSystem fs=FileSystem.get(new Path(dbLocation).toUri(),hiveConf);
    fs.mkdirs(new Path(HiveConf.getVar(hiveConf,HiveConf.ConfVars.METASTOREWAREHOUSE) + "/test"),new FsPermission((short)0));
    db.setLocationUri(dbLocation);
    boolean createFailed=false;
    try {
      client.createDatabase(db);
    }
 catch (    MetaException cantCreateDB) {
      createFailed=true;
    }
    assertTrue("Database creation succeeded even with permission problem",createFailed);
    boolean objectNotExist=false;
    try {
      client.getDatabase(TEST_DB1_NAME);
    }
 catch (    NoSuchObjectException e) {
      objectNotExist=true;
    }
    assertTrue("Database " + TEST_DB1_NAME + " exists ",objectNotExist);
    fs.setPermission(new Path(HiveConf.getVar(hiveConf,HiveConf.ConfVars.METASTOREWAREHOUSE) + "/test"),new FsPermission((short)755));
    fs.delete(new Path(HiveConf.getVar(hiveConf,HiveConf.ConfVars.METASTOREWAREHOUSE) + "/test"),true);
    db=new Database();
    db.setName(TEST_DB1_NAME);
    dbLocation=HiveConf.getVar(hiveConf,HiveConf.ConfVars.METASTOREWAREHOUSE) + "/_testDB_file_";
    fs=FileSystem.get(new Path(dbLocation).toUri(),hiveConf);
    fs.createNewFile(new Path(dbLocation));
    fs.deleteOnExit(new Path(dbLocation));
    db.setLocationUri(dbLocation);
    createFailed=false;
    try {
      client.createDatabase(db);
    }
 catch (    MetaException cantCreateDB) {
      System.err.println(cantCreateDB.getMessage());
      createFailed=true;
    }
    assertTrue("Database creation succeeded even location exists and is a file",createFailed);
    objectNotExist=false;
    try {
      client.getDatabase(TEST_DB1_NAME);
    }
 catch (    NoSuchObjectException e) {
      objectNotExist=true;
    }
    assertTrue("Database " + TEST_DB1_NAME + " exists when location is specified and is a file",objectNotExist);
  }
 catch (  Throwable e) {
    System.err.println(StringUtils.stringifyException(e));
    System.err.println("testDatabaseLocation() failed.");
    throw e;
  }
}
