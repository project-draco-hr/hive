{
  Path deletePath=null;
  Path mkDirPath=targetPath.getParent();
  if (mkDirPath != null && !fs.exists(mkDirPath)) {
    Path actualPath=mkDirPath;
    while (actualPath != null && !fs.exists(actualPath)) {
      deletePath=actualPath;
      actualPath=actualPath.getParent();
    }
    fs.mkdirs(mkDirPath);
    HadoopShims shims=ShimLoader.getHadoopShims();
    if (HiveConf.getBoolVar(conf,HiveConf.ConfVars.HIVE_WAREHOUSE_SUBDIR_INHERIT_PERMS)) {
      try {
        HadoopShims.HdfsFileStatus status=shims.getFullFileStatus(conf,fs,actualPath);
        shims.setFullFileStatus(conf,status,fs,actualPath);
      }
 catch (      Exception e) {
        LOG.warn("Error setting permissions or group of " + actualPath,e);
      }
    }
  }
  return deletePath;
}
