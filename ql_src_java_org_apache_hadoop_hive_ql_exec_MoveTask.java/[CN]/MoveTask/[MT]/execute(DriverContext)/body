{
  try {
    LoadFileDesc lfd=work.getLoadFileWork();
    if (lfd != null) {
      Path targetPath=new Path(lfd.getTargetDir());
      Path sourcePath=new Path(lfd.getSourceDir());
      FileSystem fs=sourcePath.getFileSystem(conf);
      if (lfd.getIsDfsDir()) {
        String mesg="Moving data to: " + lfd.getTargetDir();
        String mesg_detail=" from " + lfd.getSourceDir();
        console.printInfo(mesg,mesg_detail);
        fs.delete(targetPath,true);
        if (fs.exists(sourcePath)) {
          if (!fs.rename(sourcePath,targetPath)) {
            throw new HiveException("Unable to rename: " + sourcePath + " to: "+ targetPath);
          }
        }
 else         if (!fs.mkdirs(targetPath)) {
          throw new HiveException("Unable to make directory: " + targetPath);
        }
      }
 else {
        String mesg="Copying data to local directory " + lfd.getTargetDir();
        String mesg_detail=" from " + lfd.getSourceDir();
        console.printInfo(mesg,mesg_detail);
        LocalFileSystem dstFs=FileSystem.getLocal(conf);
        if (dstFs.delete(targetPath,true) || !dstFs.exists(targetPath)) {
          console.printInfo(mesg,mesg_detail);
          if (fs.exists(sourcePath)) {
            fs.copyToLocalFile(sourcePath,targetPath);
          }
 else {
            if (!dstFs.mkdirs(targetPath)) {
              throw new HiveException("Unable to make local directory: " + targetPath);
            }
          }
        }
 else {
          throw new AccessControlException("Unable to delete the existing destination directory: " + targetPath);
        }
      }
    }
    LoadTableDesc tbd=work.getLoadTableWork();
    if (tbd != null) {
      StringBuilder mesg=new StringBuilder("Loading data to table ").append(tbd.getTable().getTableName());
      if (tbd.getPartitionSpec().size() > 0) {
        mesg.append(" partition (");
        Map<String,String> partSpec=tbd.getPartitionSpec();
        for (        String key : partSpec.keySet()) {
          mesg.append(key).append('=').append(partSpec.get(key)).append(", ");
        }
        mesg.setLength(mesg.length() - 2);
        mesg.append(')');
      }
      String mesg_detail=" from " + tbd.getSourceDir();
      console.printInfo(mesg.toString(),mesg_detail);
      Table table=db.getTable(tbd.getTable().getTableName());
      if (work.getCheckFileFormat()) {
        FileStatus[] dirs;
        ArrayList<FileStatus> files;
        FileSystem fs;
        try {
          fs=FileSystem.get(table.getDataLocation(),conf);
          dirs=fs.globStatus(new Path(tbd.getSourceDir()));
          files=new ArrayList<FileStatus>();
          for (int i=0; (dirs != null && i < dirs.length); i++) {
            files.addAll(Arrays.asList(fs.listStatus(dirs[i].getPath())));
            if (files.size() > 0) {
              break;
            }
          }
        }
 catch (        IOException e) {
          throw new HiveException("addFiles: filesystem error in check phase",e);
        }
        if (HiveConf.getBoolVar(conf,HiveConf.ConfVars.HIVECHECKFILEFORMAT)) {
          boolean flag=HiveFileFormatUtils.checkInputFormat(fs,conf,tbd.getTable().getInputFileFormatClass(),files);
          if (!flag) {
            throw new HiveException("Wrong file format. Please check the file's format.");
          }
        }
      }
      DataContainer dc=null;
      if (tbd.getPartitionSpec().size() == 0) {
        dc=new DataContainer(table.getTTable());
        db.loadTable(new Path(tbd.getSourceDir()),tbd.getTable().getTableName(),tbd.getReplace(),new Path(tbd.getTmpDir()),tbd.getHoldDDLTime());
        if (work.getOutputs() != null) {
          work.getOutputs().add(new WriteEntity(table));
        }
      }
 else {
        LOG.info("Partition is: " + tbd.getPartitionSpec().toString());
        DynamicPartitionCtx dpCtx=tbd.getDPCtx();
        if (dpCtx != null && dpCtx.getNumDPCols() > 0) {
          ArrayList<LinkedHashMap<String,String>> dp=db.loadDynamicPartitions(new Path(tbd.getSourceDir()),tbd.getTable().getTableName(),tbd.getPartitionSpec(),tbd.getReplace(),new Path(tbd.getTmpDir()),dpCtx.getNumDPCols(),tbd.getHoldDDLTime());
          for (          LinkedHashMap<String,String> partSpec : dp) {
            Partition partn=db.getPartition(table,partSpec,false);
            WriteEntity enty=new WriteEntity(partn);
            if (work.getOutputs() != null) {
              work.getOutputs().add(enty);
            }
            if (queryPlan.getOutputs() == null) {
              queryPlan.setOutputs(new HashSet<WriteEntity>());
            }
            queryPlan.getOutputs().add(enty);
            dc=new DataContainer(table.getTTable(),partn.getTPartition());
            if (SessionState.get() != null) {
              SessionState.get().getLineageState().setLineage(tbd.getSourceDir(),dc,table.getCols());
            }
            console.printInfo("\tLoading partition " + partSpec);
          }
          dc=null;
        }
 else {
          db.loadPartition(new Path(tbd.getSourceDir()),tbd.getTable().getTableName(),tbd.getPartitionSpec(),tbd.getReplace(),new Path(tbd.getTmpDir()),tbd.getHoldDDLTime());
          Partition partn=db.getPartition(table,tbd.getPartitionSpec(),false);
          dc=new DataContainer(table.getTTable(),partn.getTPartition());
          if (work.getOutputs() != null) {
            work.getOutputs().add(new WriteEntity(partn));
          }
        }
      }
      if (SessionState.get() != null && dc != null) {
        SessionState.get().getLineageState().setLineage(tbd.getSourceDir(),dc,table.getCols());
      }
    }
    return 0;
  }
 catch (  Exception e) {
    console.printError("Failed with exception " + e.getMessage(),"\n" + StringUtils.stringifyException(e));
    return (1);
  }
}
