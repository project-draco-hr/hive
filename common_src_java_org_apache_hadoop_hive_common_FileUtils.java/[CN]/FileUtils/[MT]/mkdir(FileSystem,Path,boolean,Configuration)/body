{
  LOG.info("Creating directory if it doesn't exist: " + f);
  if (!inheritPerms) {
    return fs.mkdirs(f);
  }
 else {
    try {
      return fs.getFileStatus(f).isDir();
    }
 catch (    FileNotFoundException ignore) {
    }
    Path path=f;
    List<Path> pathsToSet=new ArrayList<Path>();
    while (!fs.exists(path)) {
      pathsToSet.add(path);
      path=path.getParent();
    }
    boolean success=fs.mkdirs(f);
    if (!success) {
      return false;
    }
 else {
      FsPermission parentPerm=fs.getFileStatus(path).getPermission();
      String permString=Integer.toString(parentPerm.toShort(),8);
      for (      Path pathToSet : pathsToSet) {
        LOG.info("Setting permission of parent directory: " + path.toString() + " on new directory: "+ pathToSet.toString());
        try {
          FsShell fshell=new FsShell();
          fshell.setConf(conf);
          fshell.run(new String[]{"-chmod","-R",permString,pathToSet.toString()});
        }
 catch (        Exception e) {
          LOG.warn("Error setting permissions of " + pathToSet,e);
        }
      }
      return true;
    }
  }
}
