{
  LOG.info("Creating directory if it doesn't exist: " + f);
  if (!inheritPerms) {
    return fs.mkdirs(f);
  }
 else {
    try {
      return fs.getFileStatus(f).isDir();
    }
 catch (    FileNotFoundException ignore) {
    }
    Path lastExistingParent=f;
    Path firstNonExistentParent=null;
    while (!fs.exists(lastExistingParent)) {
      firstNonExistentParent=lastExistingParent;
      lastExistingParent=lastExistingParent.getParent();
    }
    boolean success=fs.mkdirs(f);
    if (!success) {
      return false;
    }
 else {
      HadoopShims shim=ShimLoader.getHadoopShims();
      HdfsFileStatus fullFileStatus=shim.getFullFileStatus(conf,fs,lastExistingParent);
      try {
        shim.setFullFileStatus(conf,fullFileStatus,fs,firstNonExistentParent);
      }
 catch (      Exception e) {
        LOG.warn("Error setting permissions of " + firstNonExistentParent,e);
      }
      return true;
    }
  }
}
