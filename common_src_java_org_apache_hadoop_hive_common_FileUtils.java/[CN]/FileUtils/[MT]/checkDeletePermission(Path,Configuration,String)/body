{
  if (path == null) {
    return;
  }
  final FileSystem fs=path.getFileSystem(conf);
  FileStatus stat=null;
  try {
    stat=fs.getFileStatus(path);
  }
 catch (  FileNotFoundException e) {
  }
  if (stat == null) {
    return;
  }
  FileUtils.checkFileAccessWithImpersonation(fs,stat,FsAction.WRITE,user);
  HadoopShims shims=ShimLoader.getHadoopShims();
  if (!shims.supportStickyBit()) {
    return;
  }
  FileStatus parStatus=fs.getFileStatus(path.getParent());
  if (!shims.hasStickyBit(parStatus.getPermission())) {
    return;
  }
  if (parStatus.getOwner().equals(user)) {
    return;
  }
  FileStatus childStatus=fs.getFileStatus(path);
  if (childStatus.getOwner().equals(user)) {
    return;
  }
  String msg=String.format("Permission Denied: User %s can't delete %s because sticky bit is" + " set on the parent dir and user does not own this file or its parent",user,path);
  throw new IOException(msg);
}
