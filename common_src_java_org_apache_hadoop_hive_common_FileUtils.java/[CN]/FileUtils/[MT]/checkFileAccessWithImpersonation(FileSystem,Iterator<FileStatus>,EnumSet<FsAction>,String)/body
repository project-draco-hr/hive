{
  UserGroupInformation ugi=Utils.getUGI();
  String currentUser=ugi.getShortUserName();
  if (user == null || currentUser.equals(user)) {
    ShimLoader.getHadoopShims().checkFileAccess(fs,statuses,actions);
  }
 else {
    UserGroupInformation proxyUser=UserGroupInformation.createProxyUser(user,UserGroupInformation.getLoginUser());
    proxyUser.doAs(new PrivilegedExceptionAction<Object>(){
      @Override public Object run() throws Exception {
        FileSystem fsAsUser=FileSystem.get(fs.getUri(),fs.getConf());
        ShimLoader.getHadoopShims().checkFileAccess(fsAsUser,statuses,actions);
        return null;
      }
    }
);
  }
}
