{
  String historyDirectory=System.getProperty("user.home");
  if ((new File(historyDirectory)).exists()) {
    File historyFile=new File(historyDirectory + File.separator + ".hivehistory");
    historyFile.delete();
  }
  HiveConf configuration=new HiveConf();
  configuration.setBoolVar(ConfVars.HIVE_SESSION_HISTORY_ENABLED,true);
  PrintStream oldOut=System.out;
  ByteArrayOutputStream dataOut=new ByteArrayOutputStream();
  System.setOut(new PrintStream(dataOut));
  PrintStream oldErr=System.err;
  ByteArrayOutputStream dataErr=new ByteArrayOutputStream();
  System.setErr(new PrintStream(dataErr));
  CliSessionState ss=new CliSessionState(configuration);
  CliSessionState.start(ss);
  String[] args={};
  try {
    new FakeCliDriver().run(args);
    assertTrue(dataOut.toString(),dataOut.toString().contains("test message"));
    assertTrue(dataErr.toString(),dataErr.toString().contains("Hive history file="));
    assertTrue(dataErr.toString(),dataErr.toString().contains("File: fakeFile is not a file."));
    dataOut.reset();
    dataErr.reset();
  }
  finally {
    System.setOut(oldOut);
    System.setErr(oldErr);
  }
}
