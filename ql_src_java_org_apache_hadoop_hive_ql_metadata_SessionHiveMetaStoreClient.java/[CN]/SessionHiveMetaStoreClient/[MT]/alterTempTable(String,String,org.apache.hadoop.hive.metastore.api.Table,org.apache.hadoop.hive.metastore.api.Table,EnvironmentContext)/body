{
  Table newTable=new Table(deepCopyAndLowerCaseTable(newt));
  dbname=dbname.toLowerCase();
  tbl_name=tbl_name.toLowerCase();
  if (!newt.getSd().getLocation().equals(oldt.getSd().getLocation())) {
    throw new MetaException("Temp table location cannot be changed");
  }
  String newDbName=newTable.getDbName();
  String newTableName=newTable.getTableName();
  if (!newDbName.equals(oldt.getDbName()) || !newTableName.equals(oldt.getTableName())) {
    if (getTempTable(newDbName,newTableName) != null) {
      throw new MetaException("Cannot rename temporary table to " + newTableName + " - temporary table already exists with the same name");
    }
    Map<String,Table> tables=getTempTablesForDatabase(dbname);
    if (tables == null || tables.remove(tbl_name) == null) {
      throw new MetaException("Could not find temp table entry for " + dbname + "."+ tbl_name);
    }
    tables=getTempTablesForDatabase(newDbName);
    if (tables == null) {
      tables=new HashMap<String,Table>();
      SessionState.get().getTempTables().put(newDbName,tables);
    }
    tables.put(newTableName,newTable);
  }
 else {
    getTempTablesForDatabase(dbname).put(tbl_name,newTable);
  }
}
