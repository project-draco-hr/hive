{
  HttpClient client=HttpClientInit.createClient(HttpClientConfig.builder().build(),new Lifecycle());
  InputStream response;
  try {
    response=DruidStorageHandlerUtils.submitRequest(client,DruidStorageHandlerUtils.createRequest(address,query));
  }
 catch (  Exception e) {
    throw new SerDeException(StringUtils.stringifyException(e));
  }
  List<SegmentAnalysis> resultsList;
  try {
    resultsList=DruidStorageHandlerUtils.SMILE_MAPPER.readValue(response,new TypeReference<List<SegmentAnalysis>>(){
    }
);
  }
 catch (  Exception e) {
    response.close();
    throw new SerDeException(StringUtils.stringifyException(e));
  }
  if (resultsList == null || resultsList.isEmpty()) {
    throw new SerDeException("Connected to Druid but could not retrieve datasource information");
  }
  if (resultsList.size() != 1) {
    throw new SerDeException("Information about segments should have been merged");
  }
  return resultsList.get(0);
}
