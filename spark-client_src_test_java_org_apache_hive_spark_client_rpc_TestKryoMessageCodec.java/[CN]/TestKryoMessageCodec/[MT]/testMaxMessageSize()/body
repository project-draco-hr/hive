{
  KryoMessageCodec codec=new KryoMessageCodec(1024);
  ByteBuf buf=newBuffer();
  codec.encode(null,new TestMessage(new byte[512]),buf);
  try {
    codec.encode(null,new TestMessage(new byte[1025]),buf);
    fail("Should have failed to encode large message.");
  }
 catch (  IllegalArgumentException e) {
    assertTrue(e.getMessage().indexOf("maximum allowed size") > 0);
  }
  KryoMessageCodec unlimited=new KryoMessageCodec(0);
  buf=newBuffer();
  unlimited.encode(null,new TestMessage(new byte[1025]),buf);
  try {
    List<Object> out=Lists.newArrayList();
    codec.decode(null,buf,out);
    fail("Should have failed to decode large message.");
  }
 catch (  IllegalArgumentException e) {
    assertTrue(e.getMessage().indexOf("maximum allowed size") > 0);
  }
}
